import{a as P,b as B,Q,c as x}from"./utiFunc.5f90a045.js";import{j as z,q as S,s as v,c as D,h as F,k as R,g as j,u as K,x as U,_ as W,d as L,r as C,E as q,F as i,G as b,H as r,I as d,K as n,M as h,N as H,O as _,Q as T,P as O,R as w,S as A,U as E,V as g,W as G,J as k,X as J,Y as X}from"./index.3e746479.js";import{N as Y,t as Z,p as ee,a as y,b as I,c as $,i as V,Q as te}from"./NavigationBar.f4f20197.js";import{u as ae,Q as se}from"./goalStorage.2fa30136.js";import{Q as oe}from"./QCalendar.a0c74f53.js";import"./use-quasar.ae4e9323.js";var le=z({name:"QPage",props:{padding:Boolean,styleFn:Function},setup(e,{slots:t}){const{proxy:{$q:a}}=j(),o=S(K,v);if(o===v)return console.error("QPage needs to be a deep child of QLayout"),v;if(S(U,v)===v)return console.error("QPage needs to be child of QPageContainer"),v;const u=D(()=>{const p=(o.header.space===!0?o.header.size:0)+(o.footer.space===!0?o.footer.size:0);if(typeof e.styleFn=="function"){const s=o.isContainer.value===!0?o.containerHeight.value:a.screen.height;return e.styleFn(p,s)}return{minHeight:o.isContainer.value===!0?o.containerHeight.value-p+"px":a.screen.height===0?p!==0?`calc(100vh - ${p}px)`:"100vh":a.screen.height-p+"px"}}),m=D(()=>`q-page${e.padding===!0?" q-layout-padding":""}`);return()=>F("main",{class:m.value,style:u.value},R(t.default))}});const ne=L({name:"weekCalendar",components:{NavigationBar:Y,QCalendar:oe},data(){return{store:ae(),calendar:C(null),currentDate:C(Z()),events:[],mostEvts:5,treeGoals:C([]),expanded:C([]),splitterModel:C(70)}},beforeMount(){this.loadEvts(),this.constructTree()},mounted(){console.log("mounted")},computed:{storedGoalsMap(){const e=new Map;let t=this.store.getSubGoals;return t?(t.forEach(a=>{e.set(a.id,a)}),e):(console.log("GoalsMap is empty or null",t),e)},allEvents(){return this.store.getAllDates},parentGoalsMap(){const e=new Map;let t=this.store.getMainGoals;return t?(t.forEach(a=>{e.set(a.id,a)}),e):(console.log("parentGoalsMap is empty or null",t),e)},storedEvents(){return this.store.getSubGoals},eventsMap(){const e={};return this.events.forEach(t=>{if(e[t.date]||(e[t.date]=[]),e[t.date].push(t),t.days){console.log(`eventsMap multiple days? event for ${t.date}`,t.days);let a=ee(t.date),o=t.days;do a=y(a,{day:1}),e[a.date]||(e[a.date]=[]),e[a.date].push(t);while(--o>0)}}),e}},methods:{classyColor(e){return`row items-center ${e.isChildren?"text-":"text-white bg-"}${e.color} `},loadEvts(){let e=this.parentGoalsMap,t=this.storedGoalsMap,a=this.allEvents;if(t&&e){if(a)for(let o in a){let c=a[o];for(let u in c){let m=t.get(parseInt(u));if(m){let p=e.get(m.parentGoal),s=y($(o),{minute:I(c[u].time)}),l=y(s,{minute:parseInt(c[u].duration)});this.events.push({id:m.id,title:m.title,details:`${s.time} - ${l.time}`,time:c[u].time,duration:c[u].duration,date:o,bgcolor:p.bgcolor})}}}}else{console.log("ERROR--no parent or goals!!REVIEW**");return}},constructTree(){this.treeGoals=this.store.fetchGoalsTree()},getEvents(e){const t=this.eventsMap[e]||[];if(t.length===1)t[0].side="full";else if(t.length===2){const a=y($(t[0].date),{minute:I(t[0].time)}),o=y(a,{minute:t[0].duration}),c=y($(t[1].date),{minute:I(t[1].time)}),u=y(c,{minute:t[1].duration});V(c,a,o,!0)||V(u,a,o,!0)?(t[0].side="left",t[1].side="right"):(t[0].side="full",t[1].side="full")}return t.length>this.mostEvts&&(this.mostEvts=t.length),t},badgeClasses(e,t){return P(e,t)},badgeStyles(e,t,a=void 0,o=void 0){return B(e,t,a,o)},scrollToEvent(e){this.$refs.calendar.scrollToTime(e.time,350)},onToday(){this.$refs.calendar.moveToToday()},onPrev(){this.doReset=!0,this.$refs.calendar.prev()},onNext(){this.$refs.calendar.next()},onClickDate(e){console.log("onClickDate",e)},onClickTime(e){console.log("onClickTime",e)},onClickInterval(e){console.log("onClickInterval",e)},onClickHeadIntervals(e){console.log("onClickHeadIntervals",e)},onClickHeadDay(e){console.log("onClickHeadDay",e)},onChange(e){this.mostEvts=5,console.log("onChange",e)}}}),N=e=>(J("data-v-58f9e526"),e=e(),X(),e),ie={class:"q-pa-md"},re={class:"row justify-center"},de={style:{display:"flex","max-width":"800px",width:"100%",height:"400px",overflow:"auto"}},ce={style:{display:"flex","justify-content":"center","flex-wrap":"wrap",padding:"2px"}},ue={class:"title q-calendar__ellipsis"},pe={class:"title q-calendar__ellipsis"},me={class:"row justify-center items-center"},he={class:"q-pa-md"},ge={key:0,class:"q-pa-md bg-grey-12",style:{"max-width":"400px"}},ye=N(()=>n("div",{class:"row justify-center"}," Goals & Goal Events ",-1)),fe=N(()=>n("br",null,null,-1)),ve={class:"q-mr-sm text-weight-bold",size:"28px"},Ce={key:0},ke={class:"text-weight-bold"},be={key:1,class:"text-weight-light text-black"};function _e(e,t,a,o,c,u){const m=q("navigation-bar"),p=q("q-calendar");return i(),b(le,null,{default:r(()=>[d(se,{modelValue:e.splitterModel,"onUpdate:modelValue":t[2]||(t[2]=s=>e.splitterModel=s),limits:[50,100],style:{height:"600px"}},{before:r(()=>[n("div",ie,[d(m,{onToday:e.onToday,onPrev:e.onPrev,onNext:e.onNext},null,8,["onToday","onPrev","onNext"]),n("div",re,[n("div",de,[d(p,{ref:"calendar",modelValue:e.currentDate,"onUpdate:modelValue":t[0]||(t[0]=s=>e.currentDate=s),view:"week",dark:"",animated:"",hoverable:"",bordered:"","transition-prev":"slide-right","transition-next":"slide-left","no-active-date":"","interval-minutes":30,"interval-count":48,"interval-height":e.mostEvts*3,onChange:e.onChange,onClickDate:e.onClickDate,onClickTime:e.onClickTime,onClickInterval:e.onClickInterval,onClickHeadIntervals:e.onClickHeadIntervals,onClickHeadDay:e.onClickHeadDay},{"head-day-event":r(({scope:{timestamp:s}})=>[n("div",ce,[(i(!0),h(_,null,H(e.eventsMap[s.date],l=>(i(),h(_,{key:l.id},[l.time?(i(),b(Q,{key:1,class:w(e.badgeClasses(l,"header")),style:G([e.badgeStyles(l,"header"),{margin:"1px",width:"10px","max-width":"10px",height:"10px","max-height":"10px",cursor:"pointer"}]),onClick:M=>e.scrollToEvent(l)},{default:r(()=>[d(x,null,{default:r(()=>[k(g(l.time+" - "+l.title),1)]),_:2},1024)]),_:2},1032,["class","style","onClick"])):(i(),b(Q,{key:0,class:w(e.badgeClasses(l,"header")),style:G([e.badgeStyles(l,"header"),{width:"100%",cursor:"pointer",height:"12px","font-size":"10px",margin:"1px"}])},{default:r(()=>[n("div",ue,[k(g(l.title)+" ",1),d(x,null,{default:r(()=>[k(g(l.details),1)]),_:2},1024)])]),_:2},1032,["class","style"]))],64))),128))])]),"day-body":r(({scope:{timestamp:s,timeStartPos:l,timeDurationHeight:M}})=>[(i(!0),h(_,null,H(e.getEvents(s.date),f=>(i(),h(_,{key:f.id},[f.time!==void 0?(i(),h("div",{key:0,class:w(["my-event",e.badgeClasses(f,"body")]),style:G(e.badgeStyles(f,"body",l,M))},[n("span",pe,[k(g(f.title)+" ",1),d(x,null,{default:r(()=>[k(g(f.details),1)]),_:2},1024)])],6)):E("",!0)],64))),128))]),_:1},8,["modelValue","interval-height","onChange","onClickDate","onClickTime","onClickInterval","onClickHeadIntervals","onClickHeadDay"])])]),n("div",me,[d(T,{class:"q-ma-xl",color:"white","text-color":"blue",unelevated:"",to:"/summary",label:"Summary","no-caps":""}),d(T,{class:"q-ma-xl",color:"white","text-color":"blue",unelevated:"",to:"/dayCalendar",label:"Daily Calendar","no-caps":""}),d(T,{class:"q-ma-xl",color:"white","text-color":"blue",unelevated:"",to:"/viewGoals",label:"Goals","no-caps":""})])])]),after:r(()=>[n("div",he,[e.treeGoals.length>0?(i(),h("div",ge,[ye,d(O),fe,d(te,{nodes:e.treeGoals,"node-key":"label",expanded:e.expanded,"onUpdate:expanded":t[1]||(t[1]=s=>e.expanded=s),"no-connectors":"",dense:"",accordion:""},{"default-header":r(s=>[n("div",{class:w(e.classyColor(s.node))},[s.node.isChildren?E("",!0):(i(),b(A,{key:0,name:s.node.icon||s.expanded?"expand_less":"expand_more",size:"28px",class:"q-mr-sm"},null,8,["name"])),n("div",ve,g(s.node.label),1)],2)]),"default-body":r(s=>[s.node.isChildren?(i(),h("div",Ce,[n("span",ke," >> "+g(s.node.details),1)])):(i(),h("span",be,g(s.node.details),1))]),_:1},8,["nodes","expanded"])])):E("",!0)])]),_:1},8,["modelValue"])]),_:1})}var $e=W(ne,[["render",_e],["__scopeId","data-v-58f9e526"]]);export{$e as default};
