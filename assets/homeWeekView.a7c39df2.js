import{F as Z,a1 as ee,r as N,N as U,G as g,H as q,I as y,O as p,J as c,R as T,S as W,U as L,a2 as te,a3 as Q,Q as F,K as B,M as O,a4 as P,L as w,a5 as V,_ as se,a6 as H}from"./index.72713afa.js";import{u as oe,a as ae,Q as ie,b as z,c as le}from"./goalStorage.137e3a63.js";import{Q as Y}from"./QBadge.a5717ac3.js";import{i as ne,Q as re}from"./isMobile.f7350aab.js";import{Q as de}from"./index.392a35c9.js";import{t as he,F as ce,a as k,p as M,b as K,N as X,O as ue,P as G,S as j}from"./QCalendarTask.bf436935.js";import{a as me,b as ye}from"./utiFunc.12687b08.js";import{N as D}from"./actions.078eaba7.js";const fe={name:"weekCalendar",components:{NavigationBar:ee(()=>se(()=>import("./NavigationBar.5d981950.js"),["assets/NavigationBar.5d981950.js","assets/NavigationBar.bf3d18d0.css","assets/index.72713afa.js","assets/index.f80becc5.css"])),QCalendar:de},data(){return oe(),{store:ae(),calendar:N(null),currentDate:N(he()),events:[],treeGoals:N([]),expanded:N([]),showTree:N(!1),moods:N({}),mobile:N(!1),todayEvts:N({}),mostEvts:N(5),intervalMins:N(15),intervals:N(48),earliestStart:N(0),testEarliest:N(null)}},beforeMount(){this.mobile=ne(),this.loadEvts(),this.constructTree()},mounted(){console.log("mounted"),this.dayNotifData()},computed:{storedGoalsMap(){const t=new Map;let e=this.store.getSubGoals;return e?(e.forEach(s=>{t.set(s.id,s)}),t):(console.log("GoalsMap is empty or null",e),t)},label(){return this.showTree?"Hide Legend":"Show Legend"},allEvents(){return this.store.getAllDates},parentGoalsMap(){const t=new Map;let e=this.store.getMainGoals;return e?(e.forEach(s=>{t.set(s.id,s)}),t):(console.log("parentGoalsMap is empty or null",e),t)},eventsMap(){const t={};return this.events.forEach(e=>{if(t[e.date]||(t[e.date]=[]),t[e.date].push(e),e.days){console.log(`eventsMap multiple days? event for ${e.date}`,e.days);let s=ce(e.date),r=e.days;do s=k(s,{day:1}),t[s.date]||(t[s.date]=[]),t[s.date].push(e);while(--r>0)}}),t}},methods:{reload(){this.loadEvts(!0)},loadEvts(t=!1){var h,n,d,u;let e=this.parentGoalsMap,s=this.storedGoalsMap,r=this.store.getAllDates;if(s&&e){if(r){t&&(this.events=[],this.moods={});for(let a in r){let o=r[a];a==this.currentDate&&(this.todayEvts=o);for(let l in o){let i=s.get(parseInt(l));if(i){let m=e.get(i.parentGoal),S=k(K(a),{minute:M(o[l].time)}),x=k(S,{minute:parseInt(o[l].duration)}),f="";o[l].notes!==void 0&&((h=o[l])==null?void 0:h.notes)!==""?f=[`${S.time} - ${x.time}`,`${(d=(n=o[l])==null?void 0:n.atScore)!=null?d:""} >> ${i.score}`,`${(u=o[l])==null?void 0:u.notes}`].join(`
\r`):f=`${S.time} - ${x.time}`,o[l].byMood!==void 0&&(this.moods[a]||(this.moods[a]=[]),this.moods[a].push(...o[l].byMood)),this.testEarliest||(console.log(`loadEvts::testEarliest>> ${i.id}: `+i.title,JSON.stringify(a),JSON.stringify(S.time)),this.testEarliest=S),this.events.push({id:i.id,title:i.title,details:f,time:o[l].time,duration:o[l].duration,date:a,bgcolor:m.bgcolor,sortTime:S})}}}}}else{console.log("ERROR--no parent or goals!!REVIEW**");return}},dayNotifData(){if(this.mobile){if(console.log("dayNotifData",JSON.stringify(this.todayEvts)),Object.keys(this.todayEvts).length<1)return;D.hasStoredKey().then(t=>{console.log("hasStoredKey>>",JSON.stringify(t));let e=[],s=!1;for(let r in t)t[r]&&(e.push([r,t[r]]),s=r=="start"||r=="end"?t[r]:s);if(e.length<1){console.log("hasStoredKey>>NO KEY",e,s);return}return console.log("hasStoredKey>>has KEY",e,s),this.fetchStoredKeys(e,s)})}},fetchStoredKeys(t,e){let s=this.storedGoalsMap,r=()=>{D.getSkippedNotifs({date:this.currentDate}).then(d=>{var a,o;console.log("getSkippedNotifs>>",JSON.stringify(d));let u=d.skipped;if(Array.isArray(u)&&u.length>0)if(Object.keys(this.todayEvts).length>0){console.log("WoooResults>> ",JSON.stringify(u));let l=[];for(let i of u)i in this.todayEvts?(delete this.todayEvts[i],l.push((o=(a=s.get(parseInt(i)))==null?void 0:a.title)!=null?o:""),console.log("dayNotifData::deleteSkipped>> "+i,JSON.stringify(l))):console.log("dayNotifData::Skipped NOT FOUND?!? "+i,JSON.stringify(l));this.store.saveDailySchedule(this.currentDate,this.todayEvts),l.forEach(i=>{this.$q.notify({color:"warning",position:"top",message:`'${i}' Was Skipped!`,caption:`Removed from ${this.currentDate} Schedule`,icon:"thumb_down",timeout:u.length>1?2e3:3e3,multiLine:!0})}),D.clearStoreKey({key:"skip"}).then(i=>{console.log("dayNotifData::clearSkipKey",JSON.stringify(i))})}else console.log("ERROR::Skipped::storage mismatch",u.length),D.clearStoreKey({key:"skip"}).then(l=>{console.log("Skip key cleared!!")})}).catch(d=>{console.log("dayNotifData::getSkippedNotifs>>ERROR",d)})},h=()=>{D.getNotes().then(d=>{var u,a;if("notes"in d){let o=d.notes;const l=[];if(Array.isArray(o)){let i=[];for(let m of o)if(m.id in this.todayEvts){let S=Object.assign({},{...this.todayEvts[m.id],notes:m.note});this.todayEvts[m.id]=S,i.push(`'${(a=(u=s.get(parseInt(m.id)))==null?void 0:u.title)!=null?a:""}'`),l.push(m.id)}else console.log("getNotes>>ERROR note Evts not found "+m.id,JSON.stringify(m));i.length>0?this.store.saveDailySchedule(this.currentDate,this.todayEvts):console.log("getNotes>>No new Notes..Skip saveSchedule",i),this.$q.notify({color:"positive",position:"top",message:`${i.join()} Evts had notes added!!`,icon:"thumb_up",timeout:i.length>1?5e3:3e3,multiLine:!0,closeBtn:i.length>1?"Okey":null})}else{console.log("getNotes>>ERROR not array",JSON.stringify(o),Array.isArray(o));return}D.clearStoreKey({key:"notey",ids:l}).then(i=>{console.log("dayNotifData::clearNoteKey",JSON.stringify(i)),l.length>0?this.reload():console.log("dayNotifData::clearNoteKey>>no reload",l)})}})},n=()=>{D.getStartEndTimes().then(d=>{var u,a;if("started"in d&&"ended"in d){let o=d.started,l=d.ended;if(!(Array.isArray(o)&&Array.isArray(l))){console.log("getStartEndTimes>>ERROR::not arrays?!?",o,l);return}if(Object.keys(this.todayEvts).length<1&&(o.length>0||l.length>0)){console.log("ERROR::getStartEndTimes >>storage mismatch--CLEARING KEYS!!"),D.clearStoreKey({key:"start",ids:[]}).then(m=>{console.log("dayNotifData::clearStoreKey>>Start",JSON.stringify(m))}).then(()=>{console.log("dayNotifData::clearStoreKey>>End"),D.clearStoreKey({key:"end",ids:[]})});return}if(o.length>0||l.length>0){let m=[],S=[],x=[];console.log("getStartEndTimes::",JSON.stringify(o),"ended>> "+JSON.stringify(l));for(let f in this.todayEvts){let E=o.find(v=>v.id==f),_=l.find(v=>v.id==f),b=this.todayEvts[f];if(E&&_){let v=G(new Date(E.startedAt)),R=G(new Date(_.endedAt)),C=k(K(this.currentDate),{minute:M(b.time)}),J=Math.floor(j(C,v)/1e3/60),A=Math.ceil((_.endedAt-E.startedAt)/1e3/60);if(console.log(`getStartEndTimes>> ${E.id} was saved at ${C.time} for ${b.duration}`),console.log("Actually startedAt and endedAt: "+v.time+" > "+R.time,"startDiff of "+J," with actualDura: "+A),J>=3||A>b.duration){let I=v.time,$=Object.assign({},{...b,time:I,duration:A});console.log("getStartEndTimes::Setting Started>> "+f,JSON.stringify($)),this.todayEvts[f]=$,x.push([`'${(a=(u=s.get(parseInt(E.id)))==null?void 0:u.title)!=null?a:""}' was modified!`,`Start time: ${I} with duration: ${A}`])}m.push(E.id),S.push(_.id)}else if(E){console.log("dayNotifData::getStartEndTimes::Evt only IN START?!? "+f,JSON.stringify(E));let v=G(new Date(E.startedAt)),R=k(K(this.currentDate),{minute:M(b.time)}),C=k(R,{minute:parseInt(b.duration)}),J=Math.floor(j(R,v)/1e3/60),A=k(G(new Date),{minute:0}),I=Math.floor(j(C,A)/1e3/60),$=parseInt(b.duration)*2+J;($<I||b.notes)&&(console.log("getStartEndTimes::IN START ERASE "+f,v.time,"vs "+R.time,J,"till "+C.time,I,"> than "+$,b.notes),m.push(E.id))}else if(_){let v=k(K(this.currentDate),{minute:M(b.time)}),R=G(new Date(_.endedAt)),C=Math.floor(j(v,R)/1e3/60);console.log("dayNotifData::getStartEndTimes::Evt only IN END?! "+f,"dura as "+b.duration,C,JSON.stringify(_),v.time,R.time),S.push(_.id)}}x.length>0&&this.store.saveDailySchedule(this.currentDate,this.todayEvts),x.forEach(f=>{var E,_;this.$q.notify({color:"warning",position:"top",message:(E=f[0])!=null?E:"",caption:(_=f[1])!=null?_:"",icon:"tag_faces",timeout:x.length>0?0:3e3,multiLine:!0,closeBtn:x.length>0?"Ouii":null})}),m.length>0&&D.clearStoreKey({key:"start",ids:m}),S.length>0&&D.clearStoreKey({key:"end",ids:S}),x.length>0?this.reload():console.log("getStartEndTimes::No reload needed")}}else console.log("dayNotifData::getStartEndTimes::ERROR? no Start or End in response",JSON.stringify(d))})};for(let d of t)switch(d[0]){case"skip":r();break;case"notey":h();break;case"start":console.log("fetchStoredKeys::got Start",d,e);break;case"end":console.log("fetchStoredKeys::got End",d,e);break;default:console.log("ERROR::fetchStoredKeys::UNKNOWN?!?",d,e)}e?n():console.log("fetchStoredKeys::NoStartEnd?!?",t,e)},constructTree(){this.treeGoals=this.store.fetchGoalsTree()},getEvents(t){let e=(r,h)=>{let n=j(r.sortTime,h.sortTime);if(n>0)return-1;if(n==0)return 0;if(n<0)return 1};const s=this.eventsMap[t]||[];if(s.length===1)s[0].side="full";else if(s.length===2){const r=k(K(s[0].date),{minute:M(s[0].time)}),h=k(r,{minute:s[0].duration}),n=k(K(s[1].date),{minute:M(s[1].time)}),d=k(n,{minute:s[1].duration});X(n,r,h,!0)||X(d,r,h,!0)?(s[0].side="left",s[1].side="right"):(s[0].side="full",s[1].side="full")}return s.length>this.mostEvts&&(console.log(`getEvents hiiigh ${t}`,s.length,this.mobile),this.mostEvts=this.mobile?s.length+5:s.length),s.sort(e),s},isEarlier(t){var r;let e=this.getTimeyNumber(t),s=this.getTimeyNumber(this.testEarliest);console.log(`isEarlier::testEarliest>> ${(r=t==null?void 0:t.time)!=null?r:"EMPTY"}: ${this.testEarliest.time}`,JSON.stringify(e),JSON.stringify(s))},getTimeyNumber(t){return t!==null?ue(t):!1},classyColor(t){return`row items-center ${t.isChildren?"text-":"text-white bg-"}${t.color} `},badgeClasses(t,e){return me(t,e)},badgeStyles(t,e,s=void 0,r=void 0){return ye(t,e,s,r)},scrollToEvent(t){this.$refs.calendar.scrollToTime(t.time,350)},scrollToCurrent(){let t=G(new Date);console.log("scrollToCurrent",t.time,this.$refs.calendar?"yes":"no"),this.$refs.calendar.scrollToTime(t.time,500)},onToday(){this.$refs.calendar.moveToToday()},onPrev(){this.$refs.calendar.prev()},onNext(){this.$refs.calendar.next()},onClickHeadDay({scope:t,event:e}){var n,d;let s=t.timestamp.date,r=this.moods[s],h=(d=(n=this.eventsMap[s])==null?void 0:n.length)!=null?d:0;r?this.$q.notify({color:"positive",position:"top",message:`${h} Scheduled with Moods: ${r.join()}`,icon:"tag_faces",multiLine:!0,timeout:3e3}):this.$q.notify({color:"white",textColor:"black",position:"top",message:h>0?`${h} Scheduled without Any Mood!`:"Empty and NO mood!!",icon:h>0?"mood":"sentiment_neutral",iconColor:h>0?"positive":"red",multiLine:!0,timeout:3e3})},onChange(t){this.mostEvts=5}}},ge={class:"q-px-md"},pe={class:"row justify-center"},Se={class:"q-px-md",style:{display:"flex","max-width":"800px",width:"100%",height:"500px"}},Ee={style:{display:"flex","justify-content":"center","flex-wrap":"wrap",padding:"2px"}},ve={class:"title q-calendar__ellipsis"},Ne={class:"title q-calendar__ellipsis"},ke={class:"lineyy"},_e={key:0,class:"q-pa-md"},be={key:0,class:"q-pa-md bg-grey-12",style:{"max-width":"400px"}},De={class:"q-mr-sm text-weight-bold",size:"28px"},Te={key:0},we={class:"text-weight-bold liney"},xe={key:1,class:"text-weight-light text-black liney"},Oe={key:1,class:"column justify-center items-center"};function Re(t,e,s,r,h,n){const d=U("navigation-bar"),u=U("q-calendar");return g(),q(ie,{padding:""},{default:y(()=>[p("div",ge,[c(d,{onToday:n.onToday,onPrev:n.onPrev,onNext:n.onNext},null,8,["onToday","onPrev","onNext"]),e[3]||(e[3]=p("i",{class:"row justify-center q-pa-sm"},"Click on Day header for that day's Moods ",-1)),p("div",pe,[p("div",Se,[c(u,{ref:"calendar",modelValue:h.currentDate,"onUpdate:modelValue":e[0]||(e[0]=a=>h.currentDate=a),view:"week",dark:"",animated:"",hoverable:"",bordered:"","transition-prev":"slide-right","transition-next":"slide-left","no-active-date":"","interval-minutes":15,"interval-count":96,"interval-height":28,onChange:n.onChange,onClickHeadDay:n.onClickHeadDay},{"head-day-event":y(({scope:{timestamp:a}})=>[p("div",Ee,[(g(!0),T(L,null,W(n.eventsMap[a.date],o=>(g(),T(L,{key:o.id},[o.time?(g(),q(Y,{key:1,class:P(n.badgeClasses(o,"header")),style:H([n.badgeStyles(o,"header"),{margin:"1px",width:"10px","max-width":"10px",height:"10px","max-height":"10px",cursor:"pointer"}]),onClick:l=>n.scrollToEvent(o)},{default:y(()=>[c(z,null,{default:y(()=>[w(O(o.time+" - "+o.title),1)]),_:2},1024)]),_:2},1032,["class","style","onClick"])):(g(),q(Y,{key:0,class:P(n.badgeClasses(o,"header")),style:H([n.badgeStyles(o,"header"),{width:"100%",cursor:"pointer",height:"12px","font-size":"10px",margin:"1px"}])},{default:y(()=>[p("div",ve,[w(O(o.title)+" ",1),c(z,null,{default:y(()=>[w(O(o.details),1)]),_:2},1024)])]),_:2},1032,["class","style"]))],64))),128))])]),"day-body":y(({scope:{timestamp:a,timeStartPos:o,timeDurationHeight:l}})=>[(g(!0),T(L,null,W(n.getEvents(a.date),i=>(g(),T(L,{key:i.id},[i.time!==void 0?(g(),T("div",{key:0,class:P(["my-event",n.badgeClasses(i,"body")]),style:H(n.badgeStyles(i,"body",o,l))},[p("span",Ne,[w(O(i.title)+" ",1),c(z,null,{default:y(()=>[p("div",ke,O(i.details),1)]),_:2},1024)])],6)):B("",!0)],64))),128))]),_:1},8,["modelValue","onChange","onClickHeadDay"])])])]),c(te,{modelValue:h.showTree,"onUpdate:modelValue":e[1]||(e[1]=a=>h.showTree=a),label:n.label,color:"teal",class:"q-pa-md"},null,8,["modelValue","label"]),c(le,null,{default:y(()=>[h.showTree?(g(),T("div",_e,[h.treeGoals.length>0?(g(),T("div",be,[e[4]||(e[4]=p("div",{class:"row justify-center"}," Goals & Goal Events ",-1)),c(Q),e[5]||(e[5]=p("br",null,null,-1)),c(re,{nodes:h.treeGoals,"node-key":"label",expanded:h.expanded,"onUpdate:expanded":e[2]||(e[2]=a=>h.expanded=a),"no-connectors":"",dense:"",accordion:""},{"default-header":y(a=>[p("div",{class:P(n.classyColor(a.node))},[a.node.isChildren?B("",!0):(g(),q(F,{key:0,name:a.expanded?"expand_less":"expand_more",size:"28px",class:"q-mr-sm"},null,8,["name"])),p("div",De,O(a.node.label),1),c(F,{name:a.node.icon},null,8,["name"])],2)]),"default-body":y(a=>[a.node.isChildren?(g(),T("div",Te,[p("span",we," >> "+O(a.node.details),1),a.node.moods.length>0?(g(),q(z,{key:0},{default:y(()=>[w(O("Moods::> "+a.node.moods.join(",")),1)]),_:2},1024)):B("",!0)])):(g(),T("span",xe,O(a.node.details),1))]),_:1},8,["nodes","expanded"])])):(g(),T("div",Oe,[e[11]||(e[11]=p("br",null,null,-1)),c(V,null,{default:y(()=>e[6]||(e[6]=[w(" 1. Add some Goals first. A schedulable goal is one with a parent Goal--can have multiple related goals with the same parent. ")])),_:1}),c(Q),c(V,null,{default:y(()=>e[7]||(e[7]=[w(" 2. Go to Schedule to see a daily schedule. Drag scheduled events to new timeslots or click in calendar to add an event. ")])),_:1}),c(Q),c(V,null,{default:y(()=>e[8]||(e[8]=[w(" 3. Reload a saved daily schedule or defaults or choose minimal score events to schedule. Fix any scheduling conflicts. ")])),_:1}),c(Q),c(V,null,{default:y(()=>e[9]||(e[9]=[w(" 4. Save the daily schedule (dont forget to update their score as needed!) ")])),_:1}),c(Q),c(V,null,{default:y(()=>e[10]||(e[10]=[w(" 5. Check out the summary of all goals here! ")])),_:1})]))])):B("",!0)]),_:1})]),_:1})}var qe=Z(fe,[["render",Re],["__scopeId","data-v-02faa4ac"]]);export{qe as default};
