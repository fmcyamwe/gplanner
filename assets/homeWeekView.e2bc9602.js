import{a as N,b as P,Q as I,c as T}from"./utiFunc.55063972.js";import{j as R,q as M,s as y,c as H,h as V,k as B,g as F,u as z,x as K,_ as j,d as L,r as k,E as Q,F as u,G as E,H as p,I as d,K as m,M as f,N as S,O as b,Q as x,P as w,R as G,J as v,S as C,U as O}from"./index.01ac1f1f.js";import{N as U,t as W,p as A,a as h,b as _,c as $,i as q,Q as J}from"./NavigationBar.5d3cc23d.js";import{Q as X}from"./QCalendar.f0a44021.js";import{u as Y}from"./goalStorage.bc934b6b.js";import"./use-quasar.da98edb0.js";var Z=R({name:"QPage",props:{padding:Boolean,styleFn:Function},setup(e,{slots:t}){const{proxy:{$q:a}}=F(),s=M(z,y);if(s===y)return console.error("QPage needs to be a deep child of QLayout"),y;if(M(K,y)===y)return console.error("QPage needs to be child of QPageContainer"),y;const l=H(()=>{const r=(s.header.space===!0?s.header.size:0)+(s.footer.space===!0?s.footer.size:0);if(typeof e.styleFn=="function"){const n=s.isContainer.value===!0?s.containerHeight.value:a.screen.height;return e.styleFn(r,n)}return{minHeight:s.isContainer.value===!0?s.containerHeight.value-r+"px":a.screen.height===0?r!==0?`calc(100vh - ${r}px)`:"100vh":a.screen.height-r+"px"}}),c=H(()=>`q-page${e.padding===!0?" q-layout-padding":""}`);return()=>V("main",{class:c.value,style:l.value},B(t.default))}});const ee=L({name:"weekCalendar",components:{NavigationBar:U,QCalendar:X},data(){return{store:Y(),calendar:k(null),currentDate:k(W()),events:[],mostEvts:5,treeGoals:k([]),expanded:k([])}},beforeMount(){this.loadEvts(),this.constructTree()},mounted(){console.log("mounted")},computed:{storedGoalsMap(){const e=new Map;let t=this.store.getSubGoals;return t?(t.forEach(a=>{e.set(a.id,a)}),e):(console.log("GoalsMap is empty or null",t),e)},allEvents(){return this.store.getAllDates},parentGoalsMap(){const e=new Map;let t=this.store.getMainGoals;return t?(t.forEach(a=>{e.set(a.id,a)}),e):(console.log("parentGoalsMap is empty or null",t),e)},storedEvents(){return this.store.getSubGoals},eventsMap(){const e={};return this.events.forEach(t=>{if(e[t.date]||(e[t.date]=[]),e[t.date].push(t),t.days){console.log(`eventsMap multiple days? event for ${t.date}`,t.days);let a=A(t.date),s=t.days;do a=h(a,{day:1}),e[a.date]||(e[a.date]=[]),e[a.date].push(t);while(--s>0)}}),e}},methods:{loadEvts(){let e=this.parentGoalsMap,t=this.storedGoalsMap,a=this.allEvents;if(t&&e){if(a)for(let s in a){let i=a[s];for(let l in i){let c=t.get(parseInt(l));if(c){let r=e.get(c.parentGoal),n=h($(s),{minute:_(i[l].time)}),o=h(n,{minute:parseInt(i[l].duration)});this.events.push({id:c.id,title:c.title,details:`${n.time} - ${o.time}`,time:i[l].time,duration:i[l].duration,date:s,bgcolor:r.bgcolor})}else console.log(`ERROR: ${l} no exist!! on`,s)}}}else{console.log("ERROR--no parent or goals!!REVIEW**");return}},constructTree(){this.treeGoals=this.store.fetchGoalsTree(),console.log("constructTree",this.treeGoals)},getEvents(e){const t=this.eventsMap[e]||[];if(t.length===1)t[0].side="full";else if(t.length===2){console.log("getEvents...LENGTH is 2?!?",e,t);const a=h($(t[0].date),{minute:_(t[0].time)}),s=h(a,{minute:t[0].duration}),i=h($(t[1].date),{minute:_(t[1].time)}),l=h(i,{minute:t[1].duration});q(i,a,s,!0)||q(l,a,s,!0)?(t[0].side="left",t[1].side="right"):(t[0].side="full",t[1].side="full")}return t.length>this.mostEvts&&(console.log(`getEvents hiiigh ${e}`,t.length),this.mostEvts=t.length),t},badgeClasses(e,t){return N(e,t)},badgeStyles(e,t,a=void 0,s=void 0){return P(e,t,a,s)},scrollToEvent(e){this.$refs.calendar.scrollToTime(e.time,350)},onToday(){this.$refs.calendar.moveToToday()},onPrev(){this.doReset=!0,this.$refs.calendar.prev()},onNext(){this.$refs.calendar.next()},onClickDate(e){console.log("onClickDate",e)},onClickTime(e){console.log("onClickTime",e)},onClickInterval(e){console.log("onClickInterval",e)},onClickHeadIntervals(e){console.log("onClickHeadIntervals",e)},onClickHeadDay(e){console.log("onClickHeadDay",e)},onChange(e){console.log("onChange",e)}}}),te={class:"row justify-center"},ae={style:{display:"flex","max-width":"800px",width:"100%",height:"400px",overflow:"auto"}},se={style:{display:"flex","justify-content":"center","flex-wrap":"wrap",padding:"2px"}},oe={class:"title q-calendar__ellipsis"},ne={class:"title q-calendar__ellipsis"},le={class:"row justify-center items-center"},ie={class:"q-pa-xl bg-grey-9 text-white",style:{"max-width":"350px"}};function re(e,t,a,s,i,l){const c=Q("navigation-bar"),r=Q("q-calendar");return u(),E(Z,null,{default:p(()=>[d(c,{onToday:e.onToday,onPrev:e.onPrev,onNext:e.onNext},null,8,["onToday","onPrev","onNext"]),m("div",te,[m("div",ae,[d(r,{ref:"calendar",modelValue:e.currentDate,"onUpdate:modelValue":t[0]||(t[0]=n=>e.currentDate=n),view:"week",dark:"",animated:"",hoverable:"",bordered:"","transition-prev":"slide-right","transition-next":"slide-left","no-active-date":"","interval-minutes":30,"interval-count":48,"interval-height":e.mostEvts*3,onChange:e.onChange,onClickDate:e.onClickDate,onClickTime:e.onClickTime,onClickInterval:e.onClickInterval,onClickHeadIntervals:e.onClickHeadIntervals,onClickHeadDay:e.onClickHeadDay},{"head-day-event":p(({scope:{timestamp:n}})=>[m("div",se,[(u(!0),f(b,null,S(e.eventsMap[n.date],o=>(u(),f(b,{key:o.id},[o.time?(u(),E(I,{key:1,class:w(e.badgeClasses(o,"header")),style:G([e.badgeStyles(o,"header"),{margin:"1px",width:"10px","max-width":"10px",height:"10px","max-height":"10px",cursor:"pointer"}]),onClick:D=>e.scrollToEvent(o)},{default:p(()=>[d(T,null,{default:p(()=>[v(C(o.time+" - "+o.title),1)]),_:2},1024)]),_:2},1032,["class","style","onClick"])):(u(),E(I,{key:0,class:w(e.badgeClasses(o,"header")),style:G([e.badgeStyles(o,"header"),{width:"100%",cursor:"pointer",height:"12px","font-size":"10px",margin:"1px"}])},{default:p(()=>[m("div",oe,[v(C(o.title)+" ",1),d(T,null,{default:p(()=>[v(C(o.details),1)]),_:2},1024)])]),_:2},1032,["class","style"]))],64))),128))])]),"day-body":p(({scope:{timestamp:n,timeStartPos:o,timeDurationHeight:D}})=>[(u(!0),f(b,null,S(e.getEvents(n.date),g=>(u(),f(b,{key:g.id},[g.time!==void 0?(u(),f("div",{key:0,class:w(["my-event",e.badgeClasses(g,"body")]),style:G(e.badgeStyles(g,"body",o,D))},[m("span",ne,[v(C(g.title)+" ",1),d(T,null,{default:p(()=>[v(C(g.details),1)]),_:2},1024)])],6)):O("",!0)],64))),128))]),_:1},8,["modelValue","interval-height","onChange","onClickDate","onClickTime","onClickInterval","onClickHeadIntervals","onClickHeadDay"])])]),m("div",le,[d(x,{class:"q-ma-xl",color:"white","text-color":"blue",unelevated:"",to:"/summary",label:"Summary","no-caps":""}),d(x,{class:"q-ma-xl",color:"white","text-color":"blue",unelevated:"",to:"/dayCalendar",label:"Daily","no-caps":""}),d(x,{class:"q-ma-xl",color:"white","text-color":"blue",unelevated:"",to:"/viewGoals",label:"Goals","no-caps":""})]),m("div",ie,[d(J,{nodes:e.treeGoals,"node-key":"label",expanded:e.expanded,"onUpdate:expanded":t[1]||(t[1]=n=>e.expanded=n),dark:""},null,8,["nodes","expanded"])])]),_:1})}var ge=j(ee,[["render",re],["__scopeId","data-v-03ff26fe"]]);export{ge as default};
