import{j as L,c as q,h as C,k as Se,af as Ee,a2 as Oe,r as f,ag as Pe,ah as $e,w as oe,b as Be,ai as Ne,Q as T,g as be,aj as Ae,ak as Me,al as Ve,am as qe,W as Ge,an as Ie,n as He,ao as Fe,d as ye,_ as ee,F as S,M as y,J as A,S as $,I as h,H as p,R as V,ap as we,aq as _e,ar as Q,aa as Te,K as w,U as O,as as le,ad as De,ae as Ce,E as I,at as se,O as k,N as H,f as ie,G as M,P as j,au as ne,av as J,ac as Y,aw as Ue}from"./index.8b819cea.js";import{Q as Re,a as ke,b as We,c as Qe,d as ae,e as re,f as de,g as he,h as ue}from"./viewAllGoals.083f88ce.js";import{Q as x}from"./QTooltip.730acc9d.js";import{c as Le,a as Ke,b as ze}from"./utiFunc.1c184224.js";import{N as je,t as F,p as X,a as b,j as R,k as Z,T as Je,b as B,c as P,i as W,C as ce,U as N,V as fe}from"./NavigationBar.3d82843a.js";/* empty css                             */import{u as Ye}from"./goalStorage.56e89d54.js";import{u as Xe}from"./use-quasar.2197fd2b.js";const Ze=()=>!!/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);var xe=L({name:"QBtnGroup",props:{unelevated:Boolean,outline:Boolean,flat:Boolean,rounded:Boolean,square:Boolean,push:Boolean,stretch:Boolean,glossy:Boolean,spread:Boolean},setup(e,{slots:t}){const o=q(()=>{const l=["unelevated","outline","flat","rounded","square","push","stretch","glossy"].filter(s=>e[s]===!0).map(s=>`q-btn-group--${s}`).join(" ");return`q-btn-group row no-wrap${l.length>0?" "+l:""}`+(e.spread===!0?" q-btn-group--spread":" inline")});return()=>C("div",{class:o.value},Se(t.default))}});const et=Object.keys(Ee),tt=e=>et.reduce((t,o)=>{const l=e[o];return l!==void 0&&(t[o]=l),t},{});var me=L({name:"QBtnDropdown",props:{...Ee,...Oe,modelValue:Boolean,split:Boolean,dropdownIcon:String,contentClass:[Array,String,Object],contentStyle:[Array,String,Object],cover:Boolean,persistent:Boolean,noRouteDismiss:Boolean,autoClose:Boolean,menuAnchor:{type:String,default:"bottom end"},menuSelf:{type:String,default:"top end"},menuOffset:Array,disableMainBtn:Boolean,disableDropdown:Boolean,noIconAnimation:Boolean,toggleAriaLabel:String},emits:["update:modelValue","click","beforeShow","show","beforeHide","hide"],setup(e,{slots:t,emit:o}){const{proxy:l}=be(),s=f(e.modelValue),i=f(null),a=Pe(),n=q(()=>{const g={"aria-expanded":s.value===!0?"true":"false","aria-haspopup":"true","aria-controls":a,"aria-label":e.toggleAriaLabel||l.$q.lang.label[s.value===!0?"collapse":"expand"](e.label)};return(e.disable===!0||e.split===!1&&e.disableMainBtn===!0||e.disableDropdown===!0)&&(g["aria-disabled"]="true"),g}),r=q(()=>"q-btn-dropdown__arrow"+(s.value===!0&&e.noIconAnimation===!1?" rotate-180":"")+(e.split===!1?" q-btn-dropdown__arrow-container":"")),m=q(()=>$e(e)),c=q(()=>tt(e));oe(()=>e.modelValue,g=>{i.value!==null&&i.value[g?"show":"hide"]()}),oe(()=>e.split,G);function d(g){s.value=!0,o("beforeShow",g)}function u(g){o("show",g),o("update:modelValue",!0)}function E(g){s.value=!1,o("beforeHide",g)}function v(g){o("hide",g),o("update:modelValue",!1)}function D(g){o("click",g)}function K(g){Ae(g),G(),o("click",g)}function z(g){i.value!==null&&i.value.toggle(g)}function U(g){i.value!==null&&i.value.show(g)}function G(g){i.value!==null&&i.value.hide(g)}return Object.assign(l,{show:U,hide:G,toggle:z}),Be(()=>{e.modelValue===!0&&U()}),()=>{const g=[C(Ne,{class:r.value,name:e.dropdownIcon||l.$q.iconSet.arrow.dropdown})];return e.disableDropdown!==!0&&g.push(C(Re,{ref:i,id:a,class:e.contentClass,style:e.contentStyle,cover:e.cover,fit:!0,persistent:e.persistent,noRouteDismiss:e.noRouteDismiss,autoClose:e.autoClose,anchor:e.menuAnchor,self:e.menuSelf,offset:e.menuOffset,separateClosePopup:!0,transitionShow:e.transitionShow,transitionHide:e.transitionHide,transitionDuration:e.transitionDuration,onBeforeShow:d,onShow:u,onBeforeHide:E,onHide:v},t.default)),e.split===!1?C(T,{class:"q-btn-dropdown q-btn-dropdown--simple",...c.value,...n.value,disable:e.disable===!0||e.disableMainBtn===!0,noWrap:!0,round:!1,onClick:D},{default:()=>Se(t.label,[]).concat(g),loading:t.loading}):C(xe,{class:"q-btn-dropdown q-btn-dropdown--split no-wrap q-btn-item",rounded:e.rounded,square:e.square,...m.value,glossy:e.glossy,stretch:e.stretch},()=>[C(T,{class:"q-btn-dropdown--current",...c.value,disable:e.disable===!0||e.disableMainBtn===!0,noWrap:!0,round:!1,onClick:K},{default:t.label,loading:t.loading}),C(T,{class:"q-btn-dropdown__arrow-container q-anchor--skip",...n.value,...m.value,disable:e.disable===!0||e.disableDropdown===!0,rounded:e.rounded,color:e.color,textColor:e.textColor,dense:e.dense,size:e.size,padding:e.padding,ripple:e.ripple},()=>g)])}}});function ge(e){if(e===!1)return 0;if(e===!0||e===void 0)return 1;const t=parseInt(e,10);return isNaN(t)?0:t}var pe=Me({name:"close-popup",beforeMount(e,{value:t}){const o={depth:ge(t),handler(l){o.depth!==0&&setTimeout(()=>{const s=Ve(e);s!==void 0&&qe(s,l,o.depth)})},handlerKey(l){Ge(l,13)===!0&&o.handler(l)}};e.__qclosepopup=o,e.addEventListener("click",o.handler),e.addEventListener("keyup",o.handlerKey)},updated(e,{value:t,oldValue:o}){t!==o&&(e.__qclosepopup.depth=ge(t))},beforeUnmount(e){const t=e.__qclosepopup;e.removeEventListener("click",t.handler),e.removeEventListener("keyup",t.handlerKey),delete e.__qclosepopup}});function _(e,t=new WeakMap){if(Object(e)!==e)return e;if(t.has(e))return t.get(e);const o=e instanceof Date?new Date(e):e instanceof RegExp?new RegExp(e.source,e.flags):e instanceof Set?new Set:e instanceof Map?new Map:typeof e.constructor!="function"?Object.create(null):e.prototype!==void 0&&typeof e.prototype.constructor=="function"?e:new e.constructor;if(typeof e.constructor=="function"&&typeof e.valueOf=="function"){const l=e.valueOf();if(Object(l)!==l){const s=new e.constructor(l);return t.set(e,s),s}}return t.set(e,o),e instanceof Set?e.forEach(l=>{o.add(_(l,t))}):e instanceof Map&&e.forEach((l,s)=>{o.set(s,_(l,t))}),Object.assign(o,...Object.keys(e).map(l=>({[l]:_(e[l],t)})))}var ot=L({name:"QPopupEdit",props:{modelValue:{required:!0},title:String,buttons:Boolean,labelSet:String,labelCancel:String,color:{type:String,default:"primary"},validate:{type:Function,default:()=>!0},autoSave:Boolean,cover:{type:Boolean,default:!0},disable:Boolean},emits:["update:modelValue","save","cancel","beforeShow","show","beforeHide","hide"],setup(e,{slots:t,emit:o}){const{proxy:l}=be(),{$q:s}=l,i=f(null),a=f(""),n=f("");let r=!1;const m=q(()=>Ie({initialValue:a.value,validate:e.validate,set:c,cancel:d,updatePosition:u},"value",()=>n.value,g=>{n.value=g}));function c(){e.validate(n.value)!==!1&&(E()===!0&&(o("save",n.value,a.value),o("update:modelValue",n.value)),v())}function d(){E()===!0&&o("cancel",n.value,a.value),v()}function u(){He(()=>{i.value.updatePosition()})}function E(){return Fe(n.value,a.value)===!1}function v(){r=!0,i.value.hide()}function D(){r=!1,a.value=_(e.modelValue),n.value=_(e.modelValue),o("beforeShow")}function K(){o("show")}function z(){r===!1&&E()===!0&&(e.autoSave===!0&&e.validate(n.value)===!0?(o("save",n.value,a.value),o("update:modelValue",n.value)):o("cancel",n.value,a.value)),o("beforeHide")}function U(){o("hide")}function G(){const g=t.default!==void 0?[].concat(t.default(m.value)):[];return e.title&&g.unshift(C("div",{class:"q-dialog__title q-mt-sm q-mb-sm"},e.title)),e.buttons===!0&&g.push(C("div",{class:"q-popup-edit__buttons row justify-center no-wrap"},[C(T,{flat:!0,color:e.color,label:e.labelCancel||s.lang.label.cancel,onClick:d}),C(T,{flat:!0,color:e.color,label:e.labelSet||s.lang.label.set,onClick:c})])),g}return Object.assign(l,{set:c,cancel:d,show(g){i.value!==null&&i.value.show(g)},hide(g){i.value!==null&&i.value.hide(g)},updatePosition:u}),()=>{if(e.disable!==!0)return C(Re,{ref:i,class:"q-popup-edit",cover:e.cover,onBeforeShow:D,onShow:K,onBeforeHide:z,onHide:U,onEscapeKey:d},G)}}});const lt=ye({name:"GoalyEnd",props:{disabledScore:Boolean,title:String,id:Number,startTime:String,details:String,score:String,happeningNow:Boolean},emits:["saveScore","endNow","deleteNow"],computed:{aScore:{get(){return this.score},set(e){console.log("aScore getting set",e,this.id),this.$emit("saveScore",e,this.id)},cancel(){console.log("aScore remove?",this.id)}},overdueIconStyle(){return{color:this.daysOver===0?"inherit":"red","max-width":"25px","min-width":"25px"}},userIconStyle(){return{color:this.disabledScore===!0?"red":"blue",cursor:"pointer"}},endNowBtnStyle(){return{display:this.disabledScore===!0&&this.happeningNow===!0?"block":"none","text-align":"center","margin-left":"32em",height:"100%"}}},watch:{title(e){console.log("titleValue:",e)}},methods:{onDelete(){this.$emit("deleteNow",this.id)},wannaEnd(){console.log("eeeuh wish to end for",this.id,this.disabledScore,this.happeningNow),this.$emit("endNow",this.id)}}}),st={class:"title q-calendar__ellipsis"};function it(e,t,o,l,s,i){return S(),y("div",st,[A($(e.title+":"+e.score)+" ",1),h(x,null,{default:p(()=>[A($(e.details),1)]),_:1}),h(T,{"no-caps":"",class:"button",label:"End-Now",style:V(e.endNowBtnStyle),onClick:e.wannaEnd},null,8,["style","onClick"]),h(ot,{modelValue:e.aScore,"onUpdate:modelValue":t[0]||(t[0]=a=>e.aScore=a),disable:e.disabledScore,"auto-save":""},{default:p(a=>[h(we,{modelValue:a.value,"onUpdate:modelValue":n=>a.value=n,dense:"",autofocus:"",onKeyup:_e(a.set,["enter"])},{after:p(()=>[h(T,{flat:"",dense:"",color:"positive",icon:"check_circle",onClick:Q(a.set,["stop","prevent"])},null,8,["onClick"]),h(Te,{vertical:!0}),h(T,{label:"Del",flat:"",dense:"",color:"negative",icon:"delete_forever",onClick:e.onDelete},null,8,["onClick"])]),_:2},1032,["modelValue","onUpdate:modelValue","onKeyup"])]),_:1},8,["modelValue","disable"])])}var nt=ee(lt,[["render",it],["__scopeId","data-v-45f57de5"]]);const at=C("div",{class:"q-space"});var rt=L({name:"QSpace",setup(){return()=>at}});const dt={name:"adHocEvent",props:{mainGoals:Array},data(){return{aTitle:"",daP:null,own:"misc"}},emits:["saveEvent"],computed:{pGoals:{get(){return this.mainGoals}},evName:{get(){return this.aTitle},set(e){this.aTitle=e}}},methods:{onClicked(){this.$emit("saveEvent",this.aTitle,this.daP,this.own)}}},ht=e=>(De("data-v-a7cab416"),e=e(),Ce(),e),ut={class:"q-calendar__ellipsis"},ct=ht(()=>w("div",{class:"text-h6"},"adHocEvent",-1)),ft={class:"q-ml-md q-gutter-md"},mt={key:0},gt={class:"radio-select"},pt={style:{"text-align":"center"}};function vt(e,t,o,l,s,i){return S(),y("div",ut,[ct,w("div",ft,[h(we,{modelValue:i.evName,"onUpdate:modelValue":t[0]||(t[0]=a=>i.evName=a),filled:"",label:"A Goal","lazy-rules":"","item-aligned":"",rules:[a=>a&&a.length>0||"Please type a goal"]},null,8,["modelValue","rules"])]),i.pGoals?(S(),y("div",mt,[h(ke,{class:"q-ml-md",modelValue:s.daP,"onUpdate:modelValue":t[1]||(t[1]=a=>s.daP=a),options:i.pGoals,"option-value":"id","option-label":"title",disable:s.own!="misc",label:"Parent Goal"},null,8,["modelValue","options","disable"])])):O("",!0),w("div",gt,[h(le,{modelValue:s.own,"onUpdate:modelValue":t[2]||(t[2]=a=>s.own=a),val:"misc",label:"Misc"},null,8,["modelValue"]),h(rt),h(le,{modelValue:s.own,"onUpdate:modelValue":t[3]||(t[3]=a=>s.own=a),val:"self",label:"Self"},null,8,["modelValue"])]),w("div",pt,[h(T,{flat:"",label:"Add",color:"primary",onClick:i.onClicked},null,8,["onClick"])])])}var St=ee(dt,[["render",vt],["__scopeId","data-v-a7cab416"]]);function ve(e){return e.button===0}const Et=ye({name:"dayCalendar",components:{NavigationBar:je,QCalendarDay:Le,addGoalForm:We,GoalyEnd:nt,adHocEvent:St},data(){return f(null),f(null),f(null),f(null),Xe(),{currentDate:f(F()),scoreOptions:f([1,2,3,4,5]),chosenScore:f(null),chosenPrio:f(null),scheduledEvents:[],dailyScheduled:f(new Map),endTimesSet:f(new Set),startTimesSet:f(new Set),disablePrioBtn:f(!0),disableScoreBtn:f(!0),calendar:f(null),store:Ye(),anchorTimestamp:f(null),otherTimestamp:f(null),mouseDown:f(!1),mobile:f(!0),timeStartPos:f(0),showGoalForm:f(!1),pickEventDialog:f(!1),addEventDialog:f(!1),adHocEventDialog:f(!0),conflictReso:f(!1),resoType:f(""),toAddE:f(null),disabledScoreEvts:f({}),hasStarted:f({}),disableSaveSchedule:f(!0),skipAsk:f(!1),showReloadBtn:f(!1),loadDefault:f(!0),showScoreBtn:f(!1),showPrio:f(!1)}},beforeMount(){this.mobile=Ze(),this.resetGoalEvts(!0)},beforeUnmount(){clearInterval(this.intervalId)},mounted(){this.adjustCurrentTime(),this.intervalId=setInterval(()=>{this.adjustCurrentTime()},6e4)},computed:{chosenScoreLabel(){return this.chosenScore==null?"By Score":`Score > ${this.chosenScore}`},chosenPrioLabel(){return this.chosenPrio==null?"By Priority":`Prio = ${this.chosenPrio}`},style(){return{top:this.timeStartPos+"px"}},showForm(){return this.showGoalForm},doDisableSaveSchedule(){return this.disableSaveSchedule},hasEventsForDate(){return this.store.hasEventsForDate(this.currentDate)},eventsMap(){const e={};return this.scheduledEvents.forEach(t=>{if(e[t.date]||(e[t.date]=[]),e[t.date].push(t),t.days){console.log(`eventsMap multiple days? event for ${t.date}`,t.days);let o=X(t.date),l=t.days;do o=b(o,{day:1}),e[o.date]||(e[o.date]=[]),e[o.date].push(t);while(--l>0)}}),e},parentGoalsMap(){const e=new Map;let t=this.storedMainG;return t?(t.forEach(o=>{e.set(o.id,o)}),e):(console.log("parentGoalsMap is empty or null",t),e)},canbeScheduled(){let e=this.deepCopy(this.storedEvents),t=e.filter(o=>!this.scheduledEvents.find(l=>l.id==o.id));return t.length==0?e:t},storedEvents(){return this.store.getSubGoals},storedMainG(){return this.store.getMainGoals},startEndTimes(){const e=[];return this.anchorDayTimeIdentifier!==!1&&this.otherDayTimeIdentifier!==!1&&(this.anchorDayTimeIdentifier<=this.otherDayTimeIdentifier?(console.log("startEndTimes..anchor <= less",R(this.anchorTimestamp),R(this.otherTimestamp)),e.push(R(this.anchorTimestamp),R(this.otherTimestamp))):(console.log("startEndTimes..anchor <= less",R(this.anchorTimestamp),R(this.otherTimestamp)),e.push(R(this.otherTimestamp),R(this.anchorTimestamp)))),e},anchorDayTimeIdentifier(){return this.anchorTimestamp!==null?Z(this.anchorTimestamp):!1},otherDayTimeIdentifier(){return this.otherTimestamp!==null?Z(this.otherTimestamp):!1}},methods:{badgeClasses(e,t){return Ke(e,t)},badgeStyles(e,t,o=void 0,l=void 0){return ze(e,t,o,l)},getTimeNumber(e){return e!==null?Z(e):!1},getTimeyNumber(e){return e!==null?Je(e):!1},getDateEvents(e){const t=this.eventsMap[e]||[];if(t.length===1)t[0].side="full";else if(t.length===2){console.log("daEvents...LENGTH is 2?",t);const o=b(P(t[0].date),{minute:B(t[0].time)}),l=b(o,{minute:t[0].duration}),s=b(P(t[1].date),{minute:B(t[1].time)}),i=b(s,{minute:t[1].duration});W(s,o,l,!0)||W(i,o,l,!0)?(t[0].side="left",t[1].side="right"):(t[0].side="full",t[1].side="full")}return t},hasDate(e){return this.currentDate?e.find(t=>t.date===this.currentDate):!1},getEventsForDate(e){return this.store.getEventsForDate(e)},isViewingToday(){return F()==this.currentDate},isViewingPast(){let e=F();if(this.currentDate&&this.currentDate==e)return!1;let t=ce(P(e));return!(ce(P(this.currentDate))>=t)},adjustCurrentTime(){const e=N(new Date);if(this.currentDate!==e.date){this.timeStartPos=-10,this.currentTime="";return}this.currentDate=e.date,this.currentTime=e.time,this.timeStartPos=this.$refs.calendar.timeStartPos(e.time,!1);let t=this.endTimesSet&&this.endTimesSet.has(e.time),o=this.startTimesSet&&this.startTimesSet.has(e.time);(t||o)&&(console.log("sameStart/END..FOUND",this.currentTime),this.doEnableEndNowBtn(this.currentTime,t,o))},setGoalsPrio(){let e=this.store.fetchAllPrio();return!e.size>0&&console.log("ERROR...no Priority goals?",e),e.values()},resetGoalEvts(e=!1){if(this.scheduledEvents===this.allEvents&&console.log("resetGoalEvts SAME"),e){let t=this.deepCopy(this.storedEvents);return this.allEvents=[...t],t}return this.allEvents},getLocalEvt(e){for(let t=0;t<this.allEvents.length;t++)if(this.allEvents[t].id===e)return this.allEvents[t];return null},getScheduledEvent(e){for(let t=0;t<this.scheduledEvents.length;t++)if(this.scheduledEvents[t].id==e)return this.scheduledEvents[t];return null},doSaveEvtProp(e,t=null,o=null){this.store.saveSubProp(e,t,o)},addPropsEventsTo(e,t){let o=this.parentGoalsMap;return t?(t.forEach(l=>{l.date=e!=null?e:l.date;let s=o.get(l.parentGoal);s?(l.bgcolor=s.bgcolor,l.details=`${s.title.trim()} (${s==null?void 0:s.priority}) - ${l==null?void 0:l.duration}min`):(console.log("no parent goal for:",l),l.bgcolor="grey",l.details="unknown")}),t):(this.doNotify("addPropsEventsTo BUT no goals to schedule..."),[])},addEvtPropsIntoSchedule(e,t){return this.addPropsEventsTo(e,[t]),this.scheduledEvents.push(t),this.updateCurrentSchedule()},filterEvtsTo(e,t){let o=this.allEvents,l=[];return o.forEach(s=>{let i=t[s.id];i&&(s.date=e,s.time=i.time,s.duration=i.duration,l.push(s))}),l},updateCurrentSchedule(){const e=new Map;let t=new Set,o=new Set,l=new Set;return this.scheduledEvents.length<1?(this.dailyScheduled=e,this.endTimesSet=t,this.startTimesSet=l,o):(this.scheduledEvents.forEach(s=>{let i=b(P(s.date),{minute:B(s.time)}),a=b(i,{minute:s.duration});e.set(s.id,{start:i,end:a,on:s.date,originalAt:s.time,for:s.duration,score:s.score}),t.add(a.time),l.has(i.time)?o.add({at:i.time,id:s.id}):l.add(i.time)}),this.dailyScheduled=e,this.endTimesSet=t,this.startTimesSet=l,o)},addEvtInScheduleMaps(e){if(this.dailyScheduled.has(e.id))return console.log("addEvtInScheduleMaps with evt already added...ERROR?",e),!1;let t=b(P(e.date),{minute:B(e.time)}),o=b(t,{minute:e.duration});this.dailyScheduled.set(e.id,{on:e.date,originalAt:e.time,for:e.duration,start:t,end:o,score:e.score}),this.endTimesSet.add(o.time),this.startTimesSet.add(t.time)},updateEvtInScheduleMaps(e,t){if(this.dailyScheduled.has(e)){let o=this.dailyScheduled.get(e);console.log("updateEvtInScheduleMaps",o,t);let l=o.for,s=o.originalAt,i=o.start,a=o.end,n=b(t,{minute:l}),r=o.score;return this.dailyScheduled.set(e,{on:t.date,originalAt:s,for:l,start:t,end:n,score:r}),this.endTimesSet.delete(a.time)?this.endTimesSet.add(n.time):console.log("updateEvtInScheduleMaps-endTimesSet NOT FOUND?!?"),this.startTimesSet.delete(i.time)?this.startTimesSet.add(t.time):console.log("updateEvtInScheduleMaps-startTimesSet NOT FOUND?!?"),(this.currentDate==F()||!this.isViewingPast())&&(this.canEnableEditScore(e,n),this.enableEndNowBtn(e,t,n)),!0}else return console.log("updateEvtInScheduleMaps--euh not found?ERROR?",e,t),!1},evtStartedOrPassed(e){const t=[];let o=b(e,{minute:0}),l=this.getTimeNumber(o);return this.dailyScheduled.forEach((s,i,a)=>{let n=this.getTimeNumber(s.start),r=this.getTimeNumber(s.end);if(n!==!1&&r!==!1){let m=l>=n&&l<r,c=l>=r;(m||c)&&t.push(i),m&&(this.hasStarted[i]=!0),this.enableEvtScoreEdit(i,c)}else console.log(`ERROR?!:${i} has no start/end?.`,s)}),t},allowScoreEdit(e){this.dailyScheduled.forEach((t,o,l)=>{this.disabledScoreEvts[o]=!e})},enableEvtScoreEdit(e,t){this.disabledScoreEvts[e]=!t},canEnableEditScore(e,t){const o=N(new Date);fe(o,t)>0?this.disabledScoreEvts[e]=!0:(this.disabledScoreEvts[e]=!1,this.hasStarted[e]=!1)},parseScore(e){const t=e.split(/on/);return t.length!=2?(console.log(`parseScore error?${e}`,t),-1):t[1]-t[0]},doEnableEndNowBtn(e,t,o){for(let[l,s]of this.dailyScheduled){let i=t?s.end.time:s.start.time,a=o?s.start.time:e;i==e?(console.log("doEnableEndNowBtn...FOUND",l,s),this.hasStarted[l]=!t):a==e&&console.log("doEnableEndNowBtn...EUUH?!?!",l,s,e,a)}},enableEndNowBtn(e,t,o){const l=P(this.currentDate);W(l,t,o,!0)&&(this.hasStarted[e]=!0)},retrieveSameStart(e){let t=[];for(let[o,l]of this.dailyScheduled)l.start.time==e&&t.push(o);return t},timeChangeDialog(e,t,o,l,s){this.$q.dialog({title:"Default Change?",cancel:o,ok:t,message:e}).onOk(()=>l()).onCancel(()=>{console.log("Nope coolios, onCancel with temp.time add!!"),s()}).onDismiss(()=>(console.log("dismissing..DO anything?!?"),!1))},confirmAction(e,t,o,l=null){this.$q.dialog({title:"Warning",cancel:!0,message:e}).onOk(()=>{t()}).onCancel(()=>{o()}).onDismiss(()=>{if(l){console.log("confirmAction with dismiss!!"),l();return}})},showChoiceDialog(e,t,o=null,l=null){this.$q.dialog({title:e,cancel:!!l,persistent:!0,options:{type:"radio",model:"",items:t}}).onOk(s=>{o&&(s==""?this.showChoiceDialog(e,t,o,l):o(s))}).onCancel(()=>{l&&l()}).onDismiss(()=>{console.log("showChoiceDialog dismissed")})},doNotify(e,t=void 0,o="top"){this.$q.notify({color:t!==void 0?t:"negative",position:o,message:e,icon:t==null?"report_problem":"thumb_up"})},updateButtons(e=null,t=null,o=null){this.loadDefault=e!=null?e:this.loadDefault,this.showScoreBtn=t!=null?t:this.showScoreBtn,this.showPrio=o!=null?o:this.showPrio},resetButtons(e,t){this.updateButtons(!e,!t,!t)},doRemove(e){let t=this.scheduledEvents.length,o=0;for(o;o<t;o++)if(this.scheduledEvents[o].id==e.id){this.scheduledEvents.splice(o,1);let l=null;if(this.dailyScheduled.has(e.id)?(l=this.dailyScheduled.get(e.id),this.dailyScheduled.delete(e.id)):console.log("ERROR doRemove, dailyScheduled has no such item?@? ",e),l){let s=this.startTimesSet.delete(l.start.time),i=this.endTimesSet.delete(l.end.time);(!s||!i)&&console.log("ERROR doRemove scheduleSets has no such item?@? ",l,e)}break}console.log("doRemove..looping FOR",o)},removeEvtInSchedule(e,t=null){if(this.isViewingPast()){this.doNotify("Removing from the past is a no no!");return}let o=()=>{this.doRemove(e),this.disableSaveSchedule=!1,this.showReloadBtn=this.hasEventsForDate};if(!this.isViewingToday()){o(),console.log("Removed future evt");return}let l=`Remove "${e.title}" from schedule?`;this.confirmAction(l,o,function(){console.log("Cancelled remove")})},reset(){this.draggedItem=null,this.targetDrop=null,this.toAddE=null,this.chosenScore=null,this.chosenPrio=null,this.possibleRange=null},fixConflicts(e){console.log("fixConflicts...Start",e);const t=l=>{let s=0,i=null;for(let a of l){let n=this.getScheduledEvent(a);if(n){let r=this.parentGoalsMap.get(n.parentGoal);r?r.priority>s&&(s=r.priority,i=n):console.log("findhigherPrio..ERROR no PARENT found?",n)}else console.log("findhigherPrio..ERROR not found?",a)}return console.log("findhigherPrio..Highest priority be",i,s),i},o=l=>({label:l.title+" at "+l.score,value:l.id});for(let l of e){let s=null,i=this.retrieveSameStart(l.at);console.log("fixConflicts...results",i,l);let a=[],n="";for(let r of i){let m=this.getScheduledEvent(r);m?(a.push(m),n+=m.title+","):console.log("fixConflicts...ERROR not found?",r)}this.$q.dialog({title:"Alert",cancel:!1,persistent:!0,message:`${n} are conflicting.
 Choose how to solve this...`,options:{type:"radio",model:"opt1",items:[{label:"Resolve by Highest Priority",value:"opt1",color:"secondary"},{label:"Resolve by lowest Score Interval",value:"opt2"},{label:"Pick event",value:"opt3"}]}}).onOk(r=>{if(r=="opt3"){this.$q.dialog({title:"Alert",cancel:!1,persistent:!0,message:"Choose the event to schedule",options:{type:"radio",model:"",items:a.map(o)}}).onOk(c=>{console.log("Chosen Manually",c);let d=this.getScheduledEvent(c);d?s=d:console.log("ERROR...Manually choice not find",c)}).onCancel(()=>{console.log("Cancelled loading..HUH?!?")}).onDismiss(()=>{console.log("oooh dismissed inner...",s),this.pickConflictReso(s,a)});let m=this.updateCurrentSchedule();console.log("fixConflicts inner...after conflicts?",m),this.updateButtons(!0,null,null)}else if(r=="opt2"){console.log(">>>> OK, Option Score",r);let m=0,c=null;for(let d of a){let u=this.parseScore(d.score);u>-1&&u>=m?(m=u,c=d):console.log("ERROR...parseScore?",u,d)}c&&(console.log("Option Score Chosen",c),s=c)}else s=t(i),console.log(">>>> OK, Higher prio",r,s);console.log("Pick be",s)}).onCancel(()=>{console.log("Cancelled loading...HUH?!?")}).onDismiss(()=>{if(console.log("Dismissing...",s),s){this.pickConflictReso(s,a);let r=this.updateCurrentSchedule();console.log("fixConflicts outer...after conflicts?",r),this.updateButtons(!0,null,null),this.disableSaveSchedule=!1}})}return!0},pickConflictReso(e,t){for(let o of t)o.id==e.id?console.log("Skipping choice!",o):(console.log("Removing conflict event!",o),this.doRemove(o))},evtIsOverlappingTimes(e,t,o,l){let s=this.getTimeyNumber(e),i=this.getTimeyNumber(t),a=this.getTimeyNumber(o),n=this.getTimeyNumber(l);if(s===!1||a===!1||i===!1||n===!1)return console.log("ERROR... evtIsOverlappingTimes error",s,i,a,n),!1;let r=!1;return s>=a&&s<n&&(r="bas"),i>=a&&i<=n&&(r="haut"),(a>=s&&i>=n||s>a&&i<n)&&(r="surrounding"),r},hasOverlappingEvent(e,t,o){const l=[];let s=t,i=b(s,{minute:o});return this.dailyScheduled.forEach((a,n,r)=>{if(n!=e){let m=this.evtIsOverlappingTimes(s,i,a.start,a.end);m&&(console.log(`${e} has overlappingConflict: "${m}" with ${n}`),l.push({target:e,targetStart:s,direction:m,inConflict:n}))}}),l},overlapOtherEvent(e,t,o){const l=[];let s=b(t,{minute:0}),i=b(s,{minute:o}),a=this.getTimeNumber(s),n=this.getTimeNumber(i);return a===!1||n===!1?(console.log("ERROR... overlapOtherEvent targetTimestamp error",t),l):(this.dailyScheduled.forEach((r,m,c)=>{if(m!=e){let d=this.getTimeNumber(r.start),u=this.getTimeNumber(r.end);if(d!==!1&&u!==!1){let E=a>=d&&a<u||n>=d&&n<=u,v=d>=a&&n>=u;(E||v)&&(console.log(`overlapOtherEvent: ${e} overlaping with Key:${m}`,v),l.push(m))}else console.log("ERROR... overlapOtherEvent eventTimestamp error",r)}}),l)},overlapCheckEvtsAdd(e,t=null){let o={};console.log(`overlapCheckEvtsAdd with evts:${e.length} on`,t);for(let l=0;l<e.length;l++){let s=e[l],i=b(P(s.date),{minute:B(s.time)}),a=this.hasOverlappingEvent(s.id,i,s.duration);if(a.length>0){console.log(`overlapCheckEvtsAdd at ${i.time} for ${s.id}::${s.title.trim()}>>`,a);let n=0;do o[s.id]||(o[s.id]=[]),o[s.id].push(a[n]),console.log(`hasOverlappingEvent ${s.id}`,n,a[n]),n>0&&console.log("WOAH WOAH, multiple overlaps with same obj!",n,s);while(++n<a.length)}else this.addEvtPropsIntoSchedule(t,s)}return o},changeEvtTime(e,t,o){console.log(`changeEventTime ${e} with skip:${o}`,t.time,this.scheduledEvents.length);let l=this.getScheduledEvent(e);if(!l)return console.log("ERROR in changeEvtTime not found?",l,e,t),!1;let s=()=>{l.time=t.time,this.updateEvtInScheduleMaps(e,t)},i=r=>(this.doSaveEvtProp(e,t.time,null),s(),r),a=l.time,n=`"${l.title}" scheduled at:${a}. Change to ${t.time} as default time? 
 Temp add otherwise.`;(l==null?void 0:l.inDefaults)||!(l!=null&&l.canMove)?o?(console.log(`changeEventTime::skippin...BUT inDef: ${l.inDefaults} and canMove:${l.canMove}`),s()):this.timeChangeDialog(n,"Change","Temp.Add",function(){i(!0)},function(){s()}):l!=null&&l.canMove?s():this.timeChangeDialog(n,"Change","Temp.Add",function(){i(!0)},function(){console.log(`Keeping ${l.time} for ${l.id}`,t.time),s()})},recurChangeTime(e,t,o,l=!1,s=!1){let i=this.dailyScheduled.get(e);if(i){let a=B(o.time)-B(t.time),n=`${a>0?"DOWN":"UP"}`;console.log(`${e} moving due to evt ${t.id} at ${t.time}... target:${o.time} ...:GoFwd:${l} >> ${n}`,a,s);let r=null;a>0||l?r=b(o,{minute:parseInt(t.duration)+10}):(console.log(`recurChangeTime..BACKWARD ${e}`,a,l),r=b(o,{minute:-(parseInt(t.duration)+10)}));let m=this.hasOverlappingEvent(e,r,i.for);if(m.length>0){console.log(`recurChangeTime WARNING...more overlaps for ${e}`,m,r.time);let u=0,E=m.length,v=this.getScheduledEvent(e);do console.log("CASCADING timeChange:",m[u],r.time,v.title),this.recurChangeTime(m[u].inConflict,v,r,l,s);while(++u<E)}let c=this.changeEvtTime(e,r,s);console.log(`recurChangeTime...${e} done to ${r.time}`,c,n,s);let d=a>0||l?b(o,{minute:0}):b(o,{minute:0});c=this.changeEvtTime(t.id,d,s),console.log(`recurChangeTime...toAdd ${t.id} to ${d.time}`,c,n,s)}else console.log("ERROR..ERROR overlapped event not found!",e)},fixAnOverlap(e,t=null){var m;let o=[{label:"Choose by Priority",value:"opt1",color:"secondary"},{label:"Choose by Score",value:"opt2"},{label:"Choose one event",value:"opt3"}];const l=c=>c.title.trim()+" Priority = "+s(c)+" && Score:: "+c.score,s=c=>{if(c!=null&&c.parentGoal){let d=this.parentGoalsMap.get(c.parentGoal);return d==null?void 0:d.priority}return console.log("findhigherPrio..ERROR no PARENT found?",c),null},i=(c,d)=>{this.doRemove(c),console.log("fixAnOverlap, adding",d),this.addEvtPropsIntoSchedule(this.currentDate,d)},a=(c,d,u)=>{let E=u.direction=="haut";this.addEvtPropsIntoSchedule(this.currentDate,d),this.recurChangeTime(c.id,d,u.targetStart,E,!0)};let n=this.getLocalEvt(e.target),r=this.getScheduledEvent(e.inConflict);if(!r||!n){console.log("fixAnOverlap...ERROR no evts found!!",e);return}e.direction!=="surrounding"&&o.push({label:`Force in '${n.title.trim()}' at ${(m=e==null?void 0:e.targetStart)==null?void 0:m.time}`,value:"opt4"}),this.$q.dialog({title:"Overlap Warning",cancel:!0,persistent:!0,message:`Event: '${n.title.trim()}' Overlaps with Scheduled '${r.title.trim()}'

              Resolve or Cancel to keep '${r.title.trim()}'`,options:{type:"radio",model:"opt1",items:o}}).onOk(c=>{if(c=="opt3"){let d="Pick one event...",u=[{label:l(n),value:n.id},{label:l(r),value:r.id}];this.showChoiceDialog(d,u,function(E){if(E==n.id){i(r,n);return}else{console.log("OPT3,chose scheduled",E,t);return}},function(){console.log("OPT3...cancelling")})}else if(c=="opt2"){let d="Pick event by Score",u=[{label:`"${n.title.trim()}" with Score:: ${n.score} = ${this.parseScore(n.score)}`,value:n.id},{label:`"${r.title.trim()}" with Score:: ${r.score} = ${this.parseScore(r.score)}`,value:r.id}];this.showChoiceDialog(d,u,function(E){E==n.id?i(r,n):console.log("OPT2, chose scheduled",E,t)},function(){console.log("OPT2...cancelling")})}else if(c=="opt1"){let d="Pick event by Priority",u=[{label:`"${n.title.trim()}" with Priority = ${s(n)}`,value:n.id},{label:`"${r.title.trim()}" with Priority = ${s(r)}`,value:r.id}];this.showChoiceDialog(d,u,function(E){if(E==n.id){i(r,n);return}else{console.log("OK OPT1, chose scheduled",E,t);return}},function(){console.log("OPT1...cancelling")})}else a(r,n,e)}).onCancel(()=>{this.doNotify(`Keeping scheduled "${r.title.trim()}"`,"positive","bottom"),t&&console.log("huh override... coolios")}).onDismiss(()=>{})},handleOverlaps(e){if(e.length===0)return[];const t=e.pop();this.handleOverlaps(e),this.fixAnOverlap(t)},loadForDate(e,t,o){let l=()=>{let i=this.getEventsForDate(e);if(!i){console.log(`ERROR no evts found for ${e}...`,i);return}console.log(`loadForDate for ${e}`,i,this.scheduledEvents,this.dailyScheduled.size);let a=this.filterEvtsTo(e,i);this.scheduledEvents=this.addPropsEventsTo(null,a);let n=this.updateCurrentSchedule();n.size>0&&!o?(console.log("loadForDate..REVIEW overlaps!!",n,e,o),this.fixConflicts(n)):(this.showReloadBtn=!1,this.disableSaveSchedule=!0,this.doNotify(`Loaded schedule for ${e}`,"positive","bottom"))},s=()=>{let i=this.getEventsForDate(e);if(!i){console.log(`ERROR no evts found for today:${e} ?!?`,i);return}let a=this.filterEvtsTo(e,i),n=this.overlapCheckEvtsAdd(a,e);return Object.keys(n).length>0?this.doNotify(`${e} with Some overlaps to fix!`,"warning","bottom"):this.doNotify(`Loaded schedule for ${e}`,"positive","bottom"),n};if(this.scheduledEvents=[],this.updateCurrentSchedule(),t)if(this.isViewingToday()){let i=s();if(Object.keys(i).length>0){console.log("Overlaps toHandle >>",i);for(let a in i){if(!i[a]||!i[a][0]){console.log("loadForDate...ERROR no local found",a);continue}let n=i[a];this.handleOverlaps(n)}this.showReloadBtn=t,this.disableSaveSchedule=!1,this.resetButtons(t,o);return}this.evtStartedOrPassed(N(new Date)),this.disableSaveSchedule=!0}else l(),this.allowScoreEdit(o);else this.showReloadBtn=!1,this.disableSaveSchedule=!0;(o||e!==F())&&this.adjustCurrentTime(),this.reset(),this.resetButtons(t,o)},scheduleDefaults(){this.scheduledEvents=[],this.updateCurrentSchedule();let e=this.deepCopy(this.store.fetchDefaults()),t=this.isViewingToday(),o=this.isViewingPast();if(this.showReloadBtn=this.hasEventsForDate,this.resetButtons(!0,o),this.disableSaveSchedule=!(e.length>0),this.reset(),t){let l=this.addPropsEventsTo(this.currentDate,e),s=this.overlapCheckEvtsAdd(l);if(console.log(`overlaps today?:${this.currentDate}`,e.length,l.length,Object.keys(s).length),Object.keys(s).length>0)for(let i in s){if(!s[i]||!s[i][0]){console.log("scheduleDefaults...ERROR no local found",i);continue}let a=s[i];this.handleOverlaps(a)}this.evtStartedOrPassed(N(new Date));return}else{this.scheduledEvents=this.addPropsEventsTo(this.currentDate,e);let l=this.updateCurrentSchedule();console.log("doLoadDefault..sameStart?",l),o?this.allowScoreEdit(!0):this.allowScoreEdit(!1)}},deepCopy(e){if(e===null||typeof e!="object")return e;if(Array.isArray(e))return e.map(o=>this.deepCopy(o));const t={};for(let o in e)e.hasOwnProperty(o)&&(t[o]=this.deepCopy(e[o]));return t},onRefresh(e){setTimeout(()=>{this.scheduledEvents=[],this.updateCurrentSchedule(),this.resetGoalEvts(!0),this.loadForDate(this.currentDate,this.hasEventsForDate,this.isViewingPast()),e()},1e3)},doSaveSchedule(){let e={};this.dailyScheduled.size<1?e=null:this.dailyScheduled.forEach((t,o,l)=>{e[o]={duration:t.for,time:t.start.time}}),this.store.saveDailySchedule(this.currentDate,e),this.disableSaveSchedule=!0,this.showReloadBtn=!this.showReloadBtn,this.doNotify(`doSaveSchedule for ${this.currentDate}`,"positive","top")},onAddNewEvent(e,t,o){console.log("Adding Event eh...",e,t,o,this.possibleRange),this.possibleRange||(this.possibleRange=this.startEndTimes);let l=X(this.possibleRange[0]),s=b(X(this.possibleRange[1]),{minute:15}),i=Math.floor(fe(l,s)/1e3/60),a=null;if(o=="self"){let n=this.store.addMainGoal(e,"","orange",2);n?(console.log("wooh parent created",n),a=this.store.addSubGoal(n,e,"1on5",l.time,i,!1)):console.log("ERROR? no pID",n)}else if(t)a=this.store.addSubGoal(t.id,e,"1on5",l.time,i,!1);else{let n=this.store.getGoalByTitle("Misc");if(n)console.log("Woo found Misc pgoal",n),a=this.store.addSubGoal(n.id,e,"1on5",l.time,i,!1);else{console.log("ERROR? no Misc pgoal",this.storedMainG);let r=this.store.addMainGoal("Misc","","purple",2);a=this.store.addSubGoal(r,e,"1on5",l.time,i,!1)}}a?(this.addEvtPropsIntoSchedule(this.currentDate,{id:a,time:l.time,score:"1on5",duration:i,canMove:!!t}),this.disableSaveSchedule=!1,this.showReloadBtn=this.hasEventsForDate):(console.log("BOO ERROR no subID:(",a),this.doNotify("Error adding this event :(","negative")),this.addEventDialog=!1,this.reset()},onChooseEvent(){this.addEventDialog=!1,this.pickEventDialog=!0},onPickEvent(){if(this.pickEventDialog=!1,!this.toAddE){console.log("onPickEvent...ERROR nill",this.toAddE);return}console.log(`I be picking ${this.toAddE.id} :: ${this.toAddE.title}`);let e=this.getScheduledEvent(this.toAddE.id);if(e){console.log("onPickEvent...NOT NEW?!?ERROR!",e,this.toAddE);return}else{e=this.toAddE,console.log(`onPickEvent...adding ${e.id} from ${e.time} to `,this.targetDrop.timestamp.time,this.skipAsk);let t=this.addEvtPropsIntoSchedule(this.currentDate,e),o=this.hasOverlappingEvent(e.id,this.targetDrop.timestamp,e.duration),l=o.length;if(l>0){console.log("hasOverlappingEvent...?",o,this.skipAsk);let s=0;do this.recurChangeTime(o[s].inConflict,e,this.targetDrop.timestamp,!1,this.skipAsk);while(++s<l)}else console.log("onPickEvent NO overlaps...changing to targetDrop!",t,this.skipAsk),this.changeEvtTime(e.id,this.targetDrop.timestamp,this.skipAsk)}console.log("AddEvent complete",e.id,this.skipAsk,this.scheduledEvents),this.disableSaveSchedule=!1,this.showReloadBtn=this.hasEventsForDate,this.reset()},onEndNow(e){const t=N(new Date);if(console.log("oooh doEndNow!!!",e,t.time),this.dailyScheduled.has(e)){let o=this.dailyScheduled.get(e),l=o.start,s=o.end;if(W(t,l,s,!0)){let i=this.getTimeNumber(s)-this.getTimeNumber(l),a=this.getTimeNumber(t)-this.getTimeNumber(l);console.log("end data be:",s,l,o),console.log(`Great, REDUCING duration from ${i} to:`,a);for(let n=0;n<this.scheduledEvents.length;n++){let r=this.scheduledEvents[n];r.id===e&&(r.duration=a)}this.dailyScheduled.set(e,{...o,for:a,end:t}),this.endTimesSet.delete(s.time)||console.log("ERROR endTimesSet item does not exist?!?",o,this.endTimesSet),this.endTimesSet.add(t.time)}else console.log("umm aint in the middle of this event! Nothing to do...ERROR?",t.time,l.time,s.time)}else{console.log("ERROR doEndNow not found!!!",e);return}this.disabledScoreEvts[e]=!1,this.disableSaveSchedule=!1,this.showReloadBtn=this.hasEventsForDate},onSaveScore(e,t){let o=this.dailyScheduled.get(t);if(o){o.score=e,this.doSaveEvtProp(t,null,e);let s=(i=>this.scheduledEvents.find(a=>a.id==i))(t);s?s.score=e:console.log("onSaveScore ERROR not found",s,t)}else console.log(`ERROR onSaveScore could not find event ${t}?!?`)},onReloadSaved(){let e=this.hasEventsForDate,t=()=>{console.log("Aborting",this.currentDate,this.scheduledEvents,e),this.showReloadBtn=!this.isViewingPast()||e},o=()=>{this.scheduledEvents=[],this.updateCurrentSchedule(),this.loadForDate(this.currentDate,e,this.isViewingPast())};this.scheduledEvents.length>0?this.confirmAction("Overwrite current Evts?",o,t):o(),this.showReloadBtn=!1},onLoadDefault(){let e=()=>{console.log("Aborting",this.currentDate,this.scheduledEvents)},t=()=>{this.scheduleDefaults()};this.scheduledEvents.length>0?this.confirmAction("Overwrite current Evts?",t,e):this.scheduleDefaults()},choosePrio(e){let t=this.chosenPrio;t&&t==e?this.disablePrioBtn=!0:(this.chosenPrio=e,this.disablePrioBtn=!1)},chooseScore(e){let t=this.chosenScore;t&&t==e?this.disableScoreBtn=!0:(this.chosenScore=e,this.disableScoreBtn=!1)},onReloadWithPrio(){if(this.chosenPrio==null){this.doNotify("Ayo select a priority!");return}const e=()=>this.scheduledEvents.filter(l=>{var s;return((s=this.parentGoalsMap.get(l.parentGoal))==null?void 0:s.priority)==this.chosenPrio});let t=()=>{console.log("onReloadWithPrio..cancelling",this.scheduledEvents),this.reset()};const o=l=>{let s=[];if(l=="overwrite"){let a=this.deepCopy(this.storedEvents);for(let n of a){let r=this.parentGoalsMap.get(n.parentGoal);(r==null?void 0:r.priority)==this.chosenPrio&&s.push(n)}}else s=e(),console.log("findSamePrio..filtering!!",this.chosenPrio,s);let i=this.addPropsEventsTo(this.currentDate,s);if(this.isViewingToday()){let a=this.overlapCheckEvtsAdd(i);if(Object.keys(a).length>0){console.log("onReloadWithScore..overlaps!!",this.chosenScore,a);for(let r in a){if(!a[r]||!a[r][0]){console.log("onReloadWithScore...ERROR no local found",r);continue}let m=a[r];this.handleOverlaps(m)}let n=this.evtStartedOrPassed(N(new Date));console.log("onReloadWithPrio:enabledScoreEdit",n)}else console.log("onReloadWithPrio >>No overlaps!!...",i.length),this.scheduledEvents=i,this.updateCurrentSchedule()}else this.scheduledEvents=i,this.allowScoreEdit(!1);if(!this.scheduledEvents.length>0){this.doNotify(`Empty for Priority =${this.chosenPrio} :(`,"warning","bottom"),this.disableSaveSchedule=!0,this.showReloadBtn=this.hasEventsForDate;return}this.disableSaveSchedule=!1,this.showReloadBtn=this.hasEventsForDate};if(this.scheduledEvents.length>0){let l=[{label:`Filter current by priority = ${this.chosenPrio}`,value:"filter"},{label:`Overwrite and schedule by priority = ${this.chosenPrio}`,value:"overwrite"}];this.showChoiceDialog("Choose Resolution...",l,function(s){console.log("OK ReloadWithPrio",s),o(s)},t)}else o("overwrite");this.resetButtons(this.hasEventsForDate,this.isViewingPast()),this.disablePrioBtn=!0},onReloadWithScore(){if(this.chosenScore==null){this.doNotify("Ayo select a score!");return}let e=()=>{console.log("onReloadWithScore..cancelling",this.scheduledEvents),this.reset()};const t=()=>{let l=[];return this.scheduledEvents.forEach(s=>{let i=this.parseScore(s.score);i>-1&&i>=this.chosenScore&&l.push(s)}),l},o=l=>{let s=[];if(l=="overwrite"?s=this.addPropsEventsTo(this.currentDate,this.store.fetchGoalsWithMinScore(this.chosenScore)):s=t(),console.log(`onReloadWithScore: ${this.chosenScore}`,this.currentDate,this.isViewingToday(),s),this.isViewingToday()){let i=this.overlapCheckEvtsAdd(s);if(Object.keys(i).length>0){console.log("onReloadWithScore..overlaps!!",this.chosenScore,i);for(let n in i){if(!i[n]||!i[n][0]){console.log("onReloadWithScore...ERROR no local found",n);continue}let r=i[n];this.handleOverlaps(r)}let a=this.evtStartedOrPassed(N(new Date));console.log("onReloadWithScore:enabledScoreEdit",a)}else console.log("onReloadWithScore >>No overlaps!!...",s.length),this.scheduledEvents=s,this.updateCurrentSchedule()}else this.scheduledEvents=s,this.updateCurrentSchedule(),this.allowScoreEdit(!1);if(!this.scheduledEvents.length>0){this.doNotify(`Empty for Score >=${this.chosenScore} :(`,"warning","bottom"),this.disableSaveSchedule=!0,this.showReloadBtn=this.hasEventsForDate,this.disableScoreBtn=!0;return}this.disableSaveSchedule=!1,this.showReloadBtn=this.hasEventsForDate};if(this.scheduledEvents.length>0){let l=[{label:`Filter current by Interval Score > ${this.chosenScore}`,value:"filter"},{label:`Overwrite and schedule by Interval Score > ${this.chosenScore}`,value:"overwrite"}];this.showChoiceDialog("Choose Resolution...",l,function(s){o(s)},e)}else o("overwrite");this.resetButtons(this.hasEventsForDate,this.isViewingPast()),this.disableScoreBtn=!0},onChange(e){this.loadForDate(e.start,this.hasEventsForDate,this.isViewingPast())},onDragStart(e,t){if(this.isViewingPast()){this.doNotify("Editing past is no no!"),e.preventDefault();return}this.draggedItem=t},onDragEnter(e,t,o){return t==="goal-item"||(this.targetDrop=o),e.preventDefault(),!0},onDragOver(e,t,o){return e.preventDefault(),!0},onDragLeave(e,t,o){return!1},onDragEnd(e){console.log("onDragEnd",this.endTimesSet,this.startTimesSet)},onDrop(e,t,o){let l=this.getScheduledEvent(this.draggedItem.id);if(!l){console.log("onDrop ERROR",l,this.draggedItem);return}let s=null;if(t==="interval")console.log("onDrop...normal move with scope",o.timestamp),s=o.timestamp;else if(t==="goal-item"&&this.targetDrop)console.log("Dropping goal-item!!",e,t,this.targetDrop.timestamp),s=this.targetDrop.timestamp;else{console.log("Cannot drop here YO!!",e,t,o,this.targetDrop);return}if(!s){console.log("ERROR...no timestamp YO!!",e,t,o,this.targetDrop);return}let i=this.hasOverlappingEvent(l.id,s,l.duration),a=i.length;if(a>0){console.log("WOAH WOAH onDrop...overlapp!",i);let n=0;do i[n].inConflict==i[n].target&&console.log("EUUUH...self overlap?!?",i),this.recurChangeTime(i[n].inConflict,l,s,!1,!1);while(++n<a)}else{let n=this.changeEvtTime(l.id,s,!1);console.log("onDrop no overlap complete",n,l.id,s)}this.disableSaveSchedule=!1,this.showReloadBtn=this.hasEventsForDate},onDblClickEvent(e,t){if(this.isViewingPast()){this.doNotify("Removing from the past is a no no!"),e.preventDefault();return}this.removeEvtInSchedule(t)},onClickDate(e){console.log("onClickDate",e)},onClickTime(e){console.log("onClickTime..event",e),this.isViewingPast(),this.addEventDialog=!0,this.targetDrop=e.scope},onClickInterval(e){console.log("onClickInterval",e)},onClickHeadIntervals(e){console.log("onClickHeadIntervals",e)},onClickHeadDay(e){console.log("onClickHeadDay",e)},onMouseEnter(e){console.log("onMouseAt",e)},onMouseLeave(e){console.log("onMouseLeave",JSON.stringify(e))},onMouseDownTime({scope:e,event:t}){if(console.log("onMouseDownTime",{scope:e,event:t}),ve(t)){if(console.log("onMouseDownTime and its a leftClick event"),this.mobile===!0&&this.anchorTimestamp!==null&&this.otherTimestamp!==null&&R(this.anchorTimestamp)===R(this.otherTimestamp)){this.otherTimestamp=e.timestamp,this.mouseDown=!1;return}this.mouseDown=!0,this.anchorTimestamp=e.timestamp,this.otherTimestamp=e.timestamp}},onMouseUpTime({scope:e,event:t}){if(console.log("onMouseUpTime",{scope:e,event:t}),this.mobile!==!0&&ve(t)&&(this.otherTimestamp=e.timestamp,this.mouseDown=!1),!this.mousedown){let o=this.startEndTimes;if(o[1]==o[0])return;this.possibleRange=o,console.log("onMouseUpTime range change",this.possibleRange)}},onMouseMoveTime({scope:e,event:t}){this.mobile!==!0&&this.mouseDown===!0&&(this.otherTimestamp=e.timestamp)},scrollToEvent(e){this.$refs.calendar.scrollToTime(e.time,350)},onToday(){let e=()=>{this.$refs.calendar.moveToToday()},t=()=>{setTimeout(e,1e3),this.doSaveSchedule()};this.disableSaveSchedule?e():this.confirmAction("Save schedule changes?",t,e)},onPrev(){console.log("onPrev",this.currentDate);let e=()=>{this.$refs.calendar.prev()},t=()=>{setTimeout(e,1e3),this.doSaveSchedule()};this.disableSaveSchedule?e():this.confirmAction("Save schedule changes?",t,e)},onNext(){let e=()=>{this.$refs.calendar.next()},t=()=>{setTimeout(e,1e3),this.doSaveSchedule()};this.disableSaveSchedule?e():this.confirmAction("Save schedule changes?",t,e)}}}),te=e=>(De("data-v-5a3eb75f"),e=e(),Ce(),e),bt={key:0,class:"q-gutter-md"},yt={key:1,class:"subcontent"},wt={class:"float-right"},Tt={key:0},Dt={key:1},Ct={key:2},Rt={key:3},kt={class:"row justify-center"},Ot={style:{display:"flex","max-width":"800px",width:"100%",height:"400px"}},Pt={style:{display:"flex","justify-content":"center","flex-wrap":"wrap",padding:"2px"}},$t={class:"title q-calendar__ellipsis"},Bt=["onDblclick","onDragstart"],Nt=te(()=>w("div",{class:"text-h6"},"Ad hoc or Existing event",-1)),At={class:"q-ml-md event-select"},Mt=te(()=>w("div",{class:"text-h3"},"Select event",-1)),Vt={class:"q-ml-md event-select"},qt={class:"row justify-center"},Gt=te(()=>w("br",null,null,-1)),It={class:"scroll overflow-auto",style:{height:"360px",width:"100%"}};function Ht(e,t,o,l,s,i){const a=I("add-goal-form"),n=I("navigation-bar"),r=I("goaly-end"),m=I("q-calendar-day"),c=I("ad-hoc-event");return S(),y(k,null,[e.showForm?(S(),y("div",bt,[h(T,{class:"q-pl-xl justify-center",color:"","text-color":"green",elevated:"",label:"HideForm",onClick:t[0]||(t[0]=d=>e.showGoalForm=!e.showGoalForm),"no-caps":""}),h(a)])):O("",!0),e.showForm?O("",!0):(S(),y("div",yt,[h(Qe,{onRefresh:e.onRefresh},{default:p(()=>[h(n,{onToday:e.onToday,onPrev:e.onPrev,onNext:e.onNext},null,8,["onToday","onPrev","onNext"]),w("div",wt,[e.showReloadBtn?(S(),y("div",Tt,[h(T,{class:"q-mt-xl",color:"","text-color":"green",elevated:"",label:"Reload",onClick:e.onReloadSaved,"no-caps":""},null,8,["onClick"])])):O("",!0),e.loadDefault?(S(),y("div",Dt,[h(T,{class:"q-mt-xl",color:"","text-color":"blue",elevated:"",label:"Defaults",onClick:e.onLoadDefault,"no-caps":""},null,8,["onClick"])])):O("",!0),e.showScoreBtn?(S(),y("div",Ct,[h(me,{split:"",color:"",class:"q-mt-xl","text-color":"teal",elevated:"","disable-main-btn":e.disableScoreBtn,label:e.chosenScoreLabel,onClick:e.onReloadWithScore,"no-caps":""},{default:p(()=>[h(ae,null,{default:p(()=>[(S(!0),y(k,null,H(e.scoreOptions,d=>ie((S(),M(he,{key:d.id,clickable:"",onClick:u=>e.chooseScore(d)},{default:p(()=>[h(re,null,{default:p(()=>[h(de,null,{default:p(()=>[A($(d),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"])),[[pe]])),128))]),_:1})]),_:1},8,["disable-main-btn","label","onClick"])])):O("",!0),e.showPrio?(S(),y("div",Rt,[h(me,{split:"",color:"",class:"q-mt-xl","text-color":"teal",elevated:"","disable-main-btn":e.disablePrioBtn,label:e.chosenPrioLabel,onClick:e.onReloadWithPrio,"no-caps":""},{default:p(()=>[h(ae,null,{default:p(()=>[(S(!0),y(k,null,H(e.setGoalsPrio(),d=>ie((S(),M(he,{key:d,clickable:"",onClick:u=>e.choosePrio(d)},{default:p(()=>[h(re,null,{default:p(()=>[h(de,null,{default:p(()=>[A($(d),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"])),[[pe]])),128))]),_:1})]),_:1},8,["disable-main-btn","label","onClick"])])):O("",!0)])]),_:1},8,["onRefresh"]),w("div",kt,[w("div",Ot,[h(m,{ref:"calendar",view:"day",modelValue:e.currentDate,"onUpdate:modelValue":t[5]||(t[5]=d=>e.currentDate=d),"drag-enter-func":e.onDragEnter,"drag-over-func":e.onDragOver,"drag-leave-func":e.onDragLeave,"drop-func":e.onDrop,animated:"",bordered:"",hoverable:"","no-active-date":"","transition-next":"slide-left","transition-prev":"slide-right","time-clicks-clamped":"","interval-minutes":15,"interval-count":96,"interval-height":28,"selected-start-end-dates":e.startEndTimes,onChange:e.onChange,onClickDate:e.onClickDate,onClickTime:e.onClickTime,onClickInterval:e.onClickInterval,onClickHeadIntervals:e.onClickHeadIntervals,onClickHeadDay:e.onClickHeadDay,onMousedownTime:e.onMouseDownTime,onMouseupTime:e.onMouseUpTime,onMousemoveTime:e.onMouseMoveTime},{"head-day-event":p(({scope:{timestamp:d}})=>[w("div",Pt,[(S(!0),y(k,null,H(e.eventsMap[d.date],u=>(S(),y(k,{key:u.id},[u.time?(S(),M(ue,{key:1,class:j(e.badgeClasses(u,"header")),style:V([e.badgeStyles(u,"header"),{margin:"1px",width:"10px","max-width":"10px",height:"10px","max-height":"10px",cursor:"pointer"}]),onClick:E=>e.scrollToEvent(u)},{default:p(()=>[h(x,null,{default:p(()=>[A($(u.time+" - "+u.title),1)]),_:2},1024)]),_:2},1032,["class","style","onClick"])):(S(),M(ue,{key:0,class:j(e.badgeClasses(u,"header")),style:V([e.badgeStyles(u,"header"),{width:"100%",cursor:"pointer",height:"12px","font-size":"10px",margin:"1px"}])},{default:p(()=>[w("div",$t,[A($(u.title)+" ",1),h(x,null,{default:p(()=>[A($(u.details),1)]),_:2},1024)])]),_:2},1032,["class","style"]))],64))),128))])]),"day-container":p(({scope:{days:d}})=>[e.hasDate(d)?(S(),y(k,{key:0},[w("div",{class:"day-view-current-time-indicator",style:V(e.style)},null,4),w("div",{class:"day-view-current-time-line",style:V(e.style)},null,4)],64)):O("",!0)]),"day-body":p(({scope:{timestamp:d,timeStartPos:u,timeDurationHeight:E}})=>[(S(!0),y(k,null,H(e.getDateEvents(d.date),v=>(S(),y(k,{key:v.id},[v.time!==void 0?(S(),y("div",{key:0,class:j(["my-event",e.badgeClasses(v,"body")]),style:V(e.badgeStyles(v,"body",u,E)),draggable:!0,onDblclick:Q(D=>e.onDblClickEvent(D,v),["prevent"]),onDragstart:Q(D=>e.onDragStart(D,v),["stop"]),onDragend:t[1]||(t[1]=Q((...D)=>e.onDragEnd&&e.onDragEnd(...D),["stop"])),onDrop:t[2]||(t[2]=D=>e.onDrop(D,"goal-item",e.scope)),onDragenter:t[3]||(t[3]=D=>e.onDragEnter(D,"goal-item",e.scope)),onDragover:t[4]||(t[4]=D=>e.onDragOver(D,"goal-item",e.scope))},[h(r,{disabledScore:e.disabledScoreEvts[v.id],title:v.title,id:v.id,startTime:v.time,score:v.score,details:v.details,happeningNow:e.hasStarted[v.id]?e.hasStarted[v.id]:!1,onEndNow:e.onEndNow,onSaveScore:e.onSaveScore,onDeleteNow:D=>e.removeEvtInSchedule(v,D)},null,8,["disabledScore","title","id","startTime","score","details","happeningNow","onEndNow","onSaveScore","onDeleteNow"])],46,Bt)):O("",!0)],64))),128))]),_:1},8,["modelValue","drag-enter-func","drag-over-func","drag-leave-func","drop-func","selected-start-end-dates","onChange","onClickDate","onClickTime","onClickInterval","onClickHeadIntervals","onClickHeadDay","onMousedownTime","onMouseupTime","onMousemoveTime"])]),h(se,{modelValue:e.addEventDialog,"onUpdate:modelValue":t[8]||(t[8]=d=>e.addEventDialog=d),"transition-show":"rotate","transition-hide":"rotate"},{default:p(()=>[e.adHocEventDialog?(S(),M(Y,{key:0},{default:p(()=>[h(ne,null,{default:p(()=>[Nt]),_:1}),h(J,{align:"center"},{default:p(()=>[h(T,{flat:"",label:"Add hoc",color:"primary",onClick:t[6]||(t[6]=d=>e.adHocEventDialog=!e.adHocEventDialog)}),h(T,{flat:"",label:"Existing",color:"primary",onClick:e.onChooseEvent},null,8,["onClick"])]),_:1})]),_:1})):(S(),M(Y,{key:1},{default:p(()=>[w("div",At,[h(c,{mainGoals:e.storedMainG,onSaveEvent:e.onAddNewEvent},null,8,["mainGoals","onSaveEvent"]),h(T,{flat:"",label:"Cancel",color:"primary",onClick:t[7]||(t[7]=d=>e.adHocEventDialog=!e.adHocEventDialog)})])]),_:1}))]),_:1},8,["modelValue"]),h(se,{modelValue:e.pickEventDialog,"onUpdate:modelValue":t[11]||(t[11]=d=>e.pickEventDialog=d),"transition-show":"rotate","transition-hide":"rotate"},{default:p(()=>[h(Y,null,{default:p(()=>[h(ne,null,{default:p(()=>[Mt]),_:1}),h(Te),w("div",Vt,[h(ke,{modelValue:e.toAddE,"onUpdate:modelValue":t[9]||(t[9]=d=>e.toAddE=d),options:e.canbeScheduled,"option-value":"id","option-label":"title",label:"Sub Goal","item-aligned":"",popupContentClass:"q-gutter-md"},null,8,["modelValue","options"])]),h(J,{align:"center"},{default:p(()=>[h(Ue,{dense:"",modelValue:e.skipAsk,"onUpdate:modelValue":t[10]||(t[10]=d=>e.skipAsk=d),label:"Force",color:"teal",class:"q-pa-sm"},null,8,["modelValue"])]),_:1}),h(J,{align:"evenly"},{default:p(()=>[h(T,{elevated:"",label:"Add",color:"primary",class:"q-mr-md",onClick:e.onPickEvent},null,8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),w("div",qt,[h(T,{class:"q-mt-xl",color:"Green","text-color":"blue",elevated:"",label:"SaveSchedule",disable:e.doDisableSaveSchedule,onClick:e.doSaveSchedule,"no-caps":""},null,8,["disable","onClick"]),h(T,{class:"q-mt-xl",color:"","text-color":"green",elevated:"",label:"ShowForm",onClick:t[12]||(t[12]=d=>e.showGoalForm=!e.showGoalForm),"no-caps":""})]),Gt,w("div",It,[(S(!0),y(k,null,H(e.storedEvents,(d,u)=>(S(),y("div",{key:u,class:"col-12",style:{"font-size":"10px","line-height":"10px","max-height":"14px","min-height":"14px",padding:"2px 2px","white-space":"nowrap"}},$(d),1))),128))])]))],64)}var jt=ee(Et,[["render",Ht],["__scopeId","data-v-5a3eb75f"]]);export{jt as default};
