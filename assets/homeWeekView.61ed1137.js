import{a as P,b as B,Q as D,c as w}from"./utiFunc.fa09095d.js";import{j as z,q as S,s as v,c as Q,h as F,k as R,g as j,u as K,x as W,_ as U,d as L,r as k,E as M,F as l,G as x,H as u,I as i,K as r,M as m,N as q,O as b,Q as T,P as O,R as A,S as g,U as _,V as H,W as E,J as C,X as J,Y as X}from"./index.0be02db7.js";import{N as Y,t as Z,p as ee,a as y,b as G,c as I,i as N,Q as te}from"./NavigationBar.a73f663d.js";import{Q as ae}from"./QCalendar.d1ca0719.js";import{u as se}from"./goalStorage.2ff93a7a.js";import"./use-quasar.d05457bc.js";var oe=z({name:"QPage",props:{padding:Boolean,styleFn:Function},setup(e,{slots:t}){const{proxy:{$q:a}}=j(),s=S(K,v);if(s===v)return console.error("QPage needs to be a deep child of QLayout"),v;if(S(W,v)===v)return console.error("QPage needs to be child of QPageContainer"),v;const c=Q(()=>{const p=(s.header.space===!0?s.header.size:0)+(s.footer.space===!0?s.footer.size:0);if(typeof e.styleFn=="function"){const o=s.isContainer.value===!0?s.containerHeight.value:a.screen.height;return e.styleFn(p,o)}return{minHeight:s.isContainer.value===!0?s.containerHeight.value-p+"px":a.screen.height===0?p!==0?`calc(100vh - ${p}px)`:"100vh":a.screen.height-p+"px"}}),h=Q(()=>`q-page${e.padding===!0?" q-layout-padding":""}`);return()=>F("main",{class:h.value,style:c.value},R(t.default))}});const ne=L({name:"weekCalendar",components:{NavigationBar:Y,QCalendar:ae},data(){return{store:se(),calendar:k(null),currentDate:k(Z()),events:[],mostEvts:5,treeGoals:k([]),expanded:k([])}},beforeMount(){this.loadEvts(),this.constructTree()},mounted(){console.log("mounted")},computed:{storedGoalsMap(){const e=new Map;let t=this.store.getSubGoals;return t?(t.forEach(a=>{e.set(a.id,a)}),e):(console.log("GoalsMap is empty or null",t),e)},allEvents(){return this.store.getAllDates},parentGoalsMap(){const e=new Map;let t=this.store.getMainGoals;return t?(t.forEach(a=>{e.set(a.id,a)}),e):(console.log("parentGoalsMap is empty or null",t),e)},storedEvents(){return this.store.getSubGoals},eventsMap(){const e={};return this.events.forEach(t=>{if(e[t.date]||(e[t.date]=[]),e[t.date].push(t),t.days){console.log(`eventsMap multiple days? event for ${t.date}`,t.days);let a=ee(t.date),s=t.days;do a=y(a,{day:1}),e[a.date]||(e[a.date]=[]),e[a.date].push(t);while(--s>0)}}),e}},methods:{classyColor(e){return`row items-center ${e.isChildren?"text-":"text-white bg-"}${e.color} `},loadEvts(){let e=this.parentGoalsMap,t=this.storedGoalsMap,a=this.allEvents;if(t&&e){if(a)for(let s in a){let d=a[s];for(let c in d){let h=t.get(parseInt(c));if(h){let p=e.get(h.parentGoal),o=y(I(s),{minute:G(d[c].time)}),n=y(o,{minute:parseInt(d[c].duration)});this.events.push({id:h.id,title:h.title,details:`${o.time} - ${n.time}`,time:d[c].time,duration:d[c].duration,date:s,bgcolor:p.bgcolor})}}}}else{console.log("ERROR--no parent or goals!!REVIEW**");return}},constructTree(){this.treeGoals=this.store.fetchGoalsTree()},getEvents(e){const t=this.eventsMap[e]||[];if(t.length===1)t[0].side="full";else if(t.length===2){const a=y(I(t[0].date),{minute:G(t[0].time)}),s=y(a,{minute:t[0].duration}),d=y(I(t[1].date),{minute:G(t[1].time)}),c=y(d,{minute:t[1].duration});N(d,a,s,!0)||N(c,a,s,!0)?(t[0].side="left",t[1].side="right"):(t[0].side="full",t[1].side="full")}return t.length>this.mostEvts&&(this.mostEvts=t.length),t},badgeClasses(e,t){return P(e,t)},badgeStyles(e,t,a=void 0,s=void 0){return B(e,t,a,s)},scrollToEvent(e){this.$refs.calendar.scrollToTime(e.time,350)},onToday(){this.$refs.calendar.moveToToday()},onPrev(){this.doReset=!0,this.$refs.calendar.prev()},onNext(){this.$refs.calendar.next()},onClickDate(e){console.log("onClickDate",e)},onClickTime(e){console.log("onClickTime",e)},onClickInterval(e){console.log("onClickInterval",e)},onClickHeadIntervals(e){console.log("onClickHeadIntervals",e)},onClickHeadDay(e){console.log("onClickHeadDay",e)},onChange(e){this.mostEvts=5,console.log("onChange",e)}}}),V=e=>(J("data-v-7ce6ed8b"),e=e(),X(),e),le={class:"row justify-center"},ie={style:{display:"flex","max-width":"800px",width:"100%",height:"400px",overflow:"auto"}},re={style:{display:"flex","justify-content":"center","flex-wrap":"wrap",padding:"2px"}},de={class:"title q-calendar__ellipsis"},ce={class:"title q-calendar__ellipsis"},ue={class:"row justify-center items-center"},pe={key:0,class:"q-pa-xl bg-grey-12",style:{"max-width":"400px"}},he=V(()=>r("div",{class:"row justify-center"}," Goals & Goal Events ",-1)),me=V(()=>r("br",null,null,-1)),ge={class:"q-mr-sm text-weight-bold",size:"28px"},ye={key:0},fe={class:"text-weight-bold"},ve={key:1,class:"text-weight-light text-black"};function Ce(e,t,a,s,d,c){const h=M("navigation-bar"),p=M("q-calendar");return l(),x(oe,null,{default:u(()=>[i(h,{onToday:e.onToday,onPrev:e.onPrev,onNext:e.onNext},null,8,["onToday","onPrev","onNext"]),r("div",le,[r("div",ie,[i(p,{ref:"calendar",modelValue:e.currentDate,"onUpdate:modelValue":t[0]||(t[0]=o=>e.currentDate=o),view:"week",dark:"",animated:"",hoverable:"",bordered:"","transition-prev":"slide-right","transition-next":"slide-left","no-active-date":"","interval-minutes":30,"interval-count":48,"interval-height":e.mostEvts*3,onChange:e.onChange,onClickDate:e.onClickDate,onClickTime:e.onClickTime,onClickInterval:e.onClickInterval,onClickHeadIntervals:e.onClickHeadIntervals,onClickHeadDay:e.onClickHeadDay},{"head-day-event":u(({scope:{timestamp:o}})=>[r("div",re,[(l(!0),m(b,null,q(e.eventsMap[o.date],n=>(l(),m(b,{key:n.id},[n.time?(l(),x(D,{key:1,class:_(e.badgeClasses(n,"header")),style:E([e.badgeStyles(n,"header"),{margin:"1px",width:"10px","max-width":"10px",height:"10px","max-height":"10px",cursor:"pointer"}]),onClick:$=>e.scrollToEvent(n)},{default:u(()=>[i(w,null,{default:u(()=>[C(g(n.time+" - "+n.title),1)]),_:2},1024)]),_:2},1032,["class","style","onClick"])):(l(),x(D,{key:0,class:_(e.badgeClasses(n,"header")),style:E([e.badgeStyles(n,"header"),{width:"100%",cursor:"pointer",height:"12px","font-size":"10px",margin:"1px"}])},{default:u(()=>[r("div",de,[C(g(n.title)+" ",1),i(w,null,{default:u(()=>[C(g(n.details),1)]),_:2},1024)])]),_:2},1032,["class","style"]))],64))),128))])]),"day-body":u(({scope:{timestamp:o,timeStartPos:n,timeDurationHeight:$}})=>[(l(!0),m(b,null,q(e.getEvents(o.date),f=>(l(),m(b,{key:f.id},[f.time!==void 0?(l(),m("div",{key:0,class:_(["my-event",e.badgeClasses(f,"body")]),style:E(e.badgeStyles(f,"body",n,$))},[r("span",ce,[C(g(f.title)+" ",1),i(w,null,{default:u(()=>[C(g(f.details),1)]),_:2},1024)])],6)):H("",!0)],64))),128))]),_:1},8,["modelValue","interval-height","onChange","onClickDate","onClickTime","onClickInterval","onClickHeadIntervals","onClickHeadDay"])])]),r("div",ue,[i(T,{class:"q-ma-xl",color:"white","text-color":"blue",unelevated:"",to:"/summary",label:"Summary","no-caps":""}),i(T,{class:"q-ma-xl",color:"white","text-color":"blue",unelevated:"",to:"/dayCalendar",label:"Daily Calendar","no-caps":""}),i(T,{class:"q-ma-xl",color:"white","text-color":"blue",unelevated:"",to:"/viewGoals",label:"Goals","no-caps":""})]),e.treeGoals.length>0?(l(),m("div",pe,[he,i(O),me,i(te,{nodes:e.treeGoals,"node-key":"label",expanded:e.expanded,"onUpdate:expanded":t[1]||(t[1]=o=>e.expanded=o),"no-connectors":"",dense:""},{"default-header":u(o=>[r("div",{class:_(e.classyColor(o.node))},[i(A,{name:o.node.icon||"arrow",size:"28px",class:"q-mr-sm"},null,8,["name"]),r("div",ge,g(o.node.label),1)],2)]),"default-body":u(o=>[o.node.isChildren?(l(),m("div",ye,[r("span",fe," >> "+g(o.node.details),1)])):(l(),m("span",ve,g(o.node.details),1))]),_:1},8,["nodes","expanded"])])):H("",!0)]),_:1})}var Ee=U(ne,[["render",Ce],["__scopeId","data-v-7ce6ed8b"]]);export{Ee as default};
