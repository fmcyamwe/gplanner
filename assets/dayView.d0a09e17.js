import{j as Q,c as q,h as C,k as Ee,af as be,a2 as Oe,r as f,ag as $e,ah as Ne,w as oe,b as Be,ai as Ae,Q as D,g as ye,aj as Me,ak as Ve,al as qe,am as Ge,W as Ie,an as He,n as Fe,ao as _e,d as we,_ as ee,F as S,M as y,J as A,S as $,I as u,H as p,R as V,ap as De,aq as Ue,ar as W,aa as Te,K as w,as as le,U as P,ad as Ce,ae as Re,E as I,at as se,O as k,N as H,f as ie,G as M,P as j,au as ne,av as J,ac as Y,aw as Le}from"./index.0f75d3cd.js";import{Q as ke,a as Pe,b as We,c as Qe,d as ze,e as ae,f as re,g as de,h as he}from"./viewAllGoals.68919cda.js";import{a as x,Q as ue}from"./QBadge.bb61bc7c.js";import{c as Ke,a as je,b as Je}from"./utiFunc.696b94ce.js";import{N as Ye,t as F,p as X,a as b,j as R,k as Z,S as Xe,b as N,c as O,i as L,C as ce,T as B,U as fe}from"./NavigationBar.8e417093.js";/* empty css                             */import{u as Ze}from"./goalStorage.8dbaf97b.js";import{u as xe}from"./use-quasar.17b845fa.js";var et=Q({name:"QBtnGroup",props:{unelevated:Boolean,outline:Boolean,flat:Boolean,rounded:Boolean,square:Boolean,push:Boolean,stretch:Boolean,glossy:Boolean,spread:Boolean},setup(e,{slots:t}){const s=q(()=>{const o=["unelevated","outline","flat","rounded","square","push","stretch","glossy"].filter(l=>e[l]===!0).map(l=>`q-btn-group--${l}`).join(" ");return`q-btn-group row no-wrap${o.length>0?" "+o:""}`+(e.spread===!0?" q-btn-group--spread":" inline")});return()=>C("div",{class:s.value},Ee(t.default))}});const tt=Object.keys(be),ot=e=>tt.reduce((t,s)=>{const o=e[s];return o!==void 0&&(t[s]=o),t},{});var me=Q({name:"QBtnDropdown",props:{...be,...Oe,modelValue:Boolean,split:Boolean,dropdownIcon:String,contentClass:[Array,String,Object],contentStyle:[Array,String,Object],cover:Boolean,persistent:Boolean,noRouteDismiss:Boolean,autoClose:Boolean,menuAnchor:{type:String,default:"bottom end"},menuSelf:{type:String,default:"top end"},menuOffset:Array,disableMainBtn:Boolean,disableDropdown:Boolean,noIconAnimation:Boolean,toggleAriaLabel:String},emits:["update:modelValue","click","beforeShow","show","beforeHide","hide"],setup(e,{slots:t,emit:s}){const{proxy:o}=ye(),l=f(e.modelValue),i=f(null),n=$e(),a=q(()=>{const m={"aria-expanded":l.value===!0?"true":"false","aria-haspopup":"true","aria-controls":n,"aria-label":e.toggleAriaLabel||o.$q.lang.label[l.value===!0?"collapse":"expand"](e.label)};return(e.disable===!0||e.split===!1&&e.disableMainBtn===!0||e.disableDropdown===!0)&&(m["aria-disabled"]="true"),m}),r=q(()=>"q-btn-dropdown__arrow"+(l.value===!0&&e.noIconAnimation===!1?" rotate-180":"")+(e.split===!1?" q-btn-dropdown__arrow-container":"")),h=q(()=>Ne(e)),v=q(()=>ot(e));oe(()=>e.modelValue,m=>{i.value!==null&&i.value[m?"show":"hide"]()}),oe(()=>e.split,G);function d(m){l.value=!0,s("beforeShow",m)}function c(m){s("show",m),s("update:modelValue",!0)}function E(m){l.value=!1,s("beforeHide",m)}function g(m){s("hide",m),s("update:modelValue",!1)}function T(m){s("click",m)}function z(m){Me(m),G(),s("click",m)}function K(m){i.value!==null&&i.value.toggle(m)}function U(m){i.value!==null&&i.value.show(m)}function G(m){i.value!==null&&i.value.hide(m)}return Object.assign(o,{show:U,hide:G,toggle:K}),Be(()=>{e.modelValue===!0&&U()}),()=>{const m=[C(Ae,{class:r.value,name:e.dropdownIcon||o.$q.iconSet.arrow.dropdown})];return e.disableDropdown!==!0&&m.push(C(ke,{ref:i,id:n,class:e.contentClass,style:e.contentStyle,cover:e.cover,fit:!0,persistent:e.persistent,noRouteDismiss:e.noRouteDismiss,autoClose:e.autoClose,anchor:e.menuAnchor,self:e.menuSelf,offset:e.menuOffset,separateClosePopup:!0,transitionShow:e.transitionShow,transitionHide:e.transitionHide,transitionDuration:e.transitionDuration,onBeforeShow:d,onShow:c,onBeforeHide:E,onHide:g},t.default)),e.split===!1?C(D,{class:"q-btn-dropdown q-btn-dropdown--simple",...v.value,...a.value,disable:e.disable===!0||e.disableMainBtn===!0,noWrap:!0,round:!1,onClick:T},{default:()=>Ee(t.label,[]).concat(m),loading:t.loading}):C(et,{class:"q-btn-dropdown q-btn-dropdown--split no-wrap q-btn-item",rounded:e.rounded,square:e.square,...h.value,glossy:e.glossy,stretch:e.stretch},()=>[C(D,{class:"q-btn-dropdown--current",...v.value,disable:e.disable===!0||e.disableMainBtn===!0,noWrap:!0,round:!1,onClick:z},{default:t.label,loading:t.loading}),C(D,{class:"q-btn-dropdown__arrow-container q-anchor--skip",...a.value,...h.value,disable:e.disable===!0||e.disableDropdown===!0,rounded:e.rounded,color:e.color,textColor:e.textColor,dense:e.dense,size:e.size,padding:e.padding,ripple:e.ripple},()=>m)])}}});function ge(e){if(e===!1)return 0;if(e===!0||e===void 0)return 1;const t=parseInt(e,10);return isNaN(t)?0:t}var pe=Ve({name:"close-popup",beforeMount(e,{value:t}){const s={depth:ge(t),handler(o){s.depth!==0&&setTimeout(()=>{const l=qe(e);l!==void 0&&Ge(l,o,s.depth)})},handlerKey(o){Ie(o,13)===!0&&s.handler(o)}};e.__qclosepopup=s,e.addEventListener("click",s.handler),e.addEventListener("keyup",s.handlerKey)},updated(e,{value:t,oldValue:s}){t!==s&&(e.__qclosepopup.depth=ge(t))},beforeUnmount(e){const t=e.__qclosepopup;e.removeEventListener("click",t.handler),e.removeEventListener("keyup",t.handlerKey),delete e.__qclosepopup}});const lt=()=>!!/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);function _(e,t=new WeakMap){if(Object(e)!==e)return e;if(t.has(e))return t.get(e);const s=e instanceof Date?new Date(e):e instanceof RegExp?new RegExp(e.source,e.flags):e instanceof Set?new Set:e instanceof Map?new Map:typeof e.constructor!="function"?Object.create(null):e.prototype!==void 0&&typeof e.prototype.constructor=="function"?e:new e.constructor;if(typeof e.constructor=="function"&&typeof e.valueOf=="function"){const o=e.valueOf();if(Object(o)!==o){const l=new e.constructor(o);return t.set(e,l),l}}return t.set(e,s),e instanceof Set?e.forEach(o=>{s.add(_(o,t))}):e instanceof Map&&e.forEach((o,l)=>{s.set(l,_(o,t))}),Object.assign(s,...Object.keys(e).map(o=>({[o]:_(e[o],t)})))}var st=Q({name:"QPopupEdit",props:{modelValue:{required:!0},title:String,buttons:Boolean,labelSet:String,labelCancel:String,color:{type:String,default:"primary"},validate:{type:Function,default:()=>!0},autoSave:Boolean,cover:{type:Boolean,default:!0},disable:Boolean},emits:["update:modelValue","save","cancel","beforeShow","show","beforeHide","hide"],setup(e,{slots:t,emit:s}){const{proxy:o}=ye(),{$q:l}=o,i=f(null),n=f(""),a=f("");let r=!1;const h=q(()=>He({initialValue:n.value,validate:e.validate,set:v,cancel:d,updatePosition:c},"value",()=>a.value,m=>{a.value=m}));function v(){e.validate(a.value)!==!1&&(E()===!0&&(s("save",a.value,n.value),s("update:modelValue",a.value)),g())}function d(){E()===!0&&s("cancel",a.value,n.value),g()}function c(){Fe(()=>{i.value.updatePosition()})}function E(){return _e(a.value,n.value)===!1}function g(){r=!0,i.value.hide()}function T(){r=!1,n.value=_(e.modelValue),a.value=_(e.modelValue),s("beforeShow")}function z(){s("show")}function K(){r===!1&&E()===!0&&(e.autoSave===!0&&e.validate(a.value)===!0?(s("save",a.value,n.value),s("update:modelValue",a.value)):s("cancel",a.value,n.value)),s("beforeHide")}function U(){s("hide")}function G(){const m=t.default!==void 0?[].concat(t.default(h.value)):[];return e.title&&m.unshift(C("div",{class:"q-dialog__title q-mt-sm q-mb-sm"},e.title)),e.buttons===!0&&m.push(C("div",{class:"q-popup-edit__buttons row justify-center no-wrap"},[C(D,{flat:!0,color:e.color,label:e.labelCancel||l.lang.label.cancel,onClick:d}),C(D,{flat:!0,color:e.color,label:e.labelSet||l.lang.label.set,onClick:v})])),m}return Object.assign(o,{set:v,cancel:d,show(m){i.value!==null&&i.value.show(m)},hide(m){i.value!==null&&i.value.hide(m)},updatePosition:c}),()=>{if(e.disable!==!0)return C(ke,{ref:i,class:"q-popup-edit",cover:e.cover,onBeforeShow:T,onShow:z,onBeforeHide:K,onHide:U,onEscapeKey:d},G)}}});const it=we({name:"GoalyEnd",props:{disabledScore:Boolean,title:String,id:Number,startTime:String,details:String,score:String,happeningNow:Boolean},emits:["saveScore","endNow","deleteNow"],computed:{aScore:{get(){return this.score},set(e){console.log("aScore getting set",e,this.id),this.$emit("saveScore",e,this.id)},cancel(){console.log("aScore remove?",this.id)}},userIconStyle(){return{color:this.disabledScore===!0?"red":"blue",cursor:"pointer"}},endNowBtnStyle(){return{display:this.disabledScore===!0&&this.happeningNow===!0?"block":"none","text-align":"right","margin-left":"32em",height:"auto"}}},watch:{title(e){console.log("titleValue:",e)}},methods:{onDelete(){this.$emit("deleteNow",this.id)},wannaEnd(){console.log("eeeuh wish to end for",this.id,this.disabledScore,this.happeningNow),this.$emit("endNow",this.id)}}}),nt={class:"title q-calendar__ellipsis"};function at(e,t,s,o,l,i){return S(),y("div",nt,[A($(e.title+":"+e.score)+" ",1),u(x,null,{default:p(()=>[A($(e.details),1)]),_:1}),u(D,{"no-caps":"",class:"button",label:"End-Now",style:V(e.endNowBtnStyle),onClick:e.wannaEnd},null,8,["style","onClick"]),u(st,{modelValue:e.aScore,"onUpdate:modelValue":t[0]||(t[0]=n=>e.aScore=n),disable:e.disabledScore,"auto-save":""},{default:p(n=>[u(De,{modelValue:n.value,"onUpdate:modelValue":a=>n.value=a,dense:"",onKeyup:Ue(n.set,["enter"])},{after:p(()=>[u(D,{flat:"",dense:"",color:"positive",icon:"check_circle",onClick:W(n.set,["stop","prevent"])},null,8,["onClick"]),u(Te,{vertical:!0}),u(D,{label:"Del",flat:"",dense:"",color:"negative",icon:"delete_forever",onClick:e.onDelete},null,8,["onClick"])]),_:2},1032,["modelValue","onUpdate:modelValue","onKeyup"])]),_:1},8,["modelValue","disable"])])}var rt=ee(it,[["render",at],["__scopeId","data-v-1fedd850"]]);const dt=C("div",{class:"q-space"});var ve=Q({name:"QSpace",setup(){return()=>dt}});const ht={name:"adHocEvent",props:{mainGoals:Array},data(){return{aTitle:"",daP:null,own:"misc",duration:15}},emits:["saveEvent"],computed:{pGoals:{get(){return this.mainGoals}},evName:{get(){return this.aTitle},set(e){this.aTitle=e}}},methods:{onClicked(){this.$emit("saveEvent",this.aTitle,this.daP,this.own,this.duration)}}},ut=e=>(Ce("data-v-755546ed"),e=e(),Re(),e),ct={class:"q-calendar__ellipsis"},ft=ut(()=>w("div",{class:"text-h6"},"adHocEvent",-1)),mt={class:"q-ml-md q-gutter-md"},gt={class:"radio-select"},pt={key:0},vt={style:{"text-align":"center"}};function St(e,t,s,o,l,i){return S(),y("div",ct,[ft,u(ve),w("div",mt,[u(De,{modelValue:i.evName,"onUpdate:modelValue":t[0]||(t[0]=n=>i.evName=n),filled:"",label:"A Goal","lazy-rules":"","item-aligned":"",rules:[n=>n&&n.length>0||"Please type a goal"]},null,8,["modelValue","rules"]),w("div",gt,[u(le,{modelValue:l.own,"onUpdate:modelValue":t[1]||(t[1]=n=>l.own=n),val:"misc",label:"Misc"},null,8,["modelValue"]),u(ve),u(le,{modelValue:l.own,"onUpdate:modelValue":t[2]||(t[2]=n=>l.own=n),val:"self",label:"Self"},null,8,["modelValue"])]),i.pGoals?(S(),y("div",pt,[u(Pe,{class:"q-ml-md",modelValue:l.daP,"onUpdate:modelValue":t[3]||(t[3]=n=>l.daP=n),options:i.pGoals,"option-value":"id","option-label":"title",disable:l.own!="misc",label:"Parent Goal"},null,8,["modelValue","options","disable"])])):P("",!0),w("div",null,[u(We,{min:15,max:120,thickness:.22,step:5,modelValue:l.duration,"onUpdate:modelValue":t[4]||(t[4]=n=>l.duration=n),"show-value":"",label:"Duration",size:"75px",color:"teal","track-color":"grey-3",class:"q-ma-md"},null,8,["thickness","modelValue"])])]),w("div",vt,[u(D,{flat:"",label:"Add",color:"primary",onClick:i.onClicked},null,8,["onClick"])])])}var Et=ee(ht,[["render",St],["__scopeId","data-v-755546ed"]]);function Se(e){return e.button===0}const bt=we({name:"dayCalendar",components:{NavigationBar:Ye,QCalendarDay:Ke,addGoalForm:Qe,GoalyEnd:rt,adHocEvent:Et},data(){return f(null),f(null),f(null),f(null),xe(),{currentDate:f(F()),scoreOptions:f([1,2,3,4,5]),chosenScore:f(null),chosenPrio:f(null),scheduledEvents:[],dailyScheduled:f(new Map),endTimesSet:f(new Set),startTimesSet:f(new Set),disablePrioBtn:f(!0),disableScoreBtn:f(!0),calendar:f(null),store:Ze(),anchorTimestamp:f(null),otherTimestamp:f(null),mouseDown:f(!1),mobile:f(!0),timeStartPos:f(0),showGoalForm:f(!1),pickEventDialog:f(!1),addEventDialog:f(!1),adHocEventDialog:f(!0),conflictReso:f(!1),resoType:f(""),toAddE:f(null),disabledScoreEvts:f({}),hasStarted:f({}),disableSaveSchedule:f(!0),skipAsk:f(!1),showReloadBtn:f(!1),loadDefault:f(!0),showScoreBtn:f(!1),showPrio:f(!1)}},beforeMount(){this.mobile=lt(),this.resetGoalEvts(!0)},beforeUnmount(){clearInterval(this.intervalId)},mounted(){this.adjustCurrentTime(),this.intervalId=setInterval(()=>{this.adjustCurrentTime()},6e4)},computed:{chosenScoreLabel(){return this.chosenScore==null?"By Score":`Score > ${this.chosenScore}`},chosenPrioLabel(){return this.chosenPrio==null?"By Priority":`Prio = ${this.chosenPrio}`},style(){return{top:this.timeStartPos+"px"}},showForm(){return this.showGoalForm},doDisableSaveSchedule(){return this.disableSaveSchedule},hasEventsForDate(){return this.store.hasEventsForDate(this.currentDate)},eventsMap(){const e={};return this.scheduledEvents.forEach(t=>{if(e[t.date]||(e[t.date]=[]),e[t.date].push(t),t.days){console.log(`eventsMap multiple days? event for ${t.date}`,t.days);let s=X(t.date),o=t.days;do s=b(s,{day:1}),e[s.date]||(e[s.date]=[]),e[s.date].push(t);while(--o>0)}}),e},parentGoalsMap(){const e=new Map;let t=this.storedMainG;return t?(t.forEach(s=>{e.set(s.id,s)}),e):(console.log("parentGoalsMap is empty or null",t),e)},canbeScheduled(){let e=this.deepCopy(this.storedEvents),t=e.filter(s=>!this.scheduledEvents.find(o=>o.id==s.id));return t.length==0?e:t},storedEvents(){return this.store.getSubGoals},storedMainG(){return this.store.getMainGoals},startEndTimes(){const e=[];return this.anchorDayTimeIdentifier!==!1&&this.otherDayTimeIdentifier!==!1&&(this.anchorDayTimeIdentifier<=this.otherDayTimeIdentifier?(console.log("startEndTimes..anchor <= less",R(this.anchorTimestamp),R(this.otherTimestamp)),e.push(R(this.anchorTimestamp),R(this.otherTimestamp))):(console.log("startEndTimes..anchor <= less",R(this.anchorTimestamp),R(this.otherTimestamp)),e.push(R(this.otherTimestamp),R(this.anchorTimestamp)))),e},anchorDayTimeIdentifier(){return this.anchorTimestamp!==null?Z(this.anchorTimestamp):!1},otherDayTimeIdentifier(){return this.otherTimestamp!==null?Z(this.otherTimestamp):!1}},methods:{badgeClasses(e,t){return je(e,t)},badgeStyles(e,t,s=void 0,o=void 0){return Je(e,t,s,o)},getTimeNumber(e){return e!==null?Z(e):!1},getTimeyNumber(e){return e!==null?Xe(e):!1},getDateEvents(e){const t=this.eventsMap[e]||[];if(t.length===1)t[0].side="full";else if(t.length===2){console.log("getDateEvents...LENGTH is 2?",e,t);const s=b(O(t[0].date),{minute:N(t[0].time)}),o=b(s,{minute:t[0].duration}),l=b(O(t[1].date),{minute:N(t[1].time)}),i=b(l,{minute:t[1].duration});L(l,s,o,!0)||L(i,s,o,!0)?(t[0].side="left",t[1].side="right"):(t[0].side="full",t[1].side="full")}return t},hasDate(e){return this.currentDate?e.find(t=>t.date===this.currentDate):!1},getEventsForDate(e){return this.store.getEventsForDate(e)},isViewingToday(){return F()==this.currentDate},isViewingPast(){let e=F();if(this.currentDate&&this.currentDate==e)return!1;let t=ce(O(e));return!(ce(O(this.currentDate))>=t)},adjustCurrentTime(){const e=B(new Date);if(this.currentDate!==e.date){this.timeStartPos=-10,this.currentTime="";return}this.currentDate=e.date,this.currentTime=e.time,this.timeStartPos=this.$refs.calendar.timeStartPos(e.time,!1);let t=this.endTimesSet&&this.endTimesSet.has(e.time),s=this.startTimesSet&&this.startTimesSet.has(e.time);(t||s)&&(console.log("sameStart/END..FOUND",this.currentTime),this.doEnableEndNowBtn(this.currentTime,t,s))},setGoalsPrio(){let e=this.store.fetchAllPrio();return!e.size>0&&console.log("ERROR...no Priority goals?",e),e.values()},resetGoalEvts(e=!1){if(this.scheduledEvents===this.allEvents&&console.log("resetGoalEvts SAME"),e){let t=this.deepCopy(this.storedEvents);return this.allEvents=[...t],t}return this.allEvents},getLocalEvt(e){for(let t=0;t<this.allEvents.length;t++)if(this.allEvents[t].id===e)return this.allEvents[t];return null},getScheduledEvent(e){for(let t=0;t<this.scheduledEvents.length;t++)if(this.scheduledEvents[t].id==e)return this.scheduledEvents[t];return null},doSaveEvtProp(e,t=null,s=null){this.store.saveSubProp(e,t,s)},filterEvtsTo(e,t){let s=this.allEvents,o=[];return s.forEach(l=>{let i=t[l.id];i&&(l.date=e,l.time=i.time,l.duration=i.duration,o.push(l))}),o},updateCurrentSchedule(){const e=new Map;let t=new Set,s=new Set,o=new Set;return this.scheduledEvents.length<1?(this.dailyScheduled=e,this.endTimesSet=t,this.startTimesSet=o,s):(this.scheduledEvents.forEach(l=>{let i=b(O(l.date),{minute:N(l.time)}),n=b(i,{minute:l.duration});e.set(l.id,{start:i,end:n,on:l.date,originalAt:l.time,for:l.duration,score:l.score}),t.add(n.time),o.has(i.time)?s.add({at:i.time,id:l.id}):o.add(i.time)}),this.dailyScheduled=e,this.endTimesSet=t,this.startTimesSet=o,s)},addEvtInScheduleMaps(e){if(this.dailyScheduled.has(e.id))return console.log("addEvtInScheduleMaps with evt already added...ERROR?",e),!1;let t=b(O(e.date),{minute:N(e.time)}),s=b(t,{minute:e.duration});this.dailyScheduled.set(e.id,{on:e.date,originalAt:e.time,for:e.duration,start:t,end:s,score:e.score}),this.endTimesSet.add(s.time),this.startTimesSet.add(t.time)},updateEvtInScheduleMaps(e,t){if(this.dailyScheduled.has(e)){let s=this.dailyScheduled.get(e),o=s.for,l=s.originalAt,i=s.start,n=s.end,a=b(t,{minute:o}),r=s.score;return this.dailyScheduled.set(e,{on:t.date,originalAt:l,for:o,start:t,end:a,score:r}),this.endTimesSet.delete(n.time)?this.endTimesSet.add(a.time):console.log("updateEvtInScheduleMaps-endTimesSet NOT FOUND?!?"),this.startTimesSet.delete(i.time)?this.startTimesSet.add(t.time):console.log("updateEvtInScheduleMaps-startTimesSet NOT FOUND?!?",e,t),(this.currentDate==F()||!this.isViewingPast())&&(this.canEnableEditScore(e,a),this.enableEndNowBtn(e,t,a)),!0}else return console.log("updateEvtInScheduleMaps--euh not found?ERROR?",e,t),!1},evtStartedOrPassed(e){const t=[];let s=b(e,{minute:0}),o=this.getTimeNumber(s);return this.dailyScheduled.forEach((l,i,n)=>{let a=this.getTimeNumber(l.start),r=this.getTimeNumber(l.end);if(a!==!1&&r!==!1){let h=o>=a&&o<r,v=o>=r;(h||v)&&t.push(i),h&&(this.hasStarted[i]=!0),this.enableEvtScoreEdit(i,v)}else console.log(`ERROR?!:${i} has no start/end?.`,l)}),t},allowScoreEdit(e){this.dailyScheduled.forEach((t,s,o)=>{this.disabledScoreEvts[s]=!e})},enableEvtScoreEdit(e,t){this.disabledScoreEvts[e]=!t},canEnableEditScore(e,t){const s=B(new Date);fe(s,t)>0?this.disabledScoreEvts[e]=!0:(this.disabledScoreEvts[e]=!1,this.hasStarted[e]=!1)},parseScore(e){const t=e.split(/on/);return t.length!=2?(console.log(`parseScore error?${e}`,t),-1):t[1]-t[0]},doEnableEndNowBtn(e,t,s){for(let[o,l]of this.dailyScheduled){let i=t?l.end.time:l.start.time,n=s?l.start.time:e;i==e?(console.log("doEnableEndNowBtn...FOUND",o,l,s,t),this.hasStarted[o]=!t):n==e&&console.log("doEnableEndNowBtn...EUUH?!?!",o,l,e,n)}},enableEndNowBtn(e,t,s){const o=O(this.currentDate);L(o,t,s,!0)&&(this.hasStarted[e]=!0)},retrieveSameStart(e){let t=[];for(let[s,o]of this.dailyScheduled)o.start.time==e&&t.push(s);return t},timeChangeDialog(e,t,s,o,l){this.$q.dialog({title:"Default Change?",cancel:s,ok:t,message:e}).onOk(()=>o()).onCancel(()=>{console.log("Nope coolios, onCancel with temp.time add!!"),l()}).onDismiss(()=>(console.log("dismissing..DO anything?!?"),!1))},confirmAction(e,t,s,o=null){this.$q.dialog({title:"Warning",cancel:!0,message:e}).onOk(()=>{t()}).onCancel(()=>{s()}).onDismiss(()=>{if(o){console.log("confirmAction with dismiss!!"),o();return}})},radioChoiceDialog(e,t,s=null,o=null){this.$q.dialog({title:e,cancel:!!o,persistent:!0,options:{type:"radio",model:"",items:t}}).onOk(l=>{s&&(l==""?this.radioChoiceDialog(e,t,s,o):s(l))}).onCancel(()=>{o&&o()}).onDismiss(()=>{console.log("radioChoiceDialog dismissed")})},doNotify(e,t=void 0,s="top"){this.$q.notify({color:t!==void 0?t:"negative",position:s,message:e,icon:t==null?"report_problem":"thumb_up"})},updateButtons(e=null,t=null,s=null){this.loadDefault=e!=null?e:this.loadDefault,this.showScoreBtn=t!=null?t:this.showScoreBtn,this.showPrio=s!=null?s:this.showPrio},resetButtons(e,t){this.updateButtons(!e,!t,!t)},doRemove(e){let t=this.scheduledEvents.length,s=0;for(s;s<t;s++)if(this.scheduledEvents[s].id==e.id){this.scheduledEvents.splice(s,1);let o=null;if(this.dailyScheduled.has(e.id)?(o=this.dailyScheduled.get(e.id),this.dailyScheduled.delete(e.id)):console.log("ERROR doRemove, dailyScheduled has no such item?@? ",e),o){let l=this.startTimesSet.delete(o.start.time),i=this.endTimesSet.delete(o.end.time);(!l||!i)&&console.log("ERROR doRemove scheduleSets has no such item?@? ",o,e)}break}console.log("doRemove..looping FOR",s)},removeEvtInSchedule(e,t=null){if(this.isViewingPast()){this.doNotify("Removing from the past is a no no!");return}let s=()=>{this.doRemove(e),this.disableSaveSchedule=!1,this.showReloadBtn=this.hasEventsForDate};if(!this.isViewingToday()){s(),console.log("Removed future evt");return}let o=`Remove "${e.title}" from schedule?`;this.confirmAction(o,s,function(){console.log("Cancelled remove")})},reset(){this.draggedItem=null,this.targetDrop=null,this.toAddE=null,this.chosenScore=null,this.chosenPrio=null,this.possibleRange=null},fixConflicts(e){console.log("fixConflicts...Start",e);const t=o=>{let l=0,i=null;for(let n of o){let a=this.getScheduledEvent(n);if(a){let r=this.parentGoalsMap.get(a.parentGoal);r?r.priority>l&&(l=r.priority,i=a):console.log("findhigherPrio..ERROR no PARENT found?",a)}else console.log("findhigherPrio..ERROR not found?",n)}return console.log("findhigherPrio..Highest priority be",i,l),i},s=o=>({label:o.title+" at "+o.score,value:o.id});for(let o of e){let l=null,i=this.retrieveSameStart(o.at);console.log("fixConflicts...results",i,o);let n=[],a="";for(let r of i){let h=this.getScheduledEvent(r);h?(n.push(h),a+=h.title+","):console.log("fixConflicts...ERROR not found?",r)}this.$q.dialog({title:"Alert",cancel:!1,persistent:!0,message:`${a} are conflicting.
 Choose how to solve this...`,options:{type:"radio",model:"opt1",items:[{label:"Resolve by Highest Priority",value:"opt1",color:"secondary"},{label:"Resolve by lowest Score Interval",value:"opt2"},{label:"Pick event",value:"opt3"}]}}).onOk(r=>{if(r=="opt3"){this.$q.dialog({title:"Alert",cancel:!1,persistent:!0,message:"Choose the event to schedule",options:{type:"radio",model:"",items:n.map(s)}}).onOk(v=>{console.log("Chosen Manually",v);let d=this.getScheduledEvent(v);d?l=d:console.log("ERROR...Manually choice not find",v)}).onCancel(()=>{console.log("Cancelled loading..HUH?!?")}).onDismiss(()=>{console.log("oooh dismissed inner...",l),this.pickConflictReso(l,n)});let h=this.updateCurrentSchedule();console.log("fixConflicts inner...after conflicts?",h),this.updateButtons(!0,null,null)}else if(r=="opt2"){console.log(">>>> OK, Option Score",r);let h=0,v=null;for(let d of n){let c=this.parseScore(d.score);c>-1&&c>=h?(h=c,v=d):console.log("ERROR...parseScore?",c,d)}v&&(console.log("Option Score Chosen",v),l=v)}else l=t(i),console.log(">>>> OK, Higher prio",r,l);console.log("Pick be",l)}).onCancel(()=>{console.log("Cancelled loading...HUH?!?")}).onDismiss(()=>{if(console.log("Dismissing...",l),l){this.pickConflictReso(l,n);let r=this.updateCurrentSchedule();console.log("fixConflicts outer...after conflicts?",r),this.updateButtons(!0,null,null),this.disableSaveSchedule=!1}})}return!0},pickConflictReso(e,t){for(let s of t)s.id==e.id?console.log("Skipping choice!",s):(console.log("Removing conflict event!",s),this.doRemove(s))},evtIsOverlappingTimes(e,t,s,o){let l=this.getTimeyNumber(e),i=this.getTimeyNumber(t),n=this.getTimeyNumber(s),a=this.getTimeyNumber(o);if(l===!1||n===!1||i===!1||a===!1)return console.log("ERROR... evtIsOverlappingTimes error",l,i,n,a),!1;let r=!1;return l>=n&&l<a&&(r="bas"),i>=n&&i<=a&&(r="haut"),(n>=l&&i>=a||l>n&&i<a)&&(r="surrounding"),r},hasOverlappingEvent(e,t,s){const o=[];let l=t,i=b(l,{minute:s});return this.dailyScheduled.forEach((n,a,r)=>{if(a!=e){let h=this.evtIsOverlappingTimes(l,i,n.start,n.end);h&&(console.log(`${e} overlappingConflict: "${h}" with ${a} at`,n.start.time),o.push({target:e,targetStart:l,direction:h,inConflict:a}))}}),o},overlapCheckEvtsAdd(e,t=null,s=!1){let o={};for(let l=0;l<e.length;l++){let i=e[l],n=b(O(i.date),{minute:N(i.time)}),a=this.hasOverlappingEvent(i.id,n,i.duration);if(a.length>0){console.log(`overlapCheckEvtsAdd at ${n.time} for ${i.id}:"${i.title.trim()}">>`,a.length);let r=0;do o[i.id]||(o[i.id]=[]),o[i.id].push(a[r]),r>0&&console.log("WOAH WOAH, multiple overlaps with same obj!",r,i,a[r]);while(++r<a.length)}else this.addEvtPropsIntoSchedule(t,i)}return o},addEvtPropsIntoSchedule(e,t){return this.addPropsEventsTo(e,[t]),this.scheduledEvents.push(t),this.updateCurrentSchedule()},addPropsEventsTo(e,t){let s=this.parentGoalsMap;return t?(t.forEach(o=>{o.date=e!=null?e:o.date;let l=s.get(o.parentGoal);l?(o.bgcolor=l.bgcolor,o.details=`${l.title.trim()} (${l==null?void 0:l.priority}) - ${o==null?void 0:o.duration}min`):(console.log("no parent goal for:",o),o.bgcolor="grey",o.details="unknown")}),t):(this.doNotify("addPropsEventsTo BUT no goals to schedule..."),[])},changeEvtTime(e,t,s){console.log(`changeEventTime ${e} with skip:${s}`,t.time,this.scheduledEvents.length);let o=this.getScheduledEvent(e);if(!o)return console.log("ERROR in changeEvtTime not found?",o,e,t),!1;let l=()=>{console.log(`doUpdateEvt for ${e} from ${o.time} to ${t.time}`),o.time=t.time,this.updateEvtInScheduleMaps(e,t);let r=b(t,{minute:parseInt(o.duration)});this.canEnableEditScore(e,r),this.enableEndNowBtn(e,t,r)},i=r=>(this.doSaveEvtProp(e,t.time,null),l(),r),n=o.time,a=`Evt '${o.title.trim()}' scheduled at ${n}. 
 Change default time to ${t.time}? 
 Cancel to Temp add.`;(o==null?void 0:o.inDefaults)||!(o!=null&&o.canMove)?s?(console.log(`changeEventTime::skippin...BUT inDef: ${o.inDefaults} and canMove:${o.canMove}`),l()):(console.log(`changeEventTime::NOT skippin...BUT inDef: ${o.inDefaults} and canMove:${o.canMove}`),this.timeChangeDialog(a,"Change","Temp.Add",function(){i(!0)},function(){l()})):(console.log(`changeEventTime::ASKIN?!? move:${o==null?void 0:o.canMove} inDef:${o==null?void 0:o.inDefaults}`,s),o!=null&&o.canMove?l():this.timeChangeDialog(a,"Change","Temp.Add",function(){i(!0)},function(){console.log(`Keeping ${o.time} for ${o.id}`,t.time),l()}))},recurChangeTime(e,t,s,o=!1,l=!1){let i=this.dailyScheduled.get(e);if(i){let n=N(i.start.time)-N(s.time),a=`${n>0?"DOWN":"UP"}`;console.log(`${e} moving due to evt ${t.id} at: ${s.time} ...:GoFwd:${o} >> ${a}`,n,l);let r=null;if(n>0||o){r=b(s,{minute:parseInt(t.duration)+10});let d=b(s,{minute:parseInt(i.for)+10});console.log(`recurChangeTime:${e}...FORWARD ${n}`,i.for,t.duration,r.time,d.time)}else r=b(s,{minute:-(parseInt(i.for)+10)}),console.log(`recurChangeTime:${e}...BACKWARD ${n}`,r);let h=this.hasOverlappingEvent(e,r,i.for);if(h.length>0){console.log(`WARNING WARNING...more overlaps for ${e} at ${r.time}`,h);let d=0,c=h.length,E=this.getScheduledEvent(e);do console.log("CASCADING timeChange:",h[d],i,E),this.recurChangeTime(h[d].inConflict,E,r,o,!0);while(++d<c)}this.changeEvtTime(e,r,l),console.log(`recurChangeTime...OVERLAPPED:${e} done to ${r.time}`,a,l);let v=n>0||o?b(s,{minute:0}):b(s,{minute:0});this.changeEvtTime(t.id,v,l),console.log(`recurChangeTime...TARGET:${t.id} at time>> ${v.time}`,o,a,l)}else console.log("ERROR..ERROR overlapped event not found!",e)},fixAnOverlap(e,t=null){var v;let s=[{label:"Choose by Priority",value:"opt1",color:"secondary"},{label:"Choose by Score",value:"opt2"},{label:"Choose one event",value:"opt3"}];const o=d=>d.title.trim()+" Priority = "+l(d)+" && Score:: "+d.score,l=d=>{if(d!=null&&d.parentGoal){let c=this.parentGoalsMap.get(d.parentGoal);return c==null?void 0:c.priority}return console.log("findhigherPrio..ERROR no PARENT found?",d),null},i=(d,c)=>{this.doRemove(d),console.log(`fixAnOverlap, adding ${c.title} at ${c.time}`,e),this.addEvtPropsIntoSchedule(this.currentDate,c)},n=(d,c,E)=>{let g=E.direction=="haut";this.addEvtPropsIntoSchedule(this.currentDate,c),console.log(`forceAdd changing ${d.id} due to ${c.title}. goFwd>>${g}`,E),this.recurChangeTime(d.id,c,E.targetStart,g,!0)},a=d=>{this.doNotify(`Cancelling to keep "${d}"`,"positive","bottom")};let r=this.getLocalEvt(e.target),h=this.getScheduledEvent(e.inConflict);if(!h||!r){console.log("fixAnOverlap...ERROR no evts found!!",e);return}e.direction!=="surrounding"&&s.push({label:`Force in '${r.title.trim()}' at ${(v=e==null?void 0:e.targetStart)==null?void 0:v.time}`,value:"opt4"}),this.$q.dialog({title:"Warning--Resolve Overlap",cancel:!0,persistent:!0,message:`Event: '${r.title.trim()}' Overlaps with Scheduled '${h.title.trim()}'.
      
Resolve or Cancel to keep '${h.title.trim()}'`,options:{type:"radio",model:"opt1",items:s}}).onOk(d=>{if(d=="opt3"){let c="Pick one event...",E=[{label:o(r),value:r.id},{label:o(h),value:h.id}];this.radioChoiceDialog(c,E,function(g){if(g==r.id){i(h,r);return}else{console.log("OPT3,chose scheduled",g,t);return}},function(){a(h.title.trim())})}else if(d=="opt2"){let c="Pick event by Score",E=[{label:`"${r.title.trim()}" with Score:: ${r.score} = ${this.parseScore(r.score)}`,value:r.id},{label:`"${h.title.trim()}" with Score:: ${h.score} = ${this.parseScore(h.score)}`,value:h.id}];this.radioChoiceDialog(c,E,function(g){g==r.id?i(h,r):console.log("OPT2, chose scheduled",g,t)},function(){a(h.title.trim())})}else if(d=="opt1"){let c="Pick event by Priority",E=[{label:`"${r.title.trim()}" with Priority = ${l(r)}`,value:r.id},{label:`"${h.title.trim()}" with Priority = ${l(h)}`,value:h.id}];this.radioChoiceDialog(c,E,function(g){if(g==r.id){i(h,r);return}else{console.log("OK OPT1, chose scheduled",g,t);return}},function(){a(h.title.trim())})}else n(h,r,e)}).onCancel(()=>{this.doNotify(`Keeping scheduled "${h.title.trim()}"`,"positive","bottom"),t&&console.log("huh override... coolios")}).onDismiss(()=>{})},handleOverlaps(e){if(e.length===0)return[];const t=e.pop();this.handleOverlaps(e),this.fixAnOverlap(t)},loadForDate(e,t,s){let o=()=>{let i=this.getEventsForDate(e);if(!i){console.log(`ERROR no evts found for ${e}...`,i);return}console.log(`doLoadNotPresent for ${e}`,i,this.scheduledEvents,this.dailyScheduled.size);let n=this.filterEvtsTo(e,i);this.scheduledEvents=this.addPropsEventsTo(null,n);let a=this.updateCurrentSchedule();a.size>0&&!s?(console.log("doLoadNotPresent..FIX overlaps!!",a,e,s),this.doNotify(`${s?"past":"future"}: ${e} with Some overlaps to fix!`,"warning","bottom"),this.fixConflicts(a)):(this.showReloadBtn=!1,this.disableSaveSchedule=!0,this.doNotify(`Loaded schedule for ${s?"past":"future"}:: ${e}`,"positive","bottom"))},l=()=>{let i=this.getEventsForDate(e);if(!i){console.log(`ERROR no evts found for today:${e} ?!?`,i);return}let n=this.filterEvtsTo(e,i);console.log(`OverlapCheckLoadToday ${e}`,i,this.scheduledEvents,this.dailyScheduled.size);let a=this.overlapCheckEvtsAdd(n,e);return Object.keys(a).length>0?this.doNotify(`${e} with Some overlaps to fix!`,"warning","bottom"):this.doNotify(`Loaded schedule for ${e}`,"positive","bottom"),a};if(this.scheduledEvents=[],this.updateCurrentSchedule(),t)if(this.isViewingToday()){let i=l();if(Object.keys(i).length>0){console.log("Overlaps toHandle >>",i);for(let n in i){if(!i[n]||!i[n][0]){console.log("loadForDate...ERROR no local found",n);continue}let a=i[n];this.handleOverlaps(a)}this.showReloadBtn=t,this.disableSaveSchedule=!1,this.resetButtons(t,s);return}this.evtStartedOrPassed(B(new Date)),this.disableSaveSchedule=!0}else o(),this.allowScoreEdit(s);else this.showReloadBtn=!1,this.disableSaveSchedule=!0;(s||e!==F())&&this.adjustCurrentTime(),console.log(`loadForDate...got here too fast? ${t} >> inPast:${s}`),this.reset(),this.resetButtons(t,s)},scheduleDefaults(){this.scheduledEvents=[],this.updateCurrentSchedule();let e=this.deepCopy(this.store.fetchDefaults()),t=this.isViewingToday(),s=this.isViewingPast();if(this.showReloadBtn=this.hasEventsForDate,this.resetButtons(!0,s),this.disableSaveSchedule=!(e.length>0),this.reset(),t){let o=this.addPropsEventsTo(this.currentDate,e),l=this.overlapCheckEvtsAdd(o);if(Object.keys(l).length>0){console.log(`Defaults overlaps on:${this.currentDate} ${e.length} == ${o.length} ?!? and Length:`,Object.keys(l).length);for(let i in l){if(!l[i]||!l[i][0]){console.log("scheduleDefaults...ERROR no local found",i);continue}let n=l[i];this.handleOverlaps(n)}}this.evtStartedOrPassed(B(new Date));return}else{this.scheduledEvents=this.addPropsEventsTo(this.currentDate,e);let o=this.updateCurrentSchedule();console.log("doLoadDefault..sameStart?",o),s?this.allowScoreEdit(!0):this.allowScoreEdit(!1)}},deepCopy(e){if(e===null||typeof e!="object")return e;if(Array.isArray(e))return e.map(s=>this.deepCopy(s));const t={};for(let s in e)e.hasOwnProperty(s)&&(t[s]=this.deepCopy(e[s]));return t},onRefresh(e){setTimeout(()=>{this.scheduledEvents=[],this.updateCurrentSchedule(),this.resetGoalEvts(!0),this.loadForDate(this.currentDate,this.hasEventsForDate,this.isViewingPast()),e()},1e3)},doSaveSchedule(){let e={};this.dailyScheduled.size<1?e=null:this.dailyScheduled.forEach((t,s,o)=>{e[s]={duration:t.for,time:t.start.time}}),this.store.saveDailySchedule(this.currentDate,e),this.disableSaveSchedule=!0,this.showReloadBtn=!1,this.doNotify(`doSaveSchedule for ${this.currentDate}`,"positive","top")},onAddNewEvent(e,t,s,o){console.log("Adding Event eh...",e,t,s,o,this.possibleRange),this.possibleRange||(this.possibleRange=this.startEndTimes);let l=X(this.possibleRange[0]),i=o>15?b(l,{minute:parseInt(o)}):b(X(this.possibleRange[1]),{minute:15}),n=Math.floor(fe(l,i)/1e3/60);console.log("With times as ",e,t,s,l.time,i.time,n);let a=null;if(s=="self"){let r=this.store.addMainGoal(e,"","purple-10",2);r?(console.log("wooh SELF parent created",r),a=this.store.addSubGoal(r,e,"1on5",l.time,n,!0,!1)):console.log("ERROR? no pID",r)}else if(t){a=this.store.addSubGoal(t.id,e,"1on5",l.time,n,!1,!1);//!canMove and notInDefaults
}else{let r=this.store.getGoalByTitle("Misc");if(r){console.log("Woo found Misc pgoal",r),a=this.store.addSubGoal(r.id,e,"1on5",l.time,n,!1,!1);//!canMove and notInDefaults
}else{let h=this.store.addMainGoal("Misc","","grey-10",2);h&&(console.log("No Misc pgoal...created",h),a=this.store.addSubGoal(h,e,"1on5",l.time,n,!0,!1))}}if(a){let r=this.hasOverlappingEvent(a,l,n);if(r.length>0){this.resetGoalEvts(!0);for(let h=0;h<r.length;h++){let v=r[h];console.log("onAddNewEvt, OVERLAPS handling",v),this.fixAnOverlap(v)}}else this.addEvtPropsIntoSchedule(this.currentDate,{id:a,time:l.time,score:"1on5",duration:n,canMove:!t});this.disableSaveSchedule=!1,this.showReloadBtn=this.hasEventsForDate}else console.log("BOO ERROR no subID:(",a),this.doNotify("Error adding this event :(","negative");this.addEventDialog=!1,this.reset()},onChooseEvent(){this.addEventDialog=!1,this.pickEventDialog=!0},onPickEvent(){if(this.pickEventDialog=!1,!this.toAddE){console.log("onPickEvent...ERROR nill",this.toAddE);return}console.log(`I be picking ${this.toAddE.id} :: ${this.toAddE.title}`);let e=this.getScheduledEvent(this.toAddE.id);if(e){console.log("onPickEvent...NOT NEW?!?ERROR!",e,this.toAddE);return}else{e=this.toAddE,console.log(`onPickEvent...adding ${e.id} from ${e.time} to `,this.targetDrop.timestamp.time,this.skipAsk);let t=this.addEvtPropsIntoSchedule(this.currentDate,e),s=this.hasOverlappingEvent(e.id,this.targetDrop.timestamp,e.duration),o=s.length;if(o>0){console.log(`onPickEvent::hasOverlappingEvent of size: ${o} with skip:${this.skipAsk}`);let l=0;do this.recurChangeTime(s[l].inConflict,e,this.targetDrop.timestamp,s[l].direction=="haut",this.skipAsk);while(++l<o)}else console.log("onPickEvent NO overlaps...changing to targetDrop!",t,this.skipAsk),this.changeEvtTime(e.id,this.targetDrop.timestamp,this.skipAsk)}console.log("AddEvent complete",e.id,this.skipAsk,this.scheduledEvents),this.disableSaveSchedule=!1,this.showReloadBtn=this.hasEventsForDate,this.reset()},onEndNow(e){const t=B(new Date);let s=this.hasEventsForDate;if(console.log("oooh doEndNow!!!",e,t.time,s),this.dailyScheduled.has(e)){let o=this.dailyScheduled.get(e),l=o.start,i=o.end;if(L(t,l,i,!0)){let n=this.getTimeNumber(i)-this.getTimeNumber(l),a=this.getTimeNumber(t)-this.getTimeNumber(l);console.log("end data be:",l.time,i.time,o),console.log(`Great, REDUCING duration from ${n} to:`,a);for(let r=0;r<this.scheduledEvents.length;r++){let h=this.scheduledEvents[r];h.id===e&&(h.duration=a)}this.dailyScheduled.set(e,{...o,for:a,end:t}),this.endTimesSet.delete(i.time)||console.log("ERROR endTimesSet item does not exist?!?",o,this.endTimesSet),this.endTimesSet.add(t.time)}else console.log("umm aint in the middle of this event! Nothing to do...ERROR?",t.time,l.time,i.time)}else{console.log("ERROR doEndNow not found!!!",e);return}this.disabledScoreEvts[e]=!1,this.disableSaveSchedule=!1,this.showReloadBtn=s},onSaveScore(e,t){let s=this.dailyScheduled.get(t);if(s){s.score=e,this.doSaveEvtProp(t,null,e);let l=(i=>this.scheduledEvents.find(n=>n.id==i))(t);l?l.score=e:console.log("onSaveScore ERROR not found",l,t)}else console.log(`ERROR onSaveScore could not find event ${t}?!?`)},onReloadSaved(){let e=this.hasEventsForDate,t=()=>{console.log("Aborting",this.currentDate,this.scheduledEvents,e),this.showReloadBtn=!this.isViewingPast()||e},s=()=>{this.scheduledEvents=[],this.updateCurrentSchedule(),this.loadForDate(this.currentDate,e,this.isViewingPast())};this.scheduledEvents.length>0?this.confirmAction("Overwrite current Evts?",s,t):s(),this.showReloadBtn=!1},onLoadDefault(){let e=()=>{console.log("Aborting",this.currentDate,this.scheduledEvents)},t=()=>{this.scheduleDefaults()};this.scheduledEvents.length>0?this.confirmAction("Overwrite current Evts?",t,e):this.scheduleDefaults()},choosePrio(e){let t=this.chosenPrio;t&&t==e?this.disablePrioBtn=!0:(this.chosenPrio=e,this.disablePrioBtn=!1)},chooseScore(e){let t=this.chosenScore;t&&t==e?this.disableScoreBtn=!0:(this.chosenScore=e,this.disableScoreBtn=!1)},onReloadWithPrio(){if(this.chosenPrio==null){this.doNotify("Ayo select a priority!");return}const e=()=>this.scheduledEvents.filter(o=>{var l;return((l=this.parentGoalsMap.get(o.parentGoal))==null?void 0:l.priority)==this.chosenPrio});let t=()=>{console.log("onReloadWithPrio..cancelling",this.scheduledEvents),this.reset()};const s=o=>{let l=[];if(o=="overwrite"||o=="add"){let i=this.deepCopy(this.storedEvents);for(let n of i){let a=this.parentGoalsMap.get(n.parentGoal);(a==null?void 0:a.priority)==this.chosenPrio&&l.push(n)}l=this.addPropsEventsTo(this.currentDate,l),o=="add"&&(l=l.filter(n=>!this.scheduledEvents.find(a=>a.id==n.id)),console.log(`findSamePrio...ADDIN from ${this.scheduledEvents.length}`,l))}else l=e(),console.log("findSamePrio..filtering!!",this.chosenPrio,l);if(this.isViewingToday()){let i=this.overlapCheckEvtsAdd(l);if(Object.keys(i).length>0){console.log("onReloadWithPrio..overlaps!!",this.chosenScore,i);for(let a in i){if(!i[a]||!i[a][0]){console.log("onReloadWithPrio...ERROR no local found",a);continue}let r=i[a];this.handleOverlaps(r)}let n=this.evtStartedOrPassed(B(new Date));console.log("onReloadWithPrio:enabledScoreEdit",n)}else{if(console.log("onReloadWithPrio >>No overlaps!!...",l.length),o=="add"){let n=this.scheduledEvents.concat(l);this.scheduledEvents=n}else this.scheduledEvents=l;this.updateCurrentSchedule()}}else{if(o=="add"){let i=this.scheduledEvents.concat(l);this.scheduledEvents=i}else this.scheduledEvents=l;this.updateCurrentSchedule(),console.log("onReloadWithPrio scheduliin..",this.scheduledEvents),this.allowScoreEdit(!1)}if(!this.scheduledEvents.length>0){this.doNotify(`Empty for Priority =${this.chosenPrio} :(`,"warning","bottom"),this.disableSaveSchedule=!0,this.showReloadBtn=this.hasEventsForDate;return}this.disableSaveSchedule=!1,this.showReloadBtn=this.hasEventsForDate};if(this.scheduledEvents.length>0){let o=[{label:`Filter current by priority == ${this.chosenPrio}`,value:"filter"},{label:`Add to current Evts with priority == ${this.chosenPrio}`,value:"add"},{label:`Overwrite and schedule All by priority == ${this.chosenPrio}`,value:"overwrite"}];this.radioChoiceDialog("Choose Resolution...",o,function(l){console.log("OK ReloadWithPrio",l),s(l)},t)}else s("overwrite");this.resetButtons(this.hasEventsForDate,this.isViewingPast()),this.disablePrioBtn=!0},onReloadWithScore(){if(this.chosenScore==null){this.doNotify("Ayo select a score!");return}let e=()=>{console.log("onReloadWithScore..cancelling",this.scheduledEvents),this.reset()};const t=()=>{let o=[];return this.scheduledEvents.forEach(l=>{let i=this.parseScore(l.score);i>-1&&i>=this.chosenScore&&o.push(l)}),o},s=o=>{let l=[];if(o=="overwrite"||o=="add"?(l=this.addPropsEventsTo(this.currentDate,this.store.fetchGoalsWithMinScore(this.chosenScore)),o=="add"&&(l=l.filter(i=>!this.scheduledEvents.find(n=>n.id==i.id)))):l=t(),console.log(`reloadEvtsWithScore>'${o}'::${this.chosenScore}`,this.currentDate,this.isViewingToday(),l),this.isViewingToday()){let i=this.overlapCheckEvtsAdd(l);if(Object.keys(i).length>0){console.log("onReloadWithScore..overlaps!!",this.chosenScore,i);for(let a in i){if(!i[a]||!i[a][0]){console.log("onReloadWithScore...ERROR no local found",a);continue}let r=i[a];this.handleOverlaps(r)}let n=this.evtStartedOrPassed(B(new Date));console.log("onReloadWithScore:enabledScoreEdit",n)}else{if(console.log("onReloadWithScore >>No overlaps!!...",l),o=="add"){let n=this.scheduledEvents.concat(l);this.scheduledEvents=n}else this.scheduledEvents=l;this.updateCurrentSchedule()}}else{if(o=="add"){let i=this.scheduledEvents.concat(l);this.scheduledEvents=i}else this.scheduledEvents=l;console.log("onReloadWithScore scheduliin..",this.scheduledEvents),this.updateCurrentSchedule(),this.allowScoreEdit(!1)}if(!this.scheduledEvents.length>0){this.doNotify(`Empty for Score >=${this.chosenScore} :(`,"warning","bottom"),this.disableSaveSchedule=!0,this.showReloadBtn=this.hasEventsForDate,this.disableScoreBtn=!0;return}this.disableSaveSchedule=!1,this.showReloadBtn=this.hasEventsForDate};if(this.scheduledEvents.length>0){let o=[{label:`Filter current by Interval Score >= ${this.chosenScore}`,value:"filter"},{label:`Add to current Evts with Interval Score >= ${this.chosenScore}`,value:"add"},{label:`Overwrite and schedule All by Interval Score >= ${this.chosenScore}`,value:"overwrite"}];this.radioChoiceDialog("Schedule change...",o,function(l){s(l)},e)}else s("overwrite");this.resetButtons(this.hasEventsForDate,this.isViewingPast()),this.disableScoreBtn=!0},onChange(e){this.loadForDate(e.start,this.hasEventsForDate,this.isViewingPast())},onDragStart(e,t){if(this.isViewingPast()){this.doNotify("Editing past is no no!"),e.preventDefault();return}this.draggedItem=t},onDragEnter(e,t,s){return t==="goal-item"||(this.targetDrop=s),e.preventDefault(),!0},onDragOver(e,t,s){return e.preventDefault(),!0},onDragLeave(e,t,s){return!1},onDragEnd(e){console.log("onDragEnd",this.startTimesSet,this.endTimesSet)},onDrop(e,t,s){let o=this.getScheduledEvent(this.draggedItem.id);if(!o){console.log("onDrop ERROR",o,this.draggedItem);return}let l=null;if(t==="interval")console.log("onDrop to time-interval",s.timestamp.time),l=s.timestamp;else if(t==="goal-item"&&this.targetDrop)console.log("Dropping goal-item!!",e,t,this.targetDrop.timestamp),l=this.targetDrop.timestamp;else{console.log("Cannot drop here YO!!",e,t,s,this.targetDrop);return}if(!l){console.log("ERROR...no timestamp YO!!",e,t,s,this.targetDrop);return}let i=this.hasOverlappingEvent(o.id,l,o.duration),n=i.length;if(n>0){console.log("WOAH WOAH onDrop...overlapp!",i);let a=0;do i[a].inConflict==i[a].target&&console.log("EUUUH...self overlap?!?",i),this.recurChangeTime(i[a].inConflict,o,l,!1,!1);while(++a<n)}else{let a=this.changeEvtTime(o.id,l,!1);console.log("onDrop no overlap complete",a,o.id,l)}this.disableSaveSchedule=!1,this.showReloadBtn=this.hasEventsForDate},onDblClickEvent(e,t){if(this.isViewingPast()){this.doNotify("Removing from the past is a no no!"),e.preventDefault();return}this.removeEvtInSchedule(t)},onClickDate(e){console.log("onClickDate",e)},onClickTime(e){console.log("onClickTime..event",e),this.isViewingPast(),this.addEventDialog=!0,this.targetDrop=e.scope},onClickInterval(e){console.log("onClickInterval",e)},onClickHeadIntervals(e){console.log("onClickHeadIntervals",e)},onClickHeadDay(e){console.log("onClickHeadDay",e)},onMouseEnter(e){console.log("onMouseAt",e)},onMouseLeave(e){console.log("onMouseLeave",JSON.stringify(e))},onMouseDownTime({scope:e,event:t}){if(console.log("onMouseDownTime",{scope:e,event:t}),Se(t)){if(console.log("onMouseDownTime and its a leftClick event"),this.mobile===!0&&this.anchorTimestamp!==null&&this.otherTimestamp!==null&&R(this.anchorTimestamp)===R(this.otherTimestamp)){this.otherTimestamp=e.timestamp,this.mouseDown=!1;return}this.mouseDown=!0,this.anchorTimestamp=e.timestamp,this.otherTimestamp=e.timestamp}},onMouseUpTime({scope:e,event:t}){if(console.log("onMouseUpTime",{scope:e,event:t}),this.mobile!==!0&&Se(t)&&(this.otherTimestamp=e.timestamp,this.mouseDown=!1),!this.mousedown){let s=this.startEndTimes;if(s[1]==s[0])return;this.possibleRange=s,console.log("onMouseUpTime range change",this.possibleRange)}},onMouseMoveTime({scope:e,event:t}){this.mobile!==!0&&this.mouseDown===!0&&(this.otherTimestamp=e.timestamp)},scrollToEvent(e){this.$refs.calendar.scrollToTime(e.time,350)},onToday(){let e=()=>{this.$refs.calendar.moveToToday()},t=()=>{setTimeout(e,1e3),this.doSaveSchedule()};this.disableSaveSchedule?e():this.confirmAction("Save schedule changes?",t,e)},onPrev(){console.log("onPrev",this.currentDate);let e=()=>{this.$refs.calendar.prev()},t=()=>{setTimeout(e,1e3),this.doSaveSchedule()};this.disableSaveSchedule?e():this.confirmAction("Save schedule changes?",t,e)},onNext(){let e=()=>{this.$refs.calendar.next()},t=()=>{setTimeout(e,1e3),this.doSaveSchedule()};this.disableSaveSchedule?e():this.confirmAction("Save schedule changes?",t,e)}}}),te=e=>(Ce("data-v-0261721d"),e=e(),Re(),e),yt={key:0,class:"q-gutter-md"},wt={key:1,class:"subcontent"},Dt={class:"float-right"},Tt={key:0},Ct={key:1},Rt={key:2},kt={key:3},Pt={class:"row justify-center"},Ot={style:{display:"flex","max-width":"800px",width:"100%",height:"400px"}},$t={style:{display:"flex","justify-content":"center","flex-wrap":"wrap",padding:"2px"}},Nt={class:"title q-calendar__ellipsis"},Bt=["onDblclick","onDragstart"],At=te(()=>w("div",{class:"text-h6"},"Ad hoc or Existing event",-1)),Mt={class:"q-ml-md event-select"},Vt=te(()=>w("div",{class:"text-h3"},"Select event",-1)),qt={class:"q-ml-md event-select"},Gt={class:"row justify-center"},It=te(()=>w("br",null,null,-1)),Ht={class:"scroll overflow-auto",style:{height:"360px",width:"100%"}};function Ft(e,t,s,o,l,i){const n=I("add-goal-form"),a=I("navigation-bar"),r=I("goaly-end"),h=I("q-calendar-day"),v=I("ad-hoc-event");return S(),y(k,null,[e.showForm?(S(),y("div",yt,[u(D,{class:"q-pl-xl justify-center",color:"","text-color":"green",elevated:"",label:"HideForm",onClick:t[0]||(t[0]=d=>e.showGoalForm=!e.showGoalForm),"no-caps":""}),u(n)])):P("",!0),e.showForm?P("",!0):(S(),y("div",wt,[u(ze,{onRefresh:e.onRefresh},{default:p(()=>[u(a,{onToday:e.onToday,onPrev:e.onPrev,onNext:e.onNext},null,8,["onToday","onPrev","onNext"]),w("div",Dt,[e.showReloadBtn?(S(),y("div",Tt,[u(D,{class:"q-mt-xl",color:"","text-color":"green",elevated:"",label:"Reload",onClick:e.onReloadSaved,"no-caps":""},null,8,["onClick"])])):P("",!0),e.loadDefault?(S(),y("div",Ct,[u(D,{class:"q-mt-xl",color:"","text-color":"blue",elevated:"",label:"Defaults",onClick:e.onLoadDefault,"no-caps":""},null,8,["onClick"])])):P("",!0),e.showScoreBtn?(S(),y("div",Rt,[u(me,{split:"",color:"",class:"q-mt-xl","text-color":"teal",elevated:"","disable-main-btn":e.disableScoreBtn,label:e.chosenScoreLabel,onClick:e.onReloadWithScore,"no-caps":""},{default:p(()=>[u(ae,null,{default:p(()=>[(S(!0),y(k,null,H(e.scoreOptions,d=>ie((S(),M(he,{key:d.id,clickable:"",onClick:c=>e.chooseScore(d)},{default:p(()=>[u(re,null,{default:p(()=>[u(de,null,{default:p(()=>[A($(d),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"])),[[pe]])),128))]),_:1})]),_:1},8,["disable-main-btn","label","onClick"])])):P("",!0),e.showPrio?(S(),y("div",kt,[u(me,{split:"",color:"",class:"q-mt-xl","text-color":"teal",elevated:"","disable-main-btn":e.disablePrioBtn,label:e.chosenPrioLabel,onClick:e.onReloadWithPrio,"no-caps":""},{default:p(()=>[u(ae,null,{default:p(()=>[(S(!0),y(k,null,H(e.setGoalsPrio(),d=>ie((S(),M(he,{key:d,clickable:"",onClick:c=>e.choosePrio(d)},{default:p(()=>[u(re,null,{default:p(()=>[u(de,null,{default:p(()=>[A($(d),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"])),[[pe]])),128))]),_:1})]),_:1},8,["disable-main-btn","label","onClick"])])):P("",!0)])]),_:1},8,["onRefresh"]),w("div",Pt,[w("div",Ot,[u(h,{ref:"calendar",view:"day",modelValue:e.currentDate,"onUpdate:modelValue":t[5]||(t[5]=d=>e.currentDate=d),"drag-enter-func":e.onDragEnter,"drag-over-func":e.onDragOver,"drag-leave-func":e.onDragLeave,"drop-func":e.onDrop,animated:"",bordered:"",hoverable:"","no-active-date":"","transition-next":"slide-left","transition-prev":"slide-right","time-clicks-clamped":"","interval-minutes":15,"interval-count":96,"interval-height":28,"selected-start-end-dates":e.startEndTimes,onChange:e.onChange,onClickDate:e.onClickDate,onClickTime:e.onClickTime,onClickInterval:e.onClickInterval,onClickHeadIntervals:e.onClickHeadIntervals,onClickHeadDay:e.onClickHeadDay,onMousedownTime:e.onMouseDownTime,onMouseupTime:e.onMouseUpTime,onMousemoveTime:e.onMouseMoveTime},{"head-day-event":p(({scope:{timestamp:d}})=>[w("div",$t,[(S(!0),y(k,null,H(e.eventsMap[d.date],c=>(S(),y(k,{key:c.id},[c.time?(S(),M(ue,{key:1,class:j(e.badgeClasses(c,"header")),style:V([e.badgeStyles(c,"header"),{margin:"1px",width:"10px","max-width":"10px",height:"10px","max-height":"10px",cursor:"pointer"}]),onClick:E=>e.scrollToEvent(c)},{default:p(()=>[u(x,null,{default:p(()=>[A($(c.time+" - "+c.title),1)]),_:2},1024)]),_:2},1032,["class","style","onClick"])):(S(),M(ue,{key:0,class:j(e.badgeClasses(c,"header")),style:V([e.badgeStyles(c,"header"),{width:"100%",cursor:"pointer",height:"12px","font-size":"10px",margin:"1px"}])},{default:p(()=>[w("div",Nt,[A($(c.title)+" ",1),u(x,null,{default:p(()=>[A($(c.details),1)]),_:2},1024)])]),_:2},1032,["class","style"]))],64))),128))])]),"day-container":p(({scope:{days:d}})=>[e.hasDate(d)?(S(),y(k,{key:0},[w("div",{class:"day-view-current-time-indicator",style:V(e.style)},null,4),w("div",{class:"day-view-current-time-line",style:V(e.style)},null,4)],64)):P("",!0)]),"day-body":p(({scope:{timestamp:d,timeStartPos:c,timeDurationHeight:E}})=>[(S(!0),y(k,null,H(e.getDateEvents(d.date),g=>(S(),y(k,{key:g.id},[g.time!==void 0?(S(),y("div",{key:0,class:j(["my-event",e.badgeClasses(g,"body")]),style:V(e.badgeStyles(g,"body",c,E)),draggable:!0,onDblclick:W(T=>e.onDblClickEvent(T,g),["prevent"]),onDragstart:W(T=>e.onDragStart(T,g),["stop"]),onDragend:t[1]||(t[1]=W((...T)=>e.onDragEnd&&e.onDragEnd(...T),["stop"])),onDrop:t[2]||(t[2]=T=>e.onDrop(T,"goal-item",e.scope)),onDragenter:t[3]||(t[3]=T=>e.onDragEnter(T,"goal-item",e.scope)),onDragover:t[4]||(t[4]=T=>e.onDragOver(T,"goal-item",e.scope))},[u(r,{disabledScore:e.disabledScoreEvts[g.id],title:g.title,id:g.id,startTime:g.time,score:g.score,details:g.details,happeningNow:e.hasStarted[g.id]?e.hasStarted[g.id]:!1,onEndNow:e.onEndNow,onSaveScore:e.onSaveScore,onDeleteNow:T=>e.removeEvtInSchedule(g,T)},null,8,["disabledScore","title","id","startTime","score","details","happeningNow","onEndNow","onSaveScore","onDeleteNow"])],46,Bt)):P("",!0)],64))),128))]),_:1},8,["modelValue","drag-enter-func","drag-over-func","drag-leave-func","drop-func","selected-start-end-dates","onChange","onClickDate","onClickTime","onClickInterval","onClickHeadIntervals","onClickHeadDay","onMousedownTime","onMouseupTime","onMousemoveTime"])]),u(se,{modelValue:e.addEventDialog,"onUpdate:modelValue":t[8]||(t[8]=d=>e.addEventDialog=d),"transition-show":"rotate","transition-hide":"rotate"},{default:p(()=>[e.adHocEventDialog?(S(),M(Y,{key:0},{default:p(()=>[u(ne,null,{default:p(()=>[At]),_:1}),u(J,{align:"center"},{default:p(()=>[u(D,{flat:"",label:"Add hoc",color:"primary",onClick:t[6]||(t[6]=d=>e.adHocEventDialog=!e.adHocEventDialog)}),u(D,{flat:"",label:"Existing",color:"primary",onClick:e.onChooseEvent},null,8,["onClick"])]),_:1})]),_:1})):(S(),M(Y,{key:1},{default:p(()=>[w("div",Mt,[u(v,{mainGoals:e.storedMainG,onSaveEvent:e.onAddNewEvent},null,8,["mainGoals","onSaveEvent"]),u(D,{flat:"",label:"Cancel",color:"primary",onClick:t[7]||(t[7]=d=>e.adHocEventDialog=!e.adHocEventDialog)})])]),_:1}))]),_:1},8,["modelValue"]),u(se,{modelValue:e.pickEventDialog,"onUpdate:modelValue":t[11]||(t[11]=d=>e.pickEventDialog=d),"transition-show":"rotate","transition-hide":"rotate"},{default:p(()=>[u(Y,null,{default:p(()=>[u(ne,null,{default:p(()=>[Vt]),_:1}),u(Te),w("div",qt,[u(Pe,{modelValue:e.toAddE,"onUpdate:modelValue":t[9]||(t[9]=d=>e.toAddE=d),options:e.canbeScheduled,"option-value":"id","option-label":"title",label:"Sub Goal","item-aligned":"",popupContentClass:"q-gutter-md"},null,8,["modelValue","options"])]),u(J,{align:"center"},{default:p(()=>[u(Le,{dense:"",modelValue:e.skipAsk,"onUpdate:modelValue":t[10]||(t[10]=d=>e.skipAsk=d),label:"Force",color:"teal",class:"q-pa-sm"},null,8,["modelValue"])]),_:1}),u(J,{align:"evenly"},{default:p(()=>[u(D,{elevated:"",label:"Add",color:"primary",class:"q-mr-md",onClick:e.onPickEvent},null,8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),w("div",Gt,[u(D,{class:"q-mt-xl",color:"Green","text-color":"blue",elevated:"",label:"SaveSchedule",disable:e.doDisableSaveSchedule,onClick:e.doSaveSchedule,"no-caps":""},null,8,["disable","onClick"]),u(D,{class:"q-mt-xl",color:"","text-color":"green",elevated:"",label:"ShowForm",onClick:t[12]||(t[12]=d=>e.showGoalForm=!e.showGoalForm),"no-caps":""})]),It,w("div",Ht,[(S(!0),y(k,null,H(e.storedEvents,(d,c)=>(S(),y("div",{key:c,class:"col-12",style:{"font-size":"10px","line-height":"10px","max-height":"14px","min-height":"14px",padding:"2px 2px","white-space":"nowrap"}},$(d),1))),128))])]))],64)}var Jt=ee(bt,[["render",Ft],["__scopeId","data-v-0261721d"]]);export{Jt as default};
