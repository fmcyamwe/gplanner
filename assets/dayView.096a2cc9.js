import{j as Y,r as E,c as W,ah as $e,n as Re,an as Ne,h as k,g as ve,Q as N,d as z,_ as Q,F as D,M as $,J as V,S as M,I as g,H as C,R as H,ao as Se,ap as Pe,aq as K,ai as X,G as J,K as T,k as Ee,ar as ye,a2 as ke,as as Be,at as Ae,w as re,b as Me,ae as be,au as Ge,av as Ie,aw as Ve,ax as _e,W as Le,N as ie,O as I,f as Je,ay as de,U as A,al as ne,am as ae,E as L,az as he,aA as Z,ak as ee,aB as ce,af as Fe,P as te}from"./index.e0396806.js";import{Q as we,a as qe,b as He,c as Ue,d as We,e as Ce,f as Qe,g as xe,h as ze}from"./goalForm.c1b86375.js";import{c as le,a as je,b as Ke,p as Ye,Q as ue}from"./utiFunc.43277fbc.js";import{N as Xe,t as F,p as oe,a as R,j as U,k as se,T as Ze,b as q,c as G,i as j,C as fe,U as _,V as me,Q as et}from"./NavigationBar.097b4931.js";import{a as tt}from"./QCalendar.8a653ee8.js";/* empty css                             */import{u as ot}from"./goalStorage.401cb835.js";import{u as st}from"./use-quasar.83b7c9a5.js";const it=()=>!!/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);function x(t,o=new WeakMap){if(Object(t)!==t)return t;if(o.has(t))return o.get(t);const s=t instanceof Date?new Date(t):t instanceof RegExp?new RegExp(t.source,t.flags):t instanceof Set?new Set:t instanceof Map?new Map:typeof t.constructor!="function"?Object.create(null):t.prototype!==void 0&&typeof t.prototype.constructor=="function"?t:new t.constructor;if(typeof t.constructor=="function"&&typeof t.valueOf=="function"){const l=t.valueOf();if(Object(l)!==l){const i=new t.constructor(l);return o.set(t,i),i}}return o.set(t,s),t instanceof Set?t.forEach(l=>{s.add(x(l,o))}):t instanceof Map&&t.forEach((l,i)=>{s.set(i,x(l,o))}),Object.assign(s,...Object.keys(t).map(l=>({[l]:x(t[l],o)})))}var lt=Y({name:"QPopupEdit",props:{modelValue:{required:!0},title:String,buttons:Boolean,labelSet:String,labelCancel:String,color:{type:String,default:"primary"},validate:{type:Function,default:()=>!0},autoSave:Boolean,cover:{type:Boolean,default:!0},disable:Boolean},emits:["update:modelValue","save","cancel","beforeShow","show","beforeHide","hide"],setup(t,{slots:o,emit:s}){const{proxy:l}=ve(),{$q:i}=l,n=E(null),a=E(""),d=E("");let c=!1;const f=W(()=>$e({initialValue:a.value,validate:t.validate,set:p,cancel:b,updatePosition:O},"value",()=>d.value,m=>{d.value=m}));function p(){t.validate(d.value)!==!1&&(y()===!0&&(s("save",d.value,a.value),s("update:modelValue",d.value)),w())}function b(){y()===!0&&s("cancel",d.value,a.value),w()}function O(){Re(()=>{n.value.updatePosition()})}function y(){return Ne(d.value,a.value)===!1}function w(){c=!0,n.value.hide()}function S(){c=!1,a.value=x(t.modelValue),d.value=x(t.modelValue),s("beforeShow")}function r(){s("show")}function h(){c===!1&&y()===!0&&(t.autoSave===!0&&t.validate(d.value)===!0?(s("save",d.value,a.value),s("update:modelValue",d.value)):s("cancel",d.value,a.value)),s("beforeHide")}function u(){s("hide")}function v(){const m=o.default!==void 0?[].concat(o.default(f.value)):[];return t.title&&m.unshift(k("div",{class:"q-dialog__title q-mt-sm q-mb-sm"},t.title)),t.buttons===!0&&m.push(k("div",{class:"q-popup-edit__buttons row justify-center no-wrap"},[k(N,{flat:!0,color:t.color,label:t.labelCancel||i.lang.label.cancel,onClick:b}),k(N,{flat:!0,color:t.color,label:t.labelSet||i.lang.label.set,onClick:p})])),m}return Object.assign(l,{set:p,cancel:b,show(m){n.value!==null&&n.value.show(m)},hide(m){n.value!==null&&n.value.hide(m)},updatePosition:O}),()=>{if(t.disable!==!0)return k(we,{ref:n,class:"q-popup-edit",cover:t.cover,onBeforeShow:S,onShow:r,onBeforeHide:h,onHide:u,onEscapeKey:b},v)}}});const nt=z({name:"GoalyEnd",props:{disabledScore:Boolean,title:String,id:Number,startTime:String,details:String,score:String,happeningNow:Boolean},data(){const t=E(""),o=E(!1);return{errorMessageScore:t,errorScore:o}},emits:["saveScore","endNow","deleteNow"],computed:{aScore:{get(){return this.score},set(t){console.log("aScore getting set",t,this.id),this.aScorey(t)&&this.$emit("saveScore",t,this.id)},cancel(){console.log("aScore remove?",this.id)}},userIconStyle(){return{color:this.disabledScore===!0?"red":"blue",cursor:"pointer"}},endNowBtnStyle(){return{display:this.disabledScore===!0&&this.happeningNow===!0?"block":"none","text-align":"right","margin-left":"32em",height:"auto"}}},watch:{title(t){console.log("titleValue:",t)}},methods:{onDelete(){this.$emit("deleteNow",this.id)},wannaEnd(){console.log("eeeuh wish to end for",this.id,this.disabledScore,this.happeningNow),this.$emit("endNow",this.id)},aScorey(t){return t.length<4||!t.includes("on")?(this.errorScore=!0,this.errorMessageScore=`Error: ${t} Unsaved.Must format as: #on#`,!1):(this.errorScore=!1,this.errorMessageScore="",!0)}}}),at={class:"title q-calendar__ellipsis"};function rt(t,o,s,l,i,n){return D(),$("div",at,[V(M(`${t.title} (${t.score})`)+" ",1),g(le,null,{default:C(()=>[V(M(t.details),1)]),_:1}),g(N,{"no-caps":"",class:"button",label:"End-Now",style:H(t.endNowBtnStyle),onClick:t.wannaEnd},null,8,["style","onClick"]),g(lt,{modelValue:t.aScore,"onUpdate:modelValue":o[0]||(o[0]=a=>t.aScore=a),disable:t.disabledScore,"auto-save":""},{default:C(a=>[g(Se,{modelValue:a.value,"onUpdate:modelValue":d=>a.value=d,dense:"",onKeyup:Pe(a.set,["enter"]),hint:"format: #on#",error:t.errorScore,"error-message":t.errorMessageScore},{after:C(()=>[g(N,{flat:"",dense:"",color:"positive",icon:"check_circle",onClick:K(a.set,["stop","prevent"])},null,8,["onClick"]),g(X,{vertical:!0}),g(N,{label:"Del",flat:"",dense:"",color:"negative",icon:"delete_forever",onClick:t.onDelete},null,8,["onClick"])]),_:2},1032,["modelValue","onUpdate:modelValue","onKeyup","error","error-message"])]),_:1},8,["modelValue","disable"])])}var dt=Q(nt,[["render",rt],["__scopeId","data-v-413bfe90"]]);const ht=z({name:"schedBtn",props:{textLabel:String},emits:["doBtnAction"],methods:{onClicked(){this.$emit("doBtnAction")}}});function ct(t,o,s,l,i,n){return D(),J(N,{color:"",elevated:"",onClick:t.onClicked,"no-caps":""},{default:C(()=>[T("div",null,M(t.textLabel),1)]),_:1},8,["onClick"])}var ut=Q(ht,[["render",ct],["__scopeId","data-v-f8dc388e"]]),ft=Y({name:"QBtnGroup",props:{unelevated:Boolean,outline:Boolean,flat:Boolean,rounded:Boolean,square:Boolean,push:Boolean,stretch:Boolean,glossy:Boolean,spread:Boolean},setup(t,{slots:o}){const s=W(()=>{const l=["unelevated","outline","flat","rounded","square","push","stretch","glossy"].filter(i=>t[i]===!0).map(i=>`q-btn-group--${i}`).join(" ");return`q-btn-group row no-wrap${l.length>0?" "+l:""}`+(t.spread===!0?" q-btn-group--spread":" inline")});return()=>k("div",{class:s.value},Ee(o.default))}});const mt=Object.keys(ye),gt=t=>mt.reduce((o,s)=>{const l=t[s];return l!==void 0&&(o[s]=l),o},{});var pt=Y({name:"QBtnDropdown",props:{...ye,...ke,modelValue:Boolean,split:Boolean,dropdownIcon:String,contentClass:[Array,String,Object],contentStyle:[Array,String,Object],cover:Boolean,persistent:Boolean,noRouteDismiss:Boolean,autoClose:Boolean,menuAnchor:{type:String,default:"bottom end"},menuSelf:{type:String,default:"top end"},menuOffset:Array,disableMainBtn:Boolean,disableDropdown:Boolean,noIconAnimation:Boolean,toggleAriaLabel:String},emits:["update:modelValue","click","beforeShow","show","beforeHide","hide"],setup(t,{slots:o,emit:s}){const{proxy:l}=ve(),i=E(t.modelValue),n=E(null),a=Be(),d=W(()=>{const m={"aria-expanded":i.value===!0?"true":"false","aria-haspopup":"true","aria-controls":a,"aria-label":t.toggleAriaLabel||l.$q.lang.label[i.value===!0?"collapse":"expand"](t.label)};return(t.disable===!0||t.split===!1&&t.disableMainBtn===!0||t.disableDropdown===!0)&&(m["aria-disabled"]="true"),m}),c=W(()=>"q-btn-dropdown__arrow"+(i.value===!0&&t.noIconAnimation===!1?" rotate-180":"")+(t.split===!1?" q-btn-dropdown__arrow-container":"")),f=W(()=>Ae(t)),p=W(()=>gt(t));re(()=>t.modelValue,m=>{n.value!==null&&n.value[m?"show":"hide"]()}),re(()=>t.split,v);function b(m){i.value=!0,s("beforeShow",m)}function O(m){s("show",m),s("update:modelValue",!0)}function y(m){i.value=!1,s("beforeHide",m)}function w(m){s("hide",m),s("update:modelValue",!1)}function S(m){s("click",m)}function r(m){Ge(m),v(),s("click",m)}function h(m){n.value!==null&&n.value.toggle(m)}function u(m){n.value!==null&&n.value.show(m)}function v(m){n.value!==null&&n.value.hide(m)}return Object.assign(l,{show:u,hide:v,toggle:h}),Me(()=>{t.modelValue===!0&&u()}),()=>{const m=[k(be,{class:c.value,name:t.dropdownIcon||l.$q.iconSet.arrow.dropdown})];return t.disableDropdown!==!0&&m.push(k(we,{ref:n,id:a,class:t.contentClass,style:t.contentStyle,cover:t.cover,fit:!0,persistent:t.persistent,noRouteDismiss:t.noRouteDismiss,autoClose:t.autoClose,anchor:t.menuAnchor,self:t.menuSelf,offset:t.menuOffset,separateClosePopup:!0,transitionShow:t.transitionShow,transitionHide:t.transitionHide,transitionDuration:t.transitionDuration,onBeforeShow:b,onShow:O,onBeforeHide:y,onHide:w},o.default)),t.split===!1?k(N,{class:"q-btn-dropdown q-btn-dropdown--simple",...p.value,...d.value,disable:t.disable===!0||t.disableMainBtn===!0,noWrap:!0,round:!1,onClick:S},{default:()=>Ee(o.label,[]).concat(m),loading:o.loading}):k(ft,{class:"q-btn-dropdown q-btn-dropdown--split no-wrap q-btn-item",rounded:t.rounded,square:t.square,...f.value,glossy:t.glossy,stretch:t.stretch},()=>[k(N,{class:"q-btn-dropdown--current",...p.value,disable:t.disable===!0||t.disableMainBtn===!0,noWrap:!0,round:!1,onClick:r},{default:o.label,loading:o.loading}),k(N,{class:"q-btn-dropdown__arrow-container q-anchor--skip",...d.value,...f.value,disable:t.disable===!0||t.disableDropdown===!0,rounded:t.rounded,color:t.color,textColor:t.textColor,dense:t.dense,size:t.size,padding:t.padding,ripple:t.ripple},()=>m)])}}});function ge(t){if(t===!1)return 0;if(t===!0||t===void 0)return 1;const o=parseInt(t,10);return isNaN(o)?0:o}var vt=Ie({name:"close-popup",beforeMount(t,{value:o}){const s={depth:ge(o),handler(l){s.depth!==0&&setTimeout(()=>{const i=Ve(t);i!==void 0&&_e(i,l,s.depth)})},handlerKey(l){Le(l,13)===!0&&s.handler(l)}};t.__qclosepopup=s,t.addEventListener("click",s.handler),t.addEventListener("keyup",s.handlerKey)},updated(t,{value:o,oldValue:s}){o!==s&&(t.__qclosepopup.depth=ge(o))},beforeUnmount(t){const o=t.__qclosepopup;t.removeEventListener("click",o.handler),t.removeEventListener("keyup",o.handlerKey),delete t.__qclosepopup}});const St=z({name:"schedDropBtn",props:{optionLabel:String,disableBtn:Boolean,daOptions:Array},emits:["doReload","chooseOption"],methods:{onClicked(){this.$emit("doReload")},onSelect(t){this.$emit("chooseOption",t)}}});function Et(t,o,s,l,i,n){return D(),J(pt,{split:"",color:"",elevated:"","disable-main-btn":t.disableBtn,label:t.optionLabel,onClick:t.onClicked,"no-caps":""},{default:C(()=>[g(qe,null,{default:C(()=>[(D(!0),$(I,null,ie(t.daOptions,a=>Je((D(),J(He,{key:a,clickable:"",onClick:d=>t.onSelect(a)},{default:C(()=>[g(Ue,null,{default:C(()=>[g(We,null,{default:C(()=>[V(M(a),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"])),[[vt]])),128))]),_:1})]),_:1},8,["disable-main-btn","label","onClick"])}var yt=Q(St,[["render",Et],["__scopeId","data-v-86c49dde"]]);const bt=k("div",{class:"q-space"});var De=Y({name:"QSpace",setup(){return()=>bt}});const wt={name:"adHocEvent",props:{mainGoals:Array},data(){return{aTitle:"",daP:null,own:"misc",duration:15}},emits:["saveEvent","doCancel"],computed:{pGoals:{get(){return this.mainGoals}},evName:{get(){return this.aTitle},set(t){this.aTitle=t}}},methods:{onClicked(){this.$emit("saveEvent",this.aTitle,this.daP,this.own,this.duration),this.own="own",this.P=null,this.duration=15}}},Ct=t=>(ne("data-v-5b47391d"),t=t(),ae(),t),Dt=Ct(()=>T("div",{class:"text-h3"},"Ad hoc Event",-1)),Tt={class:"q-ml-md"},Ot={class:"radio-select"},$t={key:0},Rt={class:"q-mx-md",style:{"text-align":"center"}};function Nt(t,o,s,l,i,n){return D(),$(I,null,[Dt,g(De),g(X),T("div",Tt,[g(Se,{modelValue:n.evName,"onUpdate:modelValue":o[0]||(o[0]=a=>n.evName=a),filled:"",label:"A Goal","lazy-rules":"","item-aligned":"",rules:[a=>a&&a.length>0||"Please type a goal"]},null,8,["modelValue","rules"]),T("div",Ot,[g(de,{class:"q-mx-md",modelValue:i.own,"onUpdate:modelValue":o[1]||(o[1]=a=>i.own=a),val:"misc",label:"Misc"},null,8,["modelValue"]),g(de,{class:"q-mx-md",modelValue:i.own,"onUpdate:modelValue":o[2]||(o[2]=a=>i.own=a),val:"self",label:"By Self"},null,8,["modelValue"])]),n.pGoals?(D(),$("div",$t,[g(Ce,{class:"q-mx-md",modelValue:i.daP,"onUpdate:modelValue":o[3]||(o[3]=a=>i.daP=a),options:n.pGoals,"option-value":"id","option-label":"title",disable:i.own!="misc",label:"Select Parent Goal"},null,8,["modelValue","options","disable"])])):A("",!0),T("div",null,[V(" Duration "),g(Qe,{min:15,max:120,thickness:.22,step:5,modelValue:i.duration,"onUpdate:modelValue":o[4]||(o[4]=a=>i.duration=a),"show-value":"",label:"Duration",size:"75px",color:"teal","track-color":"grey-3",class:"q-ma-md"},null,8,["thickness","modelValue"])])]),T("div",Rt,[g(N,{flat:"",align:"center",label:"Cancel",color:"primary",onClick:o[5]||(o[5]=a=>t.$emit("doCancel"))}),g(N,{elevated:"",color:"primary",onClick:n.onClicked},{default:C(()=>[V(" Add ")]),_:1},8,["onClick"])])],64)}var Pt=Q(wt,[["render",Nt],["__scopeId","data-v-5b47391d"]]);const kt=z({name:"schedDialog",components:{adHocEvent:Pt},props:{storedGoals:Array,canBeScheduled:Array},data(){return{hideAdHocEventDialog:E(!0),showPickEventDialog:E(!1),show:E(!0),doForce:E(!1),toAddEE:E(null)}},emits:["onAddNewEvent","onPickEvent","euhHidin"],computed:{toAddE:{get(){return this.toAddEE},set(t){this.toAddEE=t}},showDefaultEvtByType:{get(){return this.show},set(t){this.show=t}},allScheduled:{get(){return this.canBeScheduled}}},methods:{onAddClicked(){this.$emit("onPickEvent",this.toAddE,this.doForce)},addNewEvent(t,o,s,l){this.$emit("onAddNewEvent",t,o,s,l)},onChooseExisting(){this.hideAdHocEventDialog=!0,this.showPickEventDialog=!0},gonHide(){this.$emit("euhHidin")},onCancelBtn(){let t=this.showPickEventDialog;console.log(`onCancelBtn...with PickDialog?${t}`),t?this.showPickEventDialog=!1:this.showDefaultEvtByType=!this.showDefaultEvtByType},reset(){}}}),Te=t=>(ne("data-v-e06b9de8"),t=t(),ae(),t),Bt=Te(()=>T("div",{class:"text-h6"},"Ad hoc or Existing event",-1)),At={class:"q-ma-md event-select"},Mt=Te(()=>T("div",{class:"text-h3"},"Select event",-1)),Gt={class:"q-ma-md event-select"};function It(t,o,s,l,i,n){const a=L("ad-hoc-event");return D(),$(I,null,[g(ce,{modelValue:t.hideAdHocEventDialog,"onUpdate:modelValue":o[1]||(o[1]=d=>t.hideAdHocEventDialog=d),"transition-show":"rotate","transition-hide":"rotate","no-esc-dismiss":"",onBeforeHide:t.gonHide},{default:C(()=>[t.showDefaultEvtByType?(D(),J(ee,{key:0},{default:C(()=>[g(he,null,{default:C(()=>[Bt]),_:1}),g(Z,{align:"center"},{default:C(()=>[g(N,{flat:"",label:"Add hoc",color:"primary",onClick:o[0]||(o[0]=d=>t.showDefaultEvtByType=!t.showDefaultEvtByType)}),g(N,{flat:"",label:"Existing",color:"primary",onClick:t.onChooseExisting},null,8,["onClick"])]),_:1})]),_:1})):(D(),J(ee,{key:1},{default:C(()=>[T("div",At,[g(a,{mainGoals:t.storedGoals,onSaveEvent:t.addNewEvent,onDoCancel:t.onCancelBtn},null,8,["mainGoals","onSaveEvent","onDoCancel"]),g(De)])]),_:1}))]),_:1},8,["modelValue","onBeforeHide"]),g(ce,{modelValue:t.showPickEventDialog,"onUpdate:modelValue":o[4]||(o[4]=d=>t.showPickEventDialog=d),"transition-show":"rotate","transition-hide":"rotate","no-esc-dismiss":"",onBeforeHide:t.gonHide},{default:C(()=>[g(ee,null,{default:C(()=>[g(he,null,{default:C(()=>[Mt]),_:1}),g(X),T("div",Gt,[g(Ce,{modelValue:t.toAddE,"onUpdate:modelValue":o[2]||(o[2]=d=>t.toAddE=d),options:t.allScheduled,"option-value":"id","option-label":"title",label:"Sub Goal","item-aligned":"",borderless:"",popupContentClass:"q-gutter-md"},null,8,["modelValue","options"])]),g(Z,{align:"center"},{default:C(()=>[g(Fe,{dense:"",modelValue:t.doForce,"onUpdate:modelValue":o[3]||(o[3]=d=>t.doForce=d),label:"Force",color:"teal",class:"q-pa-sm"},null,8,["modelValue"])]),_:1}),g(Z,{align:"center"},{default:C(()=>[g(N,{flat:"",label:"Cancel",color:"primary",onClick:t.onCancelBtn},null,8,["onClick"]),g(N,{elevated:"",color:"primary",onClick:t.onAddClicked},{default:C(()=>[V(" Add ")]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue","onBeforeHide"])],64)}var Vt=Q(kt,[["render",It],["__scopeId","data-v-e06b9de8"]]);function pe(t){return t.button===0}const _t=z({name:"dayCalendar",components:{NavigationBar:Xe,QCalendarDay:tt,addGoalForm:xe,GoalyEnd:dt,schedBtn:ut,schedDropBtn:yt,schedDialog:Vt},data(){return E(null),E(null),E(null),E(null),st(),{currentDate:E(F()),scoreOptions:E([1,2,3,4,5]),chosenScore:E(null),chosenPrio:E(null),scheduledEvents:[],dailyScheduled:E(new Map),endTimesSet:E(new Set),startTimesSet:E(new Set),disablePrioBtn:E(!0),disableScoreBtn:E(!0),calendar:E(null),store:ot(),anchorTimestamp:E(null),otherTimestamp:E(null),mouseDown:E(!1),mobile:E(!0),timeStartPos:E(0),showGoalForm:E(!1),addEventDialog:E(!1),disabledScoreEvts:E({}),hasStarted:E({}),disableSaveSchedule:E(!0),showReloadBtn:E(!1),showLoadDefaults:E(!0),showScoreBtn:E(!1),showPrio:E(!1),showClearBtn:E(!1),treeGoals:E([]),expanded:E([]),selected:E([])}},beforeMount(){this.mobile=it(),this.resetGoalEvts(!0),this.constructTree()},beforeUnmount(){clearInterval(this.intervalId)},mounted(){this.adjustCurrentTime(),this.intervalId=setInterval(()=>{this.adjustCurrentTime()},6e4)},computed:{chosenScoreLabel(){return this.chosenScore==null?"By Score":`Score >= ${this.chosenScore}`},chosenPrioLabel(){return this.chosenPrio==null?"By Priority":`Prio = ${this.chosenPrio}`},style(){return{top:this.timeStartPos+"px"}},showForm(){return this.showGoalForm},doDisableSaveSchedule(){return this.disableSaveSchedule},hasEventsForDate(){return this.store.hasEventsForDate(this.currentDate)},eventsMap(){const t={};return this.scheduledEvents.forEach(o=>{if(t[o.date]||(t[o.date]=[]),t[o.date].push(o),o.days){console.log(`eventsMap multiple days? event for ${o.date}`,o.days);let s=oe(o.date),l=o.days;do s=R(s,{day:1}),t[s.date]||(t[s.date]=[]),t[s.date].push(o);while(--l>0)}}),t},parentGoalsMap(){const t=new Map;let o=this.storedMainG;return o?(o.forEach(s=>{t.set(s.id,s)}),t):(console.log("parentGoalsMap is empty or null",o),t)},canbeScheduled(){let t=this.deepCopy(this.storedEvents),o=t.filter(s=>!this.scheduledEvents.find(l=>l.id==s.id));return o.length==0?t:o},storedEvents(){return this.store.getSubGoals},storedMainG(){return this.store.getMainGoals},storedAlternatives(){return this.store.fetchAlternativeEvts()},startEndTimes(){const t=[];return this.anchorDayTimeIdentifier!==!1&&this.otherDayTimeIdentifier!==!1&&(this.anchorDayTimeIdentifier<=this.otherDayTimeIdentifier?t.push(U(this.anchorTimestamp),U(this.otherTimestamp)):t.push(U(this.otherTimestamp),U(this.anchorTimestamp))),t},anchorDayTimeIdentifier(){return this.anchorTimestamp!==null?se(this.anchorTimestamp):!1},otherDayTimeIdentifier(){return this.otherTimestamp!==null?se(this.otherTimestamp):!1}},methods:{constructTree(){this.treeGoals=this.store.fetchGoalsTree()},badgeClasses(t,o){return je(t,o)},badgeStyles(t,o,s=void 0,l=void 0){return Ke(t,o,s,l)},titleStyles(t){const o={};let s=/\d/g;if(t&&t.color&&!t.isChildren){let l=t.color.split("-");if(l.length>1)return l[1].match(s)?o["background-color"]=`${l[0]}`:o["background-color"]=`${l[1]}`,o;o["background-color"]=`${t.color}`}return o},getTimeNumber(t){return t!==null?se(t):!1},getTimeyNumber(t){return t!==null?Ze(t):!1},labelGoals(){let t=0;for(const o in this.treeGoals)t+=this.treeGoals[o].children.length;return`Total goals: ${t}`},getDateEvents(t){const o=this.eventsMap[t]||[];if(o.length===1)o[0].side="full";else if(o.length===2){const s=R(G(o[0].date),{minute:q(o[0].time)}),l=R(s,{minute:o[0].duration}),i=R(G(o[1].date),{minute:q(o[1].time)}),n=R(i,{minute:o[1].duration});j(i,s,l,!0)||j(n,s,l,!0)?(console.log("getDateEvents...LENGTH==2..LEFT/RIGHT 'TWIX",s,l,i,n),o[0].side="left",o[1].side="right"):(o[0].side="full",o[1].side="full")}return o},hasDate(t){return this.currentDate?t.find(o=>o.date===this.currentDate):!1},getEventsForDate(t){return this.store.getEventsForDate(t)},isViewingToday(){return F()==this.currentDate},isViewingPast(){let t=F();if(this.currentDate&&this.currentDate==t)return!1;let o=fe(G(t));return!(fe(G(this.currentDate))>=o)},adjustCurrentTime(){const t=_(new Date);if(this.currentDate!==t.date){this.timeStartPos=-10,this.currentTime="";return}this.currentDate=t.date,this.currentTime=t.time,this.timeStartPos=this.$refs.calendar.timeStartPos(t.time,!1);let o=this.endTimesSet&&this.endTimesSet.has(t.time),s=this.startTimesSet&&this.startTimesSet.has(t.time);(o||s)&&this.doEnableEndNowBtn(this.currentTime,o,s)},setGoalsPrio(){let t=this.store.fetchAllPrio();return!t.size>0?(console.log("ERROR...no Priority goals?",t),[]):Array.from(t.values())},resetGoalEvts(t=!1){if(this.scheduledEvents==this.allEvents&&console.log("resetGoalEvts SAME"),t){let o=this.deepCopy(this.storedEvents);return this.allEvents=[...o],o}return this.allEvents},getLocalEvt(t){for(let o=0;o<this.allEvents.length;o++)if(this.allEvents[o].id===t)return this.allEvents[o];return null},getScheduledEvent(t){for(let o=0;o<this.scheduledEvents.length;o++)if(this.scheduledEvents[o].id==t)return this.scheduledEvents[o];return null},doSaveEvtProp(t,o=null,s=null){this.store.saveSubProp(t,o,s)},evtStartedOrPassed(t){const o=[];let s=R(t,{minute:0}),l=this.getTimeNumber(s);return this.dailyScheduled.forEach((i,n,a)=>{let d=this.getTimeNumber(i.start),c=this.getTimeNumber(i.end);if(d!==!1&&c!==!1){let f=l>=d&&l<c,p=l>=c;(f||p)&&o.push(n),f&&(this.hasStarted[n]=!0),this.enableEvtScoreEdit(n,p)}else console.log(`ERROR?!:${n} has no start/end?.`,i)}),o},allowScoreEdit(t){this.dailyScheduled.forEach((o,s,l)=>{this.disabledScoreEvts[s]=!t})},enableEvtScoreEdit(t,o){this.disabledScoreEvts[t]=!o},canEnableEditScore(t,o){const s=_(new Date);me(s,o)>0?this.disabledScoreEvts[t]=!0:(this.disabledScoreEvts[t]=!1,this.hasStarted[t]=!1)},parseScore(t){const o=t.split(/on/);return o.length!=2?(console.log(`parseScore error?${t}`,o),-1):o[1]-o[0]},doEnableEndNowBtn(t,o,s){for(let[l,i]of this.dailyScheduled)(o?i.end.time:i.start.time)==t&&(this.hasStarted[l]=!o,this.disabledScoreEvts[l]=!o)},enableEndNowBtn(t,o,s){const l=_(new Date);j(l,o,s,!0)?this.hasStarted[t]=!0:this.hasStarted[t]=!1},retrieveSameStart(t){let o=[];for(let[s,l]of this.dailyScheduled)l.start.time==t&&o.push(s);return o},confirmTimeChange(t,o,s,l,i,n,a=null){this.$q.dialog({title:t,message:o,cancel:!0,options:{type:"radio",model:"",items:[{label:s+" and "+l,value:"ok"},{label:l,value:"cancel"}]}}).onOk(d=>{if(d==""){console.log("confirmTimeChange onOk with no selection...doing onDismiss?!?"),this.doNotify("No selection made...Leaving Evt as is!","positive","bottom"),a?a():console.log("confirmTimeChange:: NoDismiss");return}return i(d)}).onCancel(()=>{n()})},confirmAction(t,o,s,l,i=null){this.$q.dialog({title:"Warning",cancel:!0,ok:o,message:t}).onOk(()=>{s()}).onCancel(()=>{l()}).onDismiss(()=>{if(i){console.log("confirmAction with dismiss!!"),i();return}})},radioChoiceDialog(t,o,s,l,i=null,n=null,a=null){this.$q.dialog({title:t,cancel:!!n,persistent:!0,message:o,options:{type:"radio",model:l,items:s}}).onOk(d=>{i&&(d==""?this.radioChoiceDialog(t,o,s,l,i,n,a):i(d))}).onCancel(()=>{n&&n()}).onDismiss(()=>{a&&a()})},checkBoxDialog(t,o,s,l,i=null,n=null,a=null){let d=s.length;this.$q.dialog({title:t,message:o,options:{type:"checkbox",model:[],isValid:c=>c.length>0&&c.length<=d,items:s},cancel:!0,persistent:!0}).onOk(c=>{i(c)}).onCancel(()=>{n&&n()}).onDismiss(()=>{a&&a()})},doNotify(t,o=void 0,s="top"){this.$q.notify({color:o!==void 0?o:"negative",position:s,message:t,icon:o==null?"report_problem":"thumb_up"})},updateButtons(t=null,o=null,s=null){this.showLoadDefaults=t!=null?t:this.showLoadDefaults,this.showScoreBtn=o!=null?o:this.showScoreBtn,this.showPrio=s!=null?s:this.showPrio},resetButtons(t,o){this.updateButtons(!t,!o,!o)},doRemove(t){let o=this.scheduledEvents.length,s=0;for(s;s<o;s++)if(this.scheduledEvents[s].id==t.id){this.scheduledEvents.splice(s,1);let l=null;if(this.dailyScheduled.has(t.id)?(l=this.dailyScheduled.get(t.id),this.dailyScheduled.delete(t.id)):console.log("doRemove ::> dailyScheduled has no such item?@? ERROR",t),l){let i=this.startTimesSet.delete(l.start.time),n=this.endTimesSet.delete(l.end.time);(!i||!n)&&console.log(`doRemove ::> ERROR? scheduleSets has no such item?@? start:${i}...end:${n}`,l,t.id+" "+(t==null?void 0:t.title.trim())+" "+(t==null?void 0:t.details))}break}},chooseAlternatives(t){let o=this.storedAlternatives,s=_(new Date),l=t.time,i=s.date;const n=f=>({label:f.title.trim()+" for "+f.duration+"min. at "+f.time+"("+f.score+")",value:f.id}),a=f=>f.filter(p=>!this.scheduledEvents.find(b=>b.id==p.id)),d=f=>{let p=R(G(i),{day:0}),b=R(G(p.date),{day:1}),O=this.getEventsForDate(p.date),y={};O?y=O:console.log("addInFutur EMPTY for >>...",p.date),f.forEach(w=>{let S=this.getLocalEvt(w);if(y[w]){console.log("addInFutur...ALREADY PRESENT",w,JSON.parse(JSON.stringify(S))),this.doNotify(`Alternative '${S==null?void 0:S.title.trim()}'already present on ${p.date}. Moving it to next day`,"warning");let r=this.getEventsForDate(b.date);r?r[w]?(console.log("addInFutur...ALREADY PRESENT",S,JSON.parse(JSON.stringify(r))),this.doNotify(`Alternative '${S==null?void 0:S.title.trim()}'also present on ${b.date}....smh`)):r[w]={duration:S.duration,time:l}:(console.log("addInFutur next day EMPTY for >>...",b.date),r={},r[w]={duration:S.duration,time:l}),this.store.saveDailySchedule(b.date,r)}else y[w]={duration:S.duration,time:l}}),this.store.saveDailySchedule(p.date,y)},c=f=>{this.doRemove(t);let p=o.find(O=>O.id==f);console.log("remReplace...Add at:",l,JSON.parse(JSON.stringify(p))),p=this.addPropsEventsTo(this.currentDate,[{...p,time:l}]),this.addEvtPropsIntoSchedule(p[0]);let b=this.updateCurrentSchedule();console.log("chooseAlternatives::remReplace:END",b),this.doSaveSchedule()};if(o=a(o),o.length==0){this.doNotify("Removing not allowed! Alternatives already present!");return}this.checkBoxDialog("Gotta pick alternatives","Select the first Evt to replace the removed and an Extra evt for later!",o.map(n),o[0].id,function(f){console.log("chooseAlternatives::opt",f),c(f.shift()),f.length>0?d(f):this.doNotify("Removing not allowed! Alternatives already scheduled!")},function(){console.log("chooseAlternatives::onCancel")})},removeEvtInSchedule(t,o=null){if(this.isViewingPast()){if(t.duration<30){console.log("removeEvtInSchedule...baah too smoll smoll",t.title,t.duration),this.doNotify("Removing from the past is a no no!");return}this.chooseAlternatives(t);return}let s=()=>{this.doRemove(t),this.disableSaveSchedule=!1,this.showReloadBtn=this.hasEventsForDate};if(!this.isViewingToday()){s(),console.log("Removed future evt");return}let l=`Remove "${t.title}" from schedule?`;this.confirmAction(l,"Remove",s,function(){console.log("Cancelled remove")})},updateCurrentSchedule(){const t=new Map;let o=new Set,s=new Set,l=new Set;return this.scheduledEvents.length<1?(this.dailyScheduled=t,this.endTimesSet=o,this.startTimesSet=l,s):(this.scheduledEvents.forEach(i=>{let n=R(G(i.date),{minute:q(i.time)}),a=R(n,{minute:i.duration});t.set(i.id,{start:n,end:a,on:i.date,originalAt:i.time,for:i.duration,score:i.score}),o.add(a.time),l.has(n.time)?s.add({at:n.time,id:i.id}):l.add(n.time),(this.currentDate==F()||!this.isViewingPast())&&(this.canEnableEditScore(i.id,a),this.enableEndNowBtn(i.id,n,a))}),this.dailyScheduled=t,this.endTimesSet=o,this.startTimesSet=l,s)},addEvtPropsIntoSchedule(t){let o=this.addEvtInScheduleMaps(t);if(!o){console.log(`addEvtPropsIntoSchedule:${t.title}..ERROR...NOT added?!?`,o);return}this.scheduledEvents.push(t)},addEvtInScheduleMaps(t){if(this.dailyScheduled.has(t.id))return console.log("addEvtInScheduleMaps with evt already added...ERROR?",t),!1;let o=R(G(t.date),{minute:q(t.time)}),s=R(o,{minute:t.duration});return this.dailyScheduled.set(t.id,{on:t.date,originalAt:t.time,for:t.duration,start:o,end:s,score:t.score}),this.endTimesSet.add(s.time),this.startTimesSet.add(o.time),(this.currentDate==F()||!this.isViewingPast())&&(this.canEnableEditScore(t.id,s),this.enableEndNowBtn(t.id,o,s)),!0},updateEvtInScheduleMaps(t,o){if(this.dailyScheduled.has(t)){let s=this.dailyScheduled.get(t),l=s.for,i=s.originalAt,n=s.start,a=s.end,d=R(o,{minute:l}),c=s.score;return this.dailyScheduled.set(t,{on:o.date,originalAt:i,for:l,start:o,end:d,score:c}),this.endTimesSet.delete(a.time)?this.endTimesSet.add(d.time):console.log("updateEvtInScheduleMaps-endTimesSet NOT FOUND?!?"),this.startTimesSet.delete(n.time)?this.startTimesSet.add(o.time):console.log("updateEvtInScheduleMaps-startTimesSet NOT FOUND?!?",t,o),(this.currentDate==F()||!this.isViewingPast())&&(this.canEnableEditScore(t,d),this.enableEndNowBtn(t,o,d)),!0}else return console.log("updateEvtInScheduleMaps--euh not found?ERROR?",t,o),!1},evtIsOverlappingTimes(t,o,s,l){let i=this.getTimeyNumber(t),n=this.getTimeyNumber(o),a=this.getTimeyNumber(s),d=this.getTimeyNumber(l);if(i===!1||a===!1||n===!1||d===!1)return console.log("ERROR... evtIsOverlappingTimes error",i,n,a,d),!1;let c=!1;return i>a&&i<=d&&(c="bas"),n>a&&n<=d&&(c="haut"),(a>=i&&n>=d||i>a&&n<d)&&(c="surrounding"),c},hasOverlappingEvent(t,o,s){const l=[];let i=o,n=R(i,{minute:s});return this.dailyScheduled.forEach((a,d,c)=>{if(d!=t){let f=this.evtIsOverlappingTimes(i,n,a.start,a.end);f&&l.push({target:t,targetStart:i,direction:f,inConflict:d})}}),l},overlapCheckEvtsAdd(t){let o={};for(let s=0;s<t.length;s++){let l=t[s],i=R(G(l.date),{minute:q(l.time)}),n=this.hasOverlappingEvent(l.id,i,l.duration);if(n.length>0){let a=0;do{let d=n[a];o[d.inConflict]||(o[d.inConflict]=[]),o[d.inConflict].push(d),a>0&&console.log("WOAH WOAH, multiple overlaps with same obj!",a,l,n[a])}while(++a<n.length)}else this.addEvtPropsIntoSchedule(l)}return o},updatedEvtDetails(t){let o=this.parentGoalsMap.get(t.parentGoal);return o?(t.bgcolor=o.bgcolor,t.details=`::${o.title.trim()} -- ${t==null?void 0:t.time} -> ${t==null?void 0:t.duration}min`):(console.log("ERROR?!? no parent goal for:",t),t.bgcolor="grey",t.title=`Ad-hoc:${t==null?void 0:t.title} (${this.parseScore(t==null?void 0:t.score)})`,t.details=`${t==null?void 0:t.title}: ${t==null?void 0:t.time} -- ${t==null?void 0:t.duration}min`),t},addPropsEventsTo(t,o){if(!o)return this.doNotify("addPropsEventsTo BUT no goals to schedule..."),[];let s=[];return o.forEach(l=>{let i=this.getLocalEvt(l.id);i?(i.duration=l.duration,i.time=l.time,i.date=t,s.push(this.updatedEvtDetails(i))):console.log("ERROR in addPropsEventsTo...Evt:not present!",l)}),s},changeEvtTime(t,o,s,l=!1){let i=this.getScheduledEvent(t),n=null;if(i)n=i.time;else if(console.log(`changeEventTime::ADDIN Evt:${t}...doAdd:${l}`),l){if(i=this.getLocalEvt(t),!i)return console.log("ERROR in changeEvtTime STILL NOT found?!?",e,t,o,l),!1;n=i.time}else return console.log("ERROR in changeEvtTime not found, not adding!",t,o,l),!1;let a=()=>{if(console.log(`doUpdateEvt '${i.title.trim()}' from ${n} to ${o.time} with doAdd?:${l}-->${i.time}`),l){let f=this.addPropsEventsTo(this.currentDate,[{...i,time:o.time}]);console.log("doUpdateEvt:: afterProps",JSON.parse(JSON.stringify(f[0]))),this.addEvtPropsIntoSchedule(f[0]);return}this.updateEvtInScheduleMaps(t,o),l||(i.time=o.time,this.updatedEvtDetails(i))},d=()=>{if(console.log(`keepAsIs '${i.title.trim()}' to ${n} with add:${l}`),l){let f=this.addPropsEventsTo(this.currentDate,[{...i,time:n}]);console.log("keepAsIs:: afterProps",JSON.parse(JSON.stringify(f[0]))),this.addEvtPropsIntoSchedule(f[0])}else this.updateEvtInScheduleMaps(t,n),i.time=n,this.updatedEvtDetails(i)},c=f=>(f=="ok"&&this.doSaveEvtProp(t,o.time,null),a(),f);if(console.log(`changeEventTime::${i.title}...skipAsk:${s} with evt canMove:${i==null?void 0:i.canMove} and inDef:${i==null?void 0:i.inDefaults}`),(i==null?void 0:i.inDefaults)||!(i!=null&&i.canMove))if(s)a();else{if(n==o.time){console.log("SAME TIME,no need to ask");return}let f=`Evt '${i.title.trim()}' scheduled at ${n}.
        
Change default time to ${o.time} ?
        
Cancel to Temporary ${l?"add":"move"}.
        
No selection to keep time as-is default`;this.confirmTimeChange("Default Time Change?",f,"Change",`Temp.${l?"Add":"Move"}`,function(p){c(p)},function(){console.log("changeEventTime::onCancel...keeping as is>"),d()},function(){console.log("changeEventTime::onDismiss...no action?"),d()})}else if(i!=null&&i.canMove)a();else{if(n==o.time){console.log("SAME TIME,no need to ask");return}let f=`Evt '${i.title.trim()}' Set to not move from ${n}.
        
Move time to ${o.time} ?
        
Cancel to Temporary ${l?"add":"move"}.
        
No selection to keep time as-is default`;this.confirmTimeChange("Moving Evt's time",f,"Change",`Temp.${l?"Add":"Move"}`,function(p){c(p)},function(){console.log("changeEventTime::onCancel...no action>"),d()},function(){console.log("changeEventTime::onDismiss...no action?"),d()})}},recurChangeTime(t,o,s,l=!1,i=!1){let n=this.dailyScheduled.get(t);if(n){let a=q(n.start.time)-q(s.time),d=`${a>0?"DOWN":"UP"}`,c=null;if(a>=0){c=R(s,{minute:parseInt(o.duration)+10});let b=R(s,{minute:parseInt(n.for)+10});console.log(`recurChangeTime:${t}...FORWARD ${d} for ${a} due to evt:${o.id} of dura:${o.duration} at ${s.time}.New>`,c.time,b.time,i,l)}else c=R(s,{minute:-(parseInt(n.for)+10)}),console.log(`recurChangeTime:${t}...BACKWARD ${d} for ${a} due to evt:${o.id} of dura:${o.duration} at ${s.time}.New`,c.time,i,l);let f=this.hasOverlappingEvent(t,c,n.for);if(f.length>0){console.log(`WARNING WARNING...more overlaps for ${t} at ${c.time}`,f);let b=0,O=f.length,y=this.getScheduledEvent(t);do{if(console.log(`CASCADING timeChange...doAdd?:${i}, skip:${l}`,f[b],n,y),f[b].inConflict==o.id){console.log("EUUUH...self overlap?!?",f[b]);break}this.recurChangeTime(f[b].inConflict,y,c,!0)}while(++b<O)}this.changeEvtTime(t,c,l),console.log(`recurChangeTime...skip:${l} OVERLAPPED:${t} moved ${d} to ${c.time}`);let p=s;this.changeEvtTime(o.id,p,l,i),console.log(`recurChangeTime...TARGET:${o.id} went ${d} skip:${l}.Add:${i} to time>> ${p.time}`)}else console.log("ERROR..ERROR overlapped event not found!",t)},fixyOverlaps(t,o=null){var w,S;let s=Object.keys(t).length,l=[],i=[];const n=r=>{if(r!=null&&r.parentGoal){let h=this.parentGoalsMap.get(r.parentGoal);return h==null?void 0:h.priority}return console.log("findPrio..ERROR no PARENT found?",r),null},a=r=>r.title.trim()+" Priority = "+n(r)+" && Score:: "+r.score,d=r=>{this.doNotify(r,"positive","bottom")},c=r=>{console.log(`fixyOverlaps:doRem ${r.id}:${r.title}`),i.push(r),this.doRemove(r)},f=r=>{l.push(r),console.log(`fixyOverlaps:doKeep ${r.id}:${r.title}`)},p=(r,h,u)=>{if(f(h),console.log(`fixyOverlaps::removeReplace >> ${r.title.trim()} WITH ${h.title.trim()}`,u),h=this.addPropsEventsTo(u.targetStart.date,[{...h,time:u.targetStart.time}]),o){console.log("fixyOverlaps:removeReplace...override",JSON.parse(JSON.stringify(h))),this.updateEvtInScheduleMaps(h[0].id,u.targetStart),console.log("fixyOverlaps",this.startTimesSet,this.endTimesSet);return}c(r),this.addEvtPropsIntoSchedule(h[0]);let v=this.updateCurrentSchedule();console.log("fixyOverlaps::removeReplace::DONE",v),v.size>0&&this.fixConflicts(v)},b=(r,h,u)=>{var m;let v=u.direction=="haut";l.push(h),console.log("forceYAdd",JSON.parse(JSON.stringify(h)),JSON.parse(JSON.stringify(r)),u),h=this.addPropsEventsTo(this.currentDate,[h]),console.log(`forceAdd changing evt:${r.id} to ${(m=u==null?void 0:u.targetStart)==null?void 0:m.time} goFwd>>${v}`),this.recurChangeTime(r.id,h[0],u.targetStart,!0,!0)};let O=r=>{console.log(r,JSON.parse(JSON.stringify(i)),JSON.parse(JSON.stringify(l)),s)};const y=(r,h,u,v)=>{if(r=="opt3"){let m="Pick one event...",B=[{label:a(h),value:h.id},{label:a(u),value:u.id}];this.radioChoiceDialog("",m,B,"",function(P){P==h.id?p(u,h,v):(console.log("by Event,chose scheduled",P,o),o&&c(h),f(u))},function(){d(`Cancelling to keep "${u.title.trim()}"`),o&&c(h)},function(){O("onDismiss opt3,remvd > Kept")})}else if(r=="opt2"){let m="Pick event by Score",B=[{label:`"${h.title.trim()}" with Score:: ${h.score} = ${this.parseScore(h.score)}`,value:h.id},{label:`"${u.title.trim()}" with Score:: ${u.score} = ${this.parseScore(u.score)}`,value:u.id}];this.radioChoiceDialog("",m,B,"",function(P){P==h.id?p(u,h,v):(console.log("by Score, chose scheduled",P,o),f(u),o&&c(h))},function(){d(`Cancelling to keep "${u.title.trim()}"`),o&&c(h)},function(){O("onDismiss opt2,remvd > Kept")})}else if(r=="opt1"){let m="Pick event by Priority",B=[{label:`"${h.title.trim()}" with Priority = ${n(h)}`,value:h.id},{label:`"${u.title.trim()}" with Priority = ${n(u)}`,value:u.id}];this.radioChoiceDialog("",m,B,"",function(P){P==h.id?p(u,h,v):(console.log("by Priority, chose scheduled",P,o),o&&c(h),f(u))},function(){d(`Cancelling to keep "${u.title.trim()}"`),o&&c(h)},function(){O("onDismiss opt1,remvd > Kept")})}else b(u,h,v)};for(let r in t){if(!t[r]||!t[r][0]){console.log("fixyOverlaps...ERROR no local found",r);continue}let h=t[r];if(h.length>1){console.log("fixyOverlaps::WOAH WOAH...multiple overlaps!!"),this.multiConflicts(h);continue}const u=h.pop();let v=this.getLocalEvt(u.target),m=this.getScheduledEvent(u.inConflict);if(!m||!v){console.log("fixyOverlaps...ERROR ERROR no evts found!!!",u);return}console.log(`fixyOverlaps::adding Evt ${v.id}:${v.title.trim()}(${v.time}) AT >> ${(w=u==null?void 0:u.targetStart)==null?void 0:w.time} --${u.direction} 
 Overlap with ${m.id}:${m.title.trim()}(${m.time})`,o);let B=[{label:"Choose by Priority",value:"opt1",color:"secondary"},{label:"Choose by Score",value:"opt2"},{label:"Choose one event",value:"opt3"}];u.direction!=="surrounding"&&B.push({label:`Force in '${v.title.trim()}' at ${(S=u==null?void 0:u.targetStart)==null?void 0:S.time}?`,value:"opt4"});let P=`Event: '${v.title.trim()}' Overlaps with Scheduled '${m.title.trim()}'.

      Resolve or Cancel to keep '${m.title.trim()}'`;this.radioChoiceDialog("Warning::Overlapping Events",P,B,"opt1",function(Oe){y(Oe,v,m,u)},function(){d(`Keeping scheduled "${m.title.trim()}"`),f(m),o&&(console.log("huh OVERRIDE... coolios removing",v.title.trim()),toRem(v))},function(){console.log("fixyOverlaps::onDismiss,remvd > Kept",JSON.parse(JSON.stringify(i)),JSON.parse(JSON.stringify(l)),s),(l.length==s||i.length==s)&&console.log(`fixyOverlaps::setTimeout:DONE?!? k=${l.length},rm=${i.length}`,s)})}},multiConflicts(t){var y,w,S;let o="",s=[],l=null,i=[],n=null,a=[{label:"Resolve by Highest Priority",value:"opt1",color:"secondary"},{label:"Resolve by lowest Score Interval",value:"opt2"},{label:"Pick event",value:"opt3"}];const d=r=>({label:r.title+" at "+r.score,value:r.id}),c=r=>{let h=0,u=null;for(let v of r)if(v.parentGoal){let m=this.parentGoalsMap.get(v.parentGoal);m?m.priority>h&&(h=m.priority,u=v):console.log("findhighestPrio..ERROR no PARENT found?",v)}else console.log("findhighestPrio..ERROR EVT not found?",v);return console.log("multiConflicts::findhighestPrio...",u==null?void 0:u.title.trim(),h),u};let f=r=>{let h=0,u=null;for(let v of r){let m=this.parseScore(v.score);m>-1&&m>=h?(h=m,u=v):console.log("multiConflicts::ERROR...parseScore?",m,v)}if(u)return console.log("multiConflicts::Score Chosen..lowest?",u.id,u==null?void 0:u.title.trim(),u.score),u},p=(r,h)=>{console.log(`removeConflicts with toKeep=${r.length} out of total:${h.length}`),h.forEach((v,m,B)=>{if(r.find(P=>P.id==v.id))if(console.log("removeConflicts:KEEEP",v.id,v==null?void 0:v.title.trim(),n),v.id!=l.id){let P=this.addPropsEventsTo(this.currentDate,[{...v,time:n}]);this.addEvtPropsIntoSchedule(P[0])}else console.log("removeConflicts...already scheduled!!",n,v);else v.id==l.id&&(console.log("removeConflicts...removing scheduled!!",v),this.doRemove(v))});let u=this.updateCurrentSchedule();console.log("multiConflicts::removeConflicts::DONE",u),u.size>0&&this.fixConflicts(u)},b=r=>{this.radioChoiceDialog("","Choose the event to schedule",r.map(d),"",function(h){console.log("chooseEvt::chose",h);let u=r.find(v=>v.id==h);if(u)i.push(u);else{console.log("chooseEvt::ERROR NOT FOUND!!",h);return}return console.log(`chooseEvt::onOk >>${h} >> ${u==null?void 0:u.title.trim()}`),u},null,function(){i.length>0&&(console.log("chooseEvt::LAST LAST?",JSON.parse(JSON.stringify(i))),setTimeout(()=>{p(i,r)},0))})};for(let r of t){console.log("multiConflicts....handling:>",JSON.parse(JSON.stringify(r)));let h=this.getScheduledEvent(r.inConflict);if(!h){console.log("multiConflicts...ERROR ERROR no evts found!!!",r);return}if(!l)l=h,n=(y=r==null?void 0:r.targetStart)==null?void 0:y.time;else if(l.id!=h.id){console.log("multiConflicts...ERROR Not same inConflict",h.id);return}let u=this.getLocalEvt(r.target);if(!u){console.log("multiConflicts...ERROR ERROR local evt not found!!!",r);return}o+=` '${u==null?void 0:u.title.trim()}',`,s.push(u),((w=r==null?void 0:r.targetStart)==null?void 0:w.time)!=n&&console.log("multiConflicts...oh WELL timey timey",n,(S=r==null?void 0:r.targetStart)==null?void 0:S.time)}let O=`${o} conflicts with scheduled '${l==null?void 0:l.title.trim()}'

      Choose how to solve this...`;s.unshift(l),this.radioChoiceDialog("Overlap warning!!",O,a,"",function(r){if(r=="opt3")b(s);else if(r=="opt2"){let h=f(s);console.log("multiConflicts::opt2",h.id,h==null?void 0:h.title.trim(),h.score),i.push(h)}else{let h=c(s);console.log("multiConflicts::opt1",h.id,h==null?void 0:h.title.trim(),h.score),i.push(h)}},null,function(){i.length>0&&(console.log("multiConflicts::MAIN LAST LAST?",JSON.parse(JSON.stringify(i))),setTimeout(()=>{p(i,s)},0))})},fixConflicts(t){console.log("fixConflicts...Start",t,t.size);const o=a=>{let d=0,c=null;for(let f of a){let p=this.getScheduledEvent(f);if(p){let b=this.parentGoalsMap.get(p.parentGoal);b?b.priority>d&&(d=b.priority,c=p):console.log("findhighestPrio..ERROR no PARENT found?",p)}else console.log("findhighestPrio..ERROR EVT not found?",f)}return console.log("fixConflicts::findhighestPrio...",c==null?void 0:c.title.trim(),d),c},s=a=>({label:a.title+" at "+a.score,value:a.id});let l=[],i=new Set,n=[{label:"Resolve by Highest Priority",value:"opt1",color:"secondary"},{label:"Resolve by lowest Score Interval",value:"opt2"},{label:"Pick event",value:"opt3"}];for(let a of t){let d=this.retrieveSameStart(a.at);console.log("fixConflicts:conflict",JSON.parse(JSON.stringify(a)),JSON.parse(JSON.stringify(d)));let c=[],f="";for(let S of d){let r=this.getScheduledEvent(S);r?(c.push(r),f+=` '${r==null?void 0:r.title.trim()}',`,i.has(r)?console.log(`Set already contain ${r.id}~${r.title}..skipping`):i.add(r)):console.log("fixConflicts...ERROR not found?",S)}let p=S=>{console.log("onOk::Chosen Manually",S);let r=this.getScheduledEvent(S);return r?(l.push(r),r):(console.log("fixConflicts::onOk:: ERROR?!?! Not found",S),r=this.getLocalEvt(S),r?(l.push(r),r):(console.log("fixConflicts::onOk:: ERROR ERROR..still not found!!!",S),!1))},b=()=>{let S=0,r=null;for(let h of c){let u=this.parseScore(h.score);u>-1&&u>=S?(S=u,r=h):console.log("fixConflicts::ERROR...parseScore?",u,h)}if(r)return console.log("fixConflicts::Score Chosen..lowest?",r.id,r==null?void 0:r.title.trim(),r.details,r.score),l.push(r),r},O=()=>{this.radioChoiceDialog("","Choose the event to schedule",c.map(s),"",function(S){let r=p(S);return console.log(`chooseEvt::onOk >>${S} >> ${r==null?void 0:r.title.trim()}`),r},null,function(){console.log("chooseEvt::onDismiss...PICK>>",l.length),l.length==t.size&&(console.log("chooseEvt::LAST LAST?",JSON.parse(JSON.stringify(l)),i),setTimeout(()=>{y(l,i),console.log("fixConflicts::setTimeout::chooseEvt::DONE",l.length)},0))})},y=(S,r)=>{r.forEach((u,v,m)=>{S.find(B=>B.id==u.id)?console.log("removeConflicts:KEEEP",u.id,u==null?void 0:u.title.trim()):this.doRemove(u)});let h=this.updateCurrentSchedule();console.log("fixConflicts::removeConflicts::DONE",h),h.size>0&&this.fixConflicts(h)},w=`${f} scheduled at same ${a.at}.

      Choose how to solve this...`;this.radioChoiceDialog("Overlap warning!!",w,n,"opt1",function(S){if(S=="opt3")O(),console.log("fixConflicts::opt3",JSON.parse(JSON.stringify(l)));else{if(S=="opt2")return b();{let r=o(d);console.log("fixConflicts::opt1",r.id,r==null?void 0:r.title.trim(),r.details,r.score),l.push(r)}}},null,function(){console.log("fixConflicts::onDismiss Main >>",l.length),l.length==t.size&&(console.log("fixConflicts::MAIN LAST LAST?",JSON.parse(JSON.stringify(l)),i),setTimeout(()=>{y(l,i),console.log("fixConflicts::setTimeout::MAIN::DONE",l.length)},0))})}return!0},loadForDate(t,o,s){let l=(a,d)=>({id:parseInt(a),duration:d.duration,time:d.time}),i=()=>{let a=this.getEventsForDate(t);if(!a){console.log(`ERROR no evts found for ${t}...`,a);return}console.log(`doLoadNotPresent ${t}::evts`,JSON.parse(JSON.stringify(a)));let d=Object.keys(a).map(f=>l(f,a[f]));this.scheduledEvents=this.addPropsEventsTo(t,d);let c=this.updateCurrentSchedule();c.size>0&&!s?(console.log(`doLoadNotPresent..FIX overlaps for ${t} in past:${s}`,c),this.doNotify(`${s?"past":"future"}: ${t} with Some overlaps to fix!`,"warning","bottom"),this.fixConflicts(c)):(this.showReloadBtn=!1,this.disableSaveSchedule=!0,this.doNotify(`Loaded schedule for ${s?"past":"future"}:: ${t}`,"positive","bottom"))},n=()=>{let a=this.getEventsForDate(t);if(!a){console.log(`ERROR no evts found for today:${t} ?!?`,a);return}console.log("OverlapCheckLoadToday:evts",JSON.parse(JSON.stringify(a)));let d=Object.keys(a).map(p=>l(p,a[p])),c=this.addPropsEventsTo(t,d);console.log(`OverlapCheckLoadToday ${t} loading:${c.length}`,this.scheduledEvents,this.dailyScheduled.size);let f=this.overlapCheckEvtsAdd(c);return Object.keys(f).length>0?this.doNotify(`${t} with Some overlaps to fix!`,"warning","bottom"):this.doNotify(`Loaded schedule for ${t}`,"positive","bottom"),f};if(this.scheduledEvents=[],this.updateCurrentSchedule(),o)if(this.isViewingToday()){let a=n();if(Object.keys(a).length>0){console.log("Overlaps toHandle >>",JSON.parse(JSON.stringify(a))),this.fixyOverlaps(a),this.showReloadBtn=o,this.showClearBtn=o,this.disableSaveSchedule=!1,this.evtStartedOrPassed(_(new Date)),this.resetButtons(o,s);return}this.evtStartedOrPassed(_(new Date)),this.disableSaveSchedule=!0}else i(),this.allowScoreEdit(s),console.log("doLoadNotPresent return...."),this.showClearBtn=!s;else this.showReloadBtn=!1,this.showClearBtn=!1,this.disableSaveSchedule=!0;(s||t!==F())&&(console.log("adjusting time for past/future",t,this.scheduledEvents.length),this.adjustCurrentTime()),this.reset(),this.resetButtons(o,s)},scheduleDefaults(t){let o=this.deepCopy(this.store.fetchDefaults()),s=this.isViewingToday(),l=this.isViewingPast();if(this.showReloadBtn=this.hasEventsForDate,this.showClearBtn=!l&&o.length>0,this.resetButtons(!0,l),this.disableSaveSchedule=!(o.length>0),s){let i=this.addPropsEventsTo(this.currentDate,o);if(t=="add"){let a=i.length;i=i.filter(d=>!this.scheduledEvents.find(c=>c.id==d.id)),console.log(`scheduleDefaults..ADDIN from ${a} to `,i.length)}let n=this.overlapCheckEvtsAdd(i);Object.keys(n).length>0&&(console.log(`scheduleDefaults overlaps on:${this.currentDate} ${o.length} == ${i.length} ?!? of size:`,Object.keys(n).length),this.fixyOverlaps(n)),this.evtStartedOrPassed(_(new Date));return}else{let i=this.addPropsEventsTo(this.currentDate,o);if(t=="add"){let a=i.length;i=i.filter(c=>!this.scheduledEvents.find(f=>f.id==c.id)),console.log(`scheduleDefaults..ADDIN to ${this.currentDate} of ${this.scheduledEvents.length} from ${a} to `,i.length);let d=this.scheduledEvents.concat(i);this.scheduledEvents=d}else this.scheduledEvents=i;let n=this.updateCurrentSchedule();console.log("scheduleDefaults..sameStart?",n),l?this.allowScoreEdit(!0):this.allowScoreEdit(!1)}},reset(){this.draggedItem=null,this.targetDrop=null,this.chosenScore=null,this.chosenPrio=null,this.possibleRange=null},deepCopy(t){if(t===null||typeof t!="object")return t;if(Array.isArray(t))return t.map(s=>this.deepCopy(s));const o={};for(let s in t)t.hasOwnProperty(s)&&(o[s]=this.deepCopy(t[s]));return o},onRefresh(t){setTimeout(()=>{this.scheduledEvents=[],this.updateCurrentSchedule(),this.resetGoalEvts(!0),this.loadForDate(this.currentDate,this.hasEventsForDate,this.isViewingPast()),t()},1e3)},doSaveSchedule(){let t={};this.dailyScheduled.size<1?t=null:this.dailyScheduled.forEach((o,s,l)=>{t[s]={duration:o.for,time:o.start.time}}),this.store.saveDailySchedule(this.currentDate,t),this.disableSaveSchedule=!0,this.showReloadBtn=!1,this.showClearBtn=t!=null,this.doNotify(`doSaveSchedule for ${this.currentDate}`,"positive","top")},addParentGoal(t,o,s="red-14",l=2){let i={};this.parentGoalsMap.forEach((d,c,f)=>{let p=d.bgcolor;i[p]=c});let n=Ye();if(Object.keys(i).length>1){//!this.scheduledEvents.find(item => item.id == x.id))
let d=n.find(c=>!i[c]);console.log(`bgcolor..from ${s} to NEW:`,d),s=d||s}return this.store.addMainGoal(t,o,s,l)},onAddNewEvent(t,o,s,l){if(this.possibleRange||(console.log("umm onAddNewEvent... not a range selection",this.startEndTimes),this.possibleRange=this.startEndTimes),t.trim()==""){this.doNotify("Empty Goal title..."),this.addEventDialog=!1,this.reset();return}let i=oe(this.possibleRange[0]),n=l>15?R(i,{minute:parseInt(l)}):R(oe(this.possibleRange[1]),{minute:15}),a=Math.floor(me(i,n)/1e3/60);console.log(`onAddNewEvent:${t} under ${s} from ${i.time} till ${n.time}.Duration:${a}`,l);let d=null;if(s=="self"){let c=this.addParentGoal(t,"","purple-10",2);c?(console.log("wooh SELF parent created",c),d=this.store.addSubGoal(c,t,"1on5",i.time,a,!0,!1,a<30)):console.log("ERROR? no pID",c)}else if(o){d=this.store.addSubGoal(o.id,t,"1on5",i.time,a,!1,!1,a<30);//!canMove and notInDefaults. isAlternative when duration<30
}else{let c=this.store.getGoalByTitle("Misc");if(c){console.log("Woo!! Misc pGoal already exists!",c),d=this.store.addSubGoal(c.id,t,"1on5",i.time,a,!1,!1,a<30);//!canMove and notInDefaults.isAlternative when duration<30
}else{let f=this.addParentGoal("Misc","Miscellaneous","grey-10",2);f&&(console.log("NEW Misc pGoal created",f),d=this.store.addSubGoal(f,t,"1on5",i.time,a,!0,!1,a<30))}}if(d){this.resetGoalEvts(!0);let c=this.hasOverlappingEvent(d,i,a);if(c.length>0)console.log("onAddNewEvent...OVERLAPS",c),this.fixyOverlaps(c,!0);else{let f=this.addPropsEventsTo(this.currentDate,[{id:d,time:i.time,title:t,score:"1on5",duration:a,canMove:!o}]);console.log(`onAddNewEvt, addEvtPropsIntoSchedule: ${d} at ${i.time}`),this.addEvtPropsIntoSchedule(f[0])}this.disableSaveSchedule=!1,this.showReloadBtn=this.hasEventsForDate,this.showClearBtn=!0}else console.log("BOO ERROR no subID:(",d),this.doNotify("Error adding this event :(","negative");this.addEventDialog=!1},closingDialog(){console.log("closingDialog..."),this.addEventDialog=!1,this.reset()},onPickEvent(t,o){if(this.addEventDialog=!1,!t){console.log("onPickEvent...ERROR nothing!",t,o),this.doNotify("No Goal selected..."),this.reset();return}let s=this.getScheduledEvent(t.id);if(s){console.log("onPickEvent...NOT NEW?!?ERROR!",s,t);return}else{s=t;let l=this.isViewingPast()?!0:o;console.log(`onPickEvent...adding ${s.id}-${s.title.trim()} from ${s.time} to ${this.targetDrop.timestamp.time} with force?${o} BUT inPast Forcing:${l}`);let i=this.hasOverlappingEvent(s.id,this.targetDrop.timestamp,s.duration),n=i.length;if(n>0){console.log(`onPickEvent::hasOverlappingEvent of size: ${n}`);let a=0;do this.recurChangeTime(i[a].inConflict,s,this.targetDrop.timestamp,l,!0);while(++a<n)}else this.changeEvtTime(s.id,this.targetDrop.timestamp,l,!0)}this.disableSaveSchedule=!1,this.showReloadBtn=this.hasEventsForDate,this.showClearBtn=!0,this.reset()},onEndNow(t){const o=_(new Date);let s=this.hasEventsForDate;if(this.dailyScheduled.has(t)){let l=this.dailyScheduled.get(t),i=l.start,n=l.end;if(j(o,i,n,!0)){let a=this.getTimeNumber(n)-this.getTimeNumber(i),d=this.getTimeNumber(o)-this.getTimeNumber(i);console.log(`Great, ${t} REDUCING duration from ${a} to:`,d);for(let c=0;c<this.scheduledEvents.length;c++){let f=this.scheduledEvents[c];f.id===t&&(f.duration=d)}this.dailyScheduled.set(t,{...l,for:d,end:o}),this.endTimesSet.delete(n.time)||console.log("ERROR endTimesSet item does not exist?!?",l,this.endTimesSet),this.endTimesSet.add(o.time)}else console.log("umm aint in the middle of this event! Nothing to do...ERROR?",o.time,i.time,n.time)}else{console.log("ERROR doEndNow not found!!!",t);return}this.disabledScoreEvts[t]=!1,this.disableSaveSchedule=!1,this.showReloadBtn=s,this.showClearBtn=!0},onSaveScore(t,o){let s=this.dailyScheduled.get(o);if(s){if(this.parseScore(t)<-1){this.doNotify("Score Error: higher# on lower#");return}s.score=t,this.doSaveEvtProp(o,null,t);let n=(a=>this.scheduledEvents.find(d=>d.id==a))(o);n?n.score=t:console.log("onSaveScore ERROR not found",n,o)}else console.log(`ERROR onSaveScore could not find event ${o}?!?`)},onClearDay(){if(this.isViewingPast()){this.doNotify("Editing past is no no!");return}this.scheduledEvents=[],this.updateCurrentSchedule(),this.resetGoalEvts(!0),this.doNotify("Cleared daily schedule","warning","top"),this.reset();let t=this.hasEventsForDate;this.showReloadBtn=t,this.showLoadDefaults=!0,this.showClearBtn=!1,this.disableSaveSchedule=!t},onReloadSaved(){let t=this.hasEventsForDate,o=()=>{console.log("Aborting",this.currentDate,this.scheduledEvents,t),this.showReloadBtn=!this.isViewingPast()||t},s=()=>{this.scheduledEvents=[],this.updateCurrentSchedule(),this.loadForDate(this.currentDate,t,this.isViewingPast()),this.reset()};this.scheduledEvents.length>0?this.confirmAction("Overwrite current Evts?","OK",s,o):s(),this.showReloadBtn=!1,this.showClearBtn=!this.isViewingPast()},onLoadDefault(){let t=()=>{console.log("Aborting",this.currentDate)},o=s=>{this.scheduleDefaults(s)};if(this.scheduledEvents.length>0){let s=[{label:"Add Defaults to current day schedule",value:"add"},{label:"Overwrite and only schedule Defaults",value:"overwrite"}];this.radioChoiceDialog("Alert!!","Currently have scheduled Events...",s,"",function(l){console.log("OK LoadDefaults",l),o(l)},t)}else o("overwrite")},choosePrio(t){let o=this.chosenPrio;o&&o==t?this.disablePrioBtn=!0:(this.chosenPrio=t,this.disablePrioBtn=!1)},chooseScore(t){let o=this.chosenScore;o&&o==t?this.disableScoreBtn=!0:(this.chosenScore=t,this.disableScoreBtn=!1)},findSamePrio(t){const o=()=>this.scheduledEvents.filter(i=>{var n;return((n=this.parentGoalsMap.get(i.parentGoal))==null?void 0:n.priority)==this.chosenPrio});let s=[],l=this.isViewingToday();if(t=="overwrite"||t=="add"){let i=this.deepCopy(this.storedEvents);for(let n of i){let a=this.parentGoalsMap.get(n.parentGoal);(a==null?void 0:a.priority)==this.chosenPrio&&s.push(n)}t=="add"?s=s.filter(n=>!this.scheduledEvents.find(a=>a.id==n.id)):(this.scheduledEvents=[],this.updateCurrentSchedule()),console.log(`findSamePrio...ADDIN to size: ${this.scheduledEvents.length}`,JSON.parse(JSON.stringify(s)))}else s=o(),console.log("findSamePrio..filtering!!",this.chosenPrio,s);if(l&&t!="filter"){s=this.addPropsEventsTo(this.currentDate,s);let i=this.overlapCheckEvtsAdd(s);Object.keys(i).length>0?(console.log(`findSamePrio${this.chosenPrio}...overlaps`,JSON.parse(JSON.stringify(i))),this.fixyOverlaps(i)):(console.log("findSamePrio >>No overlaps!!...",JSON.parse(JSON.stringify(s))),this.updateCurrentSchedule())}else{if(t=="filter")this.scheduledEvents=s;else if(s=this.addPropsEventsTo(this.currentDate,s),t=="add"){let i=this.scheduledEvents.concat(s);this.scheduledEvents=i}else this.scheduledEvents=s;this.updateCurrentSchedule()}if(!this.scheduledEvents.length>0){this.doNotify(`Empty for Priority == ${this.chosenPrio} :(`,"warning","bottom"),this.disableSaveSchedule=!0,this.showReloadBtn=this.hasEventsForDate,this.showClearBtn=!1;return}this.disableSaveSchedule=!1,this.showReloadBtn=this.hasEventsForDate,this.showClearBtn=!0},onReloadWithPrio(){if(this.chosenPrio==null){this.doNotify("Ayo select a priority!");return}let t=()=>{console.log("onReloadWithPrio..cancelling"),this.reset()};if(this.scheduledEvents.length>0){let o=[{label:`Filter current by priority == ${this.chosenPrio}`,value:"filter"},{label:`Add to current Evts with priority == ${this.chosenPrio}`,value:"add"},{label:`Overwrite and schedule All by priority == ${this.chosenPrio}`,value:"overwrite"}];this.radioChoiceDialog("","Schedule change...",o,"",this.findSamePrio,t)}else this.findSamePrio("overwrite");this.resetButtons(this.hasEventsForDate,this.isViewingPast()),this.disablePrioBtn=!0},reloadEvtsWithScore(t){const o=()=>{let i=[];return this.scheduledEvents.forEach(n=>{let a=this.parseScore(n.score);a>-1&&a>=this.chosenScore&&i.push(n)}),i};let s=[],l=this.isViewingToday();if(t=="overwrite"||t=="add"){const i=this.store.fetchGoalsWithMinScore(this.chosenScore);console.log("reloadEvtsWithScore SCORE",JSON.parse(JSON.stringify(i))),t=="add"?s=i.filter(n=>!this.scheduledEvents.find(a=>a.id==n.id)):(s=i,this.scheduledEvents=[],this.updateCurrentSchedule())}else s=o(),console.log(`reloadEvtsWithScore AFTER flag ${t}`,JSON.parse(JSON.stringify(s)),JSON.parse(JSON.stringify(this.scheduledEvents)));if(console.log(`reloadEvtsWithScore>'${t}'::${this.chosenScore}`,this.currentDate,this.scheduledEvents.length),l&&t!="filter"){console.log("reloadEvtsWithScore...checking TODAY!"),s=this.addPropsEventsTo(this.currentDate,s),console.log(`reloadEvtsWithScore::addPropsEventsTo for ${t}`,JSON.parse(JSON.stringify(s)),JSON.parse(JSON.stringify(this.scheduledEvents)));let i=this.overlapCheckEvtsAdd(s);Object.keys(i).length>0?(console.log(`onReloadWithScore ${this.chosenScore}...overlaps!!`,JSON.parse(JSON.stringify(i))),this.fixyOverlaps(i)):(console.log("onReloadWithScore >>NO OVERLAPS!!!...",JSON.parse(JSON.stringify(s))),this.updateCurrentSchedule())}else{if(t=="filter")this.scheduledEvents=s;else if(s=this.addPropsEventsTo(this.currentDate,s),t=="add"){let i=this.scheduledEvents.concat(s);this.scheduledEvents=i}else this.scheduledEvents=s;this.updateCurrentSchedule()}if(!this.scheduledEvents.length>0){this.doNotify(`Empty for Score >= ${this.chosenScore} :(`,"warning","bottom"),this.disableSaveSchedule=!0,this.showReloadBtn=this.hasEventsForDate,this.showClearBtn=!1;return}this.disableSaveSchedule=!1,this.showReloadBtn=this.hasEventsForDate,this.showClearBtn=!0},onReloadWithScore(){if(this.chosenScore==null){this.doNotify("Ayo select a score!");return}let t=()=>{console.log("onReloadWithScore..cancelling",this.scheduledEvents),this.reset()};if(this.scheduledEvents.length>0){let o=[{label:`Filter current by Interval Score >= ${this.chosenScore}`,value:"filter"},{label:`Add to current Evts with Interval Score >= ${this.chosenScore}`,value:"add"},{label:`Overwrite and schedule All by Interval Score >= ${this.chosenScore}`,value:"overwrite"}];this.radioChoiceDialog("","Schedule change...",o,"",this.reloadEvtsWithScore,t)}else this.reloadEvtsWithScore("overwrite");this.resetButtons(this.hasEventsForDate,this.isViewingPast()),this.disableScoreBtn=!0},onChange(t){this.loadForDate(t.start,this.hasEventsForDate,this.isViewingPast())},onDragStart(t,o){if(this.isViewingPast()){this.doNotify("Editing past is no no!"),t.preventDefault();return}this.draggedItem=o},onDragEnter(t,o,s){return o==="goal-item"||(this.targetDrop=s),t.preventDefault(),!0},onDragOver(t,o,s){return t.preventDefault(),!0},onDragLeave(t,o,s){return!1},onDragEnd(t){console.log("onDragEnd",this.startTimesSet,this.endTimesSet)},onDrop(t,o,s){let l=this.getScheduledEvent(this.draggedItem.id);if(!l){console.log("onDrop ERROR",l,this.draggedItem);return}let i=null;if(o==="interval")console.log("onDrop to time-interval",s.timestamp.time,l.title.trim()),i=s.timestamp;else if(o==="goal-item"&&this.targetDrop)console.log("Dropping goal-item!!",o,this.targetDrop.timestamp),i=this.targetDrop.timestamp;else{console.log("Cannot drop here YO!!",t,o,s,this.targetDrop);return}if(!i){console.log("ERROR...no timestamp YO!!",t,o,s,this.targetDrop);return}let n=this.hasOverlappingEvent(l.id,i,l.duration),a=n.length;if(a>0){console.log("onDrop...overlapp!",a,JSON.parse(JSON.stringify(n)));let d=0;do{if(n[d].inConflict==n[d].target){console.log("EUUUH...self overlap?!?",n[d]);break}console.log("onDrop...overlap handlin::",n[d],typeof n[d]),n[d].direction=="surrounding"?this.fixyOverlaps(n,!0):this.recurChangeTime(n[d].inConflict,l,i,!0)}while(++d<a)}else this.changeEvtTime(l.id,i,!1),console.log(`${l.id} onDrop no overlap complete to ${i.time}`);this.disableSaveSchedule=!1,this.showReloadBtn=this.hasEventsForDate,this.showClearBtn=!0,this.reset()},onDblClickEvent(t,o){if(this.isViewingPast()){if(o.duration<30){console.log("onDblClickEvent..baah too smoll smoll",o.title,o.duration),this.doNotify("Removing from the past is a no no!");return}this.chooseAlternatives(o),t.preventDefault();return}this.removeEvtInSchedule(o)},onClickDate(t){console.log("onClickDate",t)},onClickTime(t){console.log("onClickTime..event",t),this.addEventDialog=!0,this.targetDrop=t.scope},onClickInterval(t){console.log("onClickInterval",t)},onClickHeadIntervals(t){console.log("onClickHeadIntervals",t)},onClickHeadDay(t){console.log("onClickHeadDay",t)},onMouseEnter(t){console.log("onMouseAt",t)},onMouseLeave(t){console.log("onMouseLeave",JSON.stringify(t))},onMouseDownTime({scope:t,event:o}){if(pe(o)){if(console.log("onMouseDownTime and its a leftClick event"),this.mobile===!0&&this.anchorTimestamp!==null&&this.otherTimestamp!==null&&U(this.anchorTimestamp)===U(this.otherTimestamp)){this.otherTimestamp=t.timestamp,this.mouseDown=!1;return}this.mouseDown=!0,this.anchorTimestamp=t.timestamp,this.otherTimestamp=t.timestamp}},onMouseUpTime({scope:t,event:o}){if(this.mobile!==!0&&pe(o)&&(this.otherTimestamp=t.timestamp,this.mouseDown=!1),!this.mousedown){let s=this.startEndTimes;if(s[1]==s[0])return;this.possibleRange=s,console.log("onMouseUpTime range change",this.possibleRange)}},onMouseMoveTime({scope:t,event:o}){this.mobile!==!0&&this.mouseDown===!0&&(this.otherTimestamp=t.timestamp)},scrollToEvent(t){this.$refs.calendar.scrollToTime(t.time,350)},onToday(){let t=()=>{this.$refs.calendar.moveToToday()},o=()=>{setTimeout(t,1e3),this.doSaveSchedule()};this.disableSaveSchedule?t():this.confirmAction(`Save day: ${this.currentDate} changes?`,"Save",o,t)},onPrev(){let t=()=>{this.$refs.calendar.prev()},o=()=>{setTimeout(t,1e3),this.doSaveSchedule()};this.disableSaveSchedule?t():this.confirmAction(`Save day: ${this.currentDate} changes?`,"Save",o,t)},onNext(){let t=()=>{this.$refs.calendar.next()},o=()=>{setTimeout(t,1e3),this.doSaveSchedule()};this.disableSaveSchedule?t():this.confirmAction(`Save day: ${this.currentDate} changes?`,"Save",o,t)}}}),Lt=t=>(ne("data-v-0fdf3c51"),t=t(),ae(),t),Jt={key:0,class:"q-gutter-md"},Ft={key:1,class:"subcontent"},qt={class:"float-right"},Ht={key:0},Ut={key:1},Wt={key:2},Qt={key:3},xt={key:4},zt={class:"row justify-center"},jt={style:{display:"flex","max-width":"800px",width:"100%",height:"400px"}},Kt={style:{display:"flex","justify-content":"center","flex-wrap":"wrap",padding:"2px"}},Yt={class:"title q-calendar__ellipsis"},Xt=["onDblclick","onDragstart"],Zt={class:"row justify-center"},eo=Lt(()=>T("br",null,null,-1)),to={class:"q-pa-xl bg-grey-9",style:{"max-width":"400px"}},oo={class:"row justify-center"},so={class:"q-mr-sm text-weight-bold",size:"28px"},io={key:0},lo={class:"text-weight-bold"},no={key:1,class:"text-weight-light text-black"};function ao(t,o,s,l,i,n){const a=L("add-goal-form"),d=L("navigation-bar"),c=L("sched-btn"),f=L("sched-drop-btn"),p=L("goaly-end"),b=L("q-calendar-day"),O=L("sched-dialog");return D(),$(I,null,[t.showForm?(D(),$("div",Jt,[g(N,{class:"q-pl-xl justify-center",color:"","text-color":"green",elevated:"",label:"HideForm",onClick:o[0]||(o[0]=y=>t.showGoalForm=!t.showGoalForm),"no-caps":""}),g(a)])):A("",!0),t.showForm?A("",!0):(D(),$("div",Ft,[g(ze,{onRefresh:t.onRefresh},{default:C(()=>[g(d,{onToday:t.onToday,onPrev:t.onPrev,onNext:t.onNext},null,8,["onToday","onPrev","onNext"]),T("div",qt,[t.showReloadBtn?(D(),$("div",Ht,[g(c,{"text-label":"Reload",class:"q-mt-xl","text-color":"green",onDoBtnAction:t.onReloadSaved},null,8,["onDoBtnAction"])])):A("",!0),t.showClearBtn?(D(),$("div",Ut,[g(c,{"text-label":"Clear",class:"q-mt-xl","text-color":"lime-5",onDoBtnAction:t.onClearDay},null,8,["onDoBtnAction"])])):A("",!0),t.showLoadDefaults?(D(),$("div",Wt,[g(c,{"text-label":"Defaults",class:"q-mt-xl","text-color":"blue",onDoBtnAction:t.onLoadDefault},null,8,["onDoBtnAction"])])):A("",!0),t.showScoreBtn?(D(),$("div",Qt,[g(f,{class:"q-mt-xl","text-color":"teal",disableBtn:t.disableScoreBtn,optionLabel:t.chosenScoreLabel,daOptions:t.scoreOptions,onDoReload:t.onReloadWithScore,onChooseOption:t.chooseScore},null,8,["disableBtn","optionLabel","daOptions","onDoReload","onChooseOption"])])):A("",!0),t.showPrio?(D(),$("div",xt,[g(f,{class:"q-mt-xl","text-color":"teal",disableBtn:t.disablePrioBtn,optionLabel:t.chosenPrioLabel,daOptions:t.setGoalsPrio(),onDoReload:t.onReloadWithPrio,onChooseOption:t.choosePrio},null,8,["disableBtn","optionLabel","daOptions","onDoReload","onChooseOption"])])):A("",!0)])]),_:1},8,["onRefresh"]),T("div",zt,[T("div",jt,[g(b,{ref:"calendar",view:"day",modelValue:t.currentDate,"onUpdate:modelValue":o[5]||(o[5]=y=>t.currentDate=y),"drag-enter-func":t.onDragEnter,"drag-over-func":t.onDragOver,"drag-leave-func":t.onDragLeave,"drop-func":t.onDrop,animated:"",bordered:"",hoverable:"","no-active-date":"","transition-next":"slide-left","transition-prev":"slide-right","time-clicks-clamped":"","interval-minutes":15,"interval-count":96,"interval-height":28,"selected-start-end-dates":t.startEndTimes,onChange:t.onChange,onClickDate:t.onClickDate,onClickTime:t.onClickTime,onClickInterval:t.onClickInterval,onClickHeadIntervals:t.onClickHeadIntervals,onClickHeadDay:t.onClickHeadDay,onMousedownTime:t.onMouseDownTime,onMouseupTime:t.onMouseUpTime,onMousemoveTime:t.onMouseMoveTime},{"head-day-event":C(({scope:{timestamp:y}})=>[T("div",Kt,[(D(!0),$(I,null,ie(t.eventsMap[y.date],w=>(D(),$(I,{key:w.id},[w.time?(D(),J(ue,{key:1,class:te(t.badgeClasses(w,"header")),style:H([t.badgeStyles(w,"header"),{margin:"1px",width:"10px","max-width":"10px",height:"10px","max-height":"10px",cursor:"pointer"}]),onClick:S=>t.scrollToEvent(w)},{default:C(()=>[g(le,null,{default:C(()=>[V(M(w.time+" - "+w.title),1)]),_:2},1024)]),_:2},1032,["class","style","onClick"])):(D(),J(ue,{key:0,class:te(t.badgeClasses(w,"header")),style:H([t.badgeStyles(w,"header"),{width:"100%",cursor:"pointer",height:"12px","font-size":"10px",margin:"1px"}])},{default:C(()=>[T("div",Yt,[V(M(w.title)+" ",1),g(le,null,{default:C(()=>[V(M(w.details),1)]),_:2},1024)])]),_:2},1032,["class","style"]))],64))),128))])]),"day-container":C(({scope:{days:y}})=>[t.hasDate(y)?(D(),$(I,{key:0},[T("div",{class:"day-view-current-time-indicator",style:H(t.style)},null,4),T("div",{class:"day-view-current-time-line",style:H(t.style)},null,4)],64)):A("",!0)]),"day-body":C(({scope:{timestamp:y,timeStartPos:w,timeDurationHeight:S}})=>[(D(!0),$(I,null,ie(t.getDateEvents(y.date),r=>(D(),$(I,{key:r.id},[r.time!==void 0?(D(),$("div",{key:0,class:te(["my-event",t.badgeClasses(r,"body")]),style:H(t.badgeStyles(r,"body",w,S)),draggable:!0,onDblclick:K(h=>t.onDblClickEvent(h,r),["prevent"]),onDragstart:K(h=>t.onDragStart(h,r),["stop"]),onDragend:o[1]||(o[1]=K((...h)=>t.onDragEnd&&t.onDragEnd(...h),["stop"])),onDrop:o[2]||(o[2]=h=>t.onDrop(h,"goal-item",t.scope)),onDragenter:o[3]||(o[3]=h=>t.onDragEnter(h,"goal-item",t.scope)),onDragover:o[4]||(o[4]=h=>t.onDragOver(h,"goal-item",t.scope))},[g(p,{disabledScore:t.disabledScoreEvts[r.id],title:r.title,id:r.id,startTime:r.time,score:r.score,details:r.details,happeningNow:t.hasStarted[r.id]?t.hasStarted[r.id]:!1,onEndNow:t.onEndNow,onSaveScore:t.onSaveScore,onDeleteNow:h=>t.removeEvtInSchedule(r,h)},null,8,["disabledScore","title","id","startTime","score","details","happeningNow","onEndNow","onSaveScore","onDeleteNow"])],46,Xt)):A("",!0)],64))),128))]),_:1},8,["modelValue","drag-enter-func","drag-over-func","drag-leave-func","drop-func","selected-start-end-dates","onChange","onClickDate","onClickTime","onClickInterval","onClickHeadIntervals","onClickHeadDay","onMousedownTime","onMouseupTime","onMousemoveTime"])]),t.addEventDialog?(D(),J(O,{key:0,storedGoals:t.storedMainG,canBeScheduled:t.canbeScheduled,onOnAddNewEvent:t.onAddNewEvent,onOnPickEvent:t.onPickEvent,onEuhHidin:t.closingDialog},null,8,["storedGoals","canBeScheduled","onOnAddNewEvent","onOnPickEvent","onEuhHidin"])):A("",!0)]),T("div",Zt,[g(N,{class:"q-mt-xl",color:"Green","text-color":"blue",elevated:"",label:"SaveSchedule",disable:t.doDisableSaveSchedule,onClick:t.doSaveSchedule,"no-caps":""},null,8,["disable","onClick"]),g(N,{class:"q-mt-xl",color:"","text-color":"green",elevated:"",label:"ShowForm",onClick:o[6]||(o[6]=y=>t.showGoalForm=!t.showGoalForm),"no-caps":""})]),eo,T("div",to,[T("div",oo,M(t.labelGoals()),1),g(X),g(et,{nodes:t.treeGoals,"node-key":"label",expanded:t.expanded,"onUpdate:expanded":o[7]||(o[7]=y=>t.expanded=y),"no-connectors":"",dense:"","default-expand-all":""},{"default-header":C(y=>[T("div",{class:"row items-center",style:H(t.titleStyles(y.node))},[g(be,{name:y.node.icon||"arrow",size:"28px",class:"q-mr-sm"},null,8,["name"]),T("div",so,M(y.node.label),1)],4)]),"default-body":C(y=>[y.node.isChildren?(D(),$("div",io,[T("span",lo," >> "+M(y.node.details),1)])):(D(),$("span",no,M(y.node.details),1))]),_:1},8,["nodes","expanded"])])]))],64)}var vo=Q(_t,[["render",ao],["__scopeId","data-v-0fdf3c51"]]);export{vo as default};
