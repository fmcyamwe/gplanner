import{j as ke,U as Be,W as Ie,r as M,c as Q,w as ye,n as Le,h as oe,k as ce,ay as xe,D as Ge,g as Ve,az as Fe,ac as ue,v as je,aA as He,a9 as le,aC as ve,aa as fe,Z as Je,_ as Ue,$ as K,L as U,E as A,F as z,G as w,M as $,H as D,O as P,I as _,N as be,K as G,J as x,a1 as q,Q as Oe,a2 as se,a3 as j,bf as ze,P as Ee,R as te,a5 as ie,a4 as Y,aU as ge,f as qe,a6 as We,a7 as Qe}from"./index.f91fcb48.js";import{w as B,i as re,p as Ke,a as Ye,b as Xe,Q as ne,c as Te}from"./utiFunc.495f7aee.js";import{T as Ze,Q as et,a as tt}from"./QSelect.73d7d030.js";import{t as de,E as Ce,b as V,c as pe,a as R,p as H,d as J,U as F,i as De,V as it,m as Se,l as X,Q as ot,e as lt}from"./QCalendarTask.11a4c494.js";import{c as me,a as st,u as nt}from"./goalStorage.d9ff0887.js";import{a as at}from"./QCalendar.686c6311.js";/* empty css                             */import"./touch.70a9dd44.js";import"./QItem.302a6b1c.js";var we=ke({name:"QSplitter",props:{...Be,modelValue:{type:Number,required:!0},reverse:Boolean,unit:{type:String,default:"%",validator:l=>["%","px"].includes(l)},limits:{type:Array,validator:l=>l.length!==2||typeof l[0]!="number"||typeof l[1]!="number"?!1:l[0]>=0&&l[0]<=l[1]},emitImmediately:Boolean,horizontal:Boolean,disable:Boolean,beforeClass:[Array,String,Object],afterClass:[Array,String,Object],separatorClass:[Array,String,Object],separatorStyle:[Array,String,Object]},emits:["update:modelValue"],setup(l,{slots:e,emit:t}){const{proxy:{$q:i}}=Ve(),o=Ie(l,i),s=M(null),n={before:M(null),after:M(null)},r=Q(()=>`q-splitter no-wrap ${l.horizontal===!0?"q-splitter--horizontal column":"q-splitter--vertical row"} q-splitter--${l.disable===!0?"disabled":"workable"}`+(o.value===!0?" q-splitter--dark":"")),h=Q(()=>l.horizontal===!0?"height":"width"),p=Q(()=>l.reverse!==!0?"before":"after"),O=Q(()=>l.limits!==void 0?l.limits:l.unit==="%"?[10,90]:[50,1/0]);function y(a){return(l.unit==="%"?a:Math.round(a))+l.unit}const v=Q(()=>({[p.value]:{[h.value]:y(l.modelValue)}}));let g,b,C,S,E;function T(a){if(a.isFirst===!0){const m=s.value.getBoundingClientRect()[h.value];g=l.horizontal===!0?"up":"left",b=l.unit==="%"?100:m,C=Math.min(b,O.value[1],Math.max(O.value[0],l.modelValue)),S=(l.reverse!==!0?1:-1)*(l.horizontal===!0?1:i.lang.rtl===!0?-1:1)*(l.unit==="%"?m===0?0:100/m:1),s.value.classList.add("q-splitter--active");return}if(a.isFinal===!0){E!==l.modelValue&&t("update:modelValue",E),s.value.classList.remove("q-splitter--active");return}const d=C+S*(a.direction===g?-1:1)*a.distance[l.horizontal===!0?"y":"x"];E=Math.min(b,O.value[1],Math.max(O.value[0],d)),n[p.value].value.style[h.value]=y(E),l.emitImmediately===!0&&l.modelValue!==E&&t("update:modelValue",E)}const c=Q(()=>[[Ze,T,void 0,{[l.horizontal===!0?"vertical":"horizontal"]:!0,prevent:!0,stop:!0,mouse:!0,mouseAllDir:!0}]]);function f(a,d){a<d[0]?t("update:modelValue",d[0]):a>d[1]&&t("update:modelValue",d[1])}return ye(()=>l.modelValue,a=>{f(a,O.value)}),ye(()=>l.limits,()=>{Le(()=>{f(l.modelValue,O.value)})}),()=>{const a=[oe("div",{ref:n.before,class:["q-splitter__panel q-splitter__before"+(l.reverse===!0?" col":""),l.beforeClass],style:v.value.before},ce(e.before)),oe("div",{class:["q-splitter__separator",l.separatorClass],style:l.separatorStyle,"aria-disabled":l.disable===!0?"true":void 0},[xe("div",{class:"q-splitter__separator-area absolute-full"},ce(e.separator),"sep",l.disable!==!0,()=>c.value)]),oe("div",{ref:n.after,class:["q-splitter__panel q-splitter__after"+(l.reverse===!0?"":" col"),l.afterClass],style:v.value.after},ce(e.after))];return oe("div",{class:r.value,ref:s},Ge(e.default,a))}}}),rt=Fe({name:"touch-hold",beforeMount(l,e){const{modifiers:t}=e;if(t.mouse!==!0&&ue.has.touch!==!0)return;const i={handler:e.value,noop:je,mouseStart(s){typeof i.handler=="function"&&He(s)===!0&&(le(i,"temp",[[document,"mousemove","move","passiveCapture"],[document,"click","end","notPassiveCapture"]]),i.start(s,!0))},touchStart(s){if(s.target!==void 0&&typeof i.handler=="function"){const n=s.target;le(i,"temp",[[n,"touchmove","move","passiveCapture"],[n,"touchcancel","end","notPassiveCapture"],[n,"touchend","end","notPassiveCapture"]]),i.start(s)}},start(s,n){i.origin=ve(s);const r=Date.now();ue.is.mobile===!0&&(document.body.classList.add("non-selectable"),me(),i.styleCleanup=h=>{i.styleCleanup=void 0;const p=()=>{document.body.classList.remove("non-selectable")};h===!0?(me(),setTimeout(p,10)):p()}),i.triggered=!1,i.sensitivity=n===!0?i.mouseSensitivity:i.touchSensitivity,i.timer=setTimeout(()=>{i.timer=void 0,me(),i.triggered=!0,i.handler({evt:s,touch:n!==!0,mouse:n===!0,position:i.origin,duration:Date.now()-r})},i.duration)},move(s){const{top:n,left:r}=ve(s);i.timer!==void 0&&(Math.abs(r-i.origin.left)>=i.sensitivity||Math.abs(n-i.origin.top)>=i.sensitivity)&&(clearTimeout(i.timer),i.timer=void 0)},end(s){fe(i,"temp"),i.styleCleanup!==void 0&&i.styleCleanup(i.triggered),i.triggered===!0?s!==void 0&&Je(s):i.timer!==void 0&&(clearTimeout(i.timer),i.timer=void 0)}},o=[600,5,7];if(typeof e.arg=="string"&&e.arg.length>0&&e.arg.split(":").forEach((s,n)=>{const r=parseInt(s,10);r&&(o[n]=r)}),[i.duration,i.touchSensitivity,i.mouseSensitivity]=o,l.__qtouchhold=i,t.mouse===!0){const s=t.mouseCapture===!0||t.mousecapture===!0?"Capture":"";le(i,"main",[[l,"mousedown","mouseStart",`passive${s}`]])}ue.has.touch===!0&&le(i,"main",[[l,"touchstart","touchStart",`passive${t.capture===!0?"Capture":""}`],[l,"touchend","noop","notPassiveCapture"]])},updated(l,e){const t=l.__qtouchhold;t!==void 0&&e.oldValue!==e.value&&(typeof e.value!="function"&&t.end(),t.handler=e.value)},beforeUnmount(l){const e=l.__qtouchhold;e!==void 0&&(fe(e,"main"),fe(e,"temp"),e.timer!==void 0&&clearTimeout(e.timer),e.styleCleanup!==void 0&&e.styleCleanup(),delete l.__qtouchhold)}});const dt=()=>!!/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);let Z,I;function ht(){Z={},I=st()}function ct(){Z.pGoalsMap==null;const l=new Map;let e=_e();return e?(e.forEach(t=>{l.set(t.id,t)}),Z.pGoalsMap=l,l):(console.log("Repo:: parentGoalsMap is empty or null",e),l)}function ut(l){return I.hasEventsForDate(l)}function Re(l){return I.getEventsForDate(l)}function _e(){return I.getMainGoals}function ft(){return Z.subGoals==null&&(Z.subGoals=I.getSubGoals),Z.subGoals}function gt(){return I.fetchAlternativeEvts()}function mt(){return I.currentBalance()}function pt(){return I.fetchGoalsTree()}function St(){let l=I.fetchAllPrio();return!l.size>0?(console.log("ERROR...no Priority goals?",l),[]):Array.from(l.values()).sort()}function yt(l){return I.fetchGoalsUpToMaxScore(l)}function Ne(l,e=null,t=null){I.saveSubProp(l,e,t)}function vt(){return I.getGoalByTitle("Misc")}function Ae(l){I.setBalance(l)}function Me(l,e){I.saveDailySchedule(l,e)}function bt(l,e,t,i){return I.addMainGoal(l,e,t,i)}function ae(l,e,t,i,o,s,n,r,h){return I.addSubGoal(l,e,t,i,o,s,n,r,h)}function Ot(l,e,t=null){let i=l,o=e.id,s=e,n=t,r=l.duration,h=l.time,p=null,O=null;return{id:o,duration:r,time:h,date:()=>p,datey:y,score:v(),atScore:i.atScore,getGoal:()=>s,getPGoal:()=>n,data:()=>i,setData:a=>i=a,setMoods:a=>O=a,getMoods:S,setNotes:a=>a,hasNote:g,setDura:a=>r=a,setTime:a=>h=a,setDate:a=>p=a,durationChanged:b,timeChanged:C,parsedScore:E,withPropsEventsTo:c,addPropsEventsTo:f};function y(){return p}function v(){return i.atScore||e.score}function g(){return l.notes!==void 0}function b(){return l.duration!==e.duration}function C(){return l.time!==e.time}function S(){return"byMood"in i&&(O=i.byMood),O}function E(){const a=v().split(/on/);return a.length!=2?-89:a[1]-a[0]}function T(a){if(!a)return"";let d=a.split(":");return parseInt(d[0])>=12?a+"PM":a+"AM"}function c(a,d=null){let u=Object.assign({},{...this});return u.bgcolor=a.bgcolor,u.jeSuis?u.details=`Of '${a.title.trim()}' :: << ${u.jeSuis.join(",")} >>`:u.details=`Of '${a.title.trim()}' :: ${T(u==null?void 0:u.time)} -> ${u==null?void 0:u.duration}min -- ${u!=null&&u.inDefaults?"Dft:":":"}${u!=null&&u.canMove?":Mv:":":"}${u!=null&&u.isAlternative?":Alt":":"}`,console.log("withProps",JSON.parse(JSON.stringify(u)),u.datey(),u.date(),u.title,u.details),u}function f(a){if(!n){console.log("addProps:: ERROR no parentGoal",this.data);return}this.data,getGoal();let d=Object.assign({},{...sav});return d.bgcolor=t.bgcolor,d.jeSuis?d.details=`Of '${t.title.trim()}' :: << ${d.jeSuis.join(",")} >>`:d.details=`Of '${t.title.trim()}' :: ${T(d==null?void 0:d.time)} -> ${d==null?void 0:d.duration}min -- ${d!=null&&d.inDefaults?"Dft:":":"}${d!=null&&d.canMove?":Mv:":":"}${d!=null&&d.isAlternative?":Alt":":"}`,console.log("addProps",JSON.parse(JSON.stringify(d)),d.datey(),d.date(),d.title,d.details),d}}class Et{constructor(e,t){this.showReloadBtn=!1,this.showClearBtn=!1,this.showLoadDefaults=!0,this.showScoreBtn=!0,this.showPrioBtn=!0,this.showOneEachBtn=!1,this.disablePrioBtn=!0,this.disableScoreBtn=!0,this.disableSaveSchedule=!0,this.chosenScore=null,this.chosenPrio=null,this._dailyScheduled=new Map,this._endTimesSet=new Set,this._startTimesSet=new Set,this.savedRawEvts=[],this.actualEvts=[],this.usingMoods={},this.isDisabledScoreEdit={},this.hasStarted={},this.mobileEnableScore={},this.showMobileDialog={},this.currentDate=e,this.mobile=t,ht()}allPGoals(){return _e()}getAllEvts(){return this.actualEvts}showEvtNoteScoreMobile(e){return this.mobileEnableScore[e]&&this.showMobileDialog[e]}toggleEvtNoteScoreMobile(e){console.log("toggleEvtNoteScoreMobile >>",e),(this.isViewingPast()||this.isViewingToday())&&(this.showMobileDialog[e]=!0)}euhHidin(e){this.showMobileDialog[e]=!1}getCurrentSchedTimesSets(){return{endSet:this._endTimesSet,startSet:this._startTimesSet}}isViewingPast(){let e=de();if(this.currentDate&&this.currentDate==e)return!1;let t=Ce(V(e));return!(Ce(V(this.currentDate))>=t)}isViewingToday(){return de()==this.currentDate}toggle(){this.showReloadBtn=!this.showReloadBtn}getProps(){return{showReloadBtn:this.showReloadBtn,showClearBtn:this.showClearBtn,showLoadDefaults:this.showLoadDefaults,showScoreBtn:this.showScoreBtn,showPrioBtn:this.showPrioBtn,showOneEachBtn:this.showOneEachBtn,disablePrioBtn:this.disablePrioBtn,disableScoreBtn:this.disableScoreBtn,chosenScore:this.chosenScore,chosenPrio:this.chosenPrio}}saveBtnEnabled(){return this.disableSaveSchedule}fetchGoalsTree(){return pt()}getCurrentBalance(){return mt()}getAllPrio(){return St()}getSubGoals(){return ft()}getCurrentMoods(){return this.usingMoods}getSubGoalByID(e){let t=this.getSubGoals(),i=parseInt(e);for(let o=0;o<t.length;o++)if(t[o].id===i)return t[o];return null}getOriginalEvtTime(e){let t=this.getSubGoalByID(e);return t?t.time:""}getStoredRawEvt(e){return e in this.savedRawEvts?this.savedRawEvts[e]:null}getAltEvts(){return gt()}getEventsForDate(e){return Re(e)}updateDaySchedule(e,t){Me(e,t)}parentGoalsMap(){return ct()}parentGoalById(e){return this.parentGoalsMap().has(e)?this.parentGoalsMap().get(e):null}findSchedEvent(e){return this._dailyScheduled.has(e)?this._dailyScheduled.get(e):null}findEvent(e){for(let t=0;t<this.actualEvts.length;t++)if(this.actualEvts[t].id===e)return this.actualEvts[t];return null}hasEventsForDate(){return ut(this.currentDate)}currentSchedEventsMap(){const e={};return this.actualEvts.forEach(t=>{let i=t.date;if(e[i]||(e[i]=[]),e[i].push(t),t.days){console.log(`currentSchedEventsMap multiple days? event for ${t.date}`,t.days);let o=pe(t.date),s=t.days;do o=R(o,{day:1}),map[o.date]||(map[o.date]=[]),map[o.date].push(t);while(--s>0)}}),e}schedEvtWithProps(e,t,i){if(!e.getPGoal()){console.log("schedEvtWithProps:: ERROR no parentGoal",e.data);return}let o=e.data(),s=e.getGoal(),n=e.getPGoal(),r={...s};(e.timeChanged()||e.durationChanged())&&(r.time=o.time,r.duration=o.duration),e.setDate(this.currentDate);let h=e.getMoods();if(h){//!==
this.usingMoods[r.id]=h}return r.date=this.currentDate,r.bgcolor=n.bgcolor,r.start=t,r.end=i,r.jeSuis&&r.jeSuis.length>0?r.details=`Of '${n.title.trim()}' :: << ${r.jeSuis.join(",")} >>`:r.details=`Of '${n.title.trim()}' :: ${B(r==null?void 0:r.time)} -> ${r==null?void 0:r.duration}min -- ${r!=null&&r.inDefaults?"Dft:":":"}${r!=null&&r.canMove?":Mv:":":"}${r!=null&&r.isAlternative?":Alt":":"}`,e.hasNote()&&(r.notes=o.notes),r}doProppy(e,t){let i=this.parentGoalById(e.parentGoal);if(!i){console.log("doProppy:: ERROR no Pgoal found ?!?",e);return}let o=R(V(t),{minute:H(e.time)}),s=R(o,{minute:e.duration}),n=Object.assign({},{...e,date:t,bgcolor:i.bgcolor,start:o,end:s});return e.jeSuis&&e.jeSuis.length>0?n.details=`Of '${i.title.trim()}' :: << ${e.jeSuis.join(",")} >>`:n.details=`Of '${i.title.trim()}' :: ${B(e==null?void 0:e.time)} -> ${e==null?void 0:e.duration}min -- ${e!=null&&e.inDefaults?"Dft:":":"}${e!=null&&e.canMove?":Mv:":":"}${e!=null&&e.isAlternative?":Alt":":"}`,n.sortTime=o,"byMood"in e&&(this.usingMoods[n.id]=e.byMood),n}addGoalsToSchedule(e,t){let i={};return e.forEach(o=>{let s=this.addToSchedule(o,t,!1);s?Array.isArray(s)&&(i[o.id]=s):console.log("addGoalsToSchedule:: Evt NOT added",s,t,o.id,o.title)}),this.massageOverlapObj(i)}addToSchedule(e,t,i=!1){if(this._dailyScheduled.has(e.id))return!1;{let o=R(V(this.currentDate),{minute:H(e.time)}),s=R(o,{minute:e.duration});if(t){let h=this.hasOverlappingEvent(e.id,o,s);if(h.length>0)return h}let n=i?this.schedEvtWithProps(e,o,s):this.doProppy(e,this.currentDate);n.sortTime=o,this.actualEvts.push(n);let r={...n,for:n.duration,start:o,end:s};i&&e.atScore&&(r.atScore=e.atScore),this._dailyScheduled.set(n.id,r),this._endTimesSet.add(s.time),this._startTimesSet.add(o.time),this.enableNoteScoreEdit(n.id,o,s)}return!0}enrichAddToSchedule(){let e={},t=this.isViewingToday();console.log("enrichAddToSchedule",Object.keys(this.savedRawEvts).length,"overlapCheck:"+t);for(let i in this.savedRawEvts){let o=this.savedRawEvts[i],s=this.getSubGoalByID(i);if(!s){console.log(`enrichAddToSchedule:: No goal found for key: ${i}...skipping!`);continue}let n=this.parentGoalById(s.parentGoal),r=Ot(o,s,n),h=this.addToSchedule(r,t,!0);h?Array.isArray(h)&&(e[s.id]=h):console.log("enrichAddToSchedule..ERROR?!? not added",h,s)}return this.massageOverlapObj(e)}loadEvtsForDay(e){return e||this.resetSchedule(!0),this.savedRawEvts=Re(this.currentDate),this.savedRawEvts?{overlaps:this.enrichAddToSchedule(),canContinue:!1}:{overlaps:null,canContinue:!0}}onChangeViewDate(e){let t=e==this.currentDate;return this.currentDate=e,this.enableActionBtns(),this.loadEvtsForDay(t)}resetSchedule(e=!1){this.savedRawEvts=[],this.actualEvts=[],this._dailyScheduled=new Map,this._endTimesSet=new Set,this._startTimesSet=new Set,e&&(this.usingMoods={}),this.showReloadBtn=!1,this.showClearBtn=!1,this.disableSaveSchedule=!0}unscheduledDefaults(){return this.getSubGoals().filter(t=>(t==null?void 0:t.inDefaults)&&(t==null?void 0:t.time)!=""&&!this.actualEvts.find(i=>i.id==t.id))}unscheduled(){return this.getSubGoals().filter(t=>!this.actualEvts.find(i=>i.id==t.id))}subGoalsOfParent(e){return this.getSubGoals().filter(i=>i.parentGoal==e)}chosenScoreLabel(){return this.chosenScore==null?"By Score":`Score <= ${this.chosenScore}`}chosenPrioLabel(){return this.chosenPrio==null?"By Priority":`Prio = ${this.chosenPrio}`}onChoosenPrio(e){let t=this.chosenPrio;t&&t==e?this.disablePrioBtn=!0:(this.chosenPrio=e,this.disablePrioBtn=!1)}onChoosenScore(e){let t=this.chosenScore;t&&t==e?this.disableScoreBtn=!0:(this.chosenScore=e,this.disableScoreBtn=!1)}scheduleByScore(e){const t=()=>{let n=[];return this.actualEvts.forEach(r=>{let h=re(r.score);h>-1&&h<=this.chosenScore&&n.push(r)}),n};let i=[];if(e=="filter")i=t(),this.resetSchedule();else{const n=yt(this.chosenScore);e=="add"?i=n.filter(r=>!this.actualEvts.find(h=>h.id==r.id)):(i=n,this.resetSchedule(!0))}if(console.log(`scheduleByScore::AFTER flag ${e} from size: ${this.actualEvts.length} to some evts = ${i.length}`),i.length<1)return this.toggleActionBtns(!1,"byScore"),{overlaps:null,canContinue:!1};let o=this.addGoalsToSchedule(i,this.isViewingToday()),s=Object.keys(o).length;return this.updateCurrentMoods(),this.toggleActionBtns(i.length>0,"byScore"),{overlaps:o,canContinue:!(s>0)}}scheduleSamePrio(e){const t=()=>this.actualEvts.filter(n=>{var r;return((r=this.parentGoalById(n.parentGoal))==null?void 0:r.priority)==this.chosenPrio});let i=[];if(e=="filter")i=t(),this.resetSchedule();else{let n=this.getSubGoals();for(let r of n){let h=this.parentGoalById(r.parentGoal);(h==null?void 0:h.priority)==this.chosenPrio&&i.push(r)}e=="add"?i=i.filter(r=>!this.actualEvts.find(h=>h.id==r.id)):this.resetSchedule(!0),console.log(`scheduleSamePrio::After ${e} from size: ${this.actualEvts.length} to evts = ${i.length}`,JSON.parse(JSON.stringify(i)))}if(i.length<1)return this.toggleActionBtns(!1,"byPrio"),{overlaps:null,canContinue:!1};let o=this.addGoalsToSchedule(i,this.isViewingToday()),s=Object.keys(o).length;return this.updateCurrentMoods(),this.toggleActionBtns(i.length>0,"byPrio"),{overlaps:o,canContinue:!(s>0)}}massageOverlapObj(e){let t={};for(let i in e){let o=e[i];if(o.length>0){let s=0;do{let n=o[s];t[n.inConflict]||(t[n.inConflict]=[]),t[n.inConflict].push(n),s>0&&(console.log("WOAH WOAH, massageOverlapObj:: multiple overlaps with same obj!"+s,o,n),n.inConflict in t&&(console.log("WOAH deleting inConflict",n.inConflict),delete t[n.inConflict]),o[s-1].inConflict in t&&(console.log("WOAH deleting PREV inConflict",o[s-1].inConflict),delete t[o[s-1].inConflict]),t[n.target]?(t[n.target].push(n),console.log("WOAH obj.id already present?",n.target)):t[n.target]=[n],t[n.target].unshift(o[s-1]),t.withID||(t.withID=[]),t.withID.push(n.target))}while(++s<o.length)}}return t}massageSingleOverlapArr(e){let t={};for(let i=0;i<e.length;i++){let o=e[i];t[o==null?void 0:o.inConflict]?t[o==null?void 0:o.inConflict].push(o):t[o==null?void 0:o.inConflict]=[o],i>0&&(console.log("WOAH WOAH,massageSingleOverlapArr..multiple overlaps with same target>>",e[i].target),o.inConflict in t&&(console.log("WOAH deleting inConflict",o.inConflict),delete t[o.inConflict]),e[i-1].inConflict in t&&(console.log("WOAH deleting PREV inConflict",e[i-1].inConflict),delete t[e[i-1].inConflict]),t[o.target]?(t[o.target].push(o),console.log("WOAH obj.id already present?",o.target)):t[o.target]=[o],t[o.target].unshift(e[i-1]),t.withID||(t.withID=[]),t.withID.push(o.target))}return t}scheduleOneEach(e){const t=r=>{let h=[];return this.parentGoalsMap().forEach((p,O,y)=>{let v=this.subGoalsOfParent(p.id);if(v.length>0){let g=null,b=v.length;if(r)g=v[Math.floor(Math.random()*b)];else{let C=0;for(;this.actualEvts.some(S=>v[b].id==S.id);)if(C++,b=Math.floor(Math.random()*v.length),console.log(`selectOneFromP::index ${b} scheduled...new random> At try> `+C,v.length),C>2){console.log("selectOneFromP::random...TOO MANY TRIES..ERROR?",C,b,v.length,v);break}g=v[b],console.log("selectOneFromP::NO Random at index: "+b,C,g)}h.push(g)}else console.log("scheduleOneEach::selectOneFromP...huh no subgoals for parentGoal",p)}),h},i=()=>{let r=this.unscheduled(),h=[];return this.parentGoalsMap().forEach((p,O,y)=>{let v=r.filter(b=>b.parentGoal==p.id),g=v.length;if(g>0){let b=v[Math.floor(Math.random()*g)];h.push(b)}else console.log("scheduleOneEach::No goal for parent!!",O,p==null?void 0:p.title)}),h};let o=[];if(e=="add"?(o=i(),console.log("scheduleOneEach...TOADD!!",o)):(this.resetSchedule(!0),o=t(!0)),o.length<1)return console.log("Empty for OneEach :("),this.toggleActionBtns(!1,"oneEach"),{overlaps:null,canContinue:!1};let s=this.addGoalsToSchedule(o,this.isViewingToday()),n=Object.keys(s).length;return this.toggleActionBtns(o.length>0,"oneEach"),{overlaps:s,canContinue:!(n>0)}}scheduleByMood(e){var s;let t=[];for(let n=0;n<e.length;n++){let r=this.getSubGoalByID(e[n].id);r&&r.time!=""&&(t.push(r),this.usingMoods[e[n].id]=(s=e[n])==null?void 0:s.mood)}if(t.length<1)return console.log("Empty for Mood :("),this.toggleActionBtns(!1,"ByMood"),{overlaps:null,canContinue:!1};let i=this.addGoalsToSchedule(t,this.isViewingToday()),o=Object.keys(i).length;return o>0&&console.log(`scheduleByMood overlaps!! to ${t.length}. overlaps =${o}`),this.toggleActionBtns(t.length>0,"ByMood"),{overlaps:i,canContinue:!(o>0)}}scheduleDefaults(e){let t=null;e=="add"?t=this.unscheduledDefaults():(this.resetSchedule(!0),t=this.unscheduledDefaults()),this.showReloadBtn=this.hasEventsForDate(),this.showClearBtn=!this.isViewingPast()&&t.length>0;let i=this.addGoalsToSchedule(t,this.isViewingToday()),o=Object.keys(i).length;return o>0&&console.log(`scheduleDefaults:: Overlaps!! for ${t.length}...overlaps =${o}`),this.toggleActionBtns(t.length>0,"defaults"),{overlaps:i,canContinue:!(o>0)}}saveNewGoal(e,t,i,o,s){if(console.log(`saveNewGoal:${t} :${o}: from ${e.time}.Duration:${s}`),o=="self"){let n=this.addParentGoal(t,t,"purple-10",2);if(n)return ae(n,t,"1on5",e.time,s,!0,!1,s<30);console.log("ERROR? no pID",n)}else if(i){return console.log("with parentGoal "+i.id,i==null?void 0:i.title),ae(i.id,t,"1on5",e.time,s,!1,!1,s<30);//!canMove and notInDefaults. isAlternative when duration<30
}else{let n=vt();if(n)return ae(n.id,t,"1on5",e.time,s,!1,!1,s<30);{let r=this.addParentGoal("Misc","Miscellaneous","grey-10",2);if(r)return ae(r,t,"1on5",e.time,s,!0,!1,s<30)}}return null}addParentGoal(e,t,i="red-14",o=2){let s=[];this.parentGoalsMap().forEach((h,p,O)=>{let y=h.bgcolor;s.push(y)});let n=Ke(),r=s.length;if(r>1){let h=r;for(;s.some(O=>n[h]==O);)console.log("addParentGoal::Taken color...new random",h,n[h]),h=Math.floor(Math.random()*r);let p=n[h];console.log(`addParentGoal::bgcolor..index ${h} from ${i} to:`,p),i=p||i}return bt(e,t,i,o)}onPickEvent(e,t,i,o){const s=()=>{o&&(this.removeFromBalance(e==null?void 0:e.duration),console.log("onPickEvent...useBalance","force?"+i));let p=this.addToSchedule({...e,time:t.time},!1);return this.isViewingPast()||o?this.saveDaySchedule():this.toggleActionBtns(!0,"onPickEvt"),{overlaps:p,canContinue:!0}};let n=R(t,{minute:e.duration}),r=this.hasOverlappingEvent(e.id,t,n),h=r.length;if(h>0){console.log("onPickEvent::OVERLAPS!!"+h,"with force "+i,JSON.parse(JSON.stringify(r)));let p={overlaps:this.massageSingleOverlapArr(r),canContinue:!1};return h>1||!i?p:(this.recurChangeTime(r[0].inConflict,e,t,!0),o&&this.removeFromBalance(e==null?void 0:e.duration),this.isViewingPast()||o?this.saveDaySchedule():this.toggleActionBtns(!0,"onPickEvt"),{overlaps:null,canContinue:!0})}else return s()}onAdHocEvent(e,t,i){const o=h=>(i&&(this.removeFromBalance(h==null?void 0:h.duration),console.log("onAdHocEvent...using Balance",h==null?void 0:h.duration)),this.saveDaySchedule(),{overlaps:null,canContinue:!0});let s=this.getSubGoalByID(e);if(!s)return{overlaps:null,canContinue:!1};let n=this.addToSchedule(s,!0),r=Array.isArray(n);if(!n||r){console.log("onAdHocEvent::Overlaps!!",JSON.parse(JSON.stringify(n)));let h={overlaps:n?this.massageSingleOverlapArr(n):null,canContinue:!1};return r&&n.length>1?h:r&&n.length==1?(console.log("onAdHocEvent::Overlaps!!--FORCING at ",t.time),this.recurChangeTime(n[0].inConflict,s,t,!0),o(s)):h}return o(s)}recurChangeTime(e,t,i,o=!1){var n,r,h,p,O;let s=this.findSchedEvent(e);if(s){let y=H(s.start.time)-H(i.time),v=`${y>0?"DOWN":"UP"}`,g=null;if(y>=0){g=R(i,{minute:parseInt(t.duration)+10});let T=R(i,{minute:parseInt(s.for)+10});console.log(`recurChangeTime::(${e}) going FORWARD ${v} for ${y} due to evt:${t.id}-${(n=t==null?void 0:t.title)==null?void 0:n.trim()} at ${i.time} 
          
 doAdd?:${o} >`,JSON.parse(JSON.stringify(g.time)),"alt:",T.time);let c=J(T,g);c>0&&(Math.floor(c/1e3/60)<=y?console.log(`recurChangeTime::(${e})....with duration:${s.for} vs evtDura:${t.duration}...NOT using alternative!!`):(console.log(`recurChangeTime::DIFFY>>${c}...gonna use Alternative`,T.time),g=T))}else{g=R(i,{minute:-(parseInt(s.for)+10)});let T=R(i,{minute:-(parseInt(t.duration)+10)});console.log(`recurChangeTime::(${e}) going BACKWARD ${v} for ${y} due to evt:${t.id}-${(r=t==null?void 0:t.title)==null?void 0:r.trim()} at ${i.time}
          
 doAdd?:${o}`,g.time,"alt:"+T.time)}let b=this.hasOverlappingEvent(e,g,R(g,{minute:s.for})),C=b.length;if(C>0){console.log(`WARNING WARNING::Extra Overlaps of ${C} for overlapped ${e} at ${g.time}`,b);let T=0,c=this.findEvent(e);console.log(c?`Cascading time change while ${o?"Adding":"Moving"} (${e})' ${c==null?void 0:c.title}' due to ${t.id}-'${(h=t==null?void 0:t.title)==null?void 0:h.trim()}'`:`ERROR::recurChangeTime ${e} not found`);do{if(console.log(`${T} CASCADING timeChange (${e}) ${c==null?void 0:c.title} at: ${g.time} now at: ${s.start.time}  till ${s.end.time}`,b[T]),b[T].inConflict==t.id){console.log(`EUUUH...::recurChangeTime::self overlap?!?${e} ...breaking!`,b[T]);break}this.recurChangeTime(b[T].inConflict,c,g)}while(++T<C)}this.changeEvtTime(s,g),console.log(`recurChangeTime::OVERLAPPED (${e}) ${v} to ${g.time} >> doAdd:${o}..DONE`);let S=i;if(console.log(`recurChangeTime::TARGET>>(${t.id})${(p=t==null?void 0:t.title)==null?void 0:p.trim()} going ${v}>> doAdd?:${o} to time>> ${S.time}`),!o){this.changeEvtTime(t,S);return}let E=this.addGoalsToSchedule([{...t,time:S.time}],this.isViewingToday());if(Object.keys(E).length>0){console.log(`recurChangeTime::MORE OVERLAP moving ${v} TARGET ${(O=t==null?void 0:t.title)==null?void 0:O.trim()} of size=${Object.keys(E).length}`,JSON.parse(JSON.stringify(E)));for(let T in E){let c=E[T];if(!c[0]){console.log("recurChangeTime::OVERLAP...skip key",T);continue}let f=c.length;if(f>0){let a=0;do{if(console.log(`recurChangeTime::TARGET CASCADING OVERLAP: ${t.id}-${t==null?void 0:t.title} at: ${S.time}`,c[a].targetStart,c[a].direction),c[a].inConflict==t.id){console.log("EUUUH...::recurChangeTime::TARGET>>OVERLAP::self overlap?!?...breaking!",c[a].inConflict,t.id,c[a].targetStart);break}this.recurChangeTime(c[a].inConflict,t,S,o)}while(++a<f)}}}}else console.log("ERROR..ERROR recurChangeTime:: overlapped event not found!","doAdd? "+o,e,t)}hasOverlappingEvent(e,t,i){const o=[];return this._dailyScheduled.forEach((s,n,r)=>{if(n!=e){let h=this.checkOverlapByTime(t,i,s.start,s.end);h&&(this._startTimesSet.has(t.time)&&console.log(`hasOverlappingEvent ${e} same start`,t.time),o.push({target:e,targetStart:t,direction:h,inConflict:n}))}}),o}checkOverlapByTime(e,t,i,o){let s=this.getTimeyNumber(e),n=this.getTimeyNumber(t),r=this.getTimeyNumber(i),h=this.getTimeyNumber(o);if(s===!1||r===!1||n===!1||h===!1)return console.log("ERROR... checkOverlapByTime error",s,n,r,h),!1;let p=!1;s>r&&s<h&&(p="bas"),n>r&&n<h&&(p="haut");let O=r>=s&&n>=h,y=s>=r&&n<=h;return(O||y)&&(p="surrounding",console.log("checkOverlapByTime","surrounding:"+O,"surrounded:"+y)),p}canDropEvent(e,t){let i=R(e,{minute:t.duration}),o=this.hasOverlappingEvent(t.id,e,i);return o.length>0?{overlaps:this.massageSingleOverlapArr(o),canContinue:!1}:(this.toggleActionBtns(!0,"canDropEvent"),{overlaps:null,canContinue:!0})}toggleActionBtns(e,t){this.disableSaveSchedule=!e,this.showReloadBtn=this.hasEventsForDate(),this.showClearBtn=!this.isViewingPast()&&e}resetChosen(){this.chosenScore=null,this.chosenPrio=null}enableActionBtns(){let e=this.isViewingPast();this.showOneEachBtn=!e,this.showLoadDefaults=!e,this.showScoreBtn=!e,this.showPrioBtn=!e}tooClose(e,t){let i=R(e,{minute:0}),o=this.getTimeNumber(i),s=R(e,{day:1}),n=new Date(s.date);n.setHours(24),n.setMinutes(0),n.setSeconds(0),n.setMilliseconds(0);let r=F(n),h=Math.floor(J(i,r)/1e3/60);if(h<t)return console.log("tooClose to midnight eh...:(",h),!0;let p=!1;return this._dailyScheduled.forEach((O,y,v)=>{let b=this.getTimeNumber(O.start)-o,C=J(i,O.start);Math.floor(C/1e3/60)<=10&&b>0&&(p=y)}),p}changeEvtTime(e,t,i){return i=="ok"&&Ne(e.id,t.time,null),this.doUpdateSchedule(e,t),i}doUpdateSchedule(e,t){let i=this.findSchedEvent(e.id),o=this.findEvent(e.id);if(!i||!o){console.log("doUpdateSchedule-ERROR NOT found",e.id,i,o);return}let s=R(V(o.date),{minute:H(t.time)}),n=R(s,{minute:o.duration});this._endTimesSet.delete(i.end.time)?this._endTimesSet.add(n.time):console.log("doUpdateSchedule-endTimesSet NOT FOUND?!?"),this._startTimesSet.delete(i.start.time)?this._startTimesSet.add(s.time):console.log("doUpdateSchedule-startTimesSet NOT FOUND?!?",e.id,t),this._dailyScheduled.set(e.id,{...i,for:o.duration,start:s,end:n}),o.time=t.time,o.sortTime=s,this.updateDetz(o),this.enableNoteScoreEdit(e.id,s,n)}saveDaySchedule(){let e={};this._dailyScheduled.size<1?e=null:this._dailyScheduled.forEach((t,i,o)=>{e[i]={time:t.start.time,duration:t.for,atScore:t==null?void 0:t.atScore},this.usingMoods[i]&&(e[i].byMood=this.usingMoods[i]),t.notes!==void 0&&(t==null?void 0:t.notes)!==""&&(e[i].notes=t==null?void 0:t.notes)}),console.log("saveDaySchedule",e?Object.keys(e).length:"CLEARED"),Me(this.currentDate,e),this.disableSaveSchedule=!0,this.showReloadBtn=!1,this.showClearBtn=e!=null&&!this.isViewingPast()}updateMinEndNowBtn(e,t,i){for(let[o,s]of this._dailyScheduled)(t?s.end.time:s.start.time)==e&&(this.hasStarted[o]=!t,this.isDisabledScoreEdit[o]=!t,this.mobile&&(console.log(`updateMinEndNowBtn..MOBILE::good?>>${i}::${t}`,e),this.showMobileDialog[o]=!t))}reduceEvtDuration(e,t){let i=this.findSchedEvent(e);if(!i){console.log("ERROR:: reduceEvtDuration Evt not found!!!",e);return}const o=F(new Date);let s=i.start,n=i.end;this._dailyScheduled.set(e,{...i,for:t,duration:t,end:o}),this._endTimesSet.delete(n.time)||console.log("ERROR endTimesSet item does not exist?!?",i,this._endTimesSet),this._endTimesSet.add(o.time);let r=this.findEvent(e);r.duration=t,this.updateDetz(r),this.enableNoteScoreEdit(e,s,o),this.saveDaySchedule()}updateEvtMinsEndNowBtns(e,t,i){const o=F(new Date);let s=R(o,{minute:0}),n=this.getTimeNumber(s),r=this.getTimeNumber(t),h=this.getTimeNumber(i);if(r!==!1&&h!==!1){let p=n>=r&&n<h,O=n>=h;p&&(this.hasStarted[e]=!0),O&&this.disableEvtScoreEdit(e,O)}else console.log(`ERROR?!:${e} has no start/end?.`)}canEndNow(e){let t=this.findSchedEvent(e);if(!t)return console.log("ERROR canEndNow Evt not found!!!",e),!1;const i=F(new Date);let o=t.start,s=t.end;if(!De(i,o,s,!0))return console.log("umm aint in the middle of this event! Nothing to do...canEndNow::ERROR?",i.time,o.time,s.time),!1;let n=R(i,{minute:0}),r=J(o,n),h=Math.floor(r/1e3/60);return console.log(`canEndNow:: ${e} duration from ${t.for} to: ${h}`),h<10?h:this.reduceEvtDuration(e,h)}updateNoteScore(e,t,i=""){let o=this.findSchedEvent(e);if(o){o.score==t||(Ne(e,null,t),o.atScore=t);let n=this.findEvent(e);n?n.score=t:console.log("onSaveScore ERROR not found",n,e),i!==""&&(o.notes=i,n.notes=i),this.isViewingPast()?this.saveDaySchedule():this.toggleActionBtns(!0,"updateNoteScore")}else console.log(`ERROR ERROR::updateNoteScore could not find event ${e}?!?`)}updateDetz(e){var i,o;let t=(o=(i=this.parentGoalById(e.parentGoal))==null?void 0:i.title)==null?void 0:o.trim();e.jeSuis&&e.jeSuis.length>0?e.details=`Of '${t}' :: << ${e.jeSuis.join(",")} >>`:e.details=`Of '${t}' :: ${B(e==null?void 0:e.time)} -> ${e==null?void 0:e.duration}min -- ${e!=null&&e.inDefaults?"Dft:":":"}${e!=null&&e.canMove?":Mv:":":"}${e!=null&&e.isAlternative?":Alt":":"}`}addMinsToEvt(e,t){const i=(O,y,v)=>{let g=this.findEvent(e),b=O.end;if(!g){console.log("addMinsToEvt::ERROR not found?!?",O,e,y,v);return}return g.duration=y,this.updateDetz(g),this._dailyScheduled.set(e,{...O,for:y,end:v}),this._endTimesSet.delete(b.time)||console.log("ERROR endTimesSet item does not exist?!?"+b.time,O,this._endTimesSet),this._endTimesSet.add(v.time),this.saveDaySchedule(),{overlaps:null,canContinue:!0}};let o=this.findSchedEvent(e);if(!o){console.log("ERROR addMinsToEvt EVT not found!!!",e);return}let s=o.end,n=R(s,{minute:parseInt(t)}),r=parseInt(t)+o.for;console.log(`addMinsToEvt::(${e}) add ${t} from ${o.for} to> ${r}`,s.time,n.time);let h=this.hasOverlappingEvent(e,o.start,n),p=h.length;if(p>0){console.log("addMinsToEvt::OVERLAPS of size "+p,JSON.parse(JSON.stringify(h)));let O={overlaps:this.massageSingleOverlapArr(h),canContinue:!1};if(p>1)return O;let y=this.findEvent(h[0].inConflict);if(!y)return console.log("addMinsToEvt::ERROR conflict evt not found?!?"+p,h[0].inConflict),O;let v=(y==null?void 0:y.inDefaults)||!(y!=null&&y.canMove);if(console.log("addMinsToEvt::OVERLAPS>>askUser","default? "+(y==null?void 0:y.inDefaults),"!canMove? "+!(y!=null&&y.canMove),v,h[0].targetStart.time),v)return O;{let g=this.findEvent(e);this.recurChangeTime(h[0].inConflict,{...g,duration:r},h[0].targetStart,!1)}}return i(o,r,n)}deleteEvtMood(e){this.usingMoods[e]?(delete this.usingMoods[e],console.log("deleteEvtMood::>"+e)):console.log("deleteEvtMood>>NO mood by "+e)}updateCurrentMoods(){for(let e in this.usingMoods)this.actualEvts.find(t=>t.id==e)||this.deleteEvtMood(e)}removeScheduledEvt(e,t=!1){let i=this.getAllEvts().length;if(!e){console.log("ERROR doRemove, NO evt to delete?!?",e);return}let o=0;for(o;o<i;o++)if(this.actualEvts[o].id==e.id){this.actualEvts.splice(o,1);let s=null;if(this._dailyScheduled.has(e.id)?(s=this._dailyScheduled.get(e.id),this._dailyScheduled.delete(e.id)):console.log("removeScheduledEvt ::> dailyScheduled has no such evt?@? ERROR",e),s){let n=this._startTimesSet.delete(s.start.time),r=this._endTimesSet.delete(s.end.time);(!n||!r)&&console.log(`removeScheduledEvt ::> ERROR? scheduleSets has no such evt?@? start:${n}...end:${r}`,s,e.id+" "+(e==null?void 0:e.title.trim())+" "+(e==null?void 0:e.details)),t&&delete this.usingMoods[e.id]}break}}addToBalance(e){let i=this.getCurrentBalance()-parseInt(e==null?void 0:e.duration);Ae(i)}removeFromBalance(e){let i=this.getCurrentBalance()+parseInt(e);Ae(i)}disableEvtScoreEdit(e,t){this.isDisabledScoreEdit[e]=!t,this.mobileEnableScore[e]=t}enableNoteScoreEdit(e,t,i){const o=F(new Date);let s=J(o,i),n=R(o,{minute:0});this.getTimeNumber(n),s>0?(this.isDisabledScoreEdit[e]=!0,this.mobileEnableScore[e]=!1):(this.hasStarted[e]=!1,this.mobile&&(this.showMobileDialog[e]=!1),this.mobileEnableScore[e]=!0,this.isDisabledScoreEdit[e]=!1),De(o,t,i,!0)?this.hasStarted[e]=!0:this.hasStarted[e]=!1}getTimeyNumber(e){return e!==null?it(e):!1}getTimeNumber(e){return e!==null?Se(e):!1}}function Pe(l){return l.button===0}const Tt={name:"altDayCalendar",components:{NavigationBar:K(()=>Y(()=>import("./NavigationBar.713de98f.js"),["assets/NavigationBar.713de98f.js","assets/index.f91fcb48.js","assets/index.ddf7c1e7.css"])),QCalendarDay:at,GoalyEnd:K(()=>Y(()=>import("./goalyEnd.f899315e.js"),["assets/goalyEnd.f899315e.js","assets/goalyEnd.f5ffa344.css","assets/utiFunc.495f7aee.js","assets/index.f91fcb48.js","assets/index.ddf7c1e7.css","assets/goalStorage.d9ff0887.js","assets/QSelect.73d7d030.js","assets/touch.70a9dd44.js","assets/QItem.302a6b1c.js"])),schedBtn:K(()=>Y(()=>import("./schedBtn.9106f64a.js"),["assets/schedBtn.9106f64a.js","assets/schedBtn.32a55c93.css","assets/index.f91fcb48.js","assets/index.ddf7c1e7.css"])),dropDwnBtn:K(()=>Y(()=>import("./dropDwnBtn.8dba82a3.js"),["assets/dropDwnBtn.8dba82a3.js","assets/dropDwnBtn.35a7a0b5.css","assets/QItem.302a6b1c.js","assets/index.f91fcb48.js","assets/index.ddf7c1e7.css","assets/QList.5031b8fa.js","assets/QSelect.73d7d030.js","assets/touch.70a9dd44.js","assets/goalStorage.d9ff0887.js","assets/utiFunc.495f7aee.js"])),schedDialog:K(()=>Y(()=>import("./schedDialog.3a6c2770.js"),["assets/schedDialog.3a6c2770.js","assets/schedDialog.f43cf2d3.css","assets/index.f91fcb48.js","assets/index.ddf7c1e7.css","assets/QSpace.def7dcd8.js"])),mobileNoteScore:K(()=>Y(()=>import("./onScoreEditDialog.bc3f275d.js"),["assets/onScoreEditDialog.bc3f275d.js","assets/onScoreEditDialog.b00fdc3d.css","assets/index.f91fcb48.js","assets/index.ddf7c1e7.css"]))},data(){return nt(),M(null),M(null),M(null),M(null),M(null),{splitterPage:M(35),splitterLegend:M(40),timeStartPos:M(0),showTree:M(!1),treeGoals:M([]),expanded:M([]),filter:M([]),filterRef:M(null),calendar:M(null),showEvtDialog:M(!1),currentDate:M(de()),scoreOptions:M([1,2,3,4,5,6,7,8]),anchorTimestamp:M(null),otherTimestamp:M(null),mouseDown:M(!1),mobile:M(!0),daSchedule:M(null)}},beforeMount(){this.mobile=dt(),this.daSchedule=new Et(this.currentDate,this.mobile),this.constructTree()},mounted(){this.adjustCurrentTime(),this.intervalId=setInterval(()=>{this.adjustCurrentTime()},6e4)},beforeUnmount(){clearInterval(this.intervalId)},computed:{chosenScoreLabel(){return this.daSchedule.chosenScoreLabel()},chosenPrioLabel(){return this.daSchedule.chosenPrioLabel()},style(){return{top:this.timeStartPos+"px"}},showSchedInstru(){return this.getDateEvents(this.currentDate).length<1},showRemInstru(){return this.getDateEvents(this.currentDate).length>0&&!this.isViewingPast()},defaultLabels(){let e=this.daSchedule.unscheduled().filter(t=>(t==null?void 0:t.inDefaults)&&(t==null?void 0:t.time)!="").length;return e>0?e+" Defaults":"Defaults"},showDefaultBtn(){return this.daSchedule.unscheduledDefaults().length>0&&!this.isViewingPast()},saveScheduleDisabled(){return this.daSchedule.saveBtnEnabled()},showTreeForm(){return this.showTree||this.constructTree(),this.showTree},filterString(){return this.filter.join()},currentBalance(){return this.daSchedule.getCurrentBalance()},canbeScheduled(){let l=this.daSchedule.unscheduled(),e=(t,i)=>{if(t.parentGoal>i.parentGoal)return 1;if(t.parentGoal==i.parentGoal)return 0;if(t.parentGoal<i.parentGoal)return-1};if(l.length==0){let t=this.daSchedule.getSubGoals();return t.sort(e),t}return l.sort(e),l},scheduleMoodsLabel(){let l="",e=this.daSchedule.getCurrentMoods();if(!Object.keys(e).length>0)return l;let t=new Set;for(let o in e)t.add(e[o].join());let i=0;for(let o of t)i<1?l=o:l=l+", "+o,i++;return Object.keys(e).length!=t.size&&console.log("scheduleMoodsLabel..prob change!",JSON.parse(JSON.stringify(e)),t,l),l},startEndTimes(){const l=[];return this.anchorDayTimeIdentifier!==!1&&this.otherDayTimeIdentifier!==!1&&(this.anchorDayTimeIdentifier<=this.otherDayTimeIdentifier?l.push(X(this.anchorTimestamp),X(this.otherTimestamp)):l.push(X(this.otherTimestamp),X(this.anchorTimestamp))),l},anchorDayTimeIdentifier(){return this.anchorTimestamp!==null?Se(this.anchorTimestamp):!1},otherDayTimeIdentifier(){return this.otherTimestamp!==null?Se(this.otherTimestamp):!1},eventsMap(){return this.daSchedule.currentSchedEventsMap()}},methods:{showEvtMobile(l){return this.daSchedule.showEvtNoteScoreMobile(l)},klikaj(l){console.log("klikaj...",this.currentDate,l)},adjustCurrentTime(){var o,s;const l=F(new Date);if(this.currentDate!==l.date){this.timeStartPos=-10,this.currentTime="";return}this.currentDate=l.date,this.currentTime=l.time,this.timeStartPos=(s=(o=this.$refs)==null?void 0:o.calendar)==null?void 0:s.timeStartPos(l.time,!1);let e=this.daSchedule.getCurrentSchedTimesSets(),t=e.endSet&&e.endSet.has(l.time),i=e.startSet&&e.startSet.has(l.time);(t||i)&&(this.daSchedule.updateMinEndNowBtn(this.currentTime,t,i),i&&this.doNotify("Event Starting :)","positive","bottom"))},hasDate(l){return this.currentDate?l.find(e=>e.date===this.currentDate):!1},getDateEvents(l){let e=(i,o)=>{let s=J(i.sortTime,o.sortTime);if(s>0)return-1;if(s==0)return 0;if(s<0)return 1};const t=this.eventsMap[l]||[];return t.length===1?t[0].side="full":t.length,t.sort(e)},constructTree(){this.treeGoals=this.daSchedule.fetchGoalsTree()},resetGoalEvts(){return this.daSchedule.getSubGoals()},allMainGPrio(){return this.daSchedule.getAllPrio()},resetFilter(){var l;this.filter=[],(l=this.filterRef)==null||l.focus()},myFilterMethod(l,e){if(l.isChildren&&(l==null?void 0:l.moods.length)>0){const t=this.filter.map(o=>o.toLowerCase());let i=l==null?void 0:l.moods.some(o=>t.indexOf(o.toLowerCase())>-1);return l.label&&i}},labelGoals(l){let e=0;if(l=="s"){for(const i in this.treeGoals)e+=this.treeGoals[i].children.length;return`Scheduled => ${this.daSchedule.getAllEvts().length} out of ${e} 
`}return`Balance: ${this.daSchedule.getCurrentBalance()||0} 
`},badgeClasses(l,e){return Ye(l,e)},styleDragLine(l,e=void 0,t=void 0){let i=e(l.time),o=t(l.duration),s=i+o;this.timeStartPos+o;const n={};return e&&t&&(n.top=s+"px",n.height=o+"px"),n["align-items"]="flex-start",n},badgeStyles(l,e,t=void 0,i=void 0){return Xe(l,e,t,i)},classyColor(l){return`row items-center ${l.isChildren?"text-":"text-white bg-"}${l.color} `},isViewingPast(){return this.daSchedule.isViewingPast()},onMoodAdd(){let l=[];const e=this.filter.map(t=>t.toLowerCase());if(this.treeGoals.filter(t=>{if(t.children.length>0)return t.children.filter(i=>{if((i==null?void 0:i.moods.length)>0&&(i==null?void 0:i.moods.some(o=>e.indexOf(o.toLowerCase())>-1))){let o=i==null?void 0:i.moods.filter(s=>{if(e.indexOf(s.toLowerCase())>-1)return s});return l.push({id:i.id,mood:o}),i}})}),l.length>0){l=l.filter(i=>!this.daSchedule.getAllEvts().find(o=>o.id==i.id));let t=l.length;if(t>0){let i=this.daSchedule.scheduleByMood(l);console.log("onMoodAdd>>>",e,i,l),i.canContinue?this.doNotify(`Added ${t} Evts by Mood...doSave eh`,"positive"):i.overlaps&&Object.keys(i.overlaps).length>0?this.handleOverlaps(i.overlaps,null,"byMood"):this.doNotify("Empty as no Moods :(","warning","bottom")}else this.doNotify(`Evts of Mood '${this.filterString}' already scheduled!`,"warning","top")}else this.doNotify("Nothing to add :(","warning","top")},onScheduleOneEach(){let l=t=>{let i=this.daSchedule.scheduleOneEach(t);i.canContinue?this.doNotify("Add by OneEach ...doSave eh","positive"):i.overlaps&&Object.keys(i.overlaps).length>0?this.handleOverlaps(i.overlaps,null,"oneEach"):this.doNotify("Empty? for OneEach :(","warning","bottom")},e=()=>{console.log("onScheduleOneEach..Aborting",this.daSchedule.getAllEvts()),this.reset()};if(this.daSchedule.getAllEvts().length>0){let t=[{label:"Add one Evt from Each parent Goals",value:"add"},{label:"Overwrite current with one random Evt from Each parent Goals",value:"overwrite"}];this.radioChoiceDialog("Warning!!",`Date: ${this.currentDate} already have scheduled Events...`,t,"",l,e)}else l("overwrite")},onReloadSaved(){let l=this.daSchedule.hasEventsForDate(),e=()=>{console.log("Aborting",this.currentDate,this.scheduledEvents,l)},t=()=>{console.log("onReloadSaved::Overwriting",l);let i=this.daSchedule.loadEvtsForDay(!1);i.canContinue||(i.overlaps&&Object.keys(i.overlaps).length>0?(console.log("onReloadSaved::OVERLAPPS",i.overlaps),this.handleOverlaps(i.overlaps,null,"view")):(this.doNotify(`Reloaded schedule for ${this.currentDate}`,"positive","bottom"),(this.isViewingPast()||this.currentDate!==de())&&this.adjustCurrentTime())),this.reset()};if(this.daSchedule.getAllEvts().length>0&&!this.isViewingPast()){let i=l?"Reload? saved schedule of: "+this.currentDate:"Overwrite current Evts?";this.confirmAction(i,"OK",t,e)}else t()},onClearDay(){let l=this.daSchedule.hasEventsForDate();if(this.isViewingPast()){this.doNotify("Editing past is no no!");return}this.daSchedule.resetSchedule();let e=l?"Cleared...Can still Reload saved":"Resetting...";this.doNotify(e,"warning","top"),this.reset(),this.daSchedule.toggleActionBtns(l,"view")},onLoadDefault(){let l=()=>{console.log("Aborting",this.currentDate)},e=t=>{let i=this.daSchedule.scheduleDefaults(t);i.canContinue?this.doNotify("Add of Defaults ...doSave eh","positive"):i.overlaps&&Object.keys(i.overlaps).length>0?this.handleOverlaps(i.overlaps,null,"byDefaults"):this.doNotify("Empty? as no Defaults:(","warning","bottom")};if(this.daSchedule.getAllEvts().length>0){let t=this.daSchedule.unscheduledDefaults();console.log("onLoadDefault::unscheduledDefaults",t==null?void 0:t.length);let i=[{label:`Add ${t==null?void 0:t.length} Default Evts to current day schedule`,value:"add"},{label:"Reset and only schedule Defaults",value:"overwrite"}];this.radioChoiceDialog("Warning!!",`Date: ${this.currentDate} already have scheduled Events...`,i,"",function(o){e(o)},l)}else e("overwrite")},onChoosenPrio(l){this.daSchedule.onChoosenPrio(l)},onChoosenScore(l){this.daSchedule.onChoosenScore(l)},doReloadWithPrio(){if(this.daSchedule.chosenPrio==null){this.doNotify("Ayo select a priority!");return}let l=()=>{console.log("doReloadWithPrio..cancelling"),this.reset()},e=i=>{let o=this.daSchedule.scheduleSamePrio(i);o.canContinue?this.doNotify(`${i} for Priority == ${this.daSchedule.chosenPrio} ...doSave eh`,"positive"):o.overlaps&&Object.keys(o.overlaps).length>0?this.handleOverlaps(o.overlaps,null,"byPrio"):this.doNotify(`Empty for Priority == ${this.daSchedule.chosenPrio} :(`,"warning","bottom")},t=this.daSchedule.chosenPrio;if(this.daSchedule.getAllEvts().length>0){let i=[{label:`Filter current Evts by priority == ${t}`,value:"filter"},{label:`Add to schedule Evts with priority == ${t}`,value:"add"},{label:`Overwrite current and schedule All of priority == ${t}`,value:"overwrite"}];this.radioChoiceDialog("","Schedule change...",i,"",e,l)}else e("overwrite");this.daSchedule.disablePrioBtn=!0},doReloadWithScore(){if(this.daSchedule.chosenScore==null){this.doNotify("Ayo select a score!");return}let l=()=>{console.log("doReloadWithScore..cancelling",this.daSchedule.getAllEvts()),this.reset()},e=i=>{let o=this.daSchedule.scheduleByScore(i);o.canContinue?this.doNotify(`${i} for Score <= ${this.daSchedule.chosenScore} ...doSave eh`,"positive"):o.overlaps&&Object.keys(o.overlaps).length>0?this.handleOverlaps(o.overlaps,null,"byScore"):this.doNotify(`Empty for Score <= ${this.daSchedule.chosenScore} :(`,"warning","bottom")},t=this.daSchedule.chosenScore;if(this.daSchedule.getAllEvts().length>0){let i=[{label:`Filter current Evts by Interval Score <= ${t}`,value:"filter"},{label:`Add to schedule Evts with Interval Score <= ${t}`,value:"add"},{label:`Overwrite current and schedule All of Interval Score <= ${t}`,value:"overwrite"}];this.radioChoiceDialog("","Schedule change...",i,"",e,l)}else e("overwrite");this.daSchedule.disableScoreBtn=!0},doSaveSchedule(){this.daSchedule.saveDaySchedule(),this.doNotify(`Schedule saved for ${this.currentDate}`,"positive","top")},doDroppy(l,e,t){if(e&&t){let i=this.daSchedule.tooClose(e,t.duration);if(i&&(console.log("doDroppy::tooClose to>>",i),i===!0)){this.doNotify("Dropping event TOO close to midnight!"),this.reset();return}let o=this.daSchedule.canDropEvent(e,t),s=this.daSchedule.getOriginalEvtTime(t.id);if(o.canContinue)if((t==null?void 0:t.inDefaults)||!(t!=null&&t.canMove)){let r=t!=null&&t.inDefaults?"Default at ":"Cannot Move from ",h=[`Evt "${t.title.trim()}" ${r} ${B(s)}.`,`
Also Change Evt to new time ${B(e.time)}?`,`
Cancel or Dismiss to undo!`,`
No selection to keep at ${B(t.time)}`].join(`
`);const p=this.daSchedule,O=this.doCleanup;this.confirmTimeChange("Changing Evt's time",h,"Change","Temp.Move",function(y){p.changeEvtTime(t,e,y),O()},function(){console.log(`doDroppy::onCancel..>doing nothing for ${t.id})'${t.title.trim()}'`),O()},function(){console.log(`doDroppy::onDismiss..keep as is>> ${t.id})'${t.title.trim()}'`),O()})}else this.daSchedule.changeEvtTime(t,e,!1),this.doCleanup();else this.movedIntoConflict(o.overlaps,null,l)}else{console.log("doDroppy null ERROR?",e,this.targetDrop,t,this.selectedItem);return}},canAutoSchedule(l,e){let t=l.title.trim().toLowerCase().includes(e.title.trim().toLowerCase()),i=e.title.trim().toLowerCase().includes(l.title.trim().toLowerCase()),o=this.daSchedule.parentGoalById(l.parentGoal),s=this.daSchedule.parentGoalById(e.parentGoal),n=l.title.trim().toLowerCase().includes(s.title.trim().toLowerCase()),r=e.title.trim().toLowerCase().includes(o.title.trim().toLowerCase());return(n||r)&&console.log("canAutoSchedule:: WOAH PARENT AUTO schedule?--TODO***",n,r,"Normal AUTO>>",t,i),t||i?{addIncSched:t,schdIncToAdd:i}:!1},movedIntoConflict(l,e,t,i=0){console.log("movedIntoConflict >>",JSON.parse(JSON.stringify(l)),"from:"+t,i);const o=(c,f)=>{if(c!=null&&c.parentGoal){let a=this.daSchedule.parentGoalById(c.parentGoal);return f?`Of '${a==null?void 0:a.title.trim()}' (${a==null?void 0:a.priority})`:`Of '${a==null?void 0:a.title.trim()}'`}return console.log("prioLabel..ERROR no PARENT found?",c),""},s=(c,f)=>{switch(f){case"score":return`${o(c,!1)} > "${c.title.trim()}" with Score:: ${c.score} = ${re(c.score)}`;case"prio":return`"${c.title.trim()}" ${o(c,!0)}`;default:return`"${c.title.trim()}" ${o(c,!0)} && Score:: ${c.score} for ${c.duration} mins`}},n=(c,f=!1)=>{this.doNotify(c,f?"warning":"positive","top")},r=c=>{this.daSchedule.deleteEvtMood(c)},h=c=>{let f=this.daSchedule.getCurrentMoods()[c.id];console.log(`movedIntoConflict::doRemove ${c.id}:${c.title}`),this.daSchedule.removeScheduledEvt(c,f)};let p=c=>{console.log("onDismissy::from "+t,c,E),this.scheduleMoodsLabel,this.doCleanup(),this.daSchedule.toggleActionBtns(!0,t)};const O=(c,f,a)=>{if(console.log(`movedIntoConflict::removeReplace >> replacing>> ${c.id}) '${c.title.trim()}' WITH ${f.id}) ${f.title.trim()}`,a,"from>"+t),e){if(console.log("movedIntoConflict::removeReplace...OVERRIDE from>>"+t),t=="onDrop"){h(c);return}console.log("movedIntoConflict::removeReplace....OVERRIDE updating..."+t),this.daSchedule.doUpdateSchedule(f,a.targetStart);return}if(h(c),t=="onDrop")console.log("movedIntoConflict::removeReplace for onDrop...just updating schedule",f.id,a.targetStart.time),this.daSchedule.doUpdateSchedule(f,a.targetStart);else{console.log("movedIntoConflict::removeReplace >>addGoalsToSchedule from "+t);let d=this.daSchedule.getStoredRawEvt(a.target);d&&(JSON.parse(JSON.stringify(f)),Object.assign(f,d,{time:a.targetStart.time}));let m=this.daSchedule.addGoalsToSchedule([{...f,time:a.targetStart.time}],!0),u=Object.keys(m).length;if(u>0)return console.log(`movedIntoConflict::removeReplace:: OVERLAPS again of size:${u} from >${t}>`+f.title,JSON.parse(JSON.stringify(m))),this.doNotify(`Extra Overlaps while removing to add '${f.title.trim()}' `,"warning","top"),this.movedIntoConflict(m,e,t+"nah")}},y=(c,f)=>{let a=this.daSchedule.findEvent(f.target);if(!a){console.log("movedIntoConflict::forceAddMins>>NOT FOUND?!?",f.target);return}let d=this.daSchedule.getStoredRawEvt(f.target);if(d){let m=a.duration+parseInt(i);JSON.parse(JSON.stringify(a)),Object.assign(a,d,{duration:m})}else console.log("movedIntoConflict::forceAddMins >>NEWLY ADDED?!? Error?",a.id,a,d),Object.assign(a,{duration:newDura});this.daSchedule.recurChangeTime(c.id,a,f.targetStart,!1),this.daSchedule.saveDaySchedule()},v=(c,f,a)=>{console.log(`movedIntoConflict::forceAdd:${t} >>${f.id})'${f.title}' at ${f.time} to ${a.targetStart.time}
          
Changing >>${c.id} from ${c.time}`);let d=this.daSchedule.getStoredRawEvt(a.target);d&&(JSON.parse(JSON.stringify(f)),Object.assign(f,d,{time:a.targetStart.time}));let m=this.daSchedule.recurChangeTime(c.id,f,a.targetStart,t!="onDrop");if(m){let u=Object.keys(m).length;if(u>0)return console.log(`movedIntoConflict::forceAdd:: OVERLAPS again of size:${u} from >${t}>`+f.title,JSON.parse(JSON.stringify(m))),this.doNotify(`Extra Overlaps while adding '${f.title.trim()}'`,"negative","top"),this.movedIntoConflict(m,e,t+"nah")}p("ForceAdd")};let g=(c,f,a,d,m)=>{E.push(f),f==a.id?(O(d,a,m),n(`by ${c}, ${t=="onDrop"?"Moving":"Adding"} '${a.title.trim()}'`,!0)):(console.log(`onOkChoice::by ${c},chose scheduled ${f} ...with override?`,e,t),n(`by ${c}, Keeping '${d.title.trim()}'`),t.indexOf("byMood")>-1&&r(a.id),t=="onDrop"&&h(a))},b=(c,f)=>{if(e){if(console.log("movedIntoConflict::cancelChoice::OVERRIDE...coolios!!from:"+t,c.title.trim()),t=="onDrop"){n("Umm...not moving then...."),this.daSchedule.toggleActionBtns(!1,"view");return}h(c),n(`Keeping '${f.title.trim()}'`);return}t.indexOf("byMood")>-1&&r(c.id),this.daSchedule.toggleActionBtns(!0,"view"),n(`Keeping scheduled '${f.title.trim()}'`)};const C=(c,f,a,d)=>{if(c=="opt3"){let m="Pick one event...",u=[{label:s(f,"def"),value:f.id,color:"secondary"},{label:s(a,"def"),value:a.id}];this.radioChoiceDialog("",m,u,"",function(N){g("Choice",N,f,a,d)},null,function(){p("resolveChoice::byEvent... dismissing")})}else if(c=="opt2"){let m="Pick event by Score",u=[{label:s(f,"score"),value:f.id,color:"secondary"},{label:s(a,"score"),value:a.id}];this.radioChoiceDialog("",m,u,"",function(N){g("Score",N,f,a,d)},null,function(){p("resolveChoice::byScore... dismissing")})}else if(c=="opt1"){let m="Pick event by Priority",u=[{label:s(f,"prio"),value:f.id,color:"secondary"},{label:s(a,"prio"),value:a.id}];this.radioChoiceDialog("",m,u,"",function(N){g("Priority",N,f,a,d)},null,function(){p("resolveChoice::byPriority... dismissing")})}else c=="opt0"?(console.log("resolveChoice::it's a drop?...keeping as is....",t),n("Umm...keeping as is then!"),this.doCleanup()):v(a,f,d)},S=(c,f,a,d,m)=>{d.direction!=="surrounding"&&!m&&(t.indexOf("nah")>-1?console.log("movedIntoConflict::manualSolve NOT adding Force as from "+t):c.push({label:`Force in '${f.title.trim()}'`,value:"opt4"}));let u=`${t=="onDrop"?"Moving":"Adding"} '${f.title.trim()}' at ${B(d.targetStart.time)} Overlaps with Scheduled '${a.title.trim()}' at ${B(a==null?void 0:a.time)}.
          
Cancel to keep '${a.title.trim()}' `,N=m?"Choose Auto Resolution":"Resolve Overlapping Events";this.radioChoiceDialog(N,u,c,"opt1",function(k){C(k,f,a,d)},function(){console.log("movedIntoConflict>>manualSolve::cancelChoice? Notif?>> from: "+t,E[0]),n("Umm...keeping as is then!")})};let E=[],T=Object.keys(l).length;for(let c in l){if(!l[c]||!l[c][0]){console.log("movedIntoConflict...ERROR::skipping unknown key",c);continue}if(c=="withID"){console.log("movedIntoConflict...skipping withID key",c,l.withID);continue}let f=l[c];if(f.length>1){if("withID"in l){l.withID.find(k=>k==c)?(console.log(`movedIntoConflict::WITHID>>using oneToManyConflict as ${f.length} of`+T,l.withID),this.oneToManyConflict(f,e,t)):(console.log(`movedIntoConflict::WITHID>>using manyToOneConflictas ${f.length} of`+T,l.withID),this.manyToOneConflict(f,e,t));continue}console.log(`movedIntoConflict::NORMAL>>using manyToOneConflictas ${f.length} of`+T,l.withID),this.manyToOneConflict(f,e,t);continue}let a=[{label:"Choose one event",value:"opt3"}];t=="onDrop"?a.unshift({label:"Leave as is!",value:"opt0"},{label:"Choose by Priority",value:"opt1",color:"secondary"},{label:"Choose by Score",value:"opt2"}):a.unshift({label:"Choose by Priority",value:"opt1",color:"secondary"},{label:"Choose by Score",value:"opt2"});const d=f.pop();let m=this.daSchedule.getSubGoalByID(d.target),u=this.daSchedule.findEvent(d.inConflict);if(!u||!m){console.log("movedIntoConflict...ERROR ERROR no evts found!!!",d);return}let N=this.canAutoSchedule(m,u);if(t=="onAddMins"){let k=u!=null&&u.inDefaults?"In Defaults":u!=null&&u.canMove?"":"Cannot move",L=`Adding ${i} mins to "${m.title.trim()}" Overlaps with Scheduled "${u.title.trim()}" at ${B(u.time)} as ${k}.
            
Force?
            
Cancel/Dismiss to Leave as is.`;this.confirmAction(L,"Add",function(){y(u,d)},function(){n("Keeping as Is...")},function(){console.log("movedIntoConflict >>onAddMins>> onDismiss")})}else if(N){console.log("movedIntoConflict:: can AUTO schedule",N.addIncSched,N.schdIncToAdd,"direction == surrounding? >>",d.direction=="surrounding"),this.scrollToTime(d==null?void 0:d.targetStart,"slow");let k=`"${m.title.trim()}" at ${B(m.time)} related to Scheduled "${u.title.trim()}" at ${B(u.time)}.
            
Auto resolve Overlap?
            
Cancel/Dismiss to manually choose.`;this.confirmAction(k,"Auto",function(){var L;N.addIncSched?(console.log("Auto resolve::removeReplace..with TIMES>>",m.time,u.time,(L=d==null?void 0:d.targetStart)==null?void 0:L.time),O(u,m,d),n(`Removing Scheduled to Add '${m.title.trim()}'`,!0),E.push(m.id)):(console.log("Auto resolve::cancelChoice >> from: ",t),b(m,u),E.push(u.id))},function(){S(a,m,u,d,!0)},function(){p("Auto-dismiss")})}else S(a,m,u,d,!1)}},handleOverlaps(l,e=null,t=""){console.log("handleOverlaps >>",JSON.parse(JSON.stringify(l)),"from:"+t);for(let i in l){if(i=="withID"){console.log("handleOverlaps...skipping key",i,l.withID);continue}let o=l[i];if("withID"in l){l.withID.find(s=>s==i)?(console.log("handleOverlaps::WITHID>>oneToManyConflict="+o.length,i,l.withID),this.oneToManyConflict(o,e,t)):(console.log("handleOverlaps::WITHID>>manyToOneConflict="+o.length,i,l.withID),this.manyToOneConflict(o,e,t));continue}else this.manyToOneConflict(o,e,t)}},oneToManyConflict(l,e=null,t=""){var f;let i=null,o=[],s=[],n=new Map,r=null,h=new Map,p=[{label:"Pick one event",value:"opt3"}];const O=a=>this.findhighestPrio(a);let y=a=>this.getSmallestScoreInterval(a),v=(a,d)=>{let m=[];if(d.forEach((u,N,k)=>{if(a.find(L=>L.id==u.id))if(u.id==i.id)if(console.log("oneToManyConflict::removeConflicts::toAdd kept!>"+r.time,u==null?void 0:u.title.trim(),"at orig: "+(u==null?void 0:u.time),t),t=="onDrop")console.log("oneToManyConflict::removeConflicts...NOTHING to do? as from"+t);else{let L=n.has(u.id)?n.get(u.id):"",W=this.daSchedule.getStoredRawEvt(u.id);W&&(JSON.parse(JSON.stringify(u)),Object.assign(u,W,{time:r.time}));let ee=this.daSchedule.addGoalsToSchedule([{...u,time:r.time}],!1);if(Object.keys(ee).length>0)console.log("oneToManyConflict::removeConflicts::OVERLAP on add",ee,u,r.time),m.push(ee);else{console.log("oneToManyConflict::removeConflicts::Great NO overlap",u==null?void 0:u.title.trim());let $e=`${L} Adding '${u==null?void 0:u.title.trim()}' at ${B(r.time)}`;this.doNotify($e,"positive","top")}}else{console.log("oneToManyConflict::removeConflicts....Keeping scheduled Evt!!",r,u.id);let L=`${n.has(u.id)?n.get(u.id):""} Keeping scheduled '${u==null?void 0:u.title.trim()}'`;this.doNotify(L,"positive","top")}else if(u.id!=i.id){console.log("oneToManyConflict::removing scheduled",u.id,u.title,u.time);let L=this.daSchedule.getCurrentMoods()[u.id];this.daSchedule.removeScheduledEvt(u,L),this.doNotify(`Removed scheduled '${u==null?void 0:u.title.trim()}'`,"warning","bottom")}else console.log("removeConflicts::NOT adding original target",i.id)}),this.daSchedule.toggleActionBtns(!0,t),m.length>0)return console.log(`${t}> oneToManyConflict::removeConflict:: OVERLAPS again=${m.length}`,m),this.doNotify("More Overlaps to fix!= "+m.length,"negative","top"),this.handleOverlaps(m[0],e,t+"nah")};const g=(a,d)=>{console.log(`oneToManyConflict::forceAdd:${a.id} ${a.title} at ${d.time} from ${a.time} >>`+t,"conflict="+o.length);let m=this.daSchedule.getStoredRawEvt(a.id);m&&(JSON.parse(JSON.stringify(a)),Object.assign(a,m,{time:d.time}));let u=o.find(k=>k.id!=a.id),N=this.daSchedule.recurChangeTime(u.id,a,d,!0);if(N&&Object.keys(N).length>0)return console.log("oneToManyConflict::forceAdd:: OVERLAPS "+t,JSON.parse(JSON.stringify(N))),this.doNotify(`Extra Overlaps while force adding '${a==null?void 0:a.title.trim()}'`,"negative","top"),this.handleOverlaps(N,e,t+"nah");this.scheduleMoodsLabel,this.daSchedule.toggleActionBtns(!0,t)};let b=a=>{this.radioChoiceDialog("","Choose one Event to keep",a.map(this.getEvtLabel),"",function(d){let m=a.find(u=>u.id==d);if(m)s.push(m),n.set(m.id,"By choice,");else{console.log("chooseEvt::ERROR NOT FOUND!!",d);return}return console.log(`chooseEvt::onOk >>${d} >> ${m==null?void 0:m.title.trim()}`),m},null,function(){s.length>0&&(console.log("chooseEvt::onDismiss >>set removeConflicts out of total="+a.length,JSON.parse(JSON.stringify(s))),setTimeout(()=>{v(s,a)},0))})};t=="byScore"?p.unshift({label:"Resolve by Highest Priority",value:"opt1",color:"secondary"}):t=="byPrio"?p.unshift({label:"Resolve by Shortest Score Interval",value:"opt2"}):p.unshift({label:"Resolve by Highest Priority",value:"opt1",color:"secondary"},{label:"Resolve by Shortest Score Interval",value:"opt2"});let C=!1,S=[];for(;l.length;){const a=l.pop();console.log("oneToManyConflict::Handling:> "+t,JSON.parse(JSON.stringify(a)));let d=this.daSchedule.findEvent(a.inConflict);if(!d){console.log("oneToManyConflict...ERROR ERROR no evts found!!!",a);return}if(o.push(d),S.push(`'${d==null?void 0:d.title.trim()}'`),r?r.time!=((f=a==null?void 0:a.targetStart)==null?void 0:f.time)&&console.log("oneToManyConflict...ERROR Not same targetStart?!?",r,a==null?void 0:a.targetStart,a.direction):r=a==null?void 0:a.targetStart,h.set(a.target,a==null?void 0:a.targetStart),i)i.id!=a.target?console.log("oneToManyConflict::ERROR?...Not same target ID?!?",i,a.target):console.log("oneToManyConflict::ToAdd Good!",i.id);else{let m=this.daSchedule.getSubGoalByID(a.target);if(!m){console.log("oneToManyConflict...ERROR ERROR local evt not found!!!",a);return}i=m}a.direction=="surrounding"?C=!0:C=C}let E=S.join(" and "),T=S.length<2?this.canAutoSchedule(i,o[0]):!1;T&&(console.log("oneToManyConflict::CAN AUTO!!",T),p.unshift({label:"Auto resolve Overlap?",value:"opt0"})),C||t.indexOf("nah")>-1?console.log("oneToManyConflict::NOT adding Force as from "+t,C,o,i):p.push({label:`Force in > '${i.title.trim()}'`,value:"opt4"});let c=`'${i==null?void 0:i.title.trim()}' conflicts with scheduled ${E} 
`;o.unshift(i),r?this.scrollToTime(r,"slow"):console.log("oneToManyConflict::cant scrolly as null",r),this.radioChoiceDialog("Overlaps!!",c,p,"",function(a){var d;if(a=="opt3")b(o);else if(a=="opt2"){let m=y(o);console.log("oneToManyConflict::ByScore",m.id,m==null?void 0:m.title.trim(),m.score),s.push(m),n.set(m.id,`By shortest score interval (${m.score}),`)}else if(a=="opt1"){let m=O(o);console.log("oneToManyConflict::ByPriority",m.e.id,(d=m==null?void 0:m.e)==null?void 0:d.title.trim()),s.push(m.e),n.set(m.e.id,`By highest priority (${m.prio}),`)}else a=="opt0"?(console.log("oneToManyConflict...YEEE--auto:solve",T,o[1],o[0]),T.addIncSched?(s.push(i),n.set(i.id,"By Auto-Solve,")):(s.push(o[1]),n.set(o[1].id,"By Auto-Solve,"))):g(i,r)},null,function(){s.length>0&&(console.log("oneToManyConflict::onDismiss Main >> removeConflicts from total="+o.length,JSON.parse(JSON.stringify(s))),setTimeout(()=>{v(s,o)},0))})},manyToOneConflict(l,e=null,t=""){let i=[],o=null,s=[],n=new Map,r=new Map,h=[{label:"Pick one event",value:"opt3"}];const p=c=>this.findhighestPrio(c);let O=c=>this.getSmallestScoreInterval(c),y=(c,f)=>{console.log(`manyToOneConflict::removeConflicts with toKeep=${c.length} out of total:${f.length}`,JSON.parse(JSON.stringify(f)));let a=[];if(f.forEach((d,m,u)=>{if(c.find(N=>N.id==d.id)){let N=r.has(d.id)?r.get(d.id):"",k=n.has(d.id)?n.get(d.id):null;if(k?this.scrollToTime(k,"slow"):console.log("removeConflicts::cant scrolly as null",k),d.id!=o.id){let L=this.daSchedule.getStoredRawEvt(d.id);L&&(JSON.parse(JSON.stringify(d)),Object.assign(d,L,{time:k.time}));let W=this.daSchedule.addGoalsToSchedule([{...d,time:k.time}],!0);if(W&&Object.keys(W).length>0)a.push(W),this.doNotify(`Extra Overlaps while adding '${d==null?void 0:d.title.trim()}'`,"negative","top");else{let ee=`${N} Adding '${d==null?void 0:d.title.trim()}' at ${B(k.time)}`;this.doNotify(ee,"warning","top")}}else this.doNotify(`${N} Keeping scheduled '${d==null?void 0:d.title.trim()}' `,"positive","top")}else if(d.id==o.id){console.log("manyToOneConflict::removeConflicts...removing scheduled!!",d.id,d.title);let N=this.daSchedule.getCurrentMoods()[d.id];this.daSchedule.removeScheduledEvt(d,N)}}),a.length>0)return console.log(`manyToOneConflict::removeConflicts::extra OVERLAPS from ${t} > keeping ${c.length} overlaps =${a.length}`,a),this.doNotify("More Overlaps to fix= "+a.length,"negative","top"),this.handleOverlaps(a[0],e,t+"nah");this.daSchedule.toggleActionBtns(!0,t)};const v=c=>{let f=[];if(console.log(`manyToOneConflict::forceAdd total:${c.length}`),c.forEach(a=>{if(o.id!=a.id){let d=n.has(a.id)?n.get(a.id):null;console.log(`manyToOneConflict::forceAdd...NEW:${a.id} '${a.title.trim()}' dura= ${a.duration} origAt: ${a.time} to>>`,d.time,"from>>"+t),this.scrollToTime(d,"slow");let m=this.daSchedule.getStoredRawEvt(a.id);m&&(JSON.parse(JSON.stringify(a)),Object.assign(a,m,{time:d.time}));let u=this.daSchedule.recurChangeTime(o.id,a,d,!0);if(u&&Object.keys(u).length>0)console.log("manyToOneConflict::forceAdd >>OVERLAP on add",u,a,d.time),f.push(u);else{console.log("manyToOneConflict::forceAdd::Great NO overlap",a==null?void 0:a.title.trim());let N=`Force Added '${a==null?void 0:a.title.trim()}' at ${B(d.time)}`;this.doNotify(N,"positive","top")}}}),this.scheduleMoodsLabel,this.daSchedule.toggleActionBtns(!0,t),f.length>0)return console.log(`manyToOneConflict::forceAdd:: OVERLAPS again=${f.length} `+t,f),this.doNotify("More Overlaps to fix = "+f.length,"negative","top"),this.handleOverlaps(f[0],e,t+"nah")};let g=c=>{this.radioChoiceDialog("","Choose one Event to schedule",c.map(f=>this.getEvtLabel(f,!1)),"",function(f){let a=c.find(d=>d.id==f);if(a)s.push(a),r.set(a.id,"By pick,");else{console.log("chooseEvt::ERROR NOT FOUND!!",f);return}return a},null,function(){s.length>0&&(console.log("chooseEvt::onDismiss >> LAST?",JSON.parse(JSON.stringify(s))),setTimeout(()=>{y(s,c)},0))})};t=="byScore"?h.unshift({label:"Resolve by Highest Priority",value:"opt1",color:"secondary"}):t=="byPrio"?h.unshift({label:"Resolve by Shortest Score Interval",value:"opt2"}):h.unshift({label:"Resolve by Highest Priority",value:"opt1",color:"secondary"},{label:"Resolve by Shortest Score Interval",value:"opt2"});let b=!1,C=[];for(;l.length;){const c=l.pop();console.log("manyToOneConflict::handling:>"+t,JSON.parse(JSON.stringify(c)));let f=this.daSchedule.findEvent(c.inConflict);if(!f){console.log("manyToOneConflict...ERROR ERROR no evts found!!!",c);return}o?o.id!=f.id&&console.log("manyToOneConflict::ERROR::ERROR Not same inConflict",o.id,f.id):o=f;let a=this.daSchedule.getSubGoalByID(c.target);if(!a){console.log("manyToOneConflict...ERROR ERROR local evt not found!!!",c);return}C.push(`'${a==null?void 0:a.title.trim()}'`),i.push(a),n.set(c.target,c==null?void 0:c.targetStart),c.direction=="surrounding"?b=!0:b=b}let S=C.join(" and "),E=C.length<2?this.canAutoSchedule(i[0],o):!1;E&&(console.log("manyToOneConflict::CAN AUTO!!",E),h.unshift({label:"Auto resolve Overlap?",value:"opt0"})),b||t.indexOf("nah")>-1||h.push({label:`Force in > ${S}`,value:"opt4"});let T=`${S} conflicts with scheduled '${o==null?void 0:o.title.trim()}' at ${B(o==null?void 0:o.time)}.
`;i.unshift(o),this.radioChoiceDialog("Overlaps!",T,h,"",function(c){if(c=="opt3")g(i);else if(c=="opt2"){let f=O(i);s.push(f),r.set(f.id,`By Shortest score interval (${f.score}),`)}else if(c=="opt1"){let f=p(i);s.push(f.e),r.set(f.e.id,`By highest priority (${f.prio}),`)}else c=="opt0"?(console.log("manyToOneConflict...YEEE--auto-solve",E,i[1],i[0]),E.addIncSched?(s.push(i[1]),r.set(i[1].id,"By Auto-Solve,")):(s.push(o),r.set(o.id,"By Auto-Solve,"))):v(i)},null,function(){s.length>0&&(console.log("manyToOneConflict::onDismiss Main >> LAST?",s),setTimeout(()=>{y(s,i)},0))})},onPickEvent(l,e,t){if(this.closingDialog(),!l){console.log("onPickEvent...ERROR nothing!",l,e,t),this.doNotify("No Goal selected..."),this.reset();return}let i=this.daSchedule.isViewingPast()?!0:e,o=this.daSchedule.tooClose(this.targetDrop.timestamp,l.duration);if(o){if(console.log("onPickEvent::tooClose check FAIL!",o),o===!0){this.doNotify("Picking event TOO close to midnight!"),this.reset();return}if(i)this.doNotify(`'${l.title.trim()}' TOO close Buuut..FORCING!`,"warning","top");else{this.doNotify(`'${l.title.trim()}' Not added as TOO close to a scheduled Evt`),this.reset();return}}let s=this.daSchedule.onPickEvent(l,this.targetDrop.timestamp,i,t);s.canContinue?t&&(console.log("onPickEvent::NO OVERLAPS"),this.doNotify("What is Owed PAID! gg!","positive","top")):(console.log("onPickEvent::OVERLAPS!"+t,JSON.parse(JSON.stringify(s))),s.overlaps&&Object.keys(s.overlaps).length>0?(t&&this.doNotify("Overlaps!-Balance Not Used!","warning","top"),this.handleOverlaps(s.overlaps,null,"onPickEvt")):this.doNotify("Error? onPickEvt :(","negative","bottom"))},onAddHocEvent(l,e,t,i,o){if(this.possibleRange||(this.possibleRange=this.startEndTimes),l.trim()==""){this.doNotify("Empty Goal title..."),this.closingDialog(),this.reset();return}let s=pe(this.possibleRange[0]),n=i>15?R(s,{minute:parseInt(i)}):R(pe(this.possibleRange[1]),{minute:15}),r=Math.floor(J(s,n)/1e3/60),h=this.daSchedule.tooClose(s,r);if(h){if(console.log("onAddHocEvent::tooClose check FAIL!!",h),this.closingDialog(),h===!0){this.doNotify(`'${l}' Not added as over midnight!`);return}this.doNotify(`'${l}' too close to a scheduled Evt--Forcing!!`,"warning")}this.closingDialog();let p=this.daSchedule.saveNewGoal(s,l,e,t,r);if(p){let O=this.daSchedule.onAdHocEvent(p,s,o);if(O.canContinue)this.constructTree(),this.reset(),this.doNotify("New adHoc Evt added!","positive","top"),this.mobile&&this.adjustCurrentTime();else if(console.log("onAdHocEvent::OVERLAPS?",JSON.parse(JSON.stringify(O))),O.overlaps==null){this.doNotify("Error Adding this event :(","negative"),console.log("onAdHocEvent::ERROR not found?");return}else o&&this.doNotify("Overlaps!-Balance Not Used!","warning","top"),this.handleOverlaps(O.overlaps,null,"adHocEvt")}else console.log("BOO ERROR no subID:(",p),this.doNotify("Error creating and adding this event :(","negative")},onEndNow(l){const e=()=>{console.log("onEndNow::removing and saving!",l);let o=this.daSchedule.findEvent(l);this.daSchedule.removeScheduledEvt(o),this.daSchedule.saveDaySchedule()},t=o=>{console.log("onEndNow::reducing!!!",l,Number.isInteger(o)),this.daSchedule.reduceEvtDuration(l,o)};let i=this.daSchedule.canEndNow(l);i?this.confirmAction(`Less than 10mins remove?
 Cancel to just EndNow`,"OK",e,function(){t(i)}):console.log("onEndNow...Can NOT end?",l,i,Number.isInteger(i))},onSaveScore(l,e,t=""){let i=re(l);if(i<-1){i==-89?(console.log("onSaveScore parsing error",i,l),this.doNotify("Score Parsing Error... YOU FOO! ")):this.doNotify("Score Error: higher# on lower#");return}this.daSchedule.updateNoteScore(e,l,t)},onAddMins(l,e){let t=this.daSchedule.addMinsToEvt(l,e);if(!t.canContinue){if(t.overlaps&&Object.keys(t.overlaps).length>0)return console.log("onAddMins::OVERLAPS!!"+e,t),this.doNotify("Bumped into some Evts","warning","top"),this.movedIntoConflict(t.overlaps,!0,"onAddMins",e);this.doNotify("Add ERROR:(","negative","bottom")}},removeEvtInSchedule(l){let e=!1,t=()=>{if(this.daSchedule.removeScheduledEvt(l,e),e){console.log("removeEvtInSchedule..autoSave for: "+l.title),this.daSchedule.saveDaySchedule();return}this.daSchedule.toggleActionBtns(!0,"view")};if(this.daSchedule.isViewingPast()){if(l.duration<30){this.doNotify("Removing from the past... Check BALANCE!"),this.daSchedule.addToBalance(l),e=!0,t();return}this.chooseAlternatives(l);return}if(!this.daSchedule.isViewingToday()&&!this.mobile){e=this.daSchedule.getCurrentMoods()[l.id],t(),console.log("Removed future evt");return}let i=`Remove "${l.title}" from schedule?`,o=this.daSchedule.getCurrentMoods()[l.id];o&&(console.log("removeEvtInSchedule with MOOD?!?",o),e=!0,i=i+" With Mood "+o),this.confirmAction(i,"Remove",t,function(){console.log("Cancelled remove")})},getEvtLabel(l,e=null){let t=this.daSchedule.parentGoalById(l.parentGoal),i=`Of '${t==null?void 0:t.title.trim()}' "${l.title.trim()}" (${l.score}) `;return i+=e?`@ ${B(l==null?void 0:l.time)} ++ ${l==null?void 0:l.duration} mins`:`for ${l==null?void 0:l.duration} mins`,{label:i,value:l.id}},getSmallestScoreInterval(l){let e=9,t=null;for(let i of l){let o=re(i.score);o>-1&&o<=e&&(e=o,t=i)}if(t)return t;console.log("ERROR ERROR getSmallestScoreInterval::No current set?",e,t,l)},findhighestPrio(l){let e=0,t=null;for(let i of l)if(i.parentGoal){let o=this.daSchedule.parentGoalById(i.parentGoal);o?o.priority>e&&(e=o.priority,t=i):console.log("findhighestPrio::ERROR no PARENT found?",i)}else console.log("findhighestPrio::ERROR EVT not found?",i);return{e:t,prio:e}},chooseAlternatives(l){let e=(y,v)=>{if(y.parentGoal>v.parentGoal)return 1;if(y.parentGoal==v.parentGoal)return 0;if(y.parentGoal<v.parentGoal)return-1},t=this.daSchedule.getAltEvts().sort(e),i=F(new Date),o=l.time,s=i.date,n=l.title;const r=y=>y.filter(v=>!this.daSchedule.getAllEvts().find(g=>g.id==v.id)),h=y=>{let v=R(V(s),{day:0}),g=R(V(v.date),{day:1}),b=this.daSchedule.getEventsForDate(v.date),C={},S=null;b?C=b:console.log("chooseAlternatives::addInFutur EMPTY for >>...",v.date),y.forEach(E=>{if(S=this.daSchedule.getSubGoalByID(E),C[E]){console.log("addInFutur...ALREADY PRESENT",E,v.date,S==null?void 0:S.title.trim()),this.doNotify(`Alternative '${S==null?void 0:S.title.trim()}' already present on ${v.date}. Moving it to next day`,"warning");let T=this.daSchedule.getEventsForDate(g.date);if(T)if(!T[E])T[E]={duration:S==null?void 0:S.duration,time:o,notes:`Alt replace for '${n}'`};else{console.log("addInFutur...STILL PRESENT in next day:"+g.date,S.title.trim()),this.doNotify(`Booo! Alt '${S==null?void 0:S.title.trim()}' also present on ${g.date} :(( ...Check BALANCE!`),this.daSchedule.addToBalance(S);return}else T={},T[E]={duration:S.duration,time:o,notes:`Alt replace for '${n}'`};this.daSchedule.updateDaySchedule(g.date,T),this.doNotify(`Saving ${S.title} in ${g.date}`,"positive","bottom")}else C[E]={duration:S.duration,time:o,notes:`Alt replace for '${n}'`}}),this.daSchedule.updateDaySchedule(v.date,C)},p=y=>{this.daSchedule.removeScheduledEvt(l);let v=t.find(C=>C.id==y);console.log("remReplace...Add at:",o,v.title,"usually at:"+v.time);let g=this.daSchedule.addGoalsToSchedule([{...v,time:o,notes:`Alt replace for '${n}'`}],!0),b=Object.keys(g).length;if(b>0)return console.log(`chooseAlternatives::removeReplace:: OVERLAPS again from ${v.length} overlaps =${b}`,v,g),this.doNotify(`Extra Overlaps while adding ${v[0].title.trim()}`,"warning","top"),this.handleOverlaps(g,null,"alts");this.daSchedule.saveDaySchedule(),this.doNotify(`Added Alt replacement '${v==null?void 0:v.title}' at ${o}`,"positive","bottom")},O=y=>{this.doNotify(y)};if(t=r(t),t.length==0){O("Removing not allowed! Alternatives already present!");return}this.checkBoxDialog("Gotta pick alternative!","Select the first Evt to replace Removed + an Extra evt for next day (today)!",t.map(y=>this.getEvtLabel(y,!1)),t[0].id,function(y){console.log("chooseAlternatives::opt",y),p(y.shift()),y.length>0?h(y):(console.log("chooseAlternatives::onOk...nothing to add?!?",t.length,y.length,t.length-y.length),O("No Alternative scheduled later :("))},function(){console.log("chooseAlternatives::onCancel")})},reset(){this.selectedItem=null,this.targetDrop=null,this.touchedItem=null,this.daSchedule.resetChosen(),this.possibleRange=null},closingDialog(){this.showEvtDialog=!1},onPrev(){let l=()=>{this.$refs.calendar.prev()},e=()=>{setTimeout(l,1e3),this.doSaveSchedule()};this.saveScheduleDisabled?l():this.confirmAction(`Save day: ${this.currentDate} changes?`,"Save",e,l)},onToday(){let l=()=>{this.$refs.calendar.moveToToday()},e=()=>{setTimeout(l,1e3),this.doSaveSchedule()};this.saveScheduleDisabled?l():this.confirmAction(`Save day: ${this.currentDate} changes?`,"Save",e,l)},onNext(){let l=()=>{this.$refs.calendar.next()},e=()=>{setTimeout(l,1e3),this.doSaveSchedule()};this.saveScheduleDisabled?l():this.confirmAction(`Save day: ${this.currentDate} changes?`,"Save",e,l)},onChange(){const l=t=>{setTimeout(()=>{let i=F(new Date);this.scrollToTime(i,t?"slow":"fast")},t?0:1e3)};let e=this.daSchedule.onChangeViewDate(this.currentDate);e.canContinue?this.doNotify("Empty for currentDay :(","warning","bottom"):e.overlaps&&Object.keys(e.overlaps).length>0?(console.log("onChangeViewDate::overlaps=="+Object.keys(e.overlaps).length),this.handleOverlaps(e.overlaps,null,"view")):(this.doNotify(`Loaded schedule for ${this.currentDate}`,"positive","bottom"),this.adjustCurrentTime()),l(e.canContinue)},onDragStart(l,e){if(this.daSchedule.isViewingPast()){this.doNotify("Editing past is no no!"),l.preventDefault();return}this.selectedItem=e},onDragEnter(l,e,t){if(e==="goal-item")l.preventDefault();else{if(this.targetDrop&&this.targetDrop.timestamp.time==t.timestamp.time)console.log("onDragEnter...calendar,SAME",this.targetDrop.timestamp.time);else{let i=l.target;i.style.background=this.selectedItem.bgcolor.includes("-")?"grey":this.selectedItem.bgcolor,this.lastTarget=i}this.targetDrop=t,l.preventDefault()}return!0},onDragOver(l,e,t){return l.preventDefault(),!0},onDragLeave(l,e,t){let i=l.target;return i.style.background="",!1},onDragEnd(l){},doCleanup(){this.lastTarget&&(this.lastTarget.style.background="",this.lastTarget=null)},onDrop(l,e,t){let i=this.daSchedule.findEvent(this.selectedItem.id);if(!i){console.log("onDrop ERROR",i,this.selectedItem);return}let o=null;if(e==="interval")o=t.timestamp;else if(e==="goal-item"&&this.targetDrop)o=this.targetDrop.timestamp;else{console.log("Cannot drop here YO!!",l,e,t,this.targetDrop);return}if(!o){console.log("ERROR...no timestamp YO!!",l,e,t,this.targetDrop);return}this.doDroppy("onDrop",o,this.selectedItem)},onClickTime(l){this.showEvtDialog=!0,this.targetDrop=l.scope},onClickDate(l){console.log("onClickDate",l)},onClickInterval(l){console.log("onClickInterval",l)},onClickHeadIntervals(l){console.log("onClickHeadIntervals",l)},onClickHeadDay(l){console.log("onClickHeadDay",l)},onMouseDownTime({scope:l,event:e}){if(Pe(e)){if(this.mobile===!0&&this.anchorTimestamp!==null&&this.otherTimestamp!==null&&X(this.anchorTimestamp)===X(this.otherTimestamp)){this.otherTimestamp=l.timestamp,this.mouseDown=!1;return}this.mouseDown=!0,this.anchorTimestamp=l.timestamp,this.otherTimestamp=l.timestamp}},onMouseUpTime({scope:l,event:e}){if(this.mobile!==!0&&Pe(e)&&(this.otherTimestamp=l.timestamp,this.mouseDown=!1),!this.mousedown){let t=this.startEndTimes;if(t[1]==t[0])return;this.possibleRange=t,console.log("onMouseUpTime range change",this.possibleRange)}},onMouseMoveTime({scope:l,event:e}){this.mobile!==!0&&this.mouseDown===!0&&(this.otherTimestamp=l.timestamp)},onDblClickEvent(l,e){if(this.isViewingPast()){if(e.duration<30){console.log("onDblClickEvent..baah too smoll smoll",e.title,e.duration),this.doNotify("umm Removing from the past..Soo Check BALANCE!"),this.daSchedule.addToBalance(e),this.daSchedule.removeScheduledEvt(e);return}this.chooseAlternatives(e),l.preventDefault();return}this.removeEvtInSchedule(e),l.preventDefault()},onTouchStart(l,e){if(l.type=="touchstart"){this.selectedItem=e;let t=document.elementFromPoint(l.changedTouches[0].clientX,l.changedTouches[0].clientY);if(t.parentNode.classList.contains("my-event"))console.log("onTouchStart >>my-event-drag","isDisabledScoreEdit>> "+this.daSchedule.isDisabledScoreEdit[e.id],"showMobileDialog>> "+this.daSchedule.showMobileDialog[e.id]),t.parentNode.classList.add("my-event-drag"),this.touchedItem=t;else{let i=t.closest(".my-event");if(t=t.parentNode,t.parentNode.classList.contains("my-event"))console.log("onTouchStart >>PHEW..FOUND","isDisabledScoreEdit>> "+this.daSchedule.isDisabledScoreEdit[e.id],i),t.parentNode.classList.add("my-event-drag"),this.touchedItem=t;else{this.touchedItem=!1;return}}return l.preventDefault(),!0}console.log("onTouchStart::ERROR...UNKNOWN",l)},onTouchEvt(l,e){const t=o=>{let s=o.split(" "),n=s[s.length-2],r=R(V(this.currentDate),{minute:H(n)});return s[s.length-1]=="PM"?r.hour==12?r:R(V(this.currentDate),{hour:12,minute:H(n)}):r.hour==12?R(V(this.currentDate),{hour:-12,minute:H(n)}):r};let i=o=>{let s=o.closest(".my-event");s.classList.contains("my-event-drag")&&s.classList.toggle("my-event-drag")};if(this.selectedItem||(console.log("onTouchEvt NULL Item >>ERROR?!? "+l.type,this.selectedItem,this.touchedItem),e=this.selectedItem),this.isViewingPast()){this.doNotify("Editing past is no no!"),i(this.touchedItem),l.preventDefault(),l.stopPropagation();return}if(l.type=="touchmove"){let o=document.elementFromPoint(l.changedTouches[0].clientX,l.changedTouches[0].clientY);if(o.ariaLabel){let s=t(o.ariaLabel);if(this.targetDrop){let n=J(this.targetDrop,s);if(JSON.stringify(this.targetDrop)===JSON.stringify(s)&&n==0)return;this.lastTarget?(this.lastTarget.style.background="",o.style.background=this.selectedItem.bgcolor.includes("-")?"grey":this.selectedItem.bgcolor,this.lastTarget=o):(this.lastTarget=o,o.style.background=this.selectedItem.bgcolor.includes("-")?"grey":this.selectedItem.bgcolor)}this.targetDrop=s,l.preventDefault();return}return}if(l.type=="touchend"){let o=document.elementFromPoint(l.changedTouches[0].clientX,l.changedTouches[0].clientY);if(this.touchedItem)if(o.parentNode.classList.contains("my-event-drag"))console.log("onTouchEvt::END >>removing my-event-drag","isDisabledScoreEdit>> "+this.daSchedule.isDisabledScoreEdit[e.id],"mobileEnableScore>> "+this.daSchedule.mobileEnableScore[e.id]),o.parentNode.classList.remove("my-event-drag");else{let s=this.touchedItem.parentNode.classList.contains("my-event-drag");s?this.touchedItem.parentNode.classList.remove("my-event-drag"):console.log("onTouchEvt::END...target NO my-event-drag?",s,o,o.parentNode)}else{console.log("onTouchEvt::END >> EUUH nothing? returning....",this.touchedItem,o);return}if(o.ariaLabel){let s=t(o.ariaLabel);this.targetDrop=s,this.doDroppy("onDrop",this.targetDrop,this.selectedItem)}else(o.classList.contains("title")||o.classList.contains("my-event"))&&this.targetDrop&&this.doDroppy("onDrop",this.targetDrop,this.selectedItem);l.preventDefault(),l.stopPropagation();return}console.log("onTouchEvt::UNKNOWN",l)},onTouchHold({evt:l,...e},t){if(!this.mobile)return console.log("onTouchHold>>NOT MOBILE",l.type,"mobileEnableScore>> "+this.daSchedule.mobileEnableScore[t.id]),!0;let i=document.elementFromPoint(l.changedTouches[0].clientX,l.changedTouches[0].clientY);this.daSchedule.toggleEvtNoteScoreMobile(t.id);let o=i.closest(".my-event");i.classList.contains("title")&&i.parentNode.classList.contains("my-event-drag")?(console.log("onTouchHold...REMOVING my-event-drag"),i.parentNode.classList.remove("my-event-drag")):o&&o.classList.contains("my-event-drag")?o.classList.toggle("my-event-drag"):this.touchedItem&&(o=this.touchedItem.closest(".my-event"),o&&o.classList.contains("my-event-drag")?o.classList.toggle("my-event-drag"):console.log("ERROR...onTouchHold--class not found on Target!!",i,this.touchedItem)),this.daSchedule.isDisabledScoreEdit[t.id]&&!this.daSchedule.mobileEnableScore[t.id]&&(console.log("onTouchHold::dblClicking!",this.daSchedule.showEvtNoteScoreMobile(t.id)),this.onDblClickEvent(l,t))},scrollToEvent(l){this.$refs.calendar.scrollToTime(l.time,350)},scrollToTime(l,e=null){var t;if(this.$refs.calendar){let i=R(l,{minute:-30});console.log("scrollToTime::gonna SCROLL",l.time,i.time,e),(t=this.$refs.calendar)==null||t.scrollToTime(i.time,e?e=="fast"?400:1e3:500)}else setTimeout(()=>{let i=F(new Date);console.log("scrollToTime::NO SCROLLY at",l.time,"Now going to: "+i.time),this.scrollToTime(i,"slow")},1e3)},confirmTimeChange(l,e,t,i,o,s,n=null){this.$q.dialog({title:l,message:e,cancel:!1,ok:t,options:{type:"radio",model:"",items:[{label:t+" and "+i,value:"ok"},{label:i,value:"alt"}]},class:"overflow-wrap: break-word;",style:""}).onOk(r=>{if(r==""){console.log("confirmTimeChange onOk with no selection >>onDismiss"),this.doNotify("No selection made...Leaving as is","positive","bottom"),n?n():console.log("confirmTimeChange:: No Dismiss func to execute!");return}return o(r)}).onCancel(()=>{s()})},radioChoiceDialog(l,e,t,i,o=null,s=null,n=null){this.$q.dialog({title:l,cancel:!!s,persistent:!0,message:e,options:{type:"radio",model:i,items:t}}).onOk(r=>{o&&(r==""?this.radioChoiceDialog(l,e,t,i,o,s,n):o(r))}).onCancel(()=>{s&&s()}).onDismiss(()=>{n&&n()})},checkBoxDialog(l,e,t,i,o=null,s=null,n=null){let r=t.length,h=r>2?2:r;this.$q.dialog({title:l,message:e,options:{type:"checkbox",model:[],isValid:p=>p.length>0&&p.length>=h,items:t},cancel:!0,persistent:!0}).onOk(p=>{o(p)}).onCancel(()=>{s&&s()}).onDismiss(()=>{n&&n()})},confirmAction(l,e,t,i,o=null){this.$q.dialog({title:"Warning",cancel:!0,ok:e,message:l}).onOk(()=>{t()}).onCancel(()=>{i()}).onDismiss(()=>{if(o){o();return}})},doNotify(l,e=void 0,t="top"){this.$q.notify({color:e!==void 0?e:"negative",position:t,message:l,icon:e==null?"report_problem":"thumb_up"})},withDismissNotify(l,e=void 0,t="top",i=null,o=null){this.$q.notify({color:e!==void 0?e:"negative",position:t,message:l,icon:e==null?"report_problem":"thumb_up",timeout:i!=null?i:5e3,closeBtn:"Okey",onDismiss:o})}}},he=l=>(We("data-v-3653fe06"),l=l(),Qe(),l),Ct={class:"subcontent"},Dt={class:"q-px-md boxy"},wt={key:0},Rt={key:1},Nt={key:2},At={key:3},Mt={key:4},Pt={key:5},_t={class:"row justify-center"},$t=he(()=>$("br",null,null,-1)),kt=he(()=>$("br",null,null,-1)),Bt={key:0,class:"q-pa-sm bg-grey-12",style:{"max-width":"400px"}},It={class:"q-pa-sm row justify-center"},Lt={class:"row justify-center"},xt=he(()=>$("br",null,null,-1)),Gt={key:0,class:"q-gutter-md"},Vt={class:"q-mr-sm text-weight-bold",size:"28px"},Ft={key:0},jt={class:"text-weight-bold"},Ht={key:1,class:"text-weight-light text-black"},Jt={key:1,class:"q-pa-md q-gutter-sm bg-grey-12",style:{"max-width":"400px"}},Ut={key:0,class:"q-ma-xl column items-center instru"},zt={key:1,class:"q-ma-xl column items-center instru"},qt={key:0,class:"row"},Wt={class:"row justify-center"},Qt={class:"q-gutter-md",style:{display:"flex","max-width":"800px",width:"100%",height:"600px"}},Kt={style:{display:"flex","justify-content":"center","flex-wrap":"wrap",padding:"2px"}},Yt={class:"heady q-calendar__ellipsis"},Xt=["onDblclick","onDragstart","onTouchstart","onTouchmove","onTouchend"],Zt=he(()=>$("br",null,null,-1));function ei(l,e,t,i,o,s){const n=U("sched-btn"),r=U("drop-dwn-btn"),h=U("navigation-bar"),p=U("goaly-end"),O=U("mobileNoteScore"),y=U("q-calendar-day"),v=U("sched-dialog");return A(),z(ot,{padding:""},{default:w(()=>[$("div",Ct,[D(we,{modelValue:o.splitterPage,"onUpdate:modelValue":e[9]||(e[9]=g=>o.splitterPage=g),limits:[30,70]},{before:w(()=>[D(we,{modelValue:o.splitterLegend,"onUpdate:modelValue":e[3]||(e[3]=g=>o.splitterLegend=g),horizontal:"",limits:[20,80],style:{height:"100%"}},{before:w(()=>[$("div",Dt,[o.daSchedule.getProps().showReloadBtn?(A(),P("div",wt,[D(n,{"text-label":"Reload",class:"sched-btn","text-color":"green",onDoBtnAction:s.onReloadSaved},null,8,["onDoBtnAction"])])):_("",!0),o.daSchedule.getProps().showClearBtn?(A(),P("div",Rt,[D(n,{"text-label":"Clear",class:"sched-btn","text-color":"lime-5",onDoBtnAction:s.onClearDay},null,8,["onDoBtnAction"])])):_("",!0),s.showDefaultBtn?(A(),P("div",Nt,[D(n,{textLabel:s.defaultLabels,class:"sched-btn","text-color":"blue",onDoBtnAction:s.onLoadDefault},null,8,["textLabel","onDoBtnAction"])])):_("",!0),o.daSchedule.getProps().showScoreBtn?(A(),P("div",At,[D(r,{class:"sched-drop-btn","text-color":"teal",disableBtn:o.daSchedule.disableScoreBtn,optionLabel:s.chosenScoreLabel,daOptions:o.scoreOptions,onDoReload:s.doReloadWithScore,onChooseOption:s.onChoosenScore},null,8,["disableBtn","optionLabel","daOptions","onDoReload","onChooseOption"])])):_("",!0),o.daSchedule.getProps().showPrioBtn?(A(),P("div",Mt,[D(r,{class:"sched-drop-btn","text-color":"teal",disableBtn:o.daSchedule.getProps().disablePrioBtn,optionLabel:s.chosenPrioLabel,daOptions:s.allMainGPrio(),onDoReload:s.doReloadWithPrio,onChooseOption:s.onChoosenPrio},null,8,["disableBtn","optionLabel","daOptions","onDoReload","onChooseOption"])])):_("",!0),o.daSchedule.getProps().showOneEachBtn?(A(),P("div",Pt,[D(n,{"text-label":"One Each",class:"sched-btn","text-color":"brown",onDoBtnAction:s.onScheduleOneEach},null,8,["onDoBtnAction"])])):_("",!0)]),$("div",_t,[D(be,{class:"q-mt-md","text-color":s.saveScheduleDisabled?"grey":"blue",elevated:"",push:"",align:"evenly",label:"SaveSchedule",disable:s.saveScheduleDisabled,onClick:s.doSaveSchedule,"no-caps":""},null,8,["text-color","disable","onClick"]),D(be,{class:"q-mt-md","text-color":"green",elevated:"",push:"",align:"evenly",label:o.showTree?"HideTree":"ShowTree",onClick:e[0]||(e[0]=g=>o.showTree=!o.showTree),"no-caps":""},null,8,["label"])]),$t]),after:w(()=>[kt,o.treeGoals.length>0?(A(),P("div",Bt,[$("div",It,G(s.labelGoals("s")),1),$("div",Lt,[D(ne,{color:"secondary","multi-line":""},{default:w(()=>[x(G(s.labelGoals("b"))+" mins ",1)]),_:1})]),D(q),xt,s.showTreeForm?(A(),P("div",Gt,[D(et,{label:"'je-suis'",hint:"Keyword >> Enter","hide-hint":"",ref:"filterRef",modelValue:o.filter,"onUpdate:modelValue":e[1]||(e[1]=g=>o.filter=g),"use-input":"","use-chips":"",multiple:"",disable:s.isViewingPast(),"hide-dropdown-icon":"","input-debounce":"0","new-value-mode":"add-unique",class:"q-gutter-sm"},{"selected-item":w(g=>[D(tt,{removable:"",dense:"",onRemove:b=>g.removeAtIndex(g.index),tabindex:g.tabindex,"text-color":"black",class:"q-ma-none",style:{width:"80px"}},{default:w(()=>[x(G(g.opt),1)]),_:2},1032,["onRemove","tabindex"])]),append:w(()=>[o.filter.length>0?(A(),z(Oe,{key:0,name:"clear",class:"cursor-pointer",onClick:s.resetFilter},null,8,["onClick"])):_("",!0)]),_:1},8,["modelValue","disable"]),D(lt,{nodes:o.treeGoals,"node-key":"label",filter:s.filterString,"filter-method":s.myFilterMethod,expanded:o.expanded,"onUpdate:expanded":e[2]||(e[2]=g=>o.expanded=g),"no-connectors":"",dense:""},{"default-header":w(g=>[$("div",{class:se(s.classyColor(g.node))},[g.node.isChildren?_("",!0):(A(),z(Oe,{key:0,name:g.node.icon||g.expanded?"expand_less":"expand_more",size:"28px",right:""},null,8,["name"])),$("div",Vt,G(g.node.label),1)],2)]),"default-body":w(g=>[g.node.isChildren?(A(),P("div",Ft,[$("span",jt," >> "+G(g.node.details),1)])):(A(),P("span",Ht,G(g.node.details),1))]),_:1},8,["nodes","filter","filter-method","expanded"])])):_("",!0),o.filter.length>0?(A(),P("div",Jt,[D(n,{"text-label":"Add Moods",class:"q-mt-xl sched-btn","text-color":"red",onDoBtnAction:s.onMoodAdd},null,8,["onDoBtnAction"])])):_("",!0)])):_("",!0)]),_:1},8,["modelValue"]),s.showRemInstru?(A(),P("div",Ut,[D(j,null,{default:w(()=>[x(" Double click upcoming evt to remove it ")]),_:1}),D(q),D(j,null,{default:w(()=>[x(" For mobile, Long press hold to remove or start drag ")]),_:1}),D(q),D(j,null,{default:w(()=>[x(" Can also add note to a finished evt or remove it ")]),_:1}),D(q),D(j,null,{default:w(()=>[x(" Click on time intervals to add events to schedule ")]),_:1}),D(q),D(j,null,{default:w(()=>[x(" ShowTree to filter goals by mood keywords. ")]),_:1})])):_("",!0),s.showSchedInstru?(A(),P("div",zt,[D(j,null,{default:w(()=>[x(" Use above Scheduling buttons to add events to schedule ")]),_:1}),D(q),D(j,null,{default:w(()=>[x(" Can also use mood keyworks to filter/add associated goals. ")]),_:1}),D(q),D(j,null,{default:w(()=>[x(" Click on time intervals to add events to schedule ")]),_:1})])):_("",!0)]),separator:w(()=>[D(ze,{color:"primary",class:"q-px-md","text-color":"white",size:"40px",icon:"drag_indicator",style:{position:"relative",top:"70%"}})]),after:w(()=>[D(h,{onToday:s.onToday,onPrev:s.onPrev,onNext:s.onNext},null,8,["onToday","onPrev","onNext"]),s.scheduleMoodsLabel!=""?(A(),P("div",qt,[x(" By moods: "),D(ne,{color:"secondary","multi-line":""},{default:w(()=>[x(G(s.scheduleMoodsLabel),1)]),_:1})])):_("",!0),$("div",Wt,[$("div",Qt,[D(y,{ref:"calendar",view:"day",modelValue:o.currentDate,"onUpdate:modelValue":e[8]||(e[8]=g=>o.currentDate=g),"drag-enter-func":s.onDragEnter,"drag-over-func":s.onDragOver,"drag-leave-func":s.onDragLeave,"drop-func":s.onDrop,animated:"",bordered:"",hoverable:"","no-active-date":"","transition-next":"slide-left","transition-prev":"slide-right","time-clicks-clamped":"","interval-minutes":15,"interval-count":96,"interval-height":28,"selected-start-end-dates":s.startEndTimes,onChange:s.onChange,onClickDate:s.onClickDate,onClickTime:s.onClickTime,onClickInterval:s.onClickInterval,onClickHeadIntervals:s.onClickHeadIntervals,onClickHeadDay:s.onClickHeadDay,onMousedownTime:s.onMouseDownTime,onMouseupTime:s.onMouseUpTime,onMousemoveTime:s.onMouseMoveTime},{"head-day-event":w(({scope:{timestamp:g}})=>[$("div",Kt,[(A(!0),P(te,null,Ee(s.eventsMap[g.date],b=>(A(),P(te,{key:b.id},[b.time?(A(),z(ne,{key:1,class:se(s.badgeClasses(b,"header")),style:ie([s.badgeStyles(b,"header"),{margin:"1px",width:"10px","max-width":"10px",height:"10px","max-height":"10px",cursor:"pointer"}]),onClick:C=>s.scrollToEvent(b)},{default:w(()=>[D(Te,null,{default:w(()=>[x(G("("+b.id+") "+b.title+" - "+b.time+" >> "+b.duration+"min"),1)]),_:2},1024)]),_:2},1032,["class","style","onClick"])):(A(),z(ne,{key:0,class:se(s.badgeClasses(b,"header")),style:ie([s.badgeStyles(b,"header"),{width:"100%",cursor:"pointer",height:"12px","font-size":"10px",margin:"1px"}])},{default:w(()=>[$("div",Yt,[x(G(b.title)+" ",1),D(Te,null,{default:w(()=>[x(G(b.details),1)]),_:2},1024)])]),_:2},1032,["class","style"]))],64))),128))])]),"day-container":w(({scope:{days:g}})=>[s.hasDate(g)?(A(),P(te,{key:0},[$("div",{class:"day-view-current-time-indicator",style:ie(s.style)},null,4),$("div",{class:"day-view-current-time-line",style:ie(s.style)},null,4)],64)):_("",!0)]),"day-body":w(({scope:{timestamp:g,timeStartPos:b,timeDurationHeight:C}})=>[(A(!0),P(te,null,Ee(s.getDateEvents(g.date),S=>(A(),P(te,{key:S.id},[S.time!==void 0?(A(),P("div",{key:0,class:se(["my-event",s.badgeClasses(S,"body")]),style:ie(s.badgeStyles(S,"body",b,C)),draggable:!0,onDblclick:ge(E=>s.onDblClickEvent(E,S),["prevent"]),onDragstart:ge(E=>s.onDragStart(E,S),["stop"]),onDragend:e[4]||(e[4]=ge((...E)=>s.onDragEnd&&s.onDragEnd(...E),["stop"])),onDrop:e[5]||(e[5]=E=>s.onDrop(E,"goal-item",l.scope)),onDragenter:e[6]||(e[6]=E=>s.onDragEnter(E,"goal-item",l.scope)),onDragover:e[7]||(e[7]=E=>s.onDragOver(E,"goal-item",l.scope)),onTouchstart:E=>s.onTouchStart(E,S),onTouchmove:E=>s.onTouchEvt(E,S),onTouchend:E=>s.onTouchEvt(E,S)},[qe(D(p,{disabledScore:o.daSchedule.isDisabledScoreEdit[S.id],title:S.title,id:S.id,startTime:S.time,score:S.score,details:S.details,notes:S.notes,happeningNow:o.daSchedule.hasStarted[S.id]?o.daSchedule.hasStarted[S.id]:!1,onEndNow:s.onEndNow,onSaveScore:s.onSaveScore,onAddMins:s.onAddMins,onDeleteNow:E=>s.removeEvtInSchedule(S)},null,8,["disabledScore","title","id","startTime","score","details","notes","happeningNow","onEndNow","onSaveScore","onAddMins","onDeleteNow"]),[[rt,E=>s.onTouchHold(E,S),"400:12:15"]]),s.showEvtMobile(S.id)?(A(),z(O,{key:0,title:S.title,id:S.id,startTime:S.time,score:S.score,details:S.details,notes:S.notes,"show-dialog":s.showEvtMobile(S.id),onSaveScore:s.onSaveScore,onDeleteNow:E=>s.removeEvtInSchedule(S),onEuhHidin:E=>o.daSchedule.euhHidin(S.id)},null,8,["title","id","startTime","score","details","notes","show-dialog","onSaveScore","onDeleteNow","onEuhHidin"])):_("",!0)],46,Xt)):_("",!0)],64))),128))]),_:1},8,["modelValue","drag-enter-func","drag-over-func","drag-leave-func","drop-func","selected-start-end-dates","onChange","onClickDate","onClickTime","onClickInterval","onClickHeadIntervals","onClickHeadDay","onMousedownTime","onMouseupTime","onMousemoveTime"])])]),Zt]),_:1},8,["modelValue"]),o.showEvtDialog?(A(),z(v,{key:0,parentGoals:o.daSchedule.allPGoals(),canBeScheduled:s.canbeScheduled,balance:s.currentBalance,onAdHocEvent:s.onAddHocEvent,onOnPickEvent:s.onPickEvent,onEuhHidin:s.closingDialog},null,8,["parentGoals","canBeScheduled","balance","onAdHocEvent","onOnPickEvent","onEuhHidin"])):_("",!0)])]),_:1})}var hi=Ue(Tt,[["render",ei],["__scopeId","data-v-3653fe06"]]);export{hi as default};
