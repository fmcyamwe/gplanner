import{j as z,r as m,c as F,ah as De,n as Te,an as Re,h as $,g as me,Q as O,d as K,_ as U,F as b,M as C,J as H,S as I,I as f,H as E,R as q,ao as pe,ap as Ce,aq as j,ai as ge,K as w,ar as ie,U as k,al as ve,am as Se,G,k as Ee,as as be,a2 as Oe,at as $e,au as Pe,w as le,b as ke,ae as Ne,av as Be,aw as Ae,ax as Me,ay as Ve,W as _e,N as te,O as _,f as Ge,E as N,az as ne,aA as ae,aB as Y,ak as X,af as Ie,P as Z}from"./index.01ac1f1f.js";import{Q as ye,a as we,b as qe,c as Fe,d as He,e as Le,f as Qe,g as Ue,h as We}from"./viewAllGoals.9abe08c3.js";import{c as oe,a as Je,b as je,Q as re}from"./utiFunc.55063972.js";import{N as ze,t as B,p as x,a as D,j as P,k as ee,T as Ke,b as A,c as M,i as J,C as de,U as V,V as he,Q as Ye}from"./NavigationBar.5d3cc23d.js";import{a as Xe}from"./QCalendar.f0a44021.js";/* empty css                             */import{u as Ze}from"./goalStorage.bc934b6b.js";import{u as xe}from"./use-quasar.da98edb0.js";const et=()=>!!/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);function Q(t,o=new WeakMap){if(Object(t)!==t)return t;if(o.has(t))return o.get(t);const s=t instanceof Date?new Date(t):t instanceof RegExp?new RegExp(t.source,t.flags):t instanceof Set?new Set:t instanceof Map?new Map:typeof t.constructor!="function"?Object.create(null):t.prototype!==void 0&&typeof t.prototype.constructor=="function"?t:new t.constructor;if(typeof t.constructor=="function"&&typeof t.valueOf=="function"){const l=t.valueOf();if(Object(l)!==l){const i=new t.constructor(l);return o.set(t,i),i}}return o.set(t,s),t instanceof Set?t.forEach(l=>{s.add(Q(l,o))}):t instanceof Map&&t.forEach((l,i)=>{s.set(i,Q(l,o))}),Object.assign(s,...Object.keys(t).map(l=>({[l]:Q(t[l],o)})))}var tt=z({name:"QPopupEdit",props:{modelValue:{required:!0},title:String,buttons:Boolean,labelSet:String,labelCancel:String,color:{type:String,default:"primary"},validate:{type:Function,default:()=>!0},autoSave:Boolean,cover:{type:Boolean,default:!0},disable:Boolean},emits:["update:modelValue","save","cancel","beforeShow","show","beforeHide","hide"],setup(t,{slots:o,emit:s}){const{proxy:l}=me(),{$q:i}=l,n=m(null),a=m(""),r=m("");let d=!1;const h=F(()=>De({initialValue:a.value,validate:t.validate,set:c,cancel:S,updatePosition:p},"value",()=>r.value,g=>{r.value=g}));function c(){t.validate(r.value)!==!1&&(u()===!0&&(s("save",r.value,a.value),s("update:modelValue",r.value)),v())}function S(){u()===!0&&s("cancel",r.value,a.value),v()}function p(){Te(()=>{n.value.updatePosition()})}function u(){return Re(r.value,a.value)===!1}function v(){d=!0,n.value.hide()}function T(){d=!1,a.value=Q(t.modelValue),r.value=Q(t.modelValue),s("beforeShow")}function y(){s("show")}function R(){d===!1&&u()===!0&&(t.autoSave===!0&&t.validate(r.value)===!0?(s("save",r.value,a.value),s("update:modelValue",r.value)):s("cancel",r.value,a.value)),s("beforeHide")}function W(){s("hide")}function L(){const g=o.default!==void 0?[].concat(o.default(h.value)):[];return t.title&&g.unshift($("div",{class:"q-dialog__title q-mt-sm q-mb-sm"},t.title)),t.buttons===!0&&g.push($("div",{class:"q-popup-edit__buttons row justify-center no-wrap"},[$(O,{flat:!0,color:t.color,label:t.labelCancel||i.lang.label.cancel,onClick:S}),$(O,{flat:!0,color:t.color,label:t.labelSet||i.lang.label.set,onClick:c})])),g}return Object.assign(l,{set:c,cancel:S,show(g){n.value!==null&&n.value.show(g)},hide(g){n.value!==null&&n.value.hide(g)},updatePosition:p}),()=>{if(t.disable!==!0)return $(ye,{ref:n,class:"q-popup-edit",cover:t.cover,onBeforeShow:T,onShow:y,onBeforeHide:R,onHide:W,onEscapeKey:S},L)}}});const ot=K({name:"GoalyEnd",props:{disabledScore:Boolean,title:String,id:Number,startTime:String,details:String,score:String,happeningNow:Boolean},emits:["saveScore","endNow","deleteNow"],computed:{aScore:{get(){return this.score},set(t){console.log("aScore getting set",t,this.id),this.$emit("saveScore",t,this.id)},cancel(){console.log("aScore remove?",this.id)}},userIconStyle(){return{color:this.disabledScore===!0?"red":"blue",cursor:"pointer"}},endNowBtnStyle(){return{display:this.disabledScore===!0&&this.happeningNow===!0?"block":"none","text-align":"right","margin-left":"32em",height:"auto"}}},watch:{title(t){console.log("titleValue:",t)}},methods:{onDelete(){this.$emit("deleteNow",this.id)},wannaEnd(){console.log("eeeuh wish to end for",this.id,this.disabledScore,this.happeningNow),this.$emit("endNow",this.id)}}}),st={class:"title q-calendar__ellipsis"};function it(t,o,s,l,i,n){return b(),C("div",st,[H(I(t.title+":"+t.score)+" ",1),f(oe,null,{default:E(()=>[H(I(t.details),1)]),_:1}),f(O,{"no-caps":"",class:"button",label:"End-Now",style:q(t.endNowBtnStyle),onClick:t.wannaEnd},null,8,["style","onClick"]),f(tt,{modelValue:t.aScore,"onUpdate:modelValue":o[0]||(o[0]=a=>t.aScore=a),disable:t.disabledScore,"auto-save":""},{default:E(a=>[f(pe,{modelValue:a.value,"onUpdate:modelValue":r=>a.value=r,dense:"",onKeyup:Ce(a.set,["enter"])},{after:E(()=>[f(O,{flat:"",dense:"",color:"positive",icon:"check_circle",onClick:j(a.set,["stop","prevent"])},null,8,["onClick"]),f(ge,{vertical:!0}),f(O,{label:"Del",flat:"",dense:"",color:"negative",icon:"delete_forever",onClick:t.onDelete},null,8,["onClick"])]),_:2},1032,["modelValue","onUpdate:modelValue","onKeyup"])]),_:1},8,["modelValue","disable"])])}var lt=U(ot,[["render",it],["__scopeId","data-v-1fedd850"]]);const nt=$("div",{class:"q-space"});var ue=z({name:"QSpace",setup(){return()=>nt}});const at={name:"adHocEvent",props:{mainGoals:Array},data(){return{aTitle:"",daP:null,own:"misc",duration:15}},emits:["saveEvent"],computed:{pGoals:{get(){return this.mainGoals}},evName:{get(){return this.aTitle},set(t){this.aTitle=t}}},methods:{onClicked(){this.$emit("saveEvent",this.aTitle,this.daP,this.own,this.duration)}}},rt=t=>(ve("data-v-30b79eac"),t=t(),Se(),t),dt={class:"q-calendar__ellipsis"},ht=rt(()=>w("div",{class:"text-h6"},"adHocEvent",-1)),ut={class:"q-ml-md q-gutter-md"},ct={class:"radio-select"},ft={key:0},mt={style:{"text-align":"center"}};function pt(t,o,s,l,i,n){return b(),C("div",dt,[ht,f(ue),w("div",ut,[f(pe,{modelValue:n.evName,"onUpdate:modelValue":o[0]||(o[0]=a=>n.evName=a),filled:"",label:"A Goal","lazy-rules":"","item-aligned":"",rules:[a=>a&&a.length>0||"Please type a goal"]},null,8,["modelValue","rules"]),w("div",ct,[f(ie,{modelValue:i.own,"onUpdate:modelValue":o[1]||(o[1]=a=>i.own=a),val:"misc",label:"Misc"},null,8,["modelValue"]),f(ue),f(ie,{modelValue:i.own,"onUpdate:modelValue":o[2]||(o[2]=a=>i.own=a),val:"self",label:"Self"},null,8,["modelValue"])]),n.pGoals?(b(),C("div",ft,[f(we,{class:"q-ml-md",modelValue:i.daP,"onUpdate:modelValue":o[3]||(o[3]=a=>i.daP=a),options:n.pGoals,"option-value":"id","option-label":"title",disable:i.own!="misc",label:"Parent Goal"},null,8,["modelValue","options","disable"])])):k("",!0),w("div",null,[f(qe,{min:15,max:120,thickness:.22,step:5,modelValue:i.duration,"onUpdate:modelValue":o[4]||(o[4]=a=>i.duration=a),"show-value":"",label:"Duration",size:"75px",color:"teal","track-color":"grey-3",class:"q-ma-md"},null,8,["thickness","modelValue"])])]),w("div",mt,[f(O,{flat:"",label:"Add",color:"primary",onClick:n.onClicked},null,8,["onClick"])])])}var gt=U(at,[["render",pt],["__scopeId","data-v-30b79eac"]]);const vt=K({name:"schedBtn",props:{textLabel:String},emits:["doBtnAction"],methods:{onClicked(){this.$emit("doBtnAction")}}});function St(t,o,s,l,i,n){return b(),G(O,{color:"",elevated:"",onClick:t.onClicked,"no-caps":""},{default:E(()=>[w("div",null,I(t.textLabel),1)]),_:1},8,["onClick"])}var Et=U(vt,[["render",St],["__scopeId","data-v-f8dc388e"]]),bt=z({name:"QBtnGroup",props:{unelevated:Boolean,outline:Boolean,flat:Boolean,rounded:Boolean,square:Boolean,push:Boolean,stretch:Boolean,glossy:Boolean,spread:Boolean},setup(t,{slots:o}){const s=F(()=>{const l=["unelevated","outline","flat","rounded","square","push","stretch","glossy"].filter(i=>t[i]===!0).map(i=>`q-btn-group--${i}`).join(" ");return`q-btn-group row no-wrap${l.length>0?" "+l:""}`+(t.spread===!0?" q-btn-group--spread":" inline")});return()=>$("div",{class:s.value},Ee(o.default))}});const yt=Object.keys(be),wt=t=>yt.reduce((o,s)=>{const l=t[s];return l!==void 0&&(o[s]=l),o},{});var Dt=z({name:"QBtnDropdown",props:{...be,...Oe,modelValue:Boolean,split:Boolean,dropdownIcon:String,contentClass:[Array,String,Object],contentStyle:[Array,String,Object],cover:Boolean,persistent:Boolean,noRouteDismiss:Boolean,autoClose:Boolean,menuAnchor:{type:String,default:"bottom end"},menuSelf:{type:String,default:"top end"},menuOffset:Array,disableMainBtn:Boolean,disableDropdown:Boolean,noIconAnimation:Boolean,toggleAriaLabel:String},emits:["update:modelValue","click","beforeShow","show","beforeHide","hide"],setup(t,{slots:o,emit:s}){const{proxy:l}=me(),i=m(t.modelValue),n=m(null),a=$e(),r=F(()=>{const g={"aria-expanded":i.value===!0?"true":"false","aria-haspopup":"true","aria-controls":a,"aria-label":t.toggleAriaLabel||l.$q.lang.label[i.value===!0?"collapse":"expand"](t.label)};return(t.disable===!0||t.split===!1&&t.disableMainBtn===!0||t.disableDropdown===!0)&&(g["aria-disabled"]="true"),g}),d=F(()=>"q-btn-dropdown__arrow"+(i.value===!0&&t.noIconAnimation===!1?" rotate-180":"")+(t.split===!1?" q-btn-dropdown__arrow-container":"")),h=F(()=>Pe(t)),c=F(()=>wt(t));le(()=>t.modelValue,g=>{n.value!==null&&n.value[g?"show":"hide"]()}),le(()=>t.split,L);function S(g){i.value=!0,s("beforeShow",g)}function p(g){s("show",g),s("update:modelValue",!0)}function u(g){i.value=!1,s("beforeHide",g)}function v(g){s("hide",g),s("update:modelValue",!1)}function T(g){s("click",g)}function y(g){Be(g),L(),s("click",g)}function R(g){n.value!==null&&n.value.toggle(g)}function W(g){n.value!==null&&n.value.show(g)}function L(g){n.value!==null&&n.value.hide(g)}return Object.assign(l,{show:W,hide:L,toggle:R}),ke(()=>{t.modelValue===!0&&W()}),()=>{const g=[$(Ne,{class:d.value,name:t.dropdownIcon||l.$q.iconSet.arrow.dropdown})];return t.disableDropdown!==!0&&g.push($(ye,{ref:n,id:a,class:t.contentClass,style:t.contentStyle,cover:t.cover,fit:!0,persistent:t.persistent,noRouteDismiss:t.noRouteDismiss,autoClose:t.autoClose,anchor:t.menuAnchor,self:t.menuSelf,offset:t.menuOffset,separateClosePopup:!0,transitionShow:t.transitionShow,transitionHide:t.transitionHide,transitionDuration:t.transitionDuration,onBeforeShow:S,onShow:p,onBeforeHide:u,onHide:v},o.default)),t.split===!1?$(O,{class:"q-btn-dropdown q-btn-dropdown--simple",...c.value,...r.value,disable:t.disable===!0||t.disableMainBtn===!0,noWrap:!0,round:!1,onClick:T},{default:()=>Ee(o.label,[]).concat(g),loading:o.loading}):$(bt,{class:"q-btn-dropdown q-btn-dropdown--split no-wrap q-btn-item",rounded:t.rounded,square:t.square,...h.value,glossy:t.glossy,stretch:t.stretch},()=>[$(O,{class:"q-btn-dropdown--current",...c.value,disable:t.disable===!0||t.disableMainBtn===!0,noWrap:!0,round:!1,onClick:y},{default:o.label,loading:o.loading}),$(O,{class:"q-btn-dropdown__arrow-container q-anchor--skip",...r.value,...h.value,disable:t.disable===!0||t.disableDropdown===!0,rounded:t.rounded,color:t.color,textColor:t.textColor,dense:t.dense,size:t.size,padding:t.padding,ripple:t.ripple},()=>g)])}}});function ce(t){if(t===!1)return 0;if(t===!0||t===void 0)return 1;const o=parseInt(t,10);return isNaN(o)?0:o}var Tt=Ae({name:"close-popup",beforeMount(t,{value:o}){const s={depth:ce(o),handler(l){s.depth!==0&&setTimeout(()=>{const i=Me(t);i!==void 0&&Ve(i,l,s.depth)})},handlerKey(l){_e(l,13)===!0&&s.handler(l)}};t.__qclosepopup=s,t.addEventListener("click",s.handler),t.addEventListener("keyup",s.handlerKey)},updated(t,{value:o,oldValue:s}){o!==s&&(t.__qclosepopup.depth=ce(o))},beforeUnmount(t){const o=t.__qclosepopup;t.removeEventListener("click",o.handler),t.removeEventListener("keyup",o.handlerKey),delete t.__qclosepopup}});const Rt=K({name:"schedDropBtn",props:{optionLabel:String,disableBtn:Boolean,daOptions:Array},emits:["doReload","chooseOption"],methods:{onClicked(){this.$emit("doReload")},onSelect(t){this.$emit("chooseOption",t)}}});function Ct(t,o,s,l,i,n){return b(),G(Dt,{split:"",color:"",elevated:"","disable-main-btn":t.disableBtn,label:t.optionLabel,onClick:t.onClicked,"no-caps":""},{default:E(()=>[f(Fe,null,{default:E(()=>[(b(!0),C(_,null,te(t.daOptions,a=>Ge((b(),G(He,{key:a,clickable:"",onClick:r=>t.onSelect(a)},{default:E(()=>[f(Le,null,{default:E(()=>[f(Qe,null,{default:E(()=>[H(I(a),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"])),[[Tt]])),128))]),_:1})]),_:1},8,["disable-main-btn","label","onClick"])}var Ot=U(Rt,[["render",Ct],["__scopeId","data-v-478bd4de"]]);function fe(t){return t.button===0}const $t=K({name:"dayCalendar",components:{NavigationBar:ze,QCalendarDay:Xe,addGoalForm:Ue,GoalyEnd:lt,adHocEvent:gt,schedBtn:Et,schedDropBtn:Ot},data(){return m(null),m(null),m(null),m(null),xe(),{currentDate:m(B()),scoreOptions:m([1,2,3,4,5]),chosenScore:m(null),chosenPrio:m(null),scheduledEvents:[],dailyScheduled:m(new Map),endTimesSet:m(new Set),startTimesSet:m(new Set),disablePrioBtn:m(!0),disableScoreBtn:m(!0),calendar:m(null),store:Ze(),anchorTimestamp:m(null),otherTimestamp:m(null),mouseDown:m(!1),mobile:m(!0),timeStartPos:m(0),showGoalForm:m(!1),pickEventDialog:m(!1),addEventDialog:m(!1),adHocEventDialog:m(!0),conflictReso:m(!1),resoType:m(""),toAddE:m(null),disabledScoreEvts:m({}),hasStarted:m({}),disableSaveSchedule:m(!0),force:m(!1),showReloadBtn:m(!1),loadDefault:m(!0),showScoreBtn:m(!1),showPrio:m(!1),treeGoals:m([]),expanded:m([])}},beforeMount(){this.mobile=et(),this.resetGoalEvts(!0),this.constructTree()},beforeUnmount(){clearInterval(this.intervalId)},mounted(){this.adjustCurrentTime(),this.intervalId=setInterval(()=>{this.adjustCurrentTime()},6e4)},computed:{chosenScoreLabel(){return this.chosenScore==null?"By Score":`Score >= ${this.chosenScore}`},chosenPrioLabel(){return this.chosenPrio==null?"By Priority":`Prio = ${this.chosenPrio}`},style(){return{top:this.timeStartPos+"px"}},showForm(){return this.showGoalForm},doDisableSaveSchedule(){return this.disableSaveSchedule},hasEventsForDate(){return this.store.hasEventsForDate(this.currentDate)},eventsMap(){const t={};return this.scheduledEvents.forEach(o=>{if(t[o.date]||(t[o.date]=[]),t[o.date].push(o),o.days){console.log(`eventsMap multiple days? event for ${o.date}`,o.days);let s=x(o.date),l=o.days;do s=D(s,{day:1}),t[s.date]||(t[s.date]=[]),t[s.date].push(o);while(--l>0)}}),t},parentGoalsMap(){const t=new Map;let o=this.storedMainG;return o?(o.forEach(s=>{t.set(s.id,s)}),t):(console.log("parentGoalsMap is empty or null",o),t)},canbeScheduled(){let t=this.deepCopy(this.storedEvents),o=t.filter(s=>!this.scheduledEvents.find(l=>l.id==s.id));return o.length==0?t:o},storedEvents(){return this.store.getSubGoals},storedMainG(){return this.store.getMainGoals},startEndTimes(){const t=[];return this.anchorDayTimeIdentifier!==!1&&this.otherDayTimeIdentifier!==!1&&(this.anchorDayTimeIdentifier<=this.otherDayTimeIdentifier?(console.log("startEndTimes..anchor <= otherDayTime",P(this.anchorTimestamp),P(this.otherTimestamp)),t.push(P(this.anchorTimestamp),P(this.otherTimestamp))):(console.log("startEndTimes..otherDayTime <= anchor",P(this.anchorTimestamp),P(this.otherTimestamp)),t.push(P(this.otherTimestamp),P(this.anchorTimestamp)))),t},anchorDayTimeIdentifier(){return this.anchorTimestamp!==null?ee(this.anchorTimestamp):!1},otherDayTimeIdentifier(){return this.otherTimestamp!==null?ee(this.otherTimestamp):!1}},methods:{constructTree(){this.treeGoals=this.store.fetchGoalsTree()},badgeClasses(t,o){return Je(t,o)},badgeStyles(t,o,s=void 0,l=void 0){return je(t,o,s,l)},getTimeNumber(t){return t!==null?ee(t):!1},getTimeyNumber(t){return t!==null?Ke(t):!1},getDateEvents(t){const o=this.eventsMap[t]||[];if(o.length===1)o[0].side="full";else if(o.length===2){console.log("getDateEvents...LENGTH is 2?",t,o);const s=D(M(o[0].date),{minute:A(o[0].time)}),l=D(s,{minute:o[0].duration}),i=D(M(o[1].date),{minute:A(o[1].time)}),n=D(i,{minute:o[1].duration});J(i,s,l,!0)||J(n,s,l,!0)?(o[0].side="left",o[1].side="right"):(o[0].side="full",o[1].side="full")}return o},hasDate(t){return this.currentDate?t.find(o=>o.date===this.currentDate):!1},getEventsForDate(t){return this.store.getEventsForDate(t)},isViewingToday(){return B()==this.currentDate},isViewingPast(){let t=B();if(this.currentDate&&this.currentDate==t)return!1;let o=de(M(t));return!(de(M(this.currentDate))>=o)},adjustCurrentTime(){const t=V(new Date);if(this.currentDate!==t.date){this.timeStartPos=-10,this.currentTime="";return}this.currentDate=t.date,this.currentTime=t.time,this.timeStartPos=this.$refs.calendar.timeStartPos(t.time,!1);let o=this.endTimesSet&&this.endTimesSet.has(t.time),s=this.startTimesSet&&this.startTimesSet.has(t.time);(o||s)&&this.doEnableEndNowBtn(this.currentTime,o,s)},setGoalsPrio(){let t=this.store.fetchAllPrio();return!t.size>0?(console.log("ERROR...no Priority goals?",t),[]):Array.from(t.values())},resetGoalEvts(t=!1){if(this.scheduledEvents===this.allEvents&&console.log("resetGoalEvts SAME"),t){let o=this.deepCopy(this.storedEvents);return this.allEvents=[...o],o}return this.allEvents},getLocalEvt(t){for(let o=0;o<this.allEvents.length;o++)if(this.allEvents[o].id===t)return this.allEvents[o];return null},getScheduledEvent(t){for(let o=0;o<this.scheduledEvents.length;o++)if(this.scheduledEvents[o].id==t)return this.scheduledEvents[o];return null},doSaveEvtProp(t,o=null,s=null){this.store.saveSubProp(t,o,s)},evtStartedOrPassed(t){const o=[];let s=D(t,{minute:0}),l=this.getTimeNumber(s);return this.dailyScheduled.forEach((i,n,a)=>{let r=this.getTimeNumber(i.start),d=this.getTimeNumber(i.end);if(r!==!1&&d!==!1){let h=l>=r&&l<d,c=l>=d;(h||c)&&o.push(n),h&&(this.hasStarted[n]=!0),this.enableEvtScoreEdit(n,c)}else console.log(`ERROR?!:${n} has no start/end?.`,i)}),o},allowScoreEdit(t){this.dailyScheduled.forEach((o,s,l)=>{this.disabledScoreEvts[s]=!t})},enableEvtScoreEdit(t,o){this.disabledScoreEvts[t]=!o},canEnableEditScore(t,o){const s=V(new Date);he(s,o)>0?this.disabledScoreEvts[t]=!0:(this.disabledScoreEvts[t]=!1,this.hasStarted[t]=!1)},parseScore(t){const o=t.split(/on/);return o.length!=2?(console.log(`parseScore error?${t}`,o),-1):o[1]-o[0]},doEnableEndNowBtn(t,o,s){for(let[l,i]of this.dailyScheduled)(o?i.end.time:i.start.time)==t&&(this.hasStarted[l]=!o,this.disabledScoreEvts[l]=!o)},enableEndNowBtn(t,o,s){const l=V(new Date);J(l,o,s,!0)?this.hasStarted[t]=!0:this.hasStarted[t]=!1},retrieveSameStart(t){let o=[];for(let[s,l]of this.dailyScheduled)l.start.time==t&&o.push(s);return o},timeChangeDialog(t,o,s,l,i,n){this.$q.dialog({title:t,cancel:l,ok:s,message:o}).onOk(()=>i()).onCancel(()=>{n()}).onDismiss(()=>!1)},confirmAction(t,o,s,l=null){this.$q.dialog({title:"Warning",cancel:!0,message:t}).onOk(()=>{o()}).onCancel(()=>{s()}).onDismiss(()=>{if(l){console.log("confirmAction with dismiss!!"),l();return}})},radioChoiceDialog(t,o,s=null,l=null){this.$q.dialog({title:t,cancel:!!l,persistent:!0,options:{type:"radio",model:"",items:o}}).onOk(i=>{s&&(i==""?this.radioChoiceDialog(t,o,s,l):s(i))}).onCancel(()=>{l&&l()}).onDismiss(()=>{})},doNotify(t,o=void 0,s="top"){this.$q.notify({color:o!==void 0?o:"negative",position:s,message:t,icon:o==null?"report_problem":"thumb_up"})},updateButtons(t=null,o=null,s=null){this.loadDefault=t!=null?t:this.loadDefault,this.showScoreBtn=o!=null?o:this.showScoreBtn,this.showPrio=s!=null?s:this.showPrio},resetButtons(t,o){this.updateButtons(!t,!o,!o)},doRemove(t){let o=this.scheduledEvents.length,s=0;for(s;s<o;s++)if(this.scheduledEvents[s].id==t.id){this.scheduledEvents.splice(s,1);let l=null;if(this.dailyScheduled.has(t.id)?(l=this.dailyScheduled.get(t.id),this.dailyScheduled.delete(t.id)):console.log("ERROR doRemove, dailyScheduled has no such item?@? ",t),l){let i=this.startTimesSet.delete(l.start.time),n=this.endTimesSet.delete(l.end.time);(!i||!n)&&console.log("ERROR doRemove scheduleSets has no such item?@? ",l,t)}break}console.log("doRemove..looping FOR",s)},removeEvtInSchedule(t,o=null){if(this.isViewingPast()){this.doNotify("Removing from the past is a no no!");return}let s=()=>{this.doRemove(t),this.disableSaveSchedule=!1,this.showReloadBtn=this.hasEventsForDate};if(!this.isViewingToday()){s(),console.log("Removed future evt");return}let l=`Remove "${t.title}" from schedule?`;this.confirmAction(l,s,function(){console.log("Cancelled remove")})},reset(){this.draggedItem=null,this.targetDrop=null,this.toAddE=null,this.chosenScore=null,this.chosenPrio=null,this.possibleRange=null,this.force=!1},fixConflicts(t){console.log("fixConflicts...Start",t);const o=l=>{let i=0,n=null;for(let a of l){let r=this.getScheduledEvent(a);if(r){let d=this.parentGoalsMap.get(r.parentGoal);d?d.priority>i&&(i=d.priority,n=r):console.log("findhigherPrio..ERROR no PARENT found?",r)}else console.log("findhigherPrio..ERROR not found?",a)}return console.log("findhigherPrio..Highest priority be",n,i),n},s=l=>({label:l.title+" at "+l.score,value:l.id});for(let l of t){let i=null,n=this.retrieveSameStart(l.at);console.log("fixConflicts...results",n,l);let a=[],r="";for(let d of n){let h=this.getScheduledEvent(d);h?(a.push(h),r+=h.title+","):console.log("fixConflicts...ERROR not found?",d)}this.$q.dialog({title:"Alert",cancel:!1,persistent:!0,message:`${r} are conflicting.
 Choose how to solve this...`,options:{type:"radio",model:"opt1",items:[{label:"Resolve by Highest Priority",value:"opt1",color:"secondary"},{label:"Resolve by lowest Score Interval",value:"opt2"},{label:"Pick event",value:"opt3"}]}}).onOk(d=>{if(d=="opt3"){this.$q.dialog({title:"Alert",cancel:!1,persistent:!0,message:"Choose the event to schedule",options:{type:"radio",model:"",items:a.map(s)}}).onOk(c=>{console.log("Chosen Manually",c);let S=this.getScheduledEvent(c);S?i=S:console.log("ERROR...Manually choice not find",c)}).onCancel(()=>{console.log("Cancelled loading..HUH?!?")}).onDismiss(()=>{console.log("oooh dismissed inner...",i),this.pickConflictReso(i,a)});let h=this.updateCurrentSchedule();console.log("fixConflicts inner...after conflicts?",h),this.updateButtons(!0,null,null)}else if(d=="opt2"){console.log(">>>> OK, Option Score",d);let h=0,c=null;for(let S of a){let p=this.parseScore(S.score);p>-1&&p>=h?(h=p,c=S):console.log("ERROR...parseScore?",p,S)}c&&(console.log("Option Score Chosen",c),i=c)}else i=o(n),console.log(">>>> OK, Higher prio",d,i);console.log("Pick be",i)}).onCancel(()=>{console.log("Cancelled loading...HUH?!?")}).onDismiss(()=>{if(console.log("Dismissing...",i),i){this.pickConflictReso(i,a);let d=this.updateCurrentSchedule();console.log("fixConflicts outer...after conflicts?",d),this.updateButtons(!0,null,null),this.disableSaveSchedule=!1}})}return!0},pickConflictReso(t,o){for(let s of o)s.id==t.id?console.log("Skipping choice!",s):(console.log("Removing conflict event!",s),this.doRemove(s))},updateCurrentSchedule(){const t=new Map;let o=new Set,s=new Set,l=new Set;return this.scheduledEvents.length<1?(this.dailyScheduled=t,this.endTimesSet=o,this.startTimesSet=l,s):(this.scheduledEvents.forEach(i=>{let n=D(M(i.date),{minute:A(i.time)}),a=D(n,{minute:i.duration});t.set(i.id,{start:n,end:a,on:i.date,originalAt:i.time,for:i.duration,score:i.score}),o.add(a.time),l.has(n.time)?s.add({at:n.time,id:i.id}):l.add(n.time),(this.currentDate==B()||!this.isViewingPast())&&(this.canEnableEditScore(i.id,a),this.enableEndNowBtn(i.id,n,a))}),this.dailyScheduled=t,this.endTimesSet=o,this.startTimesSet=l,s)},addEvtPropsIntoSchedule(t){let o=this.addEvtInScheduleMaps(t);if(!o){console.log(`addEvtPropsIntoSchedule:${t.title}..ERROR...NOT added?!?`,o);return}this.scheduledEvents.push(t)},addEvtInScheduleMaps(t){if(this.dailyScheduled.has(t.id))return console.log("addEvtInScheduleMaps with evt already added...ERROR?",t),!1;let o=D(M(t.date),{minute:A(t.time)}),s=D(o,{minute:t.duration});return this.dailyScheduled.set(t.id,{on:t.date,originalAt:t.time,for:t.duration,start:o,end:s,score:t.score}),this.endTimesSet.add(s.time),this.startTimesSet.add(o.time),(this.currentDate==B()||!this.isViewingPast())&&(this.canEnableEditScore(t.id,s),this.enableEndNowBtn(t.id,o,s)),!0},updateEvtInScheduleMaps(t,o){if(this.dailyScheduled.has(t)){let s=this.dailyScheduled.get(t),l=s.for,i=s.originalAt,n=s.start,a=s.end,r=D(o,{minute:l}),d=s.score;return this.dailyScheduled.set(t,{on:o.date,originalAt:i,for:l,start:o,end:r,score:d}),this.endTimesSet.delete(a.time)?this.endTimesSet.add(r.time):console.log("updateEvtInScheduleMaps-endTimesSet NOT FOUND?!?"),this.startTimesSet.delete(n.time)?this.startTimesSet.add(o.time):console.log("updateEvtInScheduleMaps-startTimesSet NOT FOUND?!?",t,o),(this.currentDate==B()||!this.isViewingPast())&&(this.canEnableEditScore(t,r),this.enableEndNowBtn(t,o,r)),!0}else return console.log("updateEvtInScheduleMaps--euh not found?ERROR?",t,o),!1},evtIsOverlappingTimes(t,o,s,l){let i=this.getTimeyNumber(t),n=this.getTimeyNumber(o),a=this.getTimeyNumber(s),r=this.getTimeyNumber(l);if(i===!1||a===!1||n===!1||r===!1)return console.log("ERROR... evtIsOverlappingTimes error",i,n,a,r),!1;let d=!1;return i>a&&i<=r&&(d="bas"),n>a&&n<=r&&(d="haut"),(a>=i&&n>=r||i>a&&n<r)&&(d="surrounding"),d},hasOverlappingEvent(t,o,s){const l=[];let i=o,n=D(i,{minute:s});return this.dailyScheduled.forEach((a,r,d)=>{if(r!=t){let h=this.evtIsOverlappingTimes(i,n,a.start,a.end);h&&l.push({target:t,targetStart:i,direction:h,inConflict:r})}}),l},overlapCheckEvtsAdd(t){let o={};for(let s=0;s<t.length;s++){let l=t[s],i=D(M(l.date),{minute:A(l.time)}),n=this.hasOverlappingEvent(l.id,i,l.duration);if(n.length>0){console.log(`overlapCheckEvtsAdd at ${i.time} for ${l.id}:"${l.title.trim()}">>`,n.length);let a=0;do o[l.id]||(o[l.id]=[]),o[l.id].push(n[a]),a>0&&console.log("WOAH WOAH, multiple overlaps with same obj!",a,l,n[a]);while(++a<n.length)}else this.addEvtPropsIntoSchedule(l)}return o},updatedEvtDetails(t){let o=this.parentGoalsMap.get(t.parentGoal);return o?(t.bgcolor=o.bgcolor,t.details=`${o.title.trim()}: ${t==null?void 0:t.time} -- ${t==null?void 0:t.duration}min`):(console.log("ERROR?!? no parent goal for:",t),t.bgcolor="grey",t.details=`${t==null?void 0:t.title}: ${t==null?void 0:t.time} -- ${t==null?void 0:t.duration}min`,t.title=`Ad-hoc:${t==null?void 0:t.title}`),t},addPropsEventsTo(t,o){if(!o)return this.doNotify("addPropsEventsTo BUT no goals to schedule..."),[];let s=[];return o.forEach(l=>{let i=this.getLocalEvt(l.id);i?(i.duration=l.duration,i.time=l.time,i.date=t,s.push(this.updatedEvtDetails(i))):console.log("ERROR in addPropsEventsTo...Evt:not present!",l)}),s},changeEvtTime(t,o,s,l=!1){let i=this.getScheduledEvent(t),n=null;if(i)n=i.time;else if(console.log(`changeEventTime ADDIN...doAdd:${l} Evt:${t}`),l){if(i=this.getLocalEvt(t),!i)return console.log("ERROR in changeEvtTime STILL NOT found?!?",e,t,o,l),!1;n=i.time;let h=this.addPropsEventsTo(this.currentDate,[{...i,time:o.time}]);this.addEvtPropsIntoSchedule(h[0])}else return console.log("ERROR in changeEvtTime not found, not adding!",t,o,l),!1;let a=()=>{console.log(`changeEvtTime ${t} moving ${n} to ${o.time} with add?:${l}--${i.time}`),this.updateEvtInScheduleMaps(t,o),l||(i.time=o.time,this.updatedEvtDetails(i))},r=h=>(this.doSaveEvtProp(t,o.time,null),a(),h),d=`Evt '${i.title.trim()}' scheduled at ${n}. 
 Change default time to ${o.time}? 
 Cancel or Dismissing for Temporary add/move.`;if(console.log(`changeEventTime::${t}...skipAsk:${s} with evt canMove:${i==null?void 0:i.canMove} and inDef:${i==null?void 0:i.inDefaults}`),(i==null?void 0:i.inDefaults)||!(i!=null&&i.canMove))if(s)a();else{if(n==o.time){console.log("SAME TIME,no need to ask");return}this.timeChangeDialog("Default Time Change?",d,"Change","Temp.Add",function(){r(!0)},function(){a()})}else if(i!=null&&i.canMove)a();else{if(n==o.time){console.log("SAME TIME,no need to ask");return}this.timeChangeDialog("Cannot move Evt",d,"Change","Temp.Mve",function(){r(!0)},function(){console.log(`Keeping ${i.time} for ${i.id}`,o.time),a()})}},recurChangeTime(t,o,s,l=!1,i=!1){let n=this.dailyScheduled.get(t);if(n){let a=A(n.start.time)-A(s.time),r=`${a>0?"DOWN":"UP"}`,d=null;if(a>=0){d=D(s,{minute:parseInt(o.duration)+10});let S=D(s,{minute:parseInt(n.for)+10});console.log(`recurChangeTime:${t}...FORWARD ${r} for ${a} due to evt:${o.id} of dura:${o.duration} at ${s.time}.New>`,d.time,S.time,i,l)}else d=D(s,{minute:-(parseInt(n.for)+10)}),console.log(`recurChangeTime:${t}...BACKWARD ${r} for ${a} due to evt:${o.id} of dura:${o.duration} at ${s.time}.New`,d.time,i,l);let h=this.hasOverlappingEvent(t,d,n.for);if(h.length>0){console.log(`WARNING WARNING...more overlaps for ${t} at ${d.time}`,h);let S=0,p=h.length,u=this.getScheduledEvent(t);do{if(console.log(`CASCADING timeChange...doAdd?:${i}, skip:${l}`,h[S],n,u),h[S].inConflict==o.id){console.log("EUUUH...self overlap?!?",h[S]);break}this.recurChangeTime(h[S].inConflict,u,d,!0)}while(++S<p)}this.changeEvtTime(t,d,l),console.log(`recurChangeTime...skip:${l} OVERLAPPED:${t} moved ${r} to ${d.time}`);let c=s;this.changeEvtTime(o.id,c,l,i),console.log(`recurChangeTime...skip:${l}.A:${i} TARGET:${o.id} went ${r} to time>> ${c.time}`)}else console.log("ERROR..ERROR overlapped event not found!",t)},fixAnOverlap(t,o=null){var S;let s=[{label:"Choose by Priority",value:"opt1",color:"secondary"},{label:"Choose by Score",value:"opt2"},{label:"Choose one event",value:"opt3"}];const l=p=>p.title.trim()+" Priority = "+i(p)+" && Score:: "+p.score,i=p=>{if(p!=null&&p.parentGoal){let u=this.parentGoalsMap.get(p.parentGoal);return u==null?void 0:u.priority}return console.log("findhigherPrio..ERROR no PARENT found?",p),null},n=(p,u)=>{if(this.doRemove(p),console.log(`fixAnOverlap, removeReplace with ${u.title} at ${u.time} with ovrd:${o}`,t),u=this.addPropsEventsTo(t.targetStart.date,[{...u,time:t.targetStart.time}]),o){console.log("fixAnOverlap:removeReplace...override",JSON.parse(JSON.stringify(u))),this.updateEvtInScheduleMaps(u[0].id,t.targetStart),console.log("fixAnOverlap",this.startTimesSet,this.endTimesSet);return}this.addEvtPropsIntoSchedule(u[0])},a=(p,u,v)=>{var y;let T=v.direction=="haut";console.log("forceYAdd",JSON.parse(JSON.stringify(u)),JSON.parse(JSON.stringify(p)),v),u=this.addPropsEventsTo(this.currentDate,[u]),console.log(`forceAdd changing evt:${p.id} to ${(y=v==null?void 0:v.targetStart)==null?void 0:y.time} goFwd>>${T}`),this.recurChangeTime(p.id,u[0],v.targetStart,!0,!0)},r=p=>{this.doNotify(`Cancelling to keep "${p}"`,"positive","bottom")},d=p=>{this.doRemove(p)};let h=this.getLocalEvt(t.target),c=this.getScheduledEvent(t.inConflict);if(!c||!h){console.log("fixAnOverlap...ERROR no evts found!!",t);return}t.direction!=="surrounding"&&s.push({label:`Force in '${h.title.trim()}' at ${(S=t==null?void 0:t.targetStart)==null?void 0:S.time}`,value:"opt4"}),this.$q.dialog({title:"Warning--Resolve Overlap",cancel:!0,persistent:!0,message:`Event: '${h.title.trim()}' Overlaps with Scheduled '${c.title.trim()}'.
      
Resolve or Cancel to keep '${c.title.trim()}'`,options:{type:"radio",model:"opt1",items:s}}).onOk(p=>{if(p=="opt3"){let u="Pick one event...",v=[{label:l(h),value:h.id},{label:l(c),value:c.id}];this.radioChoiceDialog(u,v,function(T){if(T==h.id){n(c,h);return}else{console.log("by Event,chose scheduled",T,o),o&&d(h);return}},function(){r(c.title.trim()),o&&d(h)})}else if(p=="opt2"){let u="Pick event by Score",v=[{label:`"${h.title.trim()}" with Score:: ${h.score} = ${this.parseScore(h.score)}`,value:h.id},{label:`"${c.title.trim()}" with Score:: ${c.score} = ${this.parseScore(c.score)}`,value:c.id}];this.radioChoiceDialog(u,v,function(T){T==h.id?n(c,h):console.log("by Score, chose scheduled",T,o),o&&d(h)},function(){r(c.title.trim()),o&&d(h)})}else if(p=="opt1"){let u="Pick event by Priority",v=[{label:`"${h.title.trim()}" with Priority = ${i(h)}`,value:h.id},{label:`"${c.title.trim()}" with Priority = ${i(c)}`,value:c.id}];this.radioChoiceDialog(u,v,function(T){if(T==h.id){n(c,h);return}else{console.log("by Priority, chose scheduled",T,o),o&&d(h);return}},function(){r(c.title.trim()),o&&d(h)})}else a(c,h,t)}).onCancel(()=>{this.doNotify(`Keeping scheduled "${c.title.trim()}"`,"positive","bottom"),o&&(console.log("huh override... coolios removing",h.title.trim()),this.doRemove(h))}).onDismiss(()=>{})},handleOverlaps(t){if(t.length===0)return[];const o=t.pop();this.handleOverlaps(t),this.fixAnOverlap(o)},loadForDate(t,o,s){let l=(a,r)=>({id:parseInt(a),duration:r.duration,time:r.time}),i=()=>{let a=this.getEventsForDate(t);if(!a){console.log(`ERROR no evts found for ${t}...`,a);return}console.log("doLoadNotPresent:evts",JSON.parse(JSON.stringify(a)));let r=Object.keys(a).map(h=>l(h,a[h]));this.scheduledEvents=this.addPropsEventsTo(t,r);let d=this.updateCurrentSchedule();d.size>0&&!s?(console.log("doLoadNotPresent..FIX overlaps!!",d,t,s),this.doNotify(`${s?"past":"future"}: ${t} with Some overlaps to fix!`,"warning","bottom"),this.fixConflicts(d)):(this.showReloadBtn=!1,this.disableSaveSchedule=!0,this.doNotify(`Loaded schedule for ${s?"past":"future"}:: ${t}`,"positive","bottom"))},n=()=>{let a=this.getEventsForDate(t);if(!a){console.log(`ERROR no evts found for today:${t} ?!?`,a);return}console.log("OverlapCheckLoadToday:evts",JSON.parse(JSON.stringify(a)));let r=Object.keys(a).map(c=>l(c,a[c])),d=this.addPropsEventsTo(t,r);console.log(`OverlapCheckLoadToday ${t} loading:${d.length}`,this.scheduledEvents,this.dailyScheduled.size);let h=this.overlapCheckEvtsAdd(d);return Object.keys(h).length>0?this.doNotify(`${t} with Some overlaps to fix!`,"warning","bottom"):this.doNotify(`Loaded schedule for ${t}`,"positive","bottom"),h};if(this.scheduledEvents=[],this.updateCurrentSchedule(),o)if(this.isViewingToday()){let a=n();if(Object.keys(a).length>0){console.log("Overlaps toHandle >>",JSON.parse(JSON.stringify(a)));for(let r in a){if(!a[r]||!a[r][0]){console.log("loadForDate...ERROR no local found",r);continue}let d=a[r];this.handleOverlaps(d)}this.showReloadBtn=o,this.disableSaveSchedule=!1,this.evtStartedOrPassed(V(new Date)),this.resetButtons(o,s);return}this.evtStartedOrPassed(V(new Date)),this.disableSaveSchedule=!0}else i(),this.allowScoreEdit(s);else this.showReloadBtn=!1,this.disableSaveSchedule=!0;(s||t!==B())&&this.adjustCurrentTime(),console.log(`loadForDate...got here too fast? ${o} >> inPast:${s}`),this.reset(),this.resetButtons(o,s)},scheduleDefaults(t){let o=this.deepCopy(this.store.fetchDefaults()),s=this.isViewingToday(),l=this.isViewingPast();if(this.showReloadBtn=this.hasEventsForDate,this.resetButtons(!0,l),this.disableSaveSchedule=!(o.length>0),s){let i=this.addPropsEventsTo(this.currentDate,o);if(t=="add"){let a=i.length;i=i.filter(r=>!this.scheduledEvents.find(d=>d.id==r.id)),console.log(`scheduleDefaults..ADDIN from ${a} to `,i.length)}let n=this.overlapCheckEvtsAdd(i);if(Object.keys(n).length>0){console.log(`scheduleDefaults overlaps on:${this.currentDate} ${o.length} == ${i.length} ?!? of size:`,Object.keys(n).length);for(let a in n){if(!n[a]||!n[a][0]){console.log("scheduleDefaults...ERROR no local found",a);continue}let r=n[a];console.log(`scheduleDefaults::handlin...${a}`),this.handleOverlaps(r)}}this.evtStartedOrPassed(V(new Date));return}else{let i=this.addPropsEventsTo(this.currentDate,o);if(t=="add"){let a=i.length;i=i.filter(d=>!this.scheduledEvents.find(h=>h.id==d.id)),console.log(`scheduleDefaults..ADDIN to ${this.currentDate} of ${this.scheduledEvents.length} from ${a} to `,i.length);let r=this.scheduledEvents.concat(i);this.scheduledEvents=r}else this.scheduledEvents=i;let n=this.updateCurrentSchedule();console.log("doLoadDefault..sameStart?",n),l?this.allowScoreEdit(!0):this.allowScoreEdit(!1)}},deepCopy(t){if(t===null||typeof t!="object")return t;if(Array.isArray(t))return t.map(s=>this.deepCopy(s));const o={};for(let s in t)t.hasOwnProperty(s)&&(o[s]=this.deepCopy(t[s]));return o},onRefresh(t){setTimeout(()=>{this.scheduledEvents=[],this.updateCurrentSchedule(),this.resetGoalEvts(!0),this.loadForDate(this.currentDate,this.hasEventsForDate,this.isViewingPast()),t()},1e3)},doSaveSchedule(){let t={};this.dailyScheduled.size<1?t=null:this.dailyScheduled.forEach((o,s,l)=>{t[s]={duration:o.for,time:o.start.time}}),this.store.saveDailySchedule(this.currentDate,t),this.disableSaveSchedule=!0,this.showReloadBtn=!1,this.doNotify(`doSaveSchedule for ${this.currentDate}`,"positive","top")},onAddNewEvent(t,o,s,l){if(console.log("Adding Event eh...",t,o,s,l,this.possibleRange),this.possibleRange||(this.possibleRange=this.startEndTimes),t.trim()==""){this.doNotify("Empty Goal title..."),this.addEventDialog=!1,this.reset();return}let i=x(this.possibleRange[0]),n=l>15?D(i,{minute:parseInt(l)}):D(x(this.possibleRange[1]),{minute:15}),a=Math.floor(he(i,n)/1e3/60);console.log("With times as ",t,o,s),console.log(`from ${i.time} till ${n.time}.Duration:${a}`);let r=null;if(s=="self"){let d=this.store.addMainGoal(t,"","purple-10",2);d?(console.log("wooh SELF parent created",d),r=this.store.addSubGoal(d,t,"1on5",i.time,a,!0,!1)):console.log("ERROR? no pID",d)}else if(o){r=this.store.addSubGoal(o.id,t,"1on5",i.time,a,!1,!1);//!canMove and notInDefaults
}else{let d=this.store.getGoalByTitle("Misc");if(d){console.log("Woo found Misc pgoal",d),r=this.store.addSubGoal(d.id,t,"1on5",i.time,a,!1,!1);//!canMove and notInDefaults
}else{let h=this.store.addMainGoal("Misc","Miscellaneous","grey-10",2);h&&(console.log("No Misc pgoal...created",h),r=this.store.addSubGoal(h,t,"1on5",i.time,a,!0,!1))}}if(r){this.resetGoalEvts(!0);let d=this.hasOverlappingEvent(r,i,a);if(d.length>0)for(let h=0;h<d.length;h++){let c=d[h];console.log("onAddNewEvt, OVERLAPS handling",c),this.fixAnOverlap(c)}else{let h=this.addPropsEventsTo(this.currentDate,[{id:r,time:i.time,title:t,score:"1on5",duration:a,canMove:!o}]);console.log(`onAddNewEvt, addEvtPropsIntoSchedule: ${r} at ${i.time}`),this.addEvtPropsIntoSchedule(h[0])}this.disableSaveSchedule=!1,this.showReloadBtn=this.hasEventsForDate}else console.log("BOO ERROR no subID:(",r),this.doNotify("Error adding this event :(","negative");this.addEventDialog=!1,this.reset()},onChooseEvent(){this.addEventDialog=!1,this.pickEventDialog=!0},onPickEvent(){if(this.pickEventDialog=!1,!this.toAddE){console.log("onPickEvent...ERROR nill",this.toAddE);return}let t=this.getScheduledEvent(this.toAddE.id);if(t){console.log("onPickEvent...NOT NEW?!?ERROR!",t,this.toAddE);return}else{t=this.toAddE;let o=this.isViewingPast()?!0:this.force;console.log(`onPickEvent...adding ${t.id}:${t.title.trim()} from ${t.time} to ${this.targetDrop.timestamp.time} with force?${this.force} BUT Forcing:${o}`);let s=this.hasOverlappingEvent(t.id,this.targetDrop.timestamp,t.duration),l=s.length;if(l>0){console.log(`onPickEvent::hasOverlappingEvent of size: ${l} with force flag:${this.force} while viewing in past?${this.isViewingPast()} and force:${o}`);let i=0;do this.recurChangeTime(s[i].inConflict,t,this.targetDrop.timestamp,o,!0);while(++i<l)}else this.changeEvtTime(t.id,this.targetDrop.timestamp,o,!0)}console.log(`onPickEvent for ${t.id} complete with force:${this.force}`,this.scheduledEvents.length),this.disableSaveSchedule=!1,this.showReloadBtn=this.hasEventsForDate,this.reset()},onEndNow(t){const o=V(new Date);let s=this.hasEventsForDate;if(this.dailyScheduled.has(t)){let l=this.dailyScheduled.get(t),i=l.start,n=l.end;if(J(o,i,n,!0)){let a=this.getTimeNumber(n)-this.getTimeNumber(i),r=this.getTimeNumber(o)-this.getTimeNumber(i);console.log(`Great, ${t} REDUCING duration from ${a} to:`,r);for(let d=0;d<this.scheduledEvents.length;d++){let h=this.scheduledEvents[d];h.id===t&&(h.duration=r)}this.dailyScheduled.set(t,{...l,for:r,end:o}),this.endTimesSet.delete(n.time)||console.log("ERROR endTimesSet item does not exist?!?",l,this.endTimesSet),this.endTimesSet.add(o.time)}else console.log("umm aint in the middle of this event! Nothing to do...ERROR?",o.time,i.time,n.time)}else{console.log("ERROR doEndNow not found!!!",t);return}this.disabledScoreEvts[t]=!1,this.disableSaveSchedule=!1,this.showReloadBtn=s},onSaveScore(t,o){let s=this.dailyScheduled.get(o);if(s){s.score=t,this.doSaveEvtProp(o,null,t);let i=(n=>this.scheduledEvents.find(a=>a.id==n))(o);i?i.score=t:console.log("onSaveScore ERROR not found",i,o)}else console.log(`ERROR onSaveScore could not find event ${o}?!?`)},onReloadSaved(){let t=this.hasEventsForDate,o=()=>{console.log("Aborting",this.currentDate,this.scheduledEvents,t),this.showReloadBtn=!this.isViewingPast()||t},s=()=>{this.scheduledEvents=[],this.updateCurrentSchedule(),this.loadForDate(this.currentDate,t,this.isViewingPast()),this.reset()};this.scheduledEvents.length>0?this.confirmAction("Overwrite current Evts?",s,o):s(),this.showReloadBtn=!1},onLoadDefault(){let t=()=>{console.log("Aborting",this.currentDate)},o=s=>{this.scheduleDefaults(s)};if(this.scheduledEvents.length>0){let s=[{label:"Add Defaults to current day schedule",value:"add"},{label:"Overwrite and only schedule Defaults",value:"overwrite"}];this.radioChoiceDialog("Currently have scheduled Events...",s,function(l){console.log("OK LoadDefaults",l),o(l)},t)}else o("overwrite")},choosePrio(t){let o=this.chosenPrio;o&&o==t?this.disablePrioBtn=!0:(this.chosenPrio=t,this.disablePrioBtn=!1)},chooseScore(t){let o=this.chosenScore;o&&o==t?this.disableScoreBtn=!0:(this.chosenScore=t,this.disableScoreBtn=!1)},findSamePrio(t){const o=()=>this.scheduledEvents.filter(i=>{var n;return((n=this.parentGoalsMap.get(i.parentGoal))==null?void 0:n.priority)==this.chosenPrio});let s=[],l=this.isViewingToday();if(t=="overwrite"||t=="add"){let i=this.deepCopy(this.storedEvents);for(let n of i){let a=this.parentGoalsMap.get(n.parentGoal);(a==null?void 0:a.priority)==this.chosenPrio&&s.push(n)}t=="add"?s=s.filter(n=>!this.scheduledEvents.find(a=>a.id==n.id)):(this.scheduledEvents=[],this.updateCurrentSchedule()),console.log(`findSamePrio...ADDIN to size: ${this.scheduledEvents.length}`,JSON.parse(JSON.stringify(s)))}else s=o(),console.log("findSamePrio..filtering!!",this.chosenPrio,s);if(l&&t!="filter"){s=this.addPropsEventsTo(this.currentDate,s);let i=this.overlapCheckEvtsAdd(s);if(Object.keys(i).length>0){console.log(`findSamePrio${this.chosenPrio}...overlaps`,JSON.parse(JSON.stringify(i)));for(let n in i){if(!i[n]||!i[n][0]){console.log("findSamePrio...ERROR no local found",n);continue}let a=i[n];console.log(`findSamePrio >>handlin...${n}`),this.handleOverlaps(a)}return}else console.log("findSamePrio >>No overlaps!!...",JSON.parse(JSON.stringify(s))),this.updateCurrentSchedule()}else{if(console.log("findSamePrio...NOT TODAY!?",this.currentDate),t=="filter")this.scheduledEvents=s;else if(s=this.addPropsEventsTo(this.currentDate,s),t=="add"){let i=this.scheduledEvents.concat(s);this.scheduledEvents=i}else this.scheduledEvents=s;this.updateCurrentSchedule()}if(!this.scheduledEvents.length>0){this.doNotify(`Empty for Priority == ${this.chosenPrio} :(`,"warning","bottom"),this.disableSaveSchedule=!0,this.showReloadBtn=this.hasEventsForDate;return}this.disableSaveSchedule=!1,this.showReloadBtn=this.hasEventsForDate},onReloadWithPrio(){if(this.chosenPrio==null){this.doNotify("Ayo select a priority!");return}let t=()=>{console.log("onReloadWithPrio..cancelling"),this.reset()};if(this.scheduledEvents.length>0){let o=[{label:`Filter current by priority == ${this.chosenPrio}`,value:"filter"},{label:`Add to current Evts with priority == ${this.chosenPrio}`,value:"add"},{label:`Overwrite and schedule All by priority == ${this.chosenPrio}`,value:"overwrite"}];this.radioChoiceDialog("Schedule change...",o,this.findSamePrio,t)}else this.findSamePrio("overwrite");this.resetButtons(this.hasEventsForDate,this.isViewingPast()),this.disablePrioBtn=!0},reloadEvtsWithScore(t){const o=()=>{let i=[];return this.scheduledEvents.forEach(n=>{let a=this.parseScore(n.score);a>-1&&a>=this.chosenScore&&i.push(n)}),i};let s=[],l=this.isViewingToday();if(t=="overwrite"||t=="add"){const i=this.store.fetchGoalsWithMinScore(this.chosenScore);console.log("reloadEvtsWithScore SCORE",JSON.parse(JSON.stringify(i))),t=="add"?s=i.filter(n=>!this.scheduledEvents.find(a=>a.id==n.id)):(s=i,this.scheduledEvents=[],this.updateCurrentSchedule())}else s=o(),console.log(`reloadEvtsWithScore AFTER flag ${t}`,JSON.parse(JSON.stringify(s)),JSON.parse(JSON.stringify(this.scheduledEvents)));if(console.log(`reloadEvtsWithScore>'${t}'::${this.chosenScore}`,this.currentDate,this.scheduledEvents.length),l&&t!="filter"){console.log("reloadEvtsWithScore...checking TODAY!"),s=this.addPropsEventsTo(this.currentDate,s),console.log(`reloadEvtsWithScore::addPropsEventsTo for ${t}`,JSON.parse(JSON.stringify(s)),JSON.parse(JSON.stringify(this.scheduledEvents)));let i=this.overlapCheckEvtsAdd(s);if(Object.keys(i).length>0){console.log(`onReloadWithScore ${this.chosenScore}...overlaps!!`,JSON.parse(JSON.stringify(i)));for(let n in i){if(!i[n]||!i[n][0]){console.log("onReloadWithScore...ERROR no local found",n);continue}let a=i[n];console.log(`onReloadWithScore >>handlin...${n}`),this.handleOverlaps(a)}return}else console.log("onReloadWithScore >>NO OVERLAPS!!!...",JSON.parse(JSON.stringify(s))),this.updateCurrentSchedule()}else{if(t=="filter")this.scheduledEvents=s;else if(s=this.addPropsEventsTo(this.currentDate,s),t=="add"){let i=this.scheduledEvents.concat(s);this.scheduledEvents=i}else this.scheduledEvents=s;this.updateCurrentSchedule()}if(!this.scheduledEvents.length>0){this.doNotify(`Empty for Score >= ${this.chosenScore} :(`,"warning","bottom"),this.disableSaveSchedule=!0,this.showReloadBtn=this.hasEventsForDate;return}this.disableSaveSchedule=!1,this.showReloadBtn=this.hasEventsForDate},onReloadWithScore(){if(this.chosenScore==null){this.doNotify("Ayo select a score!");return}let t=()=>{console.log("onReloadWithScore..cancelling",this.scheduledEvents),this.reset()};if(this.scheduledEvents.length>0){let o=[{label:`Filter current by Interval Score >= ${this.chosenScore}`,value:"filter"},{label:`Add to current Evts with Interval Score >= ${this.chosenScore}`,value:"add"},{label:`Overwrite and schedule All by Interval Score >= ${this.chosenScore}`,value:"overwrite"}];this.radioChoiceDialog("Schedule change...",o,this.reloadEvtsWithScore,t)}else this.reloadEvtsWithScore("overwrite");this.resetButtons(this.hasEventsForDate,this.isViewingPast()),this.disableScoreBtn=!0},onChange(t){this.loadForDate(t.start,this.hasEventsForDate,this.isViewingPast())},onDragStart(t,o){if(this.isViewingPast()){this.doNotify("Editing past is no no!"),t.preventDefault();return}this.draggedItem=o},onDragEnter(t,o,s){return o==="goal-item"||(this.targetDrop=s),t.preventDefault(),!0},onDragOver(t,o,s){return t.preventDefault(),!0},onDragLeave(t,o,s){return!1},onDragEnd(t){console.log("onDragEnd",this.startTimesSet,this.endTimesSet)},onDrop(t,o,s){let l=this.getScheduledEvent(this.draggedItem.id);if(!l){console.log("onDrop ERROR",l,this.draggedItem);return}let i=null;if(o==="interval")console.log("onDrop to time-interval",s.timestamp.time,l.title.trim()),i=s.timestamp;else if(o==="goal-item"&&this.targetDrop)console.log("Dropping goal-item!!",o,this.targetDrop.timestamp),i=this.targetDrop.timestamp;else{console.log("Cannot drop here YO!!",t,o,s,this.targetDrop);return}if(!i){console.log("ERROR...no timestamp YO!!",t,o,s,this.targetDrop);return}let n=this.hasOverlappingEvent(l.id,i,l.duration),a=n.length;if(a>0){console.log("onDrop...overlapp!",n);let r=0;do{if(n[r].inConflict==n[r].target){console.log("EUUUH...self overlap?!?",n);break}n[r].direction=="surrounding"?this.fixAnOverlap(n[r],!0):this.recurChangeTime(n[r].inConflict,l,i,!0)}while(++r<a)}else this.changeEvtTime(l.id,i,!1),console.log("onDrop no overlap complete",l.id,i.time);this.disableSaveSchedule=!1,this.showReloadBtn=this.hasEventsForDate},onDblClickEvent(t,o){if(this.isViewingPast()){this.doNotify("Removing from the past is a no no!"),t.preventDefault();return}this.removeEvtInSchedule(o)},onClickDate(t){console.log("onClickDate",t)},onClickTime(t){this.addEventDialog=!0,this.targetDrop=t.scope},onClickInterval(t){console.log("onClickInterval",t)},onClickHeadIntervals(t){console.log("onClickHeadIntervals",t)},onClickHeadDay(t){console.log("onClickHeadDay",t)},onMouseEnter(t){console.log("onMouseAt",t)},onMouseLeave(t){console.log("onMouseLeave",JSON.stringify(t))},onMouseDownTime({scope:t,event:o}){if(fe(o)){if(console.log("onMouseDownTime and its a leftClick event"),this.mobile===!0&&this.anchorTimestamp!==null&&this.otherTimestamp!==null&&P(this.anchorTimestamp)===P(this.otherTimestamp)){this.otherTimestamp=t.timestamp,this.mouseDown=!1;return}this.mouseDown=!0,this.anchorTimestamp=t.timestamp,this.otherTimestamp=t.timestamp}},onMouseUpTime({scope:t,event:o}){if(this.mobile!==!0&&fe(o)&&(this.otherTimestamp=t.timestamp,this.mouseDown=!1),!this.mousedown){let s=this.startEndTimes;if(s[1]==s[0])return;this.possibleRange=s,console.log("onMouseUpTime range change",this.possibleRange)}},onMouseMoveTime({scope:t,event:o}){this.mobile!==!0&&this.mouseDown===!0&&(this.otherTimestamp=t.timestamp)},scrollToEvent(t){this.$refs.calendar.scrollToTime(t.time,350)},onToday(){let t=()=>{this.$refs.calendar.moveToToday()},o=()=>{setTimeout(t,1e3),this.doSaveSchedule()};this.disableSaveSchedule?t():this.confirmAction("Save schedule changes?",o,t)},onPrev(){console.log("onPrev",this.currentDate);let t=()=>{this.$refs.calendar.prev()},o=()=>{setTimeout(t,1e3),this.doSaveSchedule()};this.disableSaveSchedule?t():this.confirmAction("Save schedule changes?",o,t)},onNext(){let t=()=>{this.$refs.calendar.next()},o=()=>{setTimeout(t,1e3),this.doSaveSchedule()};this.disableSaveSchedule?t():this.confirmAction("Save schedule changes?",o,t)}}}),se=t=>(ve("data-v-0874ba94"),t=t(),Se(),t),Pt={key:0,class:"q-gutter-md"},kt={key:1,class:"subcontent"},Nt={class:"float-right"},Bt={key:0},At={key:1},Mt={key:2},Vt={key:3},_t={class:"row justify-center"},Gt={style:{display:"flex","max-width":"800px",width:"100%",height:"400px"}},It={style:{display:"flex","justify-content":"center","flex-wrap":"wrap",padding:"2px"}},qt={class:"title q-calendar__ellipsis"},Ft=["onDblclick","onDragstart"],Ht=se(()=>w("div",{class:"text-h6"},"Ad hoc or Existing event",-1)),Lt={class:"q-ml-md event-select"},Qt=se(()=>w("div",{class:"text-h3"},"Select event",-1)),Ut={class:"q-ml-md event-select"},Wt={class:"row justify-center"},Jt=se(()=>w("br",null,null,-1)),jt={class:"q-pa-xl bg-grey-9",style:{"max-width":"400px"}};function zt(t,o,s,l,i,n){const a=N("add-goal-form"),r=N("navigation-bar"),d=N("sched-btn"),h=N("sched-drop-btn"),c=N("goaly-end"),S=N("q-calendar-day"),p=N("ad-hoc-event");return b(),C(_,null,[t.showForm?(b(),C("div",Pt,[f(O,{class:"q-pl-xl justify-center",color:"","text-color":"green",elevated:"",label:"HideForm",onClick:o[0]||(o[0]=u=>t.showGoalForm=!t.showGoalForm),"no-caps":""}),f(a)])):k("",!0),t.showForm?k("",!0):(b(),C("div",kt,[f(We,{onRefresh:t.onRefresh},{default:E(()=>[f(r,{onToday:t.onToday,onPrev:t.onPrev,onNext:t.onNext},null,8,["onToday","onPrev","onNext"]),w("div",Nt,[t.showReloadBtn?(b(),C("div",Bt,[f(d,{"text-label":"Reload",class:"q-mt-xl","text-color":"green",onDoBtnAction:t.onReloadSaved},null,8,["onDoBtnAction"])])):k("",!0),t.loadDefault?(b(),C("div",At,[f(d,{"text-label":"Defaults",class:"q-mt-xl","text-color":"blue",onDoBtnAction:t.onLoadDefault},null,8,["onDoBtnAction"])])):k("",!0),t.showScoreBtn?(b(),C("div",Mt,[f(h,{class:"q-mt-xl","text-color":"teal",disableBtn:t.disableScoreBtn,optionLabel:t.chosenScoreLabel,daOptions:t.scoreOptions,onDoReload:t.onReloadWithScore,onChooseOption:t.chooseScore},null,8,["disableBtn","optionLabel","daOptions","onDoReload","onChooseOption"])])):k("",!0),t.showPrio?(b(),C("div",Vt,[f(h,{class:"q-mt-xl","text-color":"teal",disableBtn:t.disablePrioBtn,optionLabel:t.chosenPrioLabel,daOptions:t.setGoalsPrio(),onDoReload:t.onReloadWithPrio,onChooseOption:t.choosePrio},null,8,["disableBtn","optionLabel","daOptions","onDoReload","onChooseOption"])])):k("",!0)])]),_:1},8,["onRefresh"]),w("div",_t,[w("div",Gt,[f(S,{ref:"calendar",view:"day",modelValue:t.currentDate,"onUpdate:modelValue":o[5]||(o[5]=u=>t.currentDate=u),"drag-enter-func":t.onDragEnter,"drag-over-func":t.onDragOver,"drag-leave-func":t.onDragLeave,"drop-func":t.onDrop,animated:"",bordered:"",hoverable:"","no-active-date":"","transition-next":"slide-left","transition-prev":"slide-right","time-clicks-clamped":"","interval-minutes":15,"interval-count":96,"interval-height":28,"selected-start-end-dates":t.startEndTimes,onChange:t.onChange,onClickDate:t.onClickDate,onClickTime:t.onClickTime,onClickInterval:t.onClickInterval,onClickHeadIntervals:t.onClickHeadIntervals,onClickHeadDay:t.onClickHeadDay,onMousedownTime:t.onMouseDownTime,onMouseupTime:t.onMouseUpTime,onMousemoveTime:t.onMouseMoveTime},{"head-day-event":E(({scope:{timestamp:u}})=>[w("div",It,[(b(!0),C(_,null,te(t.eventsMap[u.date],v=>(b(),C(_,{key:v.id},[v.time?(b(),G(re,{key:1,class:Z(t.badgeClasses(v,"header")),style:q([t.badgeStyles(v,"header"),{margin:"1px",width:"10px","max-width":"10px",height:"10px","max-height":"10px",cursor:"pointer"}]),onClick:T=>t.scrollToEvent(v)},{default:E(()=>[f(oe,null,{default:E(()=>[H(I(v.time+" - "+v.title),1)]),_:2},1024)]),_:2},1032,["class","style","onClick"])):(b(),G(re,{key:0,class:Z(t.badgeClasses(v,"header")),style:q([t.badgeStyles(v,"header"),{width:"100%",cursor:"pointer",height:"12px","font-size":"10px",margin:"1px"}])},{default:E(()=>[w("div",qt,[H(I(v.title)+" ",1),f(oe,null,{default:E(()=>[H(I(v.details),1)]),_:2},1024)])]),_:2},1032,["class","style"]))],64))),128))])]),"day-container":E(({scope:{days:u}})=>[t.hasDate(u)?(b(),C(_,{key:0},[w("div",{class:"day-view-current-time-indicator",style:q(t.style)},null,4),w("div",{class:"day-view-current-time-line",style:q(t.style)},null,4)],64)):k("",!0)]),"day-body":E(({scope:{timestamp:u,timeStartPos:v,timeDurationHeight:T}})=>[(b(!0),C(_,null,te(t.getDateEvents(u.date),y=>(b(),C(_,{key:y.id},[y.time!==void 0?(b(),C("div",{key:0,class:Z(["my-event",t.badgeClasses(y,"body")]),style:q(t.badgeStyles(y,"body",v,T)),draggable:!0,onDblclick:j(R=>t.onDblClickEvent(R,y),["prevent"]),onDragstart:j(R=>t.onDragStart(R,y),["stop"]),onDragend:o[1]||(o[1]=j((...R)=>t.onDragEnd&&t.onDragEnd(...R),["stop"])),onDrop:o[2]||(o[2]=R=>t.onDrop(R,"goal-item",t.scope)),onDragenter:o[3]||(o[3]=R=>t.onDragEnter(R,"goal-item",t.scope)),onDragover:o[4]||(o[4]=R=>t.onDragOver(R,"goal-item",t.scope))},[f(c,{disabledScore:t.disabledScoreEvts[y.id],title:y.title,id:y.id,startTime:y.time,score:y.score,details:y.details,happeningNow:t.hasStarted[y.id]?t.hasStarted[y.id]:!1,onEndNow:t.onEndNow,onSaveScore:t.onSaveScore,onDeleteNow:R=>t.removeEvtInSchedule(y,R)},null,8,["disabledScore","title","id","startTime","score","details","happeningNow","onEndNow","onSaveScore","onDeleteNow"])],46,Ft)):k("",!0)],64))),128))]),_:1},8,["modelValue","drag-enter-func","drag-over-func","drag-leave-func","drop-func","selected-start-end-dates","onChange","onClickDate","onClickTime","onClickInterval","onClickHeadIntervals","onClickHeadDay","onMousedownTime","onMouseupTime","onMousemoveTime"])]),f(ne,{modelValue:t.addEventDialog,"onUpdate:modelValue":o[8]||(o[8]=u=>t.addEventDialog=u),"transition-show":"rotate","transition-hide":"rotate"},{default:E(()=>[t.adHocEventDialog?(b(),G(X,{key:0},{default:E(()=>[f(ae,null,{default:E(()=>[Ht]),_:1}),f(Y,{align:"center"},{default:E(()=>[f(O,{flat:"",label:"Add hoc",color:"primary",onClick:o[6]||(o[6]=u=>t.adHocEventDialog=!t.adHocEventDialog)}),f(O,{flat:"",label:"Existing",color:"primary",onClick:t.onChooseEvent},null,8,["onClick"])]),_:1})]),_:1})):(b(),G(X,{key:1},{default:E(()=>[w("div",Lt,[f(p,{mainGoals:t.storedMainG,onSaveEvent:t.onAddNewEvent},null,8,["mainGoals","onSaveEvent"]),f(O,{flat:"",label:"Cancel",color:"primary",onClick:o[7]||(o[7]=u=>t.adHocEventDialog=!t.adHocEventDialog)})])]),_:1}))]),_:1},8,["modelValue"]),f(ne,{modelValue:t.pickEventDialog,"onUpdate:modelValue":o[11]||(o[11]=u=>t.pickEventDialog=u),"transition-show":"rotate","transition-hide":"rotate"},{default:E(()=>[f(X,null,{default:E(()=>[f(ae,null,{default:E(()=>[Qt]),_:1}),f(ge),w("div",Ut,[f(we,{modelValue:t.toAddE,"onUpdate:modelValue":o[9]||(o[9]=u=>t.toAddE=u),options:t.canbeScheduled,"option-value":"id","option-label":"title",label:"Sub Goal","item-aligned":"",popupContentClass:"q-gutter-md"},null,8,["modelValue","options"])]),f(Y,{align:"center"},{default:E(()=>[f(Ie,{dense:"",modelValue:t.force,"onUpdate:modelValue":o[10]||(o[10]=u=>t.force=u),label:"Force",color:"teal",class:"q-pa-sm"},null,8,["modelValue"])]),_:1}),f(Y,{align:"evenly"},{default:E(()=>[f(O,{elevated:"",label:"Add",color:"primary",class:"q-mr-md",onClick:t.onPickEvent},null,8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),w("div",Wt,[f(O,{class:"q-mt-xl",color:"Green","text-color":"blue",elevated:"",label:"SaveSchedule",disable:t.doDisableSaveSchedule,onClick:t.doSaveSchedule,"no-caps":""},null,8,["disable","onClick"]),f(O,{class:"q-mt-xl",color:"","text-color":"green",elevated:"",label:"ShowForm",onClick:o[12]||(o[12]=u=>t.showGoalForm=!t.showGoalForm),"no-caps":""})]),Jt,w("div",jt,[f(Ye,{nodes:t.treeGoals,"node-key":"label",expanded:t.expanded,"onUpdate:expanded":o[13]||(o[13]=u=>t.expanded=u),"no-connectors":"",dense:"","default-expand-all":""},null,8,["nodes","expanded"])])]))],64)}var so=U($t,[["render",zt],["__scopeId","data-v-0874ba94"]]);export{so as default};
