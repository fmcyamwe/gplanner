import{j as Be,U as Le,W as Ie,r as A,c as z,w as be,n as xe,h as ie,k as ue,ay as Ge,D as Ve,g as Fe,az as He,ac as fe,v as Je,aA as je,a9 as le,aC as Oe,aa as ge,Z as Ue,_ as qe,$ as Q,L as H,E as R,F as J,G as N,M as $,H as C,O as M,I as _,N as Ee,K as G,J as B,a1 as K,Q as Te,a2 as se,a3 as j,bf as We,P as De,R as ee,a5 as te,a4 as Y,aU as me,f as ze,a6 as Qe,a7 as Ke}from"./index.cd2fe454.js";import{w as L,i as de,p as Ye,a as Xe,b as Ze,Q as ne,c as Ce}from"./utiFunc.3e05ecca.js";import{T as et,Q as tt,a as ot}from"./QSelect.07e70076.js";import{t as oe,E as we,b as x,a as w,p as V,i as re,c as pe,d as F,U,V as it,m as ye,l as X,Q as lt,e as st}from"./QCalendarTask.5c574253.js";import{c as Se,u as nt,a as rt}from"./goalStorage.709f87a9.js";import{a as at}from"./QCalendar.886796b7.js";/* empty css                             */import"./touch.70a9dd44.js";import"./QItem.ed35dda2.js";var Re=Be({name:"QSplitter",props:{...Le,modelValue:{type:Number,required:!0},reverse:Boolean,unit:{type:String,default:"%",validator:i=>["%","px"].includes(i)},limits:{type:Array,validator:i=>i.length!==2||typeof i[0]!="number"||typeof i[1]!="number"?!1:i[0]>=0&&i[0]<=i[1]},emitImmediately:Boolean,horizontal:Boolean,disable:Boolean,beforeClass:[Array,String,Object],afterClass:[Array,String,Object],separatorClass:[Array,String,Object],separatorStyle:[Array,String,Object]},emits:["update:modelValue"],setup(i,{slots:e,emit:t}){const{proxy:{$q:o}}=Fe(),l=Ie(i,o),s=A(null),n={before:A(null),after:A(null)},r=z(()=>`q-splitter no-wrap ${i.horizontal===!0?"q-splitter--horizontal column":"q-splitter--vertical row"} q-splitter--${i.disable===!0?"disabled":"workable"}`+(l.value===!0?" q-splitter--dark":"")),d=z(()=>i.horizontal===!0?"height":"width"),p=z(()=>i.reverse!==!0?"before":"after"),O=z(()=>i.limits!==void 0?i.limits:i.unit==="%"?[10,90]:[50,1/0]);function b(a){return(i.unit==="%"?a:Math.round(a))+i.unit}const m=z(()=>({[p.value]:{[d.value]:b(i.modelValue)}}));let y,E,T,S,g;function D(a){if(a.isFirst===!0){const v=s.value.getBoundingClientRect()[d.value];y=i.horizontal===!0?"up":"left",E=i.unit==="%"?100:v,T=Math.min(E,O.value[1],Math.max(O.value[0],i.modelValue)),S=(i.reverse!==!0?1:-1)*(i.horizontal===!0?1:o.lang.rtl===!0?-1:1)*(i.unit==="%"?v===0?0:100/v:1),s.value.classList.add("q-splitter--active");return}if(a.isFinal===!0){g!==i.modelValue&&t("update:modelValue",g),s.value.classList.remove("q-splitter--active");return}const f=T+S*(a.direction===y?-1:1)*a.distance[i.horizontal===!0?"y":"x"];g=Math.min(E,O.value[1],Math.max(O.value[0],f)),n[p.value].value.style[d.value]=b(g),i.emitImmediately===!0&&i.modelValue!==g&&t("update:modelValue",g)}const h=z(()=>[[et,D,void 0,{[i.horizontal===!0?"vertical":"horizontal"]:!0,prevent:!0,stop:!0,mouse:!0,mouseAllDir:!0}]]);function c(a,f){a<f[0]?t("update:modelValue",f[0]):a>f[1]&&t("update:modelValue",f[1])}return be(()=>i.modelValue,a=>{c(a,O.value)}),be(()=>i.limits,()=>{xe(()=>{c(i.modelValue,O.value)})}),()=>{const a=[ie("div",{ref:n.before,class:["q-splitter__panel q-splitter__before"+(i.reverse===!0?" col":""),i.beforeClass],style:m.value.before},ue(e.before)),ie("div",{class:["q-splitter__separator",i.separatorClass],style:i.separatorStyle,"aria-disabled":i.disable===!0?"true":void 0},[Ge("div",{class:"q-splitter__separator-area absolute-full"},ue(e.separator),"sep",i.disable!==!0,()=>h.value)]),ie("div",{ref:n.after,class:["q-splitter__panel q-splitter__after"+(i.reverse===!0?"":" col"),i.afterClass],style:m.value.after},ue(e.after))];return ie("div",{class:r.value,ref:s},Ve(e.default,a))}}}),dt=He({name:"touch-hold",beforeMount(i,e){const{modifiers:t}=e;if(t.mouse!==!0&&fe.has.touch!==!0)return;const o={handler:e.value,noop:Je,mouseStart(s){typeof o.handler=="function"&&je(s)===!0&&(le(o,"temp",[[document,"mousemove","move","passiveCapture"],[document,"click","end","notPassiveCapture"]]),o.start(s,!0))},touchStart(s){if(s.target!==void 0&&typeof o.handler=="function"){const n=s.target;le(o,"temp",[[n,"touchmove","move","passiveCapture"],[n,"touchcancel","end","notPassiveCapture"],[n,"touchend","end","notPassiveCapture"]]),o.start(s)}},start(s,n){o.origin=Oe(s);const r=Date.now();fe.is.mobile===!0&&(document.body.classList.add("non-selectable"),Se(),o.styleCleanup=d=>{o.styleCleanup=void 0;const p=()=>{document.body.classList.remove("non-selectable")};d===!0?(Se(),setTimeout(p,10)):p()}),o.triggered=!1,o.sensitivity=n===!0?o.mouseSensitivity:o.touchSensitivity,o.timer=setTimeout(()=>{o.timer=void 0,Se(),o.triggered=!0,o.handler({evt:s,touch:n!==!0,mouse:n===!0,position:o.origin,duration:Date.now()-r})},o.duration)},move(s){const{top:n,left:r}=Oe(s);o.timer!==void 0&&(Math.abs(r-o.origin.left)>=o.sensitivity||Math.abs(n-o.origin.top)>=o.sensitivity)&&(clearTimeout(o.timer),o.timer=void 0)},end(s){ge(o,"temp"),o.styleCleanup!==void 0&&o.styleCleanup(o.triggered),o.triggered===!0?s!==void 0&&Ue(s):o.timer!==void 0&&(clearTimeout(o.timer),o.timer=void 0)}},l=[600,5,7];if(typeof e.arg=="string"&&e.arg.length>0&&e.arg.split(":").forEach((s,n)=>{const r=parseInt(s,10);r&&(l[n]=r)}),[o.duration,o.touchSensitivity,o.mouseSensitivity]=l,i.__qtouchhold=o,t.mouse===!0){const s=t.mouseCapture===!0||t.mousecapture===!0?"Capture":"";le(o,"main",[[i,"mousedown","mouseStart",`passive${s}`]])}fe.has.touch===!0&&le(o,"main",[[i,"touchstart","touchStart",`passive${t.capture===!0?"Capture":""}`],[i,"touchend","noop","notPassiveCapture"]])},updated(i,e){const t=i.__qtouchhold;t!==void 0&&e.oldValue!==e.value&&(typeof e.value!="function"&&t.end(),t.handler=e.value)},beforeUnmount(i){const e=i.__qtouchhold;e!==void 0&&(ge(e,"main"),ge(e,"temp"),e.timer!==void 0&&clearTimeout(e.timer),e.styleCleanup!==void 0&&e.styleCleanup(),delete i.__qtouchhold)}});const ct=()=>!!/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);let Z,k;function ht(){Z={},k=nt()}function ut(){Z.pGoalsMap==null;const i=new Map;let e=$e();return e?(e.forEach(t=>{i.set(t.id,t)}),Z.pGoalsMap=i,i):(console.log("Repo:: parentGoalsMap is empty or null",e),i)}function ft(i){return k.hasEventsForDate(i)}function Ne(i){return k.getEventsForDate(i)}function $e(){return k.getMainGoals}function gt(){return Z.subGoals==null&&(Z.subGoals=k.getSubGoals),Z.subGoals}function mt(){return k.fetchAlternativeEvts()}function St(){return k.currentBalance()}function pt(){return k.fetchGoalsTree()}function yt(){let i=k.fetchAllPrio();return!i.size>0?(console.log("ERROR...no Priority goals?",i),[]):Array.from(i.values()).sort()}function vt(i){return k.fetchGoalsUpToMaxScore(i)}function Ae(i,e=null,t=null){k.saveSubProp(i,e,t)}function bt(){return k.getGoalByTitle("Misc")}function Pe(i){k.setBalance(i)}function Me(i,e){k.saveDailySchedule(i,e)}function Ot(i,e,t,o){return k.addMainGoal(i,e,t,o)}function ae(i,e,t,o,l,s,n,r,d){return k.addSubGoal(i,e,t,o,l,s,n,r,d)}function Et(i,e,t=null){let o=i,l=e.id,s=e,n=t,r=i.duration,d=i.time,p=null,O=null;return{id:l,duration:r,time:d,date:()=>p,datey:b,score:m(),getGoal:()=>s,getPGoal:()=>n,data:()=>o,setData:a=>o=a,setMoods:a=>O=a,getMoods:S,setNotes:a=>a,hasNote:y,setDura:a=>r=a,setTime:a=>d=a,setDate:a=>p=a,durationChanged:E,timeChanged:T,parsedScore:g,withPropsEventsTo:h,addPropsEventsTo:c};function b(){return p}function m(){return o.atScore||e.score}function y(){return i.notes!==void 0}function E(){return i.duration!==e.duration}function T(){return i.time!==e.time}function S(){return"byMood"in o&&(O=o.byMood),O}function g(){const a=m().split(/on/);return a.length!=2?-89:a[1]-a[0]}function D(a){if(!a)return"";let f=a.split(":");return parseInt(f[0])>=12?a+"PM":a+"AM"}function h(a,f=null){let u=Object.assign({},{...this});return u.bgcolor=a.bgcolor,u.jeSuis?u.details=`Of '${a.title.trim()}' :: << ${u.jeSuis.join(",")} >>`:u.details=`Of '${a.title.trim()}' :: ${D(u==null?void 0:u.time)} -> ${u==null?void 0:u.duration}min -- ${u!=null&&u.inDefaults?"Dft:":":"}${u!=null&&u.canMove?":Mv:":":"}${u!=null&&u.isAlternative?":Alt":":"}`,console.log("withProps",JSON.parse(JSON.stringify(u)),u.datey(),u.date(),u.title,u.details),u}function c(a){if(!n){console.log("addProps:: ERROR no parentGoal",this.data);return}this.data,getGoal();let f=Object.assign({},{...sav});return f.bgcolor=t.bgcolor,f.jeSuis?f.details=`Of '${t.title.trim()}' :: << ${f.jeSuis.join(",")} >>`:f.details=`Of '${t.title.trim()}' :: ${D(f==null?void 0:f.time)} -> ${f==null?void 0:f.duration}min -- ${f!=null&&f.inDefaults?"Dft:":":"}${f!=null&&f.canMove?":Mv:":":"}${f!=null&&f.isAlternative?":Alt":":"}`,console.log("addProps",JSON.parse(JSON.stringify(f)),f.datey(),f.date(),f.title,f.details),f}}class Tt{constructor(e,t){this.showReloadBtn=!1,this.showClearBtn=!1,this.showLoadDefaults=!0,this.showScoreBtn=!0,this.showPrioBtn=!0,this.showOneEachBtn=!1,this.disablePrioBtn=!0,this.disableScoreBtn=!0,this.disableSaveSchedule=!0,this.chosenScore=null,this.chosenPrio=null,this._dailyScheduled=new Map,this._endTimesSet=new Set,this._startTimesSet=new Set,this.savedRawEvts=[],this.actualEvts=[],this.usingMoods={},this.isDisabledScoreEdit={},this.hasStarted={},this.mobileEnableScore={},this.showMobileDialog={},this.currentDate=e,this.mobile=t,ht()}allPGoals(){return $e()}getAllEvts(){return this.actualEvts}showEvtNoteScoreMobile(e){return this.mobileEnableScore[e]&&this.showMobileDialog[e]}toggleEvtNoteScoreMobile(e){console.log("toggleEvtNoteScoreMobile >>",e),(this.isViewingPast()||this.isViewingToday())&&(this.showMobileDialog[e]=!0)}euhHidin(e){this.showMobileDialog[e]=!1}getCurrentSchedTimesSets(){return{endSet:this._endTimesSet,startSet:this._startTimesSet}}isViewingPast(){let e=oe();if(this.currentDate&&this.currentDate==e)return!1;let t=we(x(e));return!(we(x(this.currentDate))>=t)}isViewingToday(){return oe()==this.currentDate}toggle(){this.showReloadBtn=!this.showReloadBtn}getProps(){return{showReloadBtn:this.showReloadBtn,showClearBtn:this.showClearBtn,showLoadDefaults:this.showLoadDefaults,showScoreBtn:this.showScoreBtn,showPrioBtn:this.showPrioBtn,showOneEachBtn:this.showOneEachBtn,disablePrioBtn:this.disablePrioBtn,disableScoreBtn:this.disableScoreBtn,chosenScore:this.chosenScore,chosenPrio:this.chosenPrio}}saveBtnEnabled(){return this.disableSaveSchedule}fetchGoalsTree(){return pt()}getCurrentBalance(){return St()}getAllPrio(){return yt()}getSubGoals(){return gt()}getCurrentMoods(){return this.usingMoods}getSubGoalByID(e){let t=this.getSubGoals(),o=parseInt(e);for(let l=0;l<t.length;l++)if(t[l].id===o)return t[l];return null}getStoredRawEvt(e){return e in this.savedRawEvts?this.savedRawEvts[e]:null}getAltEvts(){return mt()}getEventsForDate(e){return Ne(e)}updateDaySchedule(e,t){Me(e,t)}parentGoalsMap(){return ut()}parentGoalById(e){return this.parentGoalsMap().has(e)?this.parentGoalsMap().get(e):null}findSchedEvent(e){return this._dailyScheduled.has(e)?this._dailyScheduled.get(e):null}findEvent(e){for(let t=0;t<this.actualEvts.length;t++)if(this.actualEvts[t].id===e)return this.actualEvts[t];return null}hasEventsForDate(){return ft(this.currentDate)}getDateEvents(e){let t=(l,s)=>{let n=F(l.sortTime,s.sortTime);if(n>0)return-1;if(n==0)return 0;if(n<0)return 1};const o=this.currentSchedEventsMap()[e]||[];if(o.length===1)o[0].side="full";else if(o.length===2){const l=w(x(o[0].date),{minute:V(o[0].time)}),s=w(l,{minute:o[0].duration}),n=w(x(o[1].date),{minute:V(o[1].time)}),r=w(n,{minute:o[1].duration});re(n,l,s,!0)||re(r,l,s,!0)?(console.log("getDateEvents...LENGTH==2..LEFT/RIGHT 'TWIX"),o[0].side="left",o[1].side="right"):(o[0].side="full",o[1].side="full")}return o.sort(t)}currentSchedEventsMap(){const e={};return this.actualEvts.forEach(t=>{let o=t.date;if(e[o]||(e[o]=[]),e[o].push(t),t.days){console.log(`currentSchedEventsMap multiple days? event for ${t.date}`,t.days);let l=pe(t.date),s=t.days;do l=w(l,{day:1}),map[l.date]||(map[l.date]=[]),map[l.date].push(t);while(--s>0)}}),e}enrichAddToSchedule(){let e={},t=this.isViewingToday();console.log("enrichAddToSchedule",Object.keys(this.savedRawEvts).length,"overlapCheck:"+t);for(let o in this.savedRawEvts){let l=this.savedRawEvts[o],s=this.getSubGoalByID(o);if(!s){console.log(`enrichAddToSchedule:: No goal found for key: ${o}...skipping!`);continue}let n=this.parentGoalById(s.parentGoal),r=Et(l,s,n),d=this.addToSchedule(r,t,!0);d?Array.isArray(d)&&(e[s.id]=d):console.log("enrichAddToSchedule..ERROR?!? not added",d,s)}return this.massageOverlapObj(e)}loadEvtsForDay(e){return e||this.resetSchedule(),this.savedRawEvts=Ne(this.currentDate),this.savedRawEvts?{overlaps:this.enrichAddToSchedule(),canContinue:!1}:{overlaps:null,canContinue:!0}}onChangeViewDate(e){let t=e==this.currentDate;return this.currentDate=e,this.enableActionBtns(),this.loadEvtsForDay(t)}resetSchedule(){this.savedRawEvts=[],this.actualEvts=[],this._dailyScheduled=new Map,this._endTimesSet=new Set,this._startTimesSet=new Set,this.usingMoods={},this.showReloadBtn=!1,this.showClearBtn=!1,this.disableSaveSchedule=!0}unscheduledDefaults(){return this.getSubGoals().filter(t=>(t==null?void 0:t.inDefaults)&&(t==null?void 0:t.time)!=""&&!this.actualEvts.find(o=>o.id==t.id))}unscheduled(){return this.getSubGoals().filter(t=>!this.actualEvts.find(o=>o.id==t.id))}subGoalsOfParent(e){return this.getSubGoals().filter(o=>o.parentGoal==e)}chosenScoreLabel(){return this.chosenScore==null?"By Score":`Score <= ${this.chosenScore}`}chosenPrioLabel(){return this.chosenPrio==null?"By Priority":`Prio = ${this.chosenPrio}`}onChoosenPrio(e){let t=this.chosenPrio;t&&t==e?this.disablePrioBtn=!0:(this.chosenPrio=e,this.disablePrioBtn=!1)}onChoosenScore(e){let t=this.chosenScore;t&&t==e?this.disableScoreBtn=!0:(this.chosenScore=e,this.disableScoreBtn=!1)}scheduleByScore(e){const t=()=>{let n=[];return this.actualEvts.forEach(r=>{let d=de(r.score);d>-1&&d<=this.chosenScore&&n.push(r)}),n};let o=[];if(e=="filter")o=t(),this.resetSchedule();else{const n=vt(this.chosenScore);e=="add"?o=n.filter(r=>!this.actualEvts.find(d=>d.id==r.id)):(o=n,this.resetSchedule())}if(console.log(`scheduleByScore::AFTER flag ${e} from size: ${this.actualEvts.length} to some evts = ${o.length}`),o.length<1)return this.toggleActionBtns(!1,"byScore"),{overlaps:null,canContinue:!1};let l=this.addGoalsToSchedule(o,this.isViewingToday()),s=Object.keys(l).length;return this.toggleActionBtns(o.length>0,"byScore"),{overlaps:l,canContinue:!(s>0)}}scheduleSamePrio(e){const t=()=>this.actualEvts.filter(n=>{var r;return((r=this.parentGoalById(n.parentGoal))==null?void 0:r.priority)==this.chosenPrio});let o=[];if(e=="filter")o=t(),this.resetSchedule();else{let n=this.getSubGoals();for(let r of n){let d=this.parentGoalById(r.parentGoal);(d==null?void 0:d.priority)==this.chosenPrio&&o.push(r)}e=="add"?o=o.filter(r=>!this.actualEvts.find(d=>d.id==r.id)):this.resetSchedule(),console.log(`scheduleSamePrio::After ${e} from size: ${this.actualEvts.length} to evts = ${o.length}`,JSON.parse(JSON.stringify(o)))}if(o.length<1)return this.toggleActionBtns(!1,"byPrio"),{overlaps:null,canContinue:!1};let l=this.addGoalsToSchedule(o,this.isViewingToday()),s=Object.keys(l).length;return this.toggleActionBtns(o.length>0,"byPrio"),{overlaps:l,canContinue:!(s>0)}}massageOverlapObj(e){let t={};for(let o in e){let l=e[o];if(l.length>0){let s=0;do{let n=l[s];t[n.inConflict]||(t[n.inConflict]=[]),t[n.inConflict].push(n),s>0&&(console.log("WOAH WOAH, massageOverlapObj:: multiple overlaps with same obj!"+s,l,n),n.inConflict in t&&(console.log("WOAH deleting inConflict",n.inConflict),delete t[n.inConflict]),l[s-1].inConflict in t&&(console.log("WOAH deleting PREV inConflict",l[s-1].inConflict),delete t[l[s-1].inConflict]),t[n.target]?(t[n.target].push(n),console.log("WOAH obj.id already present?",n.target)):t[n.target]=[n],t[n.target].unshift(l[s-1]),t.withID=!0)}while(++s<l.length)}}return t}massageSingleOverlapArr(e){let t={};for(let o=0;o<e.length;o++){let l=e[o];t[l==null?void 0:l.inConflict]?t[l==null?void 0:l.inConflict].push(l):t[l==null?void 0:l.inConflict]=[l],o>0&&(console.log("WOAH WOAH,massageSingleOverlapArr..multiple overlaps with same target>>",e[o].target),l.inConflict in t&&(console.log("WOAH deleting inConflict",l.inConflict),delete t[l.inConflict]),e[o-1].inConflict in t&&(console.log("WOAH deleting PREV inConflict",e[o-1].inConflict),delete t[e[o-1].inConflict]),t[l.target]?(t[l.target].push(l),console.log("WOAH obj.id already present?",l.target)):t[l.target]=[l],t[l.target].unshift(e[o-1]),t.withID=!0)}return t}scheduleOneEach(e){const t=r=>{let d=[];return this.parentGoalsMap().forEach((p,O,b)=>{let m=this.subGoalsOfParent(p.id);if(m.length>0){let y=null,E=m.length;if(r)y=m[Math.floor(Math.random()*E)];else{let T=0;for(;this.actualEvts.some(S=>m[E].id==S.id);)if(T++,E=Math.floor(Math.random()*m.length),console.log(`selectOneFromP::index ${E} scheduled...new random> At try> `+T,m.length),T>2){console.log("selectOneFromP::random...TOO MANY TRIES..ERROR?",T,E,m.length,m);break}y=m[E],console.log("selectOneFromP::NO Random at index: "+E,T,y)}d.push(y)}else console.log("scheduleOneEach::selectOneFromP...huh no subgoals for parentGoal",p)}),d},o=()=>{let r=this.unscheduled(),d=[];return this.parentGoalsMap().forEach((p,O,b)=>{let m=r.filter(E=>E.parentGoal==p.id),y=m.length;if(y>0){let E=m[Math.floor(Math.random()*y)];d.push(E)}else console.log("scheduleOneEach::No goal for parent!!",O,p==null?void 0:p.title)}),d};let l=[];if(e=="add"?(l=o(),console.log("scheduleOneEach...TOADD!!",l)):(this.resetSchedule(),l=t(!0)),l.length<1)return console.log("Empty for OneEach :("),this.toggleActionBtns(!1,"oneEach"),{overlaps:null,canContinue:!1};let s=this.addGoalsToSchedule(l,this.isViewingToday()),n=Object.keys(s).length;return this.toggleActionBtns(l.length>0,"oneEach"),{overlaps:s,canContinue:!(n>0)}}scheduleByMood(e){var s;let t=[];for(let n=0;n<e.length;n++){let r=this.getSubGoalByID(e[n].id);r&&r.time!=""&&(t.push(r),this.usingMoods[e[n].id]=(s=e[n])==null?void 0:s.mood)}if(t.length<1)return console.log("Empty for Mood :("),this.toggleActionBtns(!1,"ByMood"),{overlaps:null,canContinue:!1};let o=this.addGoalsToSchedule(t,this.isViewingToday()),l=Object.keys(o).length;return l>0&&console.log(`scheduleByMood overlaps!! to ${t.length}. overlaps =${l}`),this.toggleActionBtns(t.length>0,"ByMood"),{overlaps:o,canContinue:!(l>0)}}scheduleDefaults(e){let t=null;e=="add"?t=this.unscheduledDefaults():(this.resetSchedule(),t=this.unscheduledDefaults()),this.showReloadBtn=this.hasEventsForDate(),this.showClearBtn=!this.isViewingPast()&&t.length>0;let o=this.addGoalsToSchedule(t,this.isViewingToday()),l=Object.keys(o).length;return l>0&&console.log(`scheduleDefaults:: Overlaps!! for ${t.length}...overlaps =${l}`),this.toggleActionBtns(t.length>0,"defaults"),{overlaps:o,canContinue:!(l>0)}}schedEvtWithProps(e,t,o){if(!e.getPGoal()){console.log("schedEvtWithProps:: ERROR no parentGoal",e.data);return}let l=e.data(),s=e.getGoal(),n=e.getPGoal(),r={...s};(e.timeChanged()||e.durationChanged())&&(r.time=l.time,r.duration=l.duration),e.setDate(this.currentDate);let d=e.getMoods();if(d){//!==
this.usingMoods[r.id]=d}return r.date=this.currentDate,r.bgcolor=n.bgcolor,r.start=t,r.end=o,r.jeSuis?r.details=`Of '${n.title.trim()}' :: << ${r.jeSuis.join(",")} >>`:r.details=`Of '${n.title.trim()}' :: ${L(r==null?void 0:r.time)} -> ${r==null?void 0:r.duration}min -- ${r!=null&&r.inDefaults?"Dft:":":"}${r!=null&&r.canMove?":Mv:":":"}${r!=null&&r.isAlternative?":Alt":":"}`,e.hasNote()&&(r.notes=l.notes),r}saveNewGoal(e,t,o,l,s){if(console.log(`saveNewGoal:${t} :${l}: from ${e.time}.Duration:${s}`),l=="self"){let n=this.addParentGoal(t,t,"purple-10",2);if(n)return ae(n,t,"1on5",e.time,s,!0,!1,s<30);console.log("ERROR? no pID",n)}else if(o){return console.log("with parentGoal "+o.id,o==null?void 0:o.title),ae(o.id,t,"1on5",e.time,s,!1,!1,s<30);//!canMove and notInDefaults. isAlternative when duration<30
}else{let n=bt();if(n)return ae(n.id,t,"1on5",e.time,s,!1,!1,s<30);{let r=this.addParentGoal("Misc","Miscellaneous","grey-10",2);if(r)return ae(r,t,"1on5",e.time,s,!0,!1,s<30)}}return null}addParentGoal(e,t,o="red-14",l=2){let s=[];this.parentGoalsMap().forEach((d,p,O)=>{let b=d.bgcolor;s.push(b)});let n=Ye(),r=s.length;if(r>1){let d=r;for(;s.some(O=>n[d]==O);)console.log("addParentGoal::Taken color...new random",d,n[d]),d=Math.floor(Math.random()*r);let p=n[d];console.log(`addParentGoal::bgcolor..index ${d} from ${o} to:`,p),o=p||o}return Ot(e,t,o,l)}onPickEvent(e,t,o,l){const s=()=>{l&&(this.removeFromBalance(e==null?void 0:e.duration),console.log("onPickEvent...useBalance","force?"+o));let p=this.addToSchedule({...e,time:t.time},!1);return console.log("onPickEvent::NO overlap",l,p),this.isViewingPast()||l?this.saveDaySchedule():this.toggleActionBtns(!0,"onPickEvt"),{overlaps:p,canContinue:!0}};let n=w(t,{minute:e.duration}),r=this.hasOverlappingEvent(e.id,t,n),d=r.length;if(d>0){console.log("onPickEvent::OVERLAPS!!"+d,"with force "+o,JSON.parse(JSON.stringify(r)));let p={overlaps:this.massageSingleOverlapArr(r),canContinue:!1};return d>1||!o?p:(this.recurChangeTime(r[0].inConflict,e,t,!0),l&&this.removeFromBalance(e==null?void 0:e.duration),this.isViewingPast()||l?this.saveDaySchedule():this.toggleActionBtns(!0,"onPickEvt"),{overlaps:null,canContinue:!0})}else return s()}onAdHocEvent(e,t,o){let l=this.getSubGoalByID(e);if(!l)return{overlaps:null,canContinue:!1};const s=d=>(o&&(this.removeFromBalance(d==null?void 0:d.duration),console.log("onAdHocEvent...using Balance",d==null?void 0:d.duration)),this.saveDaySchedule(),{overlaps:null,canContinue:!0});let n=this.addToSchedule(l,!0),r=Array.isArray(n);if(!n||r){console.log("onAdHocEvent::Overlaps!!",JSON.parse(JSON.stringify(n)));let d={overlaps:n?this.massageSingleOverlapArr(n):null,canContinue:!1};return r&&n.length>1?d:r&&n.length==1?(console.log("onAdHocEvent::Overlaps!!--FORCING at ",t.time),this.recurChangeTime(n[0].inConflict,l,t,!0),s(l)):d}return s(l)}recurChangeTime(e,t,o,l=!1){var n,r,d,p;let s=this.findSchedEvent(e);if(s){let O=V(s.start.time)-V(o.time),b=`${O>0?"DOWN":"UP"}`,m=null;if(O>=0){m=w(o,{minute:parseInt(t.duration)+10});let T=w(o,{minute:parseInt(s.for)+10});console.log(`recurChangeTime::${e}...FORWARD ${b} for ${O} due to evt:${t.id}-${(n=t==null?void 0:t.title)==null?void 0:n.trim()} at ${o.time} 
          
 doAdd?:${l} >`,JSON.parse(JSON.stringify(m.time)),"alt:",T.time);let S=F(T,m);S>0&&(Math.floor(S/1e3/60)<=O?console.log(`recurChangeTime::${e}....with duration:${s.for} vs evtDura:${t.duration}...NOT using alternative!!`):(console.log(`recurChangeTime::DIFFY>>${S}...gonna use Alternative`,T.time),m=T))}else{m=w(o,{minute:-(parseInt(s.for)+10)});let T=w(o,{minute:-(parseInt(t.duration)+10)}),S=F(T,m);console.log(`recurChangeTime::${e}...BACKWARD ${b} for ${O} due to evt:${t.id}-${(r=t==null?void 0:t.title)==null?void 0:r.trim()} at ${o.time}
          
 doAdd?:${l}`,m.time,"alt:"+T.time,"diffy="+S)}let y=this.hasOverlappingEvent(e,m,w(m,{minute:s.for}));if(y.length>0){console.log(`WARNING WARNING::Extra Overlaps of ${y.length} for overlapped ${e} at ${m.time}`,y);let T=0,S=y.length,g=this.findEvent(e);console.log(g?`Cascading time change while ${l?"Adding":"Moving"}  (${e})' ${g==null?void 0:g.title}' due to ${t.id}-'${(d=t==null?void 0:t.title)==null?void 0:d.trim()}'`:`ERROR::recurChangeTime ${e} not found`);do{if(console.log(`CASCADING:: timeChange ${e}-${g==null?void 0:g.title} at: ${m.time} '
 now at: ${s.start.time}  till ${s.end.time}`,y[T]),y[T].inConflict==t.id){console.log(`EUUUH...::recurChangeTime::self overlap?!?${e} ...breaking!`,y[T]);break}this.recurChangeTime(y[T].inConflict,g,m)}while(++T<S)}this.changeEvtTime(s,m),console.log(`recurChangeTime::OVERLAPPED (${e}) ${b} to ${m.time} >> doAdd:${l}`);let E=o;console.log(`recurChangeTime::TARGET:(${t.id})${(p=t==null?void 0:t.title)==null?void 0:p.trim()} going ${b}>> doAdd?:${l} to time>> ${E.time}`),l?this.addGoalsToSchedule([{...t,time:E.time}],!1):this.changeEvtTime(t,E)}else console.log("ERROR..ERROR recurChangeTime:: overlapped event not found!",e,t)}hasOverlappingEvent(e,t,o){const l=[];return this._dailyScheduled.forEach((s,n,r)=>{if(n!=e){let d=this.checkOverlapByTime(t,o,s.start,s.end);d&&(this._startTimesSet.has(t.time)&&console.log(`hasOverlappingEvent ${e} same start`,t.time),l.push({target:e,targetStart:t,direction:d,inConflict:n}))}}),l}checkOverlapByTime(e,t,o,l){let s=this.getTimeyNumber(e),n=this.getTimeyNumber(t),r=this.getTimeyNumber(o),d=this.getTimeyNumber(l);if(s===!1||r===!1||n===!1||d===!1)return console.log("ERROR... checkOverlapByTime error",s,n,r,d),!1;let p=!1;s>r&&s<d&&(p="bas"),n>r&&n<d&&(p="haut");let O=r>=s&&n>=d,b=s>=r&&n<=d;return(O||b)&&(p="surrounding",console.log("checkOverlapByTime","surrounding:"+O,"surrounded:"+b)),p}doProppy(e,t){let o=this.parentGoalById(e.parentGoal);if(!o){console.log("doProppy:: ERROR no Pgoal found ?!?",e);return}let l=w(x(t),{minute:V(e.time)}),s=w(l,{minute:e.duration}),n=Object.assign({},{...e,date:t,bgcolor:o.bgcolor,start:l,end:s});return e.jeSuis?n.details=`Of '${o.title.trim()}' :: << ${e.jeSuis.join(",")} >>`:n.details=`Of '${o.title.trim()}' :: ${L(e==null?void 0:e.time)} -> ${e==null?void 0:e.duration}min -- ${e!=null&&e.inDefaults?"Dft:":":"}${e!=null&&e.canMove?":Mv:":":"}${e!=null&&e.isAlternative?":Alt":":"}`,n.sortTime=l,"byMood"in e&&(this.usingMoods[n.id]=e.byMood),n}canDropEvent(e,t){let o=w(e,{minute:t.duration}),l=this.hasOverlappingEvent(t.id,e,o);return l.length>0?{overlaps:this.massageSingleOverlapArr(l),canContinue:!1}:(this.toggleActionBtns(!0,"canDropEvent"),{overlaps:null,canContinue:!0})}toggleActionBtns(e,t){this.disableSaveSchedule=!e,this.showReloadBtn=this.hasEventsForDate(),this.showClearBtn=!this.isViewingPast()&&e}resetChosen(){this.chosenScore=null,this.chosenPrio=null}enableActionBtns(){let e=this.isViewingPast();this.showOneEachBtn=!e,this.showLoadDefaults=!e,this.showScoreBtn=!e,this.showPrioBtn=!e}tooClose(e,t){let o=w(e,{minute:0}),l=this.getTimeNumber(o),s=w(e,{day:1}),n=new Date(s.date);n.setHours(24),n.setMinutes(0),n.setSeconds(0),n.setMilliseconds(0);let r=U(n),d=Math.floor(F(o,r)/1e3/60);if(d<t)return console.log("tooClose to midnight eh...:(",d),!0;let p=!1;return this._dailyScheduled.forEach((O,b,m)=>{let E=this.getTimeNumber(O.start)-l,T=F(o,O.start);Math.floor(T/1e3/60)<=10&&E>0&&(p=b)}),p}changeEvtTime(e,t,o){return o=="ok"&&Ae(e.id,t.time,null),this.doUpdateSchedule(e,t),o}addGoalsToSchedule(e,t){let o={};return e.forEach(l=>{let s=this.addToSchedule(l,t,!1);s?Array.isArray(s)&&(o[l.id]=s):console.log("addGoalsToSchedule:: Evt NOT added",s,t,l.id,l.title)}),this.massageOverlapObj(o)}addToSchedule(e,t,o=!1){if(this._dailyScheduled.has(e.id))return!1;{let l=w(x(this.currentDate),{minute:V(e.time)}),s=w(l,{minute:e.duration});if(t){let r=this.hasOverlappingEvent(e.id,l,s);if(r.length>0)return r}let n=o?this.schedEvtWithProps(e,l,s):this.doProppy(e,this.currentDate);n.sortTime=l,this.actualEvts.push(n),this._dailyScheduled.set(n.id,{...n,for:n.duration,start:l,end:s,score:n.score}),this._endTimesSet.add(s.time),this._startTimesSet.add(l.time),this.enableNoteScoreEdit(n.id,l,s)}return!0}doUpdateSchedule(e,t){let o=this.findSchedEvent(e.id),l=this.findEvent(e.id);if(!o||!l){console.log("doUpdateSchedule-ERROR NOT found",e.id,o,l);return}let s=w(x(l.date),{minute:V(t.time)}),n=w(s,{minute:l.duration});this._endTimesSet.delete(o.end.time)?this._endTimesSet.add(n.time):console.log("doUpdateSchedule-endTimesSet NOT FOUND?!?"),this._startTimesSet.delete(o.start.time)?this._startTimesSet.add(s.time):console.log("doUpdateSchedule-startTimesSet NOT FOUND?!?",e.id,t),this._dailyScheduled.set(e.id,{...o,for:l.duration,start:s,end:n}),l.time=t.time,l.sortTime=s,this.enableNoteScoreEdit(e.id,s,n)}saveDaySchedule(){let e={};this._dailyScheduled.size<1?e=null:this._dailyScheduled.forEach((t,o,l)=>{e[o]={time:t.start.time,duration:t.for},this.usingMoods[o]&&(e[o].byMood=this.usingMoods[o]),t.notes!==void 0&&(t==null?void 0:t.notes)!==""&&(e[o].atScore=t==null?void 0:t.score,e[o].notes=t==null?void 0:t.notes)}),console.log("saveDaySchedule",e?Object.keys(e).length:"CLEARED"),Me(this.currentDate,e),this.disableSaveSchedule=!0,this.showReloadBtn=!1,this.showClearBtn=e!=null&&!this.isViewingPast()}updateMinEndNowBtn(e,t,o){for(let[l,s]of this._dailyScheduled)(t?s.end.time:s.start.time)==e&&(this.hasStarted[l]=!t,this.isDisabledScoreEdit[l]=!t,this.mobile&&(console.log(`updateMinEndNowBtn..MOBILE::good?>>${o}::${t}`,e),this.showMobileDialog[l]=!t))}reduceEvtDuration(e,t){let o=this.findSchedEvent(e);if(!o){console.log("ERROR:: reduceEvtDuration Evt not found!!!",e);return}const l=U(new Date);let s=o.start,n=o.end;this._dailyScheduled.set(e,{...o,for:t,duration:t,end:l}),this._endTimesSet.delete(n.time)||console.log("ERROR endTimesSet item does not exist?!?",o,this._endTimesSet),this._endTimesSet.add(l.time);let r=this.findEvent(e);r.duration=t,this.enableNoteScoreEdit(e,s,l),this.saveDaySchedule()}updateEvtMinsEndNowBtns(e,t,o){const l=U(new Date);let s=w(l,{minute:0}),n=this.getTimeNumber(s),r=this.getTimeNumber(t),d=this.getTimeNumber(o);if(r!==!1&&d!==!1){let p=n>=r&&n<d,O=n>=d;p&&(this.hasStarted[e]=!0),O&&this.disableEvtScoreEdit(e,O)}else console.log(`ERROR?!:${e} has no start/end?.`)}canEndNow(e){let t=this.findSchedEvent(e);if(!t)return console.log("ERROR canEndNow Evt not found!!!",e),!1;const o=U(new Date);let l=t.start,s=t.end;if(!re(o,l,s,!0))return console.log("umm aint in the middle of this event! Nothing to do...canEndNow::ERROR?",o.time,l.time,s.time),!1;let n=w(o,{minute:0}),r=F(l,n),d=Math.floor(r/1e3/60);return console.log(`canEndNow:: ${e} duration from ${t.for} to: ${d}`),d<10?d:this.reduceEvtDuration(e,d)}updateNoteScore(e,t,o=""){let l=this.findSchedEvent(e);if(l){l.score==t||Ae(e,null,t);let n=this.findEvent(e);n?n.score=t:console.log("onSaveScore ERROR not found",n,e),o!==""&&(l.notes=o,n.notes=o,this.saveDaySchedule())}else console.log(`ERROR ERROR::updateNoteScore could not find event ${e}?!?`)}addMinsToEvt(e,t){const o=(O,b,m)=>{console.log(`Great, ${e} Ending at:${m.time}`,b);let y=this.findEvent(e),E=O.end;if(!y){console.log("addMinsToEvt::ERROR not found?!?",O,e,b,m);return}return y.duration=b,this._dailyScheduled.set(e,{...O,for:b,end:m}),this._endTimesSet.delete(E.time)||console.log("ERROR endTimesSet item does not exist?!?"+E.time,O,this._endTimesSet),this._endTimesSet.add(m.time),this.saveDaySchedule(),{overlaps:null,canContinue:!0}};let l=this.findSchedEvent(e);if(!l){console.log("ERROR addMinsToEvt EVT not found!!!",e);return}let s=l.end,n=w(s,{minute:parseInt(t)}),r=parseInt(t)+l.for;console.log(`addMinsToEvt::${e} add ${t} from ${l.for} to> ${r}`,s.time,n.time);let d=this.hasOverlappingEvent(e,l.start,n),p=d.length;if(p>0){console.log("addMinsToEvt::OVERLAPS"+p,d);let O={overlaps:this.massageSingleOverlapArr(d),canContinue:!1};if(p>1)return O;let b=this.findEvent(d[0].inConflict);if(!b)return console.log("addMinsToEvt::ERROR conflict evt not found?!?"+p,d[0].inConflict),O;let m=(b==null?void 0:b.inDefaults)||!(b!=null&&b.canMove);return console.log("addMinsToEvt::askUser","default? "+(b==null?void 0:b.inDefaults),"!canMove? "+!(b!=null&&b.canMove),m),m?O:o(l,r,n)}return o(l,r,n)}deleteEvtMood(e){this.usingMoods[e]?(delete this.usingMoods[e],console.log("deleteEvtMood::>"+e)):console.log("deleteEvtMood>>NO mood by "+e)}removeScheduledEvt(e,t=!1){let o=this.getAllEvts().length;if(!e){console.log("ERROR doRemove, NO evt to delete?!?",e);return}let l=0;for(l;l<o;l++)if(this.actualEvts[l].id==e.id){this.actualEvts.splice(l,1);let s=null;if(this._dailyScheduled.has(e.id)?(s=this._dailyScheduled.get(e.id),this._dailyScheduled.delete(e.id)):console.log("removeScheduledEvt ::> dailyScheduled has no such evt?@? ERROR",e),s){let n=this._startTimesSet.delete(s.start.time),r=this._endTimesSet.delete(s.end.time);(!n||!r)&&console.log(`removeScheduledEvt ::> ERROR? scheduleSets has no such evt?@? start:${n}...end:${r}`,s,e.id+" "+(e==null?void 0:e.title.trim())+" "+(e==null?void 0:e.details)),t&&delete this.usingMoods[e.id]}break}}addToBalance(e){let o=this.getCurrentBalance()-parseInt(e==null?void 0:e.duration);Pe(o)}removeFromBalance(e){let o=this.getCurrentBalance()+parseInt(e);Pe(o)}disableAllScoreEdit(e){this._dailyScheduled.forEach((t,o,l)=>{this.isDisabledScoreEdit[o]=e})}disableEvtScoreEdit(e,t){this.isDisabledScoreEdit[e]=!t,this.mobileEnableScore[e]=t}enableNoteScoreEdit(e,t,o){const l=U(new Date);let s=F(l,o),n=w(l,{minute:0});this.getTimeNumber(n),s>0?(this.isDisabledScoreEdit[e]=!0,this.mobileEnableScore[e]=!1):(this.hasStarted[e]=!1,this.mobile&&(this.showMobileDialog[e]=!1),this.mobileEnableScore[e]=!0,this.isDisabledScoreEdit[e]=!1),re(l,t,o,!0)?this.hasStarted[e]=!0:this.hasStarted[e]=!1}getTimeyNumber(e){return e!==null?it(e):!1}getTimeNumber(e){return e!==null?ye(e):!1}}function _e(i){return i.button===0}const Dt={name:"altDayCalendar",components:{NavigationBar:Q(()=>Y(()=>import("./NavigationBar.5857db6a.js"),["assets/NavigationBar.5857db6a.js","assets/index.cd2fe454.js","assets/index.ddf7c1e7.css"])),QCalendarDay:at,GoalyEnd:Q(()=>Y(()=>import("./goalyEnd.073d7ebb.js"),["assets/goalyEnd.073d7ebb.js","assets/goalyEnd.f5ffa344.css","assets/utiFunc.3e05ecca.js","assets/index.cd2fe454.js","assets/index.ddf7c1e7.css","assets/goalStorage.709f87a9.js","assets/QSelect.07e70076.js","assets/touch.70a9dd44.js","assets/QItem.ed35dda2.js"])),schedBtn:Q(()=>Y(()=>import("./schedBtn.fba1e08e.js"),["assets/schedBtn.fba1e08e.js","assets/schedBtn.32a55c93.css","assets/index.cd2fe454.js","assets/index.ddf7c1e7.css"])),dropDwnBtn:Q(()=>Y(()=>import("./dropDwnBtn.ca40a3fa.js"),["assets/dropDwnBtn.ca40a3fa.js","assets/dropDwnBtn.35a7a0b5.css","assets/QItem.ed35dda2.js","assets/index.cd2fe454.js","assets/index.ddf7c1e7.css","assets/QList.490729d7.js","assets/QSelect.07e70076.js","assets/touch.70a9dd44.js","assets/goalStorage.709f87a9.js","assets/utiFunc.3e05ecca.js"])),schedDialog:Q(()=>Y(()=>import("./schedDialog.619103fa.js"),["assets/schedDialog.619103fa.js","assets/schedDialog.f43cf2d3.css","assets/index.cd2fe454.js","assets/index.ddf7c1e7.css","assets/QSpace.4856f59d.js"])),mobileNoteScore:Q(()=>Y(()=>import("./onScoreEditDialog.1e44cf41.js"),["assets/onScoreEditDialog.1e44cf41.js","assets/onScoreEditDialog.b00fdc3d.css","assets/index.cd2fe454.js","assets/index.ddf7c1e7.css"]))},data(){return rt(),A(null),A(null),A(null),A(null),{splitterPage:A(35),splitterLegend:A(40),timeStartPos:A(0),showTree:A(!1),treeGoals:A([]),expanded:A([]),filter:A([]),filterRef:A(null),calendar:A(null),showEvtDialog:A(!1),currentDate:A(oe()),scoreOptions:A([1,2,3,4,5,6,7,8]),anchorTimestamp:A(null),otherTimestamp:A(null),mouseDown:A(!1),mobile:A(!0),daSchedule:A(null)}},beforeMount(){this.mobile=ct(),this.daSchedule=new Tt(this.currentDate,this.mobile),this.constructTree()},mounted(){this.adjustCurrentTime(),this.intervalId=setInterval(()=>{this.adjustCurrentTime()},6e4)},beforeUnmount(){clearInterval(this.intervalId)},computed:{chosenScoreLabel(){return this.daSchedule.chosenScoreLabel()},chosenPrioLabel(){return this.daSchedule.chosenPrioLabel()},style(){return{top:this.timeStartPos+"px"}},showSchedInstru(){return this.getDateEvents(this.currentDate).length<1},showRemInstru(){return this.getDateEvents(this.currentDate).length>0&&!this.isViewingPast()},defaultLabels(){let e=this.daSchedule.unscheduled().filter(t=>(t==null?void 0:t.inDefaults)&&(t==null?void 0:t.time)!="").length;return e>0?e+" Defaults":"Defaults"},showDefaultBtn(){return this.daSchedule.unscheduledDefaults().length>0&&!this.isViewingPast()},saveScheduleDisabled(){return this.daSchedule.saveBtnEnabled()},showTreeForm(){return this.showTree||this.constructTree(),this.showTree},filterString(){return this.filter.join()},currentBalance(){return this.daSchedule.getCurrentBalance()},canbeScheduled(){let i=this.daSchedule.unscheduled(),e=(t,o)=>{if(t.parentGoal>o.parentGoal)return 1;if(t.parentGoal==o.parentGoal)return 0;if(t.parentGoal<o.parentGoal)return-1};if(i.length==0){let t=this.daSchedule.getSubGoals();return t.sort(e),t}return i.sort(e),i},scheduleMoodsLabel(){let i="",e=this.daSchedule.getCurrentMoods();if(!Object.keys(e).length>0)return i;let t=new Set;for(let l in e)t.add(e[l].join());let o=0;for(let l of t)o<1?i=l:i=i+", "+l,o++;return Object.keys(e).length!=t.size&&console.log("scheduleMoodsLabel..prob change!",JSON.parse(JSON.stringify(e)),t,i),i},startEndTimes(){const i=[];return this.anchorDayTimeIdentifier!==!1&&this.otherDayTimeIdentifier!==!1&&(this.anchorDayTimeIdentifier<=this.otherDayTimeIdentifier?i.push(X(this.anchorTimestamp),X(this.otherTimestamp)):i.push(X(this.otherTimestamp),X(this.anchorTimestamp))),i},anchorDayTimeIdentifier(){return this.anchorTimestamp!==null?ye(this.anchorTimestamp):!1},otherDayTimeIdentifier(){return this.otherTimestamp!==null?ye(this.otherTimestamp):!1},eventsMap(){return this.daSchedule.currentSchedEventsMap()}},methods:{showEvtMobile(i){return this.daSchedule.showEvtNoteScoreMobile(i)},klikaj(i){console.log("klikaj...",this.currentDate,i)},adjustCurrentTime(){const i=U(new Date);if(this.currentDate!==i.date){this.timeStartPos=-10,this.currentTime="";return}this.currentDate=i.date,this.currentTime=i.time,this.timeStartPos=this.$refs.calendar.timeStartPos(i.time,!1);let e=this.daSchedule.getCurrentSchedTimesSets(),t=e.endSet&&e.endSet.has(i.time),o=e.startSet&&e.startSet.has(i.time);(t||o)&&(this.daSchedule.updateMinEndNowBtn(this.currentTime,t,o),o&&this.doNotify("Event Starting :)","positive","bottom"))},hasDate(i){return this.currentDate?i.find(e=>e.date===this.currentDate):!1},getDateEvents(i){let e=(o,l)=>{let s=F(o.sortTime,l.sortTime);if(s>0)return-1;if(s==0)return 0;if(s<0)return 1};const t=this.eventsMap[i]||[];return t.length===1?t[0].side="full":t.length,t.sort(e)},constructTree(){this.treeGoals=this.daSchedule.fetchGoalsTree()},resetGoalEvts(){return this.daSchedule.getSubGoals()},allMainGPrio(){return this.daSchedule.getAllPrio()},resetFilter(){var i;this.filter=[],(i=this.filterRef)==null||i.focus()},myFilterMethod(i,e){if(i.isChildren&&(i==null?void 0:i.moods.length)>0){const t=this.filter.map(l=>l.toLowerCase());let o=i==null?void 0:i.moods.some(l=>t.indexOf(l.toLowerCase())>-1);return i.label&&o}},labelGoals(i){let e=0;if(i=="s"){for(const o in this.treeGoals)e+=this.treeGoals[o].children.length;return`Scheduled => ${this.daSchedule.getAllEvts().length} out of ${e} 
`}return`Balance: ${this.daSchedule.getCurrentBalance()||0} 
`},badgeClasses(i,e){return Xe(i,e)},styleDragLine(i,e=void 0,t=void 0){let o=e(i.time),l=t(i.duration),s=o+l;this.timeStartPos+l;const n={};return e&&t&&(n.top=s+"px",n.height=l+"px"),n["align-items"]="flex-start",n},badgeStyles(i,e,t=void 0,o=void 0){return Ze(i,e,t,o)},classyColor(i){return`row items-center ${i.isChildren?"text-":"text-white bg-"}${i.color} `},isViewingPast(){return this.daSchedule.isViewingPast()},onMoodAdd(){let i=[];const e=this.filter.map(t=>t.toLowerCase());if(this.treeGoals.filter(t=>{if(t.children.length>0)return t.children.filter(o=>{if((o==null?void 0:o.moods.length)>0&&(o==null?void 0:o.moods.some(l=>e.indexOf(l.toLowerCase())>-1))){let l=o==null?void 0:o.moods.filter(s=>{if(e.indexOf(s.toLowerCase())>-1)return s});return i.push({id:o.id,mood:l}),o}})}),i.length>0){i=i.filter(o=>!this.daSchedule.getAllEvts().find(l=>l.id==o.id));let t=i.length;if(t>0){let o=this.daSchedule.scheduleByMood(i);console.log("onMoodAdd>>>",e,o,i),o.canContinue?this.doNotify(`Added ${t} Evts by Mood...doSave eh`,"positive"):o.overlaps&&Object.keys(o.overlaps).length>0?this.handleOverlaps(o.overlaps,null,"byMood"):this.doNotify("Empty as no Moods :(","warning","bottom")}else this.doNotify(`Evts of Mood '${this.filterString}' already scheduled!`,"warning","top")}else this.doNotify("Nothing to add :(","warning","top")},onScheduleOneEach(){let i=t=>{let o=this.daSchedule.scheduleOneEach(t);console.log("onScheduleOneEach::ACTION!!!",JSON.parse(JSON.stringify(o))),o.canContinue?this.doNotify("Add by OneEach ...doSave eh","positive"):o.overlaps&&Object.keys(o.overlaps).length>0?this.handleOverlaps(o.overlaps,null,"oneEach"):this.doNotify("Empty? for OneEach :(","warning","bottom")},e=()=>{console.log("onScheduleOneEach..Aborting",this.daSchedule.getAllEvts()),this.reset()};if(this.daSchedule.getAllEvts().length>0){let t=[{label:"Add one Evt from Each parent Goals",value:"add"},{label:"Overwrite current with one random Evt from Each parent Goals",value:"overwrite"}];this.radioChoiceDialog("Warning!!",`Date: ${this.currentDate} already have scheduled Events...`,t,"",i,e)}else i("overwrite")},onReloadSaved(){let i=this.daSchedule.hasEventsForDate();console.log("onReloadSaved",i);let e=()=>{console.log("Aborting",this.currentDate,this.scheduledEvents,i)},t=()=>{console.log("onReloadSaved::Overwriting",i);let o=this.daSchedule.loadEvtsForDay(!1);o.canContinue||(o.overlaps&&Object.keys(o.overlaps).length>0?(console.log("onReloadSaved::OVERLAPPS",o.overlaps),this.handleOverlaps(o.overlaps,null,"view")):(this.doNotify(`Reloaded schedule for ${this.currentDate}`,"positive","bottom"),(this.isViewingPast()||this.currentDate!==oe())&&this.adjustCurrentTime())),this.reset()};if(this.daSchedule.getAllEvts().length>0&&!this.isViewingPast()){let o=i?"Reload? saved schedule of: "+this.currentDate:"Overwrite current Evts?";this.confirmAction(o,"OK",t,e)}else t()},onClearDay(){let i=this.daSchedule.hasEventsForDate();if(this.isViewingPast()){this.doNotify("Editing past is no no!");return}this.daSchedule.resetSchedule();let e=i?"Cleared...Can still Reload saved":"Resetting...";this.doNotify(e,"warning","top"),this.reset(),this.daSchedule.toggleActionBtns(i,"view")},onLoadDefault(){let i=()=>{console.log("Aborting",this.currentDate)},e=t=>{let o=this.daSchedule.scheduleDefaults(t);o.canContinue?this.doNotify("Add of Defaults ...doSave eh","positive"):o.overlaps&&Object.keys(o.overlaps).length>0?this.handleOverlaps(o.overlaps,null,"byDefaults"):this.doNotify("Empty? as no Defaults:(","warning","bottom")};if(this.daSchedule.getAllEvts().length>0){let t=this.daSchedule.unscheduledDefaults();console.log("onLoadDefault::unscheduledDefaults",t==null?void 0:t.length);let o=[{label:`Add ${t==null?void 0:t.length} Default Evts to current day schedule`,value:"add"},{label:"Reset and only schedule Defaults",value:"overwrite"}];this.radioChoiceDialog("Warning!!",`Date: ${this.currentDate} already have scheduled Events...`,o,"",function(l){e(l)},i)}else e("overwrite")},onChoosenPrio(i){this.daSchedule.onChoosenPrio(i)},onChoosenScore(i){this.daSchedule.onChoosenScore(i)},doReloadWithPrio(){if(this.daSchedule.chosenPrio==null){this.doNotify("Ayo select a priority!");return}let i=()=>{console.log("doReloadWithPrio..cancelling"),this.reset()},e=o=>{let l=this.daSchedule.scheduleSamePrio(o);l.canContinue?this.doNotify(`${o} for Priority == ${this.daSchedule.chosenPrio} ...doSave eh`,"positive"):l.overlaps&&Object.keys(l.overlaps).length>0?this.handleOverlaps(l.overlaps,null,"byPrio"):this.doNotify(`Empty for Priority == ${this.daSchedule.chosenPrio} :(`,"warning","bottom")},t=this.daSchedule.chosenPrio;if(this.daSchedule.getAllEvts().length>0){let o=[{label:`Filter current Evts by priority == ${t}`,value:"filter"},{label:`Add to schedule Evts with priority == ${t}`,value:"add"},{label:`Overwrite current and schedule All of priority == ${t}`,value:"overwrite"}];this.radioChoiceDialog("","Schedule change...",o,"",e,i)}else e("overwrite");this.daSchedule.disablePrioBtn=!0},doReloadWithScore(){if(this.daSchedule.chosenScore==null){this.doNotify("Ayo select a score!");return}let i=()=>{console.log("doReloadWithScore..cancelling",this.daSchedule.getAllEvts()),this.reset()},e=o=>{let l=this.daSchedule.scheduleByScore(o);l.canContinue?this.doNotify(`${o} for Score <= ${this.daSchedule.chosenScore} ...doSave eh`,"positive"):l.overlaps&&Object.keys(l.overlaps).length>0?this.handleOverlaps(l.overlaps,null,"byScore"):this.doNotify(`Empty for Score <= ${this.daSchedule.chosenScore} :(`,"warning","bottom")},t=this.daSchedule.chosenScore;if(this.daSchedule.getAllEvts().length>0){let o=[{label:`Filter current Evts by Interval Score <= ${t}`,value:"filter"},{label:`Add to schedule Evts with Interval Score <= ${t}`,value:"add"},{label:`Overwrite current and schedule All of Interval Score <= ${t}`,value:"overwrite"}];this.radioChoiceDialog("","Schedule change...",o,"",e,i)}else e("overwrite");this.daSchedule.disableScoreBtn=!0},doSaveSchedule(){this.daSchedule.saveDaySchedule(),this.doNotify(`Schedule saved for ${this.currentDate}`,"positive","top")},doDroppy(i,e,t){if(e&&t){let o=this.daSchedule.tooClose(e,t.duration);if(o&&(console.log("doDroppy::tooClose to>>",o),o===!0)){this.doNotify("Dropping event TOO close to midnight!"),this.reset();return}let l=this.daSchedule.canDropEvent(e,t);if(l.canContinue)if((t==null?void 0:t.inDefaults)||!(t!=null&&t.canMove)){let n=t!=null&&t.inDefaults?"Default at ":"Cannot Move from",r=[`Evt "${t.title.trim()}" ${n} ${L(t.time)}.`,`
Also update to new time ${L(e.time)}?`,`
Cancel or Dismiss to undo!
\u2800
`,`
No selection to keep default ${L(t.time)}`].join(`
`);const d=this.daSchedule;this.confirmTimeChange("Changing Evt's time",r,"Change","Temp.Move",function(p){d.changeEvtTime(t,e,p)},function(){console.log(`doDroppy::onCancel..>doing nothing for ${t.id})'${t.title.trim()}'`)},function(){console.log(`doDroppy::onDismiss..keep as is>> ${t.id})'${t.title.trim()}'`)})}else this.daSchedule.changeEvtTime(t,e,!1);else this.movedIntoConflict(l.overlaps,!1,i)}else{console.log("doDroppy null ERROR?",e,this.targetDrop,t,this.selectedItem);return}},movedIntoConflict(i,e,t,o=0){console.log("movedIntoConflict >>",JSON.parse(JSON.stringify(i)),"from:"+t,o);const l=(h,c)=>{if(h!=null&&h.parentGoal){let a=this.daSchedule.parentGoalById(h.parentGoal);return c?`Of '${a==null?void 0:a.title.trim()}' (${a==null?void 0:a.priority})`:`Of '${a==null?void 0:a.title.trim()}'`}return console.log("prioLabel..ERROR no PARENT found?",h),""},s=(h,c)=>{switch(c){case"score":return`${l(h,!1)} > "${h.title.trim()}" with Score:: ${h.score} = ${de(h.score)}`;case"prio":return`"${h.title.trim()}" ${l(h,!0)}`;default:return`"${h.title.trim()}" ${l(h,!0)} && Score:: ${h.score} for ${h.duration} mins`}},n=(h,c=!1)=>{this.doNotify(h,c?"warning":"positive","top")},r=h=>{this.daSchedule.deleteEvtMood(h)},d=h=>{let c=this.daSchedule.getCurrentMoods()[h.id];console.log(`handleOverlaps::doRemove ${h.id}:${h.title}`),this.daSchedule.removeScheduledEvt(h,c)},p=(h,c,a)=>{if(console.log(`movedIntoConflict::removeReplace >> replacing>> ${h.id}) '${h.title.trim()}' WITH ${c.id}) ${c.title.trim()}`,a,"from>"+t),e){if(console.log("movedIntoConflict::removeReplace...OVERRIDE from>>"+t),t=="onDrop"){d(h);return}console.log("movedIntoConflict::removeReplace....OVERRIDE updating..."+t),this.daSchedule.doUpdateSchedule(c,a.targetStart);return}d(h),this.daSchedule.doUpdateSchedule(c,a.targetStart)},O=(h,c)=>{let a=this.daSchedule.findEvent(c.target);if(!a){console.log("movedIntoConflict::forceAddMins>>NOT FOUND?!?",c.target);return}let f=this.daSchedule.getStoredRawEvt(c.target);if(f){let v=a.duration+parseInt(o);console.log("movedIntoConflict::forceAddMins>> HAS SAVED*** for:"+a.id,f,JSON.parse(JSON.stringify(a)),v),Object.assign(a,f,{duration:v})}else console.log("movedIntoConflict::forceAddMins >>NEWLY ADDED?!? Error?",a.id,a,f),Object.assign(a,{duration:newDura});this.daSchedule.recurChangeTime(h.id,a,c.targetStart,!1),this.daSchedule.saveDaySchedule()},b=(h,c,a)=>{console.log(`movedIntoConflict::forceAdd:${t} >>${c.id})'${c.title}' at ${c.time}.
          
Changing >>${h.id} from ${h.time} `,a.targetStart.time);let f=this.daSchedule.getStoredRawEvt(a.target);if(f&&(console.log("movedIntoConflict::forceAdd:: has SAVED!",f,JSON.parse(JSON.stringify(c))),Object.assign(c,f,{time:a.targetStart.time})),a.direction!=="surrounding")this.daSchedule.recurChangeTime(h.id,c,a.targetStart,t!="onDrop");else{console.log("movedIntoConflict::forceAdd: gonna addGoalsToSchedule....");let v=this.daSchedule.addGoalsToSchedule([c],!0),u=Object.keys(v).length;if(u>0)return console.log(`movedIntoConflict::forceAdd:: OVERLAPS again of size:${u} from >${t}>`+c.title,JSON.parse(JSON.stringify(v))),this.doNotify(`Extra Overlaps while adding '${c.title.trim()}' `,"warning","top"),this.movedIntoConflict(v,e,t+"nah")}this.scheduleMoodsLabel,this.daSchedule.toggleActionBtns(!0,t)};let m=(h,c,a,f,v)=>{g.push(c),c==a.id?(p(f,a,v),n(`by ${h}, ${t=="onDrop"?"Moving":"Adding"} '${a.title.trim()}'`,!0)):(console.log(`onOkChoice::by ${h},chose scheduled ${c} ...with override?`,e,t),n(`by ${h}, Keeping '${f.title.trim()}'`),t.indexOf("byMood")>-1&&r(a.id),e&&d(a))},y=(h,c)=>{if(e){if(console.log("handleOverlaps::cancelChoice::OVERRIDE...coolios!!from:"+t,h.title.trim()),t=="onDrop"){n("Umm...not moving then...."),this.daSchedule.toggleActionBtns(!1,"view");return}d(h),n(`Keeping '${c.title.trim()}'`);return}t.indexOf("byMood")>-1&&r(h.id),this.daSchedule.toggleActionBtns(!0,"view"),n(`Keeping scheduled '${c.title.trim()}'`)},E=(h,c)=>{g[0]==c?this.daSchedule.toggleActionBtns(!0,t):console.log("onDismissy::no change "+t,h,g[0],c),this.scheduleMoodsLabel};const T=(h,c,a,f)=>{if(h=="opt3"){let v="Pick one event...",u=[{label:s(c,"def"),value:c.id,color:"secondary"},{label:s(a,"def"),value:a.id}];this.radioChoiceDialog("",v,u,"",function(P){m("Choice",P,c,a,f)},null,function(){E("resolveChoice::byEvent... dismissing",c.id)})}else if(h=="opt2"){let v="Pick event by Score",u=[{label:s(c,"score"),value:c.id,color:"secondary"},{label:s(a,"score"),value:a.id}];this.radioChoiceDialog("",v,u,"",function(P){m("Score",P,c,a,f)},null,function(){E("resolveChoice::byScore... dismissing",c.id)})}else if(h=="opt1"){let v="Pick event by Priority",u=[{label:s(c,"prio"),value:c.id,color:"secondary"},{label:s(a,"prio"),value:a.id}];this.radioChoiceDialog("",v,u,"",function(P){m("Priority",P,c,a,f)},null,function(){E("resolveChoice::byPriority... dismissing",c.id)})}else h=="opt0"?(console.log("resolveChoice::it's a drop?...keeping as is....",t),n("Umm...keeping as is then!")):b(a,c,f)},S=(h,c,a,f,v)=>{f.direction!=="surrounding"&&!v&&(t.indexOf("nah")>-1?console.log("movedIntoConflict::manualSolve NOT adding Force as from "+t):h.push({label:`Force in '${c.title.trim()}'`,value:"opt4"}));let u=`Adding '${c.title.trim()}' at ${L(f.targetStart.time)} Overlaps with Scheduled '${a.title.trim()}' at ${L(a==null?void 0:a.time)}.
          
Cancel to keep '${a.title.trim()}' `,P=v?"Choose Auto Resolution":"Resolve Overlapping Events";this.radioChoiceDialog(P,u,h,"opt1",function(q){T(q,c,a,f)},function(){console.log("movedIntoConflict>>manualSolve::cancelChoice? Notif?>> from: "+t,g[0]),n("Umm...keeping as is then!")})};let g=[],D=Object.keys(i).length;for(let h in i){if(!i[h]||!i[h][0]){console.log("movedIntoConflict...skipping unknown key",h);continue}let c=i[h];if(c.length>1){"withID"in i?(console.log("movedIntoConflict::WOAH WOAH...using oneToManyConflict!"+D,JSON.parse(JSON.stringify(c))),this.oneToManyConflict(c,e,t)):(console.log("movedIntoConflict::WOAH WOAH...using manyToOneConflict!"+D,JSON.parse(JSON.stringify(c))),this.manyToOneConflict(c,e,t));continue}let a=[{label:"Choose one event",value:"opt3"}];t=="onDrop"?a.unshift({label:"Leave as is!",value:"opt0"},{label:"Choose by Priority",value:"opt1",color:"secondary"},{label:"Choose by Score",value:"opt2"}):a.unshift({label:"Choose by Priority",value:"opt1",color:"secondary"},{label:"Choose by Score",value:"opt2"});const f=c.pop();let v=this.daSchedule.getSubGoalByID(f.target),u=this.daSchedule.findEvent(f.inConflict);if(!u||!v){console.log("movedIntoConflict...ERROR ERROR no evts found!!!",f);return}let P=this.checkIncludedTitles(v,u);if(t=="onAddMins"){let q=u!=null&&u.inDefaults?"In Defaults":u!=null&&u.canMove?"":"Cannot move",I=`Adding ${o} mins to "${v.title.trim()}" Overlaps with Scheduled "${u.title.trim()}" at ${L(u.time)} as ${q}.
            
Force?
            
Cancel/Dismiss to Leave as is.`;this.confirmAction(I,"Add",function(){O(u,f)},function(){n("Keeping as Is...")},function(){console.log("movedIntoConflict >>onAddMins>> onDismiss")})}else if(console.log("movedIntoConflict::",t,"autoSolve:"+P),P){console.log("movedIntoConflict:: can AUTO schedule",P.addIncSched,P.schdIncToAdd,"direction == surrounding? >>",f.direction=="surrounding"),this.scrollToTime(f==null?void 0:f.targetStart,"slow");let q=`"${v.title.trim()}" at ${L(v.time)} related to Scheduled "${u.title.trim()}" at ${L(u.time)}.
            
Auto resolve Overlap?
            
Cancel/Dismiss to manually choose.`;this.confirmAction(q,"Auto",function(){var I;P.addIncSched?(console.log("Auto resolve::removeReplace..with TIMES>>",v.time,u.time,(I=f==null?void 0:f.targetStart)==null?void 0:I.time),p(u,v,f),n(`Removing Scheduled to Add '${v.title.trim()}'`,!0),g.push(v.id)):(console.log("Auto resolve::cancelChoice >> from: ",t),y(v,u),g.push(u.id))},function(){S(a,v,u,f,!0)},function(){E("Auto-dismiss",g[0])})}else S(a,v,u,f,!1)}},checkIncludedTitles(i,e){let t=i.title.trim().toLowerCase().includes(e.title.trim().toLowerCase()),o=e.title.trim().toLowerCase().includes(i.title.trim().toLowerCase()),l=this.daSchedule.parentGoalById(i.parentGoal),s=this.daSchedule.parentGoalById(e.parentGoal),n=i.title.trim().toLowerCase().includes(s.title.trim().toLowerCase()),r=e.title.trim().toLowerCase().includes(l.title.trim().toLowerCase());return(n||r)&&console.log("checkIncludedTitles:: WOAH PARENT AUTO schedule?--TODO***",n,r,"Normal AUTO>>",t,o),t||o?(console.log("checkIncludedTitles:: can AUTO schedule",t,o),{addIncSched:t,schdIncToAdd:o}):!1},handleOverlaps(i,e=null,t=""){console.log("handleOverlaps >>",JSON.parse(JSON.stringify(i)),"from:"+t);for(let o in i){if(!i[o]||!i[o][0]){console.log("handleOverlaps...skipping unknown key",o);continue}let l=i[o];"withID"in i?(console.log("handleOverlaps::>>oneToManyConflict="+l.length,JSON.parse(JSON.stringify(l))),this.oneToManyConflict(l,e,t)):(console.log("handleOverlaps::>> manyToOneConflict="+l.length,JSON.parse(JSON.stringify(l))),this.manyToOneConflict(l,e,t))}},oneToManyConflict(i,e=null,t=""){var S;let o="",l=null,s=[],n=[],r=new Map,d=null,p=[{label:"Pick one event",value:"opt3"}];const O=g=>this.findhighestPrio(g);let b=g=>this.getSmallestScoreInterval(g),m=(g,D)=>{let h=[];if(D.forEach((c,a,f)=>{if(g.find(v=>v.id==c.id))if(c.id==l.id)if(console.log("removeConflicts::toAdd kept!>"+d.time,c==null?void 0:c.title.trim(),"at orig: "+(c==null?void 0:c.time),t),t=="onDrop")console.log("removeConflicts...NOTHING to do as from"+t);else{let v=r.has(c.id)?r.get(c.id):"",u=this.daSchedule.addGoalsToSchedule([{...c,time:d.time}],!1);if(Object.keys(u).length>0)console.log("removeConflicts::OVERLAP on add",u,c,d.time),h.push(u);else{console.log("removeConflicts::Great NO overlap",c==null?void 0:c.title.trim());let P=`${v} Adding '${c==null?void 0:c.title.trim()}' at ${L(d.time)}`;this.doNotify(P,"positive","top")}}else{console.log("oneToManyConflict::removeConflicts....Keeping scheduled Evt!!",d,c.id);let v=`${r.has(c.id)?r.get(c.id):""} Keeping scheduled '${c==null?void 0:c.title.trim()}'`;this.doNotify(v,"positive","top")}else if(c.id!=l.id){console.log("oneToManyConflict::removing scheduled...doNotify?",c.id,c.title,c.time);let v=this.daSchedule.getCurrentMoods()[c.id];this.daSchedule.removeScheduledEvt(c,v),this.doNotify(`Removed scheduled '${c==null?void 0:c.title.trim()}'`,"warning","bottom")}else console.log("removeConflicts::NOT adding original target",l.id)}),h.length>0)return console.log(`${t}> oneToManyConflict::removeConflict:: OVERLAPS again=${h.length}`,h),this.doNotify("More Overlaps to fix!!!","warning","top"),this.handleOverlaps(h[0],e,t+"nah")};const y=(g,D)=>{console.log(`At ${D.date}:${D.time} forceAdd:${g.id} ${g.title} from ${g.time} >>`+t,JSON.parse(JSON.stringify(l)),s.length,s[s.length-1]);let h=this.daSchedule.addGoalsToSchedule([{...g,time:D.time}],!0),c=Object.keys(h).length;if(c>0)return console.log(`${t} >oneToManyConflict::forceAdd:: OVERLAPS again from ${l.length} overlaps =${c}`,JSON.parse(JSON.stringify(h))),this.doNotify(`Extra Overlaps while adding '${g.title.trim()}'`,"negative","top"),this.handleOverlaps(h,e,t+"nah");this.scheduleMoodsLabel};let E=g=>{this.radioChoiceDialog("","Choose one Event to keep",g.map(this.getEvtLabel),"",function(D){let h=g.find(c=>c.id==D);if(h)n.push(h),r.set(h.id,"By choice,");else{console.log("chooseEvt::ERROR NOT FOUND!!",D);return}return console.log(`chooseEvt::onOk >>${D} >> ${h==null?void 0:h.title.trim()}`),h},null,function(){n.length>0&&(console.log("chooseEvt::onDismiss >>set removeConflicts out of total="+g.length,JSON.parse(JSON.stringify(n))),setTimeout(()=>{m(n,g)},0))})};t=="byScore"?p.unshift({label:"Resolve by Highest Priority",value:"opt1",color:"secondary"}):t=="byPrio"?p.unshift({label:"Resolve by Shortest Score Interval",value:"opt2"}):p.unshift({label:"Resolve by Highest Priority",value:"opt1",color:"secondary"},{label:"Resolve by Shortest Score Interval",value:"opt2"});for(let g of i){console.log("oneToManyConflict::Handling:> "+t,JSON.parse(JSON.stringify(g)));let D=this.daSchedule.findEvent(g.inConflict);if(!D){console.log("oneToManyConflict...ERROR ERROR no evts found!!!",g);return}s.push(D),o+=` '${D==null?void 0:D.title.trim()}',
`,d?d.time!=((S=g==null?void 0:g.targetStart)==null?void 0:S.time)&&console.log("oneToManyConflict...ERROR Not same targetStart?!?",d,g==null?void 0:g.targetStart,g.direction):d=g==null?void 0:g.targetStart;let h=this.daSchedule.getSubGoalByID(g.target);if(!h){console.log("oneToManyConflict...ERROR ERROR local evt not found!!!",g);return}l=h,g.direction!=="surrounding"&&p.length<3&&p.push({label:`Force in '${l.title.trim()}'`,value:"opt4"})}let T=`'${l==null?void 0:l.title.trim()}' conflicts with scheduled ${o} 
`;s.unshift(l),this.radioChoiceDialog("Solve Overlaps!!",T,p,"",function(g){var D;if(g=="opt3")E(s);else if(g=="opt2"){let h=b(s);console.log("oneToManyConflict::ByScore",h.id,h==null?void 0:h.title.trim(),h.score),n.push(h),r.set(h.id,`By shortest score interval (${h.score}),`)}else if(g=="opt1"){let h=O(s);console.log("oneToManyConflict::ByPriority",h.e.id,(D=h==null?void 0:h.e)==null?void 0:D.title.trim()),n.push(h.e),r.set(h.e.id,`By highest priority (${h.prio}),`)}else console.log("oneToManyConflict::forceAdd..."),y(l,d)},null,function(){n.length>0&&(console.log("oneToManyConflict::onDismiss Main >> removeConflicts from total="+s.length,JSON.parse(JSON.stringify(n))),setTimeout(()=>{m(n,s)},0))})},manyToOneConflict(i,e=null,t=""){var D,h,c;let o="",l=[],s=null,n=[],r=null,d=new Map,p=new Map,O=[{label:"Pick one event",value:"opt3"}];const b=a=>this.findhighestPrio(a);let m=a=>this.getSmallestScoreInterval(a),y=(a,f)=>{console.log(`manyToOneConflict::removeConflicts with toKeep=${a.length} out of total:${f.length}`);let v=[];if(f.forEach((u,P,q)=>{if(a.find(I=>I.id==u.id)){let I=p.has(u.id)?p.get(u.id):"",W=d.has(u.id)?d.get(u.id):null;if(console.log("manyToOneConflict::removeConflicts:KEEEP..TIME? by>"+I,u.id,u==null?void 0:u.title.trim(),u==null?void 0:u.time,r,W==null?void 0:W.time),W?this.scrollToTime(W,"slow"):console.log("removeConflicts::cant scrolly as null",W),u.id!=s.id){let he=this.daSchedule.getStoredRawEvt(u.id);he&&(console.log("removeConflicts::CAN use SAVED for:"+u.id,he),Object.assign(u,he));let ve=this.daSchedule.addGoalsToSchedule([{...u,time:r}],!0);if(Object.keys(ve).length>0)v.push(ve),this.doNotify(`Extra Overlaps while adding '${u==null?void 0:u.title.trim()}'`,"negative","top");else{let ke=`${I} Adding '${u==null?void 0:u.title.trim()}' at ${L(r)}`;this.doNotify(ke,"warning","top")}}else this.doNotify(`${I} Keeping scheduled '${u==null?void 0:u.title.trim()}' `,"positive","top")}else if(u.id==s.id){console.log("manyToOneConflict::removeConflicts...removing scheduled!!",u.id,u.title);let I=this.daSchedule.getCurrentMoods()[u.id];this.daSchedule.removeScheduledEvt(u,I)}}),v.length>0)return console.log(`${t} > manyToOneConflict::removeConflicts:: OVERLAPS again from ${a.length} overlaps =${v.length}`,v),this.doNotify("More Overlaps to fix!!!","warning","top"),this.handleOverlaps(v[0],e,t+"nah");this.daSchedule.toggleActionBtns(!0,t)},E=a=>{this.radioChoiceDialog("","Choose one Event to schedule",a.map(f=>this.getEvtLabel(f,!1)),"",function(f){let v=a.find(u=>u.id==f);if(v)n.push(v),p.set(v.id,"By pick,");else{console.log("chooseEvt::ERROR NOT FOUND!!",f);return}return v},null,function(){n.length>0&&(console.log("chooseEvt::onDismiss >> LAST?",JSON.parse(JSON.stringify(n))),setTimeout(()=>{y(n,a)},0))})};const T=a=>{let f=[];a.forEach(v=>{if(s.id!=v.id){let u=d.has(v.id)?d.get(v.id):null;console.log(`manyToOneConflict::forceAdd...NEW:${v.id} '${v.title.trim()}' dura= ${v.duration} origAt: ${v.time} to>>`,u.time,"from>>"+t),this.scrollToTime(u,"slow");let P=this.daSchedule.getStoredRawEvt(v.id);P&&(console.log("manyToOneConflict::forceAdd >>has SAVED!"+v.id,P,JSON.parse(JSON.stringify(v))),Object.assign(v,P,{time:u.time})),this.daSchedule.recurChangeTime(s.id,v,u,t!="onDrop")}}),this.scheduleMoodsLabel,f.length>0&&(console.log(`${t}> manyToOneConflict::forceAdd:: OVERLAPS again=${f.length}`,f),this.doNotify("More Overlaps to fix!!>"+f.length,"warning","top")),this.daSchedule.toggleActionBtns(!0,t)};t=="byScore"?O.unshift({label:"Resolve by Highest Priority",value:"opt1",color:"secondary"}):t=="byPrio"?O.unshift({label:"Resolve by Shortest Score Interval",value:"opt2"}):O.unshift({label:"Resolve by Highest Priority",value:"opt1",color:"secondary"},{label:"Resolve by Shortest Score Interval",value:"opt2"});let S=!1;for(let a of i){console.log("manyToOneConflict::handling:>"+t,JSON.parse(JSON.stringify(a)));let f=this.daSchedule.findEvent(a.inConflict);if(!f){console.log("manyToOneConflict...ERROR ERROR no evts found!!!",a);return}s?s.id!=f.id&&console.log("manyToOneConflict::ERROR::ERROR Not same inConflict",s.id,f.id):(s=f,r=(D=a==null?void 0:a.targetStart)==null?void 0:D.time);let v=this.daSchedule.getSubGoalByID(a.target);if(!v){console.log("manyToOneConflict...ERROR ERROR local evt not found!!!",a);return}o+=` '${v==null?void 0:v.title.trim()}',
`,l.push(v),d.set(a.target,a==null?void 0:a.targetStart),a.direction=="surrounding"?S=!0:S=S,((h=a==null?void 0:a.targetStart)==null?void 0:h.time)!=r&&console.log("manyToOneConflict::WELL WELL timey diff?",r,(c=a==null?void 0:a.targetStart)==null?void 0:c.time,a==null?void 0:a.direction,v.title)}S||t.indexOf("nah")>-1?console.log("manyToOneConflict::NOT adding Force as from "+t,S):O.push({label:`Force in > ${o}`,value:"opt4"});let g=`${o} conflicts with scheduled '${s==null?void 0:s.title.trim()}' at ${L(s==null?void 0:s.time)}.
`;l.unshift(s),this.radioChoiceDialog("Many to One Overlaps!",g,O,"",function(a){if(a=="opt3")E(l);else if(a=="opt2"){let f=m(l);n.push(f),p.set(f.id,`By Shortest score interval (${f.score}),`)}else if(a=="opt1"){let f=b(l);n.push(f.e),p.set(f.e.id,`By highest priority (${f.prio}),`)}else T(l)},null,function(){n.length>0&&(console.log("manyToOneConflict::onDismiss Main >> LAST?",n),setTimeout(()=>{y(n,l)},0))})},reset(){this.selectedItem=null,this.targetDrop=null,this.touchedItem=null,this.daSchedule.resetChosen(),this.possibleRange=null},closingDialog(){this.showEvtDialog=!1},onPickEvent(i,e,t){if(this.closingDialog(),!i){console.log("onPickEvent...ERROR nothing!",i,e,t),this.doNotify("No Goal selected..."),this.reset();return}let o=this.daSchedule.isViewingPast()?!0:e,l=this.daSchedule.tooClose(this.targetDrop.timestamp,i.duration);if(l){if(console.log("onPickEvent::tooClose check FAIL!",l),l===!0){this.doNotify("Picking event TOO close to midnight!"),this.reset();return}if(o)this.doNotify(`'${i.title.trim()}' TOO close Buuut..FORCING!`,"warning","top");else{this.doNotify(`'${i.title.trim()}' Not added as TOO close to a scheduled Evt`),this.reset();return}}let s=this.daSchedule.onPickEvent(i,this.targetDrop.timestamp,o,t);s.canContinue?t&&(console.log("onPickEvent::NO OVERLAPS"),this.doNotify("What is Owed PAID! gg!","positive","top")):(console.log("onPickEvent::OVERLAPS!"+t,JSON.parse(JSON.stringify(s))),s.overlaps&&Object.keys(s.overlaps).length>0?(t&&this.doNotify("Overlaps!-Balance Not Used!","warning","top"),this.handleOverlaps(s.overlaps,null,"onPickEvt")):this.doNotify("Error? onPickEvt :(","negative","bottom"))},onAddHocEvent(i,e,t,o,l){if(this.possibleRange||(this.possibleRange=this.startEndTimes),i.trim()==""){this.doNotify("Empty Goal title..."),this.closingDialog(),this.reset();return}let s=pe(this.possibleRange[0]),n=o>15?w(s,{minute:parseInt(o)}):w(pe(this.possibleRange[1]),{minute:15}),r=Math.floor(F(s,n)/1e3/60),d=this.daSchedule.tooClose(s,r);if(d){if(console.log("onAddHocEvent::tooClose check FAIL!!",d),this.closingDialog(),d===!0){this.doNotify(`'${i}' Not added as over midnight!`);return}this.doNotify(`'${i}' too close to a scheduled Evt--Forcing!!`,"warning")}this.closingDialog();let p=this.daSchedule.saveNewGoal(s,i,e,t,r);if(p){let O=this.daSchedule.onAdHocEvent(p,s,l);if(O.canContinue)this.constructTree(),this.reset(),this.doNotify("New adHoc Evt added!","positive","top"),this.mobile&&this.adjustCurrentTime();else if(console.log("onAdHocEvent::OVERLAPS?",JSON.parse(JSON.stringify(O))),O.overlaps==null){this.doNotify("Error Adding this event :(","negative"),console.log("onAdHocEvent::ERROR not found?");return}else l&&this.doNotify("Overlaps!-Balance Not Used!","warning","top"),this.handleOverlaps(O.overlaps,null,"adHocEvt")}else console.log("BOO ERROR no subID:(",p),this.doNotify("Error creating and adding this event :(","negative")},onEndNow(i){const e=()=>{console.log("onEndNow::removing and saving!",i);let l=this.daSchedule.findEvent(i);this.daSchedule.removeScheduledEvt(l),this.daSchedule.saveDaySchedule()},t=l=>{console.log("onEndNow::reducing!!!",i,Number.isInteger(l)),this.daSchedule.reduceEvtDuration(i,l)};let o=this.daSchedule.canEndNow(i);o?this.confirmAction(`Less than 10mins remove?
 Cancel to just EndNow`,"OK",e,function(){t(o)}):console.log("onEndNow...Can NOT end?",i,o,Number.isInteger(o))},onSaveScore(i,e,t=""){let o=de(i);if(o<-1){o==-89?(console.log("onSaveScore parsing error",o,i),this.doNotify("Score Parsing Error... YOU FOO! ")):this.doNotify("Score Error: higher# on lower#");return}this.daSchedule.updateNoteScore(e,i,t)},onAddMins(i,e){let t=this.daSchedule.addMinsToEvt(i,e);if(!t.canContinue){if(t.overlaps&&Object.keys(t.overlaps).length>0)return console.log("onAddMins::OVERLAPS!!"+e,t),this.movedIntoConflict(t.overlaps,!0,"onAddMins",e);this.doNotify("Add ERROR:(","negative","bottom")}},removeEvtInSchedule(i){let e=!1,t=()=>{if(this.daSchedule.removeScheduledEvt(i,e),e){console.log("removeEvtInSchedule..autoSave for: "+i.title),this.daSchedule.saveDaySchedule();return}this.daSchedule.toggleActionBtns(!0,"view")};if(this.daSchedule.isViewingPast()){if(i.duration<30){this.doNotify("Removing from the past... Check BALANCE!"),this.daSchedule.addToBalance(i),e=!0,t();return}this.chooseAlternatives(i);return}if(!this.daSchedule.isViewingToday()&&!this.mobile){e=this.daSchedule.getCurrentMoods()[i.id],t(),console.log("Removed future evt");return}let o=`Remove "${i.title}" from schedule?`,l=this.daSchedule.getCurrentMoods()[i.id];l&&(console.log("removeEvtInSchedule with MOOD?!?",l),e=!0,o=o+" With Mood "+l),this.confirmAction(o,"Remove",t,function(){console.log("Cancelled remove")})},getEvtLabel(i,e=null){let t=this.daSchedule.parentGoalById(i.parentGoal),o=`Of '${t==null?void 0:t.title.trim()}' "${i.title.trim()}" (${i.score}) `;return o+=e?`@ ${L(i==null?void 0:i.time)} ++ ${i==null?void 0:i.duration} mins`:`for ${i==null?void 0:i.duration} mins`,{label:o,value:i.id}},getSmallestScoreInterval(i){let e=9,t=null;for(let o of i){let l=de(o.score);l>-1&&l<=e&&(e=l,t=o)}if(t)return t;console.log("ERROR ERROR getSmallestScoreInterval::No current set?",e,t,i)},findhighestPrio(i){let e=0,t=null;for(let o of i)if(o.parentGoal){let l=this.daSchedule.parentGoalById(o.parentGoal);l?l.priority>e&&(e=l.priority,t=o):console.log("findhighestPrio::ERROR no PARENT found?",o)}else console.log("findhighestPrio::ERROR EVT not found?",o);return{e:t,prio:e}},chooseAlternatives(i){let e=(b,m)=>{if(b.parentGoal>m.parentGoal)return 1;if(b.parentGoal==m.parentGoal)return 0;if(b.parentGoal<m.parentGoal)return-1},t=this.daSchedule.getAltEvts().sort(e),o=U(new Date);console.log("chooseAlternatives >>ALTS:",JSON.parse(JSON.stringify(t)),o.date);let l=i.time,s=o.date,n=i.title;const r=b=>b.filter(m=>!this.daSchedule.getAllEvts().find(y=>y.id==m.id)),d=b=>{let m=w(x(s),{day:0}),y=w(x(m.date),{day:1}),E=this.daSchedule.getEventsForDate(m.date),T={},S=null;E?T=E:console.log("chooseAlternatives::addInFutur EMPTY for >>...",m.date),b.forEach(g=>{if(S=this.daSchedule.getSubGoalByID(g),T[g]){console.log("addInFutur...ALREADY PRESENT",g,m.date,S==null?void 0:S.title.trim()),this.doNotify(`Alternative '${S==null?void 0:S.title.trim()}' already present on ${m.date}. Moving it to next day`,"warning");let D=this.daSchedule.getEventsForDate(y.date);if(D)if(!D[g])D[g]={duration:S==null?void 0:S.duration,time:l,notes:`Alt replace for '${n}'`};else{console.log("addInFutur...STILL PRESENT in next day:"+y.date,S.title.trim()),this.doNotify(`Booo! Alt '${S==null?void 0:S.title.trim()}' also present on ${y.date} :(( ...Check BALANCE!`),this.daSchedule.addToBalance(S);return}else D={},D[g]={duration:S.duration,time:l,notes:`Alt replace for '${n}'`};this.daSchedule.updateDaySchedule(y.date,D),this.doNotify(`Saving ${S.title} in ${y.date}`,"positive","bottom")}else T[g]={duration:S.duration,time:l,notes:`Alt replace for '${n}'`}}),console.log("chooseAlternatives::addInFutur>>>",m.date,JSON.parse(JSON.stringify(T))),this.daSchedule.updateDaySchedule(m.date,T)},p=b=>{this.daSchedule.removeScheduledEvt(i);let m=t.find(T=>T.id==b);console.log("remReplace...Add at:",l,m.title,"usually at:"+m.time);let y=this.daSchedule.addGoalsToSchedule([{...m,time:l,notes:`Alt replace for '${n}'`}],!0),E=Object.keys(y).length;if(E>0)return console.log(`chooseAlternatives::removeReplace:: OVERLAPS again from ${m.length} overlaps =${E}`,m,y),this.doNotify(`Extra Overlaps while adding ${m[0].title.trim()}`,"warning","top"),this.handleOverlaps(y,null,"alts");this.daSchedule.saveDaySchedule(),this.doNotify(`Added Alt replacement '${m==null?void 0:m.title}' at ${l}`,"positive","bottom")},O=b=>{this.doNotify(b)};if(t=r(t),t.length==0){O("Removing not allowed! Alternatives already present!");return}this.checkBoxDialog("Gotta pick alternative!","Select the first Evt to replace Removed + an Extra evt for next day (today)!",t.map(b=>this.getEvtLabel(b,!1)),t[0].id,function(b){console.log("chooseAlternatives::opt",b),p(b.shift()),b.length>0?d(b):(console.log("chooseAlternatives::onOk...nothing to add?!?",t.length,b.length,t.length-b.length),O("No Alternative scheduled later :("))},function(){console.log("chooseAlternatives::onCancel")})},onPrev(){let i=()=>{this.$refs.calendar.prev()},e=()=>{setTimeout(i,1e3),this.doSaveSchedule()};this.saveScheduleDisabled?i():this.confirmAction(`Save day: ${this.currentDate} changes?`,"Save",e,i)},onToday(){let i=()=>{this.$refs.calendar.moveToToday()},e=()=>{setTimeout(i,1e3),this.doSaveSchedule()};this.saveScheduleDisabled?i():this.confirmAction(`Save day: ${this.currentDate} changes?`,"Save",e,i)},onNext(){let i=()=>{this.$refs.calendar.next()},e=()=>{setTimeout(i,1e3),this.doSaveSchedule()};this.saveScheduleDisabled?i():this.confirmAction(`Save day: ${this.currentDate} changes?`,"Save",e,i)},onChange(){let i=this.daSchedule.onChangeViewDate(this.currentDate);i.canContinue?this.doNotify("Empty for currentDay :(","warning","bottom"):i.overlaps&&Object.keys(i.overlaps).length>0?this.movedIntoConflict(i.overlaps,null,"view"):(this.doNotify(`Loaded schedule for ${this.currentDate}`,"positive","bottom"),(this.isViewingPast()||this.currentDate!==oe())&&this.adjustCurrentTime())},onDragStart(i,e){if(this.daSchedule.isViewingPast()){this.doNotify("Editing past is no no!"),i.preventDefault();return}this.selectedItem=e},onDragEnter(i,e,t){return e==="goal-item"||(this.targetDrop=t),i.preventDefault(),!0},onDragOver(i,e,t){return i.preventDefault(),!0},onDragLeave(i,e,t){return!1},onDragEnd(i){},onDrop(i,e,t){let o=this.daSchedule.findEvent(this.selectedItem.id);if(!o){console.log("onDrop ERROR",o,this.selectedItem);return}let l=null;if(e==="interval")l=t.timestamp;else if(e==="goal-item"&&this.targetDrop)l=this.targetDrop.timestamp;else{console.log("Cannot drop here YO!!",i,e,t,this.targetDrop);return}if(!l){console.log("ERROR...no timestamp YO!!",i,e,t,this.targetDrop);return}this.doDroppy("onDrop",l,this.selectedItem)},onClickTime(i){this.showEvtDialog=!0,this.targetDrop=i.scope},onClickDate(i){console.log("onClickDate",i)},onClickInterval(i){console.log("onClickInterval",i)},onClickHeadIntervals(i){console.log("onClickHeadIntervals",i)},onClickHeadDay(i){console.log("onClickHeadDay",i)},onMouseEnter(i){console.log("onMouseAt",i)},onMouseLeave(i){console.log("onMouseLeave",JSON.stringify(i))},onMouseDownTime({scope:i,event:e}){if(_e(e)){if(this.mobile===!0&&this.anchorTimestamp!==null&&this.otherTimestamp!==null&&X(this.anchorTimestamp)===X(this.otherTimestamp)){this.otherTimestamp=i.timestamp,this.mouseDown=!1;return}this.mouseDown=!0,this.anchorTimestamp=i.timestamp,this.otherTimestamp=i.timestamp}},onMouseUpTime({scope:i,event:e}){if(this.mobile!==!0&&_e(e)&&(this.otherTimestamp=i.timestamp,this.mouseDown=!1),!this.mousedown){let t=this.startEndTimes;if(t[1]==t[0])return;this.possibleRange=t,console.log("onMouseUpTime range change",this.possibleRange)}},onMouseMoveTime({scope:i,event:e}){this.mobile!==!0&&this.mouseDown===!0&&(this.otherTimestamp=i.timestamp)},onDblClickEvent(i,e){if(this.isViewingPast()){if(e.duration<30){console.log("onDblClickEvent..baah too smoll smoll",e.title,e.duration),this.doNotify("umm Removing from the past..Soo Check BALANCE!"),this.daSchedule.addToBalance(e),this.daSchedule.removeScheduledEvt(e);return}this.chooseAlternatives(e),i.preventDefault();return}this.removeEvtInSchedule(e),i.preventDefault()},onTouchStart(i,e){if(i.type=="touchstart"){this.selectedItem=e;let t=document.elementFromPoint(i.changedTouches[0].clientX,i.changedTouches[0].clientY);if(t.parentNode.classList.contains("my-event"))console.log("onTouchStart >>my-event-drag","isDisabledScoreEdit>> "+this.daSchedule.isDisabledScoreEdit[e.id],"showMobileDialog>> "+this.daSchedule.showMobileDialog[e.id]),t.parentNode.classList.add("my-event-drag"),this.touchedItem=t;else{let o=t.closest(".my-event");if(t=t.parentNode,t.parentNode.classList.contains("my-event"))console.log("onTouchStart >>PHEW..FOUND","isDisabledScoreEdit>> "+this.daSchedule.isDisabledScoreEdit[e.id],o),t.parentNode.classList.add("my-event-drag"),this.touchedItem=t;else{this.touchedItem=!1;return}}return i.preventDefault(),!0}console.log("onTouchStart::ERROR...UNKNOWN",i)},onTouchEvt(i,e){const t=l=>{let s=l.split(" "),n=s[s.length-2],r=w(x(this.currentDate),{minute:V(n)});return s[s.length-1]=="PM"?r.hour==12?r:w(x(this.currentDate),{hour:12,minute:V(n)}):r.hour==12?w(x(this.currentDate),{hour:-12,minute:V(n)}):r};let o=l=>{let s=l.closest(".my-event");s.classList.contains("my-event-drag")?s.classList.toggle("my-event-drag"):console.log("onTouchEvt::resetClass...AINT THERE!",s,l)};if(this.selectedItem||(console.log("onTouchEvt NULL Item ?!? >> "+i.type,this.selectedItem,this.touchedItem),e=this.selectedItem),i.type=="touchmove"){if(this.isViewingPast()){this.doNotify("Editing past is no no!"),i.preventDefault(),i.stopPropagation();return}let l=document.elementFromPoint(i.changedTouches[0].clientX,i.changedTouches[0].clientY);if(l.ariaLabel){let s=t(l.ariaLabel);if(this.targetDrop){let n=F(this.targetDrop,s);if(JSON.stringify(this.targetDrop)===JSON.stringify(s)&&n==0)return}this.targetDrop=s,i.preventDefault();return}else{let s=l.closest(".my-event");s&&!s.classList.contains("my-event-drag")&&console.log("onTouchEvt::move >>TO ADD AGAIN?!?",s,l,this.touchedItem)}return}if(i.type=="touchend"){let l=document.elementFromPoint(i.changedTouches[0].clientX,i.changedTouches[0].clientY);if(this.isViewingPast()){this.doNotify("Editing past is no no!"),o(this.touchedItem),i.preventDefault(),i.stopPropagation();return}if(this.touchedItem)if(l.parentNode.classList.contains("my-event-drag"))console.log("onTouchEvt::END >>removing my-event-drag","isDisabledScoreEdit>> "+this.daSchedule.isDisabledScoreEdit[e.id],"mobileEnableScore>> "+this.daSchedule.mobileEnableScore[e.id]),l.parentNode.classList.remove("my-event-drag");else{let s=this.touchedItem.parentNode.classList.contains("my-event-drag");s?this.touchedItem.parentNode.classList.remove("my-event-drag"):console.log("onTouchEvt::END... target NO my-event-drag?",s,l,l.parentNode)}else return;if(l.ariaLabel){let s=t(l.ariaLabel);this.targetDrop=s,this.doDroppy("onTouch",this.targetDrop,this.selectedItem)}else console.log("onTouchEvt::END>>ERROR?OVERLAP?",i,l,l.parentNode,this.mobile,this.daSchedule.isDisabledScoreEdit[e.id]),l.classList.contains("title")&&(console.log("onTouchEvt::END--has title!",this.targetDrop),this.targetDrop&&this.doDroppy("onTouch",this.targetDrop,this.selectedItem));i.preventDefault(),i.stopPropagation();return}console.log("onTouchEvt::UNKNOWN",i)},onTouchHold({evt:i,...e},t){if(!this.mobile)return console.log("onTouchHold>>NOT MOBILE",i.type,"mobileEnableScore>> "+this.daSchedule.mobileEnableScore[t.id]),!0;let o=document.elementFromPoint(i.changedTouches[0].clientX,i.changedTouches[0].clientY);this.daSchedule.toggleEvtNoteScoreMobile(t.id);let l=o.closest(".my-event");o.classList.contains("title")&&o.parentNode.classList.contains("my-event-drag")?(console.log("onTouchHold...REMOVING my-event-drag"),o.parentNode.classList.remove("my-event-drag")):l&&l.classList.contains("my-event-drag")?l.classList.toggle("my-event-drag"):(console.log("onTouchHold::class not found on Target!!",o,this.touchedItem),this.touchedItem&&(l=this.touchedItem.closest(".my-event"),l&&l.classList.contains("my-event-drag")?l.classList.toggle("my-event-drag"):console.log("ERROR...onTouchHold--class not found on Target!!",o,this.touchedItem))),this.daSchedule.isDisabledScoreEdit[t.id]&&!this.daSchedule.mobileEnableScore[t.id]&&(console.log("onTouchHold::dblClicking!",this.daSchedule.showEvtNoteScoreMobile(t.id)),this.onDblClickEvent(i,t))},scrollToEvent(i){this.$refs.calendar.scrollToTime(i.time,350)},scrollToTime(i,e=null){var t;if(this.$refs.calendar){let o=w(i,{minute:-30});console.log("scrollToTime::gonna SCROLL",i.time,o.time,e),(t=this.$refs.calendar)==null||t.scrollToTime(o.time,e?e=="fast"?400:1e3:500)}else console.log("scrollToTime::NO SCROLLY",i.time,JSON.parse(JSON.stringify(this.$refs)))},confirmTimeChange(i,e,t,o,l,s,n=null){this.$q.dialog({title:i,message:e,cancel:!1,ok:t,options:{type:"radio",model:"",items:[{label:t+" and "+o,value:"ok"},{label:o,value:"alt"}]},class:"overflow-wrap: break-word;",style:""}).onOk(r=>{if(r==""){console.log("confirmTimeChange onOk with no selection >>onDismiss"),this.doNotify("No selection made...Defaulting","positive","bottom"),n?n():console.log("confirmTimeChange:: No Dismiss func to execute!");return}return l(r)}).onCancel(()=>{s()})},radioChoiceDialog(i,e,t,o,l=null,s=null,n=null){this.$q.dialog({title:i,cancel:!!s,persistent:!0,message:e,options:{type:"radio",model:o,items:t}}).onOk(r=>{l&&(r==""?this.radioChoiceDialog(i,e,t,o,l,s,n):l(r))}).onCancel(()=>{s&&s()}).onDismiss(()=>{n&&n()})},checkBoxDialog(i,e,t,o,l=null,s=null,n=null){let r=t.length,d=r>2?2:r;this.$q.dialog({title:i,message:e,options:{type:"checkbox",model:[],isValid:p=>p.length>0&&p.length>=d,items:t},cancel:!0,persistent:!0}).onOk(p=>{l(p)}).onCancel(()=>{s&&s()}).onDismiss(()=>{n&&n()})},confirmAction(i,e,t,o,l=null){this.$q.dialog({title:"Warning",cancel:!0,ok:e,message:i}).onOk(()=>{t()}).onCancel(()=>{o()}).onDismiss(()=>{if(l){l();return}})},doNotify(i,e=void 0,t="top"){this.$q.notify({color:e!==void 0?e:"negative",position:t,message:i,icon:e==null?"report_problem":"thumb_up"})},withDismissNotify(i,e=void 0,t="top",o=null,l=null){this.$q.notify({color:e!==void 0?e:"negative",position:t,message:i,icon:e==null?"report_problem":"thumb_up",timeout:o!=null?o:5e3,closeBtn:"Okey",onDismiss:l})}}},ce=i=>(Qe("data-v-64efe500"),i=i(),Ke(),i),Ct={class:"subcontent"},wt={class:"q-px-md boxy"},Rt={key:0},Nt={key:1},At={key:2},Pt={key:3},Mt={key:4},_t={key:5},$t={class:"row justify-center"},kt=ce(()=>$("br",null,null,-1)),Bt=ce(()=>$("br",null,null,-1)),Lt={key:0,class:"q-pa-sm bg-grey-12",style:{"max-width":"400px"}},It={class:"q-pa-sm row justify-center"},xt={class:"row justify-center"},Gt=ce(()=>$("br",null,null,-1)),Vt={key:0,class:"q-gutter-md"},Ft={class:"q-mr-sm text-weight-bold",size:"28px"},Ht={key:0},Jt={class:"text-weight-bold"},jt={key:1,class:"text-weight-light text-black"},Ut={key:1,class:"q-pa-md q-gutter-sm bg-grey-12",style:{"max-width":"400px"}},qt={key:0,class:"q-ma-xl column items-center instru"},Wt={key:1,class:"q-ma-xl column items-center instru"},zt={key:0,class:"row"},Qt={class:"row justify-center"},Kt={class:"q-gutter-md",style:{display:"flex","max-width":"800px",width:"100%",height:"600px"}},Yt={style:{display:"flex","justify-content":"center","flex-wrap":"wrap",padding:"2px"}},Xt={class:"heady q-calendar__ellipsis"},Zt=["onDblclick","onDragstart","onTouchstart","onTouchmove","onTouchend"],eo=ce(()=>$("br",null,null,-1));function to(i,e,t,o,l,s){const n=H("sched-btn"),r=H("drop-dwn-btn"),d=H("navigation-bar"),p=H("goaly-end"),O=H("mobileNoteScore"),b=H("q-calendar-day"),m=H("sched-dialog");return R(),J(lt,{padding:""},{default:N(()=>[$("div",Ct,[C(Re,{modelValue:l.splitterPage,"onUpdate:modelValue":e[9]||(e[9]=y=>l.splitterPage=y),limits:[30,70]},{before:N(()=>[C(Re,{modelValue:l.splitterLegend,"onUpdate:modelValue":e[3]||(e[3]=y=>l.splitterLegend=y),horizontal:"",limits:[20,80],style:{height:"100%"}},{before:N(()=>[$("div",wt,[l.daSchedule.getProps().showReloadBtn?(R(),M("div",Rt,[C(n,{"text-label":"Reload",class:"sched-btn","text-color":"green",onDoBtnAction:s.onReloadSaved},null,8,["onDoBtnAction"])])):_("",!0),l.daSchedule.getProps().showClearBtn?(R(),M("div",Nt,[C(n,{"text-label":"Clear",class:"sched-btn","text-color":"lime-5",onDoBtnAction:s.onClearDay},null,8,["onDoBtnAction"])])):_("",!0),s.showDefaultBtn?(R(),M("div",At,[C(n,{textLabel:s.defaultLabels,class:"sched-btn","text-color":"blue",onDoBtnAction:s.onLoadDefault},null,8,["textLabel","onDoBtnAction"])])):_("",!0),l.daSchedule.getProps().showScoreBtn?(R(),M("div",Pt,[C(r,{class:"sched-drop-btn","text-color":"teal",disableBtn:l.daSchedule.disableScoreBtn,optionLabel:s.chosenScoreLabel,daOptions:l.scoreOptions,onDoReload:s.doReloadWithScore,onChooseOption:s.onChoosenScore},null,8,["disableBtn","optionLabel","daOptions","onDoReload","onChooseOption"])])):_("",!0),l.daSchedule.getProps().showPrioBtn?(R(),M("div",Mt,[C(r,{class:"sched-drop-btn","text-color":"teal",disableBtn:l.daSchedule.getProps().disablePrioBtn,optionLabel:s.chosenPrioLabel,daOptions:s.allMainGPrio(),onDoReload:s.doReloadWithPrio,onChooseOption:s.onChoosenPrio},null,8,["disableBtn","optionLabel","daOptions","onDoReload","onChooseOption"])])):_("",!0),l.daSchedule.getProps().showOneEachBtn?(R(),M("div",_t,[C(n,{"text-label":"One Each",class:"sched-btn","text-color":"brown",onDoBtnAction:s.onScheduleOneEach},null,8,["onDoBtnAction"])])):_("",!0)]),$("div",$t,[C(Ee,{class:"q-mt-md","text-color":s.saveScheduleDisabled?"grey":"blue",elevated:"",push:"",align:"evenly",label:"SaveSchedule",disable:s.saveScheduleDisabled,onClick:s.doSaveSchedule,"no-caps":""},null,8,["text-color","disable","onClick"]),C(Ee,{class:"q-mt-md","text-color":"green",elevated:"",push:"",align:"evenly",label:l.showTree?"HideTree":"ShowTree",onClick:e[0]||(e[0]=y=>l.showTree=!l.showTree),"no-caps":""},null,8,["label"])]),kt]),after:N(()=>[Bt,l.treeGoals.length>0?(R(),M("div",Lt,[$("div",It,G(s.labelGoals("s")),1),$("div",xt,[C(ne,{color:"secondary","multi-line":""},{default:N(()=>[B(G(s.labelGoals("b"))+" mins ",1)]),_:1})]),C(K),Gt,s.showTreeForm?(R(),M("div",Vt,[C(tt,{label:"'je-suis'",hint:"Keyword >> Enter","hide-hint":"",ref:"filterRef",modelValue:l.filter,"onUpdate:modelValue":e[1]||(e[1]=y=>l.filter=y),"use-input":"","use-chips":"",multiple:"",disable:s.isViewingPast(),"hide-dropdown-icon":"","input-debounce":"0","new-value-mode":"add-unique",class:"q-gutter-sm"},{"selected-item":N(y=>[C(ot,{removable:"",dense:"",onRemove:E=>y.removeAtIndex(y.index),tabindex:y.tabindex,"text-color":"black",class:"q-ma-none",style:{width:"80px"}},{default:N(()=>[B(G(y.opt),1)]),_:2},1032,["onRemove","tabindex"])]),append:N(()=>[l.filter.length>0?(R(),J(Te,{key:0,name:"clear",class:"cursor-pointer",onClick:s.resetFilter},null,8,["onClick"])):_("",!0)]),_:1},8,["modelValue","disable"]),C(st,{nodes:l.treeGoals,"node-key":"label",filter:s.filterString,"filter-method":s.myFilterMethod,expanded:l.expanded,"onUpdate:expanded":e[2]||(e[2]=y=>l.expanded=y),"no-connectors":"",dense:""},{"default-header":N(y=>[$("div",{class:se(s.classyColor(y.node))},[y.node.isChildren?_("",!0):(R(),J(Te,{key:0,name:y.node.icon||y.expanded?"expand_less":"expand_more",size:"28px",right:""},null,8,["name"])),$("div",Ft,G(y.node.label),1)],2)]),"default-body":N(y=>[y.node.isChildren?(R(),M("div",Ht,[$("span",Jt," >> "+G(y.node.details),1)])):(R(),M("span",jt,G(y.node.details),1))]),_:1},8,["nodes","filter","filter-method","expanded"])])):_("",!0),l.filter.length>0?(R(),M("div",Ut,[C(n,{"text-label":"Add Moods",class:"q-mt-xl sched-btn","text-color":"red",onDoBtnAction:s.onMoodAdd},null,8,["onDoBtnAction"])])):_("",!0)])):_("",!0)]),_:1},8,["modelValue"]),s.showRemInstru?(R(),M("div",qt,[C(j,null,{default:N(()=>[B(" Double click upcoming evt to remove it ")]),_:1}),C(K),C(j,null,{default:N(()=>[B(" Can also add note to a finished evt or remove it ")]),_:1}),C(K),C(j,null,{default:N(()=>[B(" Click on time intervals to add events to schedule ")]),_:1}),C(K),C(j,null,{default:N(()=>[B(" ShowTree to filter goals by mood keywords. ")]),_:1})])):_("",!0),s.showSchedInstru?(R(),M("div",Wt,[C(j,null,{default:N(()=>[B(" Use above Scheduling buttons to add events to schedule ")]),_:1}),C(K),C(j,null,{default:N(()=>[B(" Can also use mood keyworks to filter/add associated goals. ")]),_:1}),C(K),C(j,null,{default:N(()=>[B(" Click on time intervals to add events to schedule ")]),_:1})])):_("",!0)]),separator:N(()=>[C(We,{color:"primary",class:"q-px-md","text-color":"white",size:"40px",icon:"drag_indicator",style:{position:"relative",top:"70%"}})]),after:N(()=>[C(d,{onToday:s.onToday,onPrev:s.onPrev,onNext:s.onNext},null,8,["onToday","onPrev","onNext"]),s.scheduleMoodsLabel!=""?(R(),M("div",zt,[B(" By moods: "),C(ne,{color:"secondary","multi-line":""},{default:N(()=>[B(G(s.scheduleMoodsLabel),1)]),_:1})])):_("",!0),$("div",Qt,[$("div",Kt,[C(b,{ref:"calendar",view:"day",modelValue:l.currentDate,"onUpdate:modelValue":e[8]||(e[8]=y=>l.currentDate=y),"drag-enter-func":s.onDragEnter,"drag-over-func":s.onDragOver,"drag-leave-func":s.onDragLeave,"drop-func":s.onDrop,animated:"",bordered:"",hoverable:"","no-active-date":"","transition-next":"slide-left","transition-prev":"slide-right","time-clicks-clamped":"","interval-minutes":15,"interval-count":96,"interval-height":28,"selected-start-end-dates":s.startEndTimes,onChange:s.onChange,onClickDate:s.onClickDate,onClickTime:s.onClickTime,onClickInterval:s.onClickInterval,onClickHeadIntervals:s.onClickHeadIntervals,onClickHeadDay:s.onClickHeadDay,onMousedownTime:s.onMouseDownTime,onMouseupTime:s.onMouseUpTime,onMousemoveTime:s.onMouseMoveTime},{"head-day-event":N(({scope:{timestamp:y}})=>[$("div",Yt,[(R(!0),M(ee,null,De(s.eventsMap[y.date],E=>(R(),M(ee,{key:E.id},[E.time?(R(),J(ne,{key:1,class:se(s.badgeClasses(E,"header")),style:te([s.badgeStyles(E,"header"),{margin:"1px",width:"10px","max-width":"10px",height:"10px","max-height":"10px",cursor:"pointer"}]),onClick:T=>s.scrollToEvent(E)},{default:N(()=>[C(Ce,null,{default:N(()=>[B(G("("+E.id+") "+E.title+" - "+E.time+" >> "+E.duration+"min"),1)]),_:2},1024)]),_:2},1032,["class","style","onClick"])):(R(),J(ne,{key:0,class:se(s.badgeClasses(E,"header")),style:te([s.badgeStyles(E,"header"),{width:"100%",cursor:"pointer",height:"12px","font-size":"10px",margin:"1px"}])},{default:N(()=>[$("div",Xt,[B(G(E.title)+" ",1),C(Ce,null,{default:N(()=>[B(G(E.details),1)]),_:2},1024)])]),_:2},1032,["class","style"]))],64))),128))])]),"day-container":N(({scope:{days:y}})=>[s.hasDate(y)?(R(),M(ee,{key:0},[$("div",{class:"day-view-current-time-indicator",style:te(s.style)},null,4),$("div",{class:"day-view-current-time-line",style:te(s.style)},null,4)],64)):_("",!0)]),"day-body":N(({scope:{timestamp:y,timeStartPos:E,timeDurationHeight:T}})=>[(R(!0),M(ee,null,De(s.getDateEvents(y.date),S=>(R(),M(ee,{key:S.id},[S.time!==void 0?(R(),M("div",{key:0,class:se(["my-event",s.badgeClasses(S,"body")]),style:te(s.badgeStyles(S,"body",E,T)),draggable:!0,onDblclick:me(g=>s.onDblClickEvent(g,S),["prevent"]),onDragstart:me(g=>s.onDragStart(g,S),["stop"]),onDragend:e[4]||(e[4]=me((...g)=>s.onDragEnd&&s.onDragEnd(...g),["stop"])),onDrop:e[5]||(e[5]=g=>s.onDrop(g,"goal-item",i.scope)),onDragenter:e[6]||(e[6]=g=>s.onDragEnter(g,"goal-item",i.scope)),onDragover:e[7]||(e[7]=g=>s.onDragOver(g,"goal-item",i.scope)),onTouchstart:g=>s.onTouchStart(g,S),onTouchmove:g=>s.onTouchEvt(g,S),onTouchend:g=>s.onTouchEvt(g,S)},[ze(C(p,{disabledScore:l.daSchedule.isDisabledScoreEdit[S.id],title:S.title,id:S.id,startTime:S.time,score:S.score,details:S.details,notes:S.notes,happeningNow:l.daSchedule.hasStarted[S.id]?l.daSchedule.hasStarted[S.id]:!1,onEndNow:s.onEndNow,onSaveScore:s.onSaveScore,onAddMins:s.onAddMins,onDeleteNow:g=>s.removeEvtInSchedule(S)},null,8,["disabledScore","title","id","startTime","score","details","notes","happeningNow","onEndNow","onSaveScore","onAddMins","onDeleteNow"]),[[dt,g=>s.onTouchHold(g,S),"400:12:15"]]),s.showEvtMobile(S.id)?(R(),J(O,{key:0,title:S.title,id:S.id,startTime:S.time,score:S.score,details:S.details,notes:S.notes,"show-dialog":s.showEvtMobile(S.id),onSaveScore:s.onSaveScore,onDeleteNow:g=>s.removeEvtInSchedule(S),onEuhHidin:g=>l.daSchedule.euhHidin(S.id)},null,8,["title","id","startTime","score","details","notes","show-dialog","onSaveScore","onDeleteNow","onEuhHidin"])):_("",!0)],46,Zt)):_("",!0)],64))),128))]),_:1},8,["modelValue","drag-enter-func","drag-over-func","drag-leave-func","drop-func","selected-start-end-dates","onChange","onClickDate","onClickTime","onClickInterval","onClickHeadIntervals","onClickHeadDay","onMousedownTime","onMouseupTime","onMousemoveTime"])])]),eo]),_:1},8,["modelValue"]),l.showEvtDialog?(R(),J(m,{key:0,parentGoals:l.daSchedule.allPGoals(),canBeScheduled:s.canbeScheduled,balance:s.currentBalance,onAdHocEvent:s.onAddHocEvent,onOnPickEvent:s.onPickEvent,onEuhHidin:s.closingDialog},null,8,["parentGoals","canBeScheduled","balance","onAdHocEvent","onOnPickEvent","onEuhHidin"])):_("",!0)])]),_:1})}var fo=qe(Dt,[["render",to],["__scopeId","data-v-64efe500"]]);export{fo as default};
