import{j as Ce,U as Te,W as we,r as w,c as H,w as ge,n as De,h as te,k as re,at as Re,D as Ne,g as Pe,au as $e,ad as ae,v as Me,av as Ae,aa as ie,aw as me,ab as de,Z as xe,_ as Be,$ as q,L as F,E as N,F as J,G as $,M as A,H as P,O as M,I as x,N as pe,K as I,J as U,a1 as ke,Q as Se,a2 as se,ax as _e,P as Ee,R as Y,a5 as X,a4 as j,ay as he,f as Le,a6 as Ie,a7 as Ge}from"./index.d5412a32.js";import{d as ce,a as Ve,b as Fe,p as Je,Q as oe,c as ye}from"./utiFunc.97ba64dc.js";import{T as ze,Q as We,a as He,b as qe}from"./QPullToRefresh.b70e30c0.js";import{t as z,c as ue,a as R,l as K,m as fe,U as Ue,p as k,b as B,i as le,E as ve,V as G,d as V,Q as je,e as Ke}from"./QCalendarTask.06f0220a.js";import{a as Qe}from"./QCalendar.58a69bee.js";/* empty css                             */import{a as Ye,u as Xe}from"./goalStorage.f129a10b.js";import"./QItem.feb83afb.js";var Oe=Ce({name:"QSplitter",props:{...Te,modelValue:{type:Number,required:!0},reverse:Boolean,unit:{type:String,default:"%",validator:t=>["%","px"].includes(t)},limits:{type:Array,validator:t=>t.length!==2||typeof t[0]!="number"||typeof t[1]!="number"?!1:t[0]>=0&&t[0]<=t[1]},emitImmediately:Boolean,horizontal:Boolean,disable:Boolean,beforeClass:[Array,String,Object],afterClass:[Array,String,Object],separatorClass:[Array,String,Object],separatorStyle:[Array,String,Object]},emits:["update:modelValue"],setup(t,{slots:i,emit:s}){const{proxy:{$q:n}}=Pe(),l=we(t,n),o=w(null),r={before:w(null),after:w(null)},a=H(()=>`q-splitter no-wrap ${t.horizontal===!0?"q-splitter--horizontal column":"q-splitter--vertical row"} q-splitter--${t.disable===!0?"disabled":"workable"}`+(l.value===!0?" q-splitter--dark":"")),d=H(()=>t.horizontal===!0?"height":"width"),h=H(()=>t.reverse!==!0?"before":"after"),p=H(()=>t.limits!==void 0?t.limits:t.unit==="%"?[10,90]:[50,1/0]);function S(m){return(t.unit==="%"?m:Math.round(m))+t.unit}const y=H(()=>({[h.value]:{[d.value]:S(t.modelValue)}}));let O,T,D,v,E;function g(m){if(m.isFirst===!0){const b=o.value.getBoundingClientRect()[d.value];O=t.horizontal===!0?"up":"left",T=t.unit==="%"?100:b,D=Math.min(T,p.value[1],Math.max(p.value[0],t.modelValue)),v=(t.reverse!==!0?1:-1)*(t.horizontal===!0?1:n.lang.rtl===!0?-1:1)*(t.unit==="%"?b===0?0:100/b:1),o.value.classList.add("q-splitter--active");return}if(m.isFinal===!0){E!==t.modelValue&&s("update:modelValue",E),o.value.classList.remove("q-splitter--active");return}const u=D+v*(m.direction===O?-1:1)*m.distance[t.horizontal===!0?"y":"x"];E=Math.min(T,p.value[1],Math.max(p.value[0],u)),r[h.value].value.style[d.value]=S(E),t.emitImmediately===!0&&t.modelValue!==E&&s("update:modelValue",E)}const f=H(()=>[[ze,g,void 0,{[t.horizontal===!0?"vertical":"horizontal"]:!0,prevent:!0,stop:!0,mouse:!0,mouseAllDir:!0}]]);function c(m,u){m<u[0]?s("update:modelValue",u[0]):m>u[1]&&s("update:modelValue",u[1])}return ge(()=>t.modelValue,m=>{c(m,p.value)}),ge(()=>t.limits,()=>{De(()=>{c(t.modelValue,p.value)})}),()=>{const m=[te("div",{ref:r.before,class:["q-splitter__panel q-splitter__before"+(t.reverse===!0?" col":""),t.beforeClass],style:y.value.before},re(i.before)),te("div",{class:["q-splitter__separator",t.separatorClass],style:t.separatorStyle,"aria-disabled":t.disable===!0?"true":void 0},[Re("div",{class:"q-splitter__separator-area absolute-full"},re(i.separator),"sep",t.disable!==!0,()=>f.value)]),te("div",{ref:r.after,class:["q-splitter__panel q-splitter__after"+(t.reverse===!0?"":" col"),t.afterClass],style:y.value.after},re(i.after))];return te("div",{class:a.value,ref:o},Ne(i.default,m))}}}),Ze=$e({name:"touch-hold",beforeMount(t,i){const{modifiers:s}=i;if(s.mouse!==!0&&ae.has.touch!==!0)return;const n={handler:i.value,noop:Me,mouseStart(o){typeof n.handler=="function"&&Ae(o)===!0&&(ie(n,"temp",[[document,"mousemove","move","passiveCapture"],[document,"click","end","notPassiveCapture"]]),n.start(o,!0))},touchStart(o){if(o.target!==void 0&&typeof n.handler=="function"){const r=o.target;ie(n,"temp",[[r,"touchmove","move","passiveCapture"],[r,"touchcancel","end","notPassiveCapture"],[r,"touchend","end","notPassiveCapture"]]),n.start(o)}},start(o,r){n.origin=me(o);const a=Date.now();ae.is.mobile===!0&&(document.body.classList.add("non-selectable"),ce(),n.styleCleanup=d=>{n.styleCleanup=void 0;const h=()=>{document.body.classList.remove("non-selectable")};d===!0?(ce(),setTimeout(h,10)):h()}),n.triggered=!1,n.sensitivity=r===!0?n.mouseSensitivity:n.touchSensitivity,n.timer=setTimeout(()=>{n.timer=void 0,ce(),n.triggered=!0,n.handler({evt:o,touch:r!==!0,mouse:r===!0,position:n.origin,duration:Date.now()-a})},n.duration)},move(o){const{top:r,left:a}=me(o);n.timer!==void 0&&(Math.abs(a-n.origin.left)>=n.sensitivity||Math.abs(r-n.origin.top)>=n.sensitivity)&&(clearTimeout(n.timer),n.timer=void 0)},end(o){de(n,"temp"),n.styleCleanup!==void 0&&n.styleCleanup(n.triggered),n.triggered===!0?o!==void 0&&xe(o):n.timer!==void 0&&(clearTimeout(n.timer),n.timer=void 0)}},l=[600,5,7];if(typeof i.arg=="string"&&i.arg.length>0&&i.arg.split(":").forEach((o,r)=>{const a=parseInt(o,10);a&&(l[r]=a)}),[n.duration,n.touchSensitivity,n.mouseSensitivity]=l,t.__qtouchhold=n,s.mouse===!0){const o=s.mouseCapture===!0||s.mousecapture===!0?"Capture":"";ie(n,"main",[[t,"mousedown","mouseStart",`passive${o}`]])}ae.has.touch===!0&&ie(n,"main",[[t,"touchstart","touchStart",`passive${s.capture===!0?"Capture":""}`],[t,"touchend","noop","notPassiveCapture"]])},updated(t,i){const s=t.__qtouchhold;s!==void 0&&i.oldValue!==i.value&&(typeof i.value!="function"&&s.end(),s.handler=i.value)},beforeUnmount(t){const i=t.__qtouchhold;i!==void 0&&(de(i,"main"),de(i,"temp"),i.timer!==void 0&&clearTimeout(i.timer),i.styleCleanup!==void 0&&i.styleCleanup(),delete t.__qtouchhold)}});const et=()=>!!/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);function be(t){return t.button===0}const tt={name:"dayCalendar",components:{NavigationBar:q(()=>j(()=>import("./NavigationBar.2c80bbed.js"),["assets/NavigationBar.2c80bbed.js","assets/index.d5412a32.js","assets/index.ddf7c1e7.css"])),QCalendarDay:Qe,GoalyEnd:q(()=>j(()=>import("./goalyEnd.574a3127.js"),["assets/goalyEnd.574a3127.js","assets/goalyEnd.a72927db.css","assets/utiFunc.97ba64dc.js","assets/index.d5412a32.js","assets/index.ddf7c1e7.css","assets/QPullToRefresh.b70e30c0.js","assets/QItem.feb83afb.js"])),schedBtn:q(()=>j(()=>import("./schedBtn.bd1f374c.js"),["assets/schedBtn.bd1f374c.js","assets/schedBtn.a05a5c66.css","assets/index.d5412a32.js","assets/index.ddf7c1e7.css"])),dropDwnBtn:q(()=>j(()=>import("./dropDwnBtn.4b3904c5.js"),["assets/dropDwnBtn.4b3904c5.js","assets/dropDwnBtn.35a7a0b5.css","assets/QItem.feb83afb.js","assets/index.d5412a32.js","assets/index.ddf7c1e7.css","assets/QList.5228e4b2.js","assets/QPullToRefresh.b70e30c0.js","assets/utiFunc.97ba64dc.js"])),schedDialog:q(()=>j(()=>import("./schedDialog.60bb54d7.js"),["assets/schedDialog.60bb54d7.js","assets/schedDialog.95b40b10.css","assets/index.d5412a32.js","assets/index.ddf7c1e7.css","assets/QSpace.45a1f191.js"])),scoreEditDialog:q(()=>j(()=>import("./onScoreEditDialog.a90b1bb8.js"),["assets/onScoreEditDialog.a90b1bb8.js","assets/onScoreEditDialog.d7c155a4.css","assets/index.d5412a32.js","assets/index.ddf7c1e7.css"]))},data(){return w(null),w(null),w(null),w(null),w(null),w(null),Ye(),{filter:w([]),filterRef:w(null),currentDate:w(z()),scoreOptions:w([1,2,3,4,5,6]),chosenScore:w(null),chosenPrio:w(null),hello:w(null),scheduledEvents:[],dailyScheduled:w(new Map),endTimesSet:w(new Set),startTimesSet:w(new Set),dailyScheduledMap:w(new Map),disablePrioBtn:w(!0),disableScoreBtn:w(!0),calendar:w(null),store:Xe(),anchorTimestamp:w(null),otherTimestamp:w(null),mouseDown:w(!1),mobile:w(!0),usingMoods:w({}),timeStartPos:w(0),showTree:w(!1),addEventDialog:w(!1),isDisabledScoreEdit:w({}),hasStarted:w({}),mobileEnableScore:w({}),allowDialog:w({}),disableSaveSchedule:w(!0),showReloadBtn:w(!1),showLoadDefaults:w(!0),showOneEach:w(!1),showScoreBtn:w(!1),showPrio:w(!1),showClearBtn:w(!1),splitterPage:w(35),splitterLegend:w(40),treeGoals:w([]),expanded:w([]),parentGs:w(null)}},beforeMount(){this.mobile=et(),this.resetGoalEvts(!0),this.constructTree()},beforeUnmount(){clearInterval(this.intervalId)},mounted(){this.adjustCurrentTime(),this.intervalId=setInterval(()=>{this.adjustCurrentTime()},6e4)},computed:{scheduleMoodsLabel(){let t="";if(!Object.keys(this.usingMoods).length>0)return t;let i=new Set;for(let n in this.usingMoods)i.add(this.usingMoods[n].join());let s=0;for(let n of i)s<1?t=n:t=t+", "+n,s++;return Object.keys(this.usingMoods).length!=i.size&&console.log("scheduleMoodsLabel..prob change!",JSON.parse(JSON.stringify(this.usingMoods)),i,t),t},chosenScoreLabel(){return this.chosenScore==null?"By Score":`Score >= ${this.chosenScore}`},chosenPrioLabel(){return this.chosenPrio==null?"By Priority":`Prio = ${this.chosenPrio}`},style(){return{top:this.timeStartPos+"px"}},showTreeForm(){return this.showTree||this.constructTree(),this.showTree},saveScheduleDisabled(){return this.disableSaveSchedule},hasEventsForDate(){return this.store.hasEventsForDate(this.currentDate)},eventsMap(){const t={};return this.scheduledEvents.forEach(i=>{if(t[i.date]||(t[i.date]=[]),t[i.date].push(i),i.days){console.log(`eventsMap multiple days? event for ${i.date}`,i.days);let s=ue(i.date),n=i.days;do s=R(s,{day:1}),t[s.date]||(t[s.date]=[]),t[s.date].push(i);while(--n>0)}}),t},canbeScheduled(){let t=this.deepCopy(this.storedSubGoals),i=t.filter(n=>!this.scheduledEvents.find(l=>l.id==n.id)),s=(n,l)=>{if(n.parentGoal>l.parentGoal)return 1;if(n.parentGoal==l.parentGoal)return 0;if(n.parentGoal<l.parentGoal)return-1};return i.length==0?(t.sort(s),t):(i.sort(s),i)},storedSubGoals(){return this.store.getSubGoals},storedAlternatives(){return this.store.fetchAlternativeEvts()},startEndTimes(){const t=[];return this.anchorDayTimeIdentifier!==!1&&this.otherDayTimeIdentifier!==!1&&(this.anchorDayTimeIdentifier<=this.otherDayTimeIdentifier?t.push(K(this.anchorTimestamp),K(this.otherTimestamp)):t.push(K(this.otherTimestamp),K(this.anchorTimestamp))),t},anchorDayTimeIdentifier(){return this.anchorTimestamp!==null?fe(this.anchorTimestamp):!1},otherDayTimeIdentifier(){return this.otherTimestamp!==null?fe(this.otherTimestamp):!1},storedCompPG(){return this.storedPG()},currentBalance(){return this.store.getBalance},filterString(){return this.filter.join()},defaultLabels(){let t=this.allEvents.filter(i=>(i==null?void 0:i.inDefaults)&&(i==null?void 0:i.time)!=""&&!this.scheduledEvents.find(s=>s.id==i.id)).length;return t>0?t+" Defaults":"Defaults"}},methods:{testyV(){console.log("Platform detect:",this.$q.platform)},storedPG(){return this.parentGs==this.store.getMainGoals?(console.log("storedPG SAME!!!!"),this.parentGs):(this.parentGs=this.store.getMainGoals,this.parentGs)},parentGoalsMap(){const t=new Map;let i=this.storedPG();return i?(i.forEach(s=>{t.set(s.id,s)}),t):(console.log("parentGoalsMap is empty or null",i),t)},constructTree(){this.treeGoals=this.store.fetchGoalsTree()},badgeClasses(t,i){return Ve(t,i)},badgeStyles(t,i,s=void 0,n=void 0){return Fe(t,i,s,n)},classyColor(t){return`row items-center ${t.isChildren?"text-":"text-white bg-"}${t.color} `},resetFilter(){var t;this.filter=[],(t=this.filterRef)==null||t.focus()},myFilterMethod(t,i){if(t.isChildren&&(t==null?void 0:t.moods.length)>0){const s=this.filter.map(l=>l.toLowerCase());let n=t==null?void 0:t.moods.some(l=>s.indexOf(l.toLowerCase())>-1);return t.label&&n}},getTimeNumber(t){return t!==null?fe(t):!1},getTimeyNumber(t){return t!==null?Ue(t):!1},labelGoals(t){let i=0;if(t=="s"){for(const s in this.treeGoals)i+=this.treeGoals[s].children.length;return`Scheduled => ${this.scheduledEvents.length} out of ${i} 
`}return`Balance: ${this.currentBalance?this.currentBalance:0} 
`},getDateEvents(t){let i=(n,l)=>{let o=V(n.sortTime,l.sortTime);if(o>0)return-1;if(o==0)return 0;if(o<0)return 1};const s=this.eventsMap[t]||[];if(s.length===1)s[0].side="full";else if(s.length===2){const n=R(B(s[0].date),{minute:k(s[0].time)}),l=R(n,{minute:s[0].duration}),o=R(B(s[1].date),{minute:k(s[1].time)}),r=R(o,{minute:s[1].duration});le(o,n,l,!0)||le(r,n,l,!0)?(console.log("getDateEvents...LENGTH==2..LEFT/RIGHT 'TWIX"),s[0].side="left",s[1].side="right"):(s[0].side="full",s[1].side="full")}return s.sort(i)},hasDate(t){return this.currentDate?t.find(i=>i.date===this.currentDate):!1},getEventsForDate(t){return this.store.getEventsForDate(t)},isViewingToday(){return z()==this.currentDate},isViewingPast(){let t=z();if(this.currentDate&&this.currentDate==t)return!1;let i=ve(B(t));return!(ve(B(this.currentDate))>=i)},adjustCurrentTime(){const t=G(new Date);if(this.currentDate!==t.date){this.timeStartPos=-10,this.currentTime="";return}this.currentDate=t.date,this.currentTime=t.time,this.timeStartPos=this.$refs.calendar.timeStartPos(t.time,!1);let i=this.endTimesSet&&this.endTimesSet.has(t.time),s=this.startTimesSet&&this.startTimesSet.has(t.time);(i||s)&&this.doEnableEndNowBtn(this.currentTime,i,s)},allMainGPrio(){let t=this.store.fetchAllPrio();return!t.size>0?(console.log("ERROR...no Priority goals?",t),[]):Array.from(t.values()).sort()},resetGoalEvts(t=!1){if(this.scheduledEvents==this.allEvents&&console.log("resetGoalEvts SAME"),t){let i=this.deepCopy(this.storedSubGoals);return this.allEvents=[...i],i}return this.allEvents},getLocalEvt(t){for(let i=0;i<this.allEvents.length;i++)if(this.allEvents[i].id===t)return this.allEvents[i];return null},getScheduledEvent(t){for(let i=0;i<this.scheduledEvents.length;i++)if(this.scheduledEvents[i].id==t)return this.scheduledEvents[i];return null},doSaveEvtProp(t,i=null,s=null){this.store.saveSubProp(t,i,s)},evtStartedOrPassed(t){const i=[];let s=R(t,{minute:0}),n=this.getTimeNumber(s);return this.dailyScheduled.forEach((l,o,r)=>{let a=this.getTimeNumber(l.start),d=this.getTimeNumber(l.end);if(a!==!1&&d!==!1){let h=n>=a&&n<d,p=n>=d;(h||p)&&i.push(o),h&&(this.hasStarted[o]=!0),this.enableEvtScoreEdit(o,p)}else console.log(`ERROR?!:${o} has no start/end?.`,l)}),i},allowScoreEdit(t){this.dailyScheduled.forEach((i,s,n)=>{this.isDisabledScoreEdit[s]=!t})},enableEvtScoreEdit(t,i){this.isDisabledScoreEdit[t]=!i},canEnableEditScore(t,i){const s=G(new Date);V(s,i)>0?(this.isDisabledScoreEdit[t]=!0,this.mobileEnableScore[t]=!1):(this.hasStarted[t]=!1,this.mobile&&(this.allowDialog[t]=!1),this.mobileEnableScore[t]=!0,this.isDisabledScoreEdit[t]=!1)},parseScore(t){const i=t.split(/on/);return i.length!=2?-89:i[1]-i[0]},doEnableEndNowBtn(t,i,s){for(let[n,l]of this.dailyScheduled)(i?l.end.time:l.start.time)==t&&(this.hasStarted[n]=!i,this.isDisabledScoreEdit[n]=!i)},enableEndNowBtn(t,i,s){const n=G(new Date);le(n,i,s,!0)?this.hasStarted[t]=!0:this.hasStarted[t]=!1},retrieveSameStart(t){let i=[];for(let[s,n]of this.dailyScheduled)n.start.time==t&&i.push(s);return i},confirmTimeChange(t,i,s,n,l,o,r=null){this.$q.dialog({title:t,message:i,cancel:!1,ok:s,options:{type:"radio",model:"",items:[{label:s+" and "+n,value:"ok"},{label:n,value:"alt"}]},class:"overflow-wrap: break-word;",style:""}).onOk(a=>{if(a==""){console.log("confirmTimeChange onOk with no selection >>onDismiss"),this.doNotify("No selection made...Defaulting","positive","bottom"),r?r():console.log("confirmTimeChange:: No Dismiss func to execute!");return}return l(a)}).onCancel(()=>{console.log("confirmTimeChange>> executeCancel..."),o()})},confirmAction(t,i,s,n,l=null){this.$q.dialog({title:"Warning",cancel:!0,ok:i,message:t}).onOk(()=>{s()}).onCancel(()=>{n()}).onDismiss(()=>{if(l){console.log("confirmAction with dismiss!!"),l();return}})},radioChoiceDialog(t,i,s,n,l=null,o=null,r=null){this.$q.dialog({title:t,cancel:!!o,persistent:!0,message:i,options:{type:"radio",model:n,items:s}}).onOk(a=>{l&&(a==""?this.radioChoiceDialog(t,i,s,n,l,o,r):l(a))}).onCancel(()=>{o&&o()}).onDismiss(()=>{r&&r()})},checkBoxDialog(t,i,s,n,l=null,o=null,r=null){let a=s.length,d=a>2?2:a;this.$q.dialog({title:t,message:i,options:{type:"checkbox",model:[],isValid:h=>h.length>0&&h.length==d,items:s},cancel:!0,persistent:!0}).onOk(h=>{l(h)}).onCancel(()=>{o&&o()}).onDismiss(()=>{r&&r()})},doNotify(t,i=void 0,s="top"){this.$q.notify({color:i!==void 0?i:"negative",position:s,message:t,icon:i==null?"report_problem":"thumb_up"})},useGroupNotify(t,i=void 0,s="top",n=!1,l=5e3){this.$q.notify({color:i!==void 0?i:"negative",position:s,message:t,icon:i==null?"report_problem":"thumb_up",group:n,timeout:l})},withDismissNotify(t,i=void 0,s="top",n=null,l=null){this.$q.notify({color:i!==void 0?i:"negative",position:s,message:t,icon:i==null?"report_problem":"thumb_up",timeout:n!=null?n:5e3,closeBtn:"Okey",onDismiss:l})},updateButtons(t=null,i=null,s=null){this.showLoadDefaults=t!=null?t:this.showLoadDefaults,this.showScoreBtn=i!=null?i:this.showScoreBtn,this.showPrio=s!=null?s:this.showPrio,this.showOneEach=s!=null?s:this.showOneEach},doRemove(t){let i=this.scheduledEvents.length;if(!t){console.log("ERROR doRemove, NO item to delete?!?",t);return}let s=0;for(s;s<i;s++)if(this.scheduledEvents[s].id==t.id){this.scheduledEvents.splice(s,1);let n=null;if(this.dailyScheduled.has(t.id)?(n=this.dailyScheduled.get(t.id),this.dailyScheduled.delete(t.id)):console.log("doRemove ::> dailyScheduled has no such item?@? ERROR",t),n){let l=this.startTimesSet.delete(n.start.time),o=this.endTimesSet.delete(n.end.time);(!l||!o)&&console.log(`doRemove ::> ERROR? scheduleSets has no such item?@? start:${l}...end:${o}`,n,t.id+" "+(t==null?void 0:t.title.trim())+" "+(t==null?void 0:t.details))}break}},addToBalance(t){let s=this.currentBalance-parseInt(t==null?void 0:t.duration);this.store.setBalance(s)},chooseAlternatives(t){let i=this.storedAlternatives,s=G(new Date),n=t.time,l=s.date;const o=p=>{let S=this.parentGoalsMap().get(p.parentGoal);return{label:`Of '${S==null?void 0:S.title.trim()}' "${p.title.trim()}" (${p.score}) for ${p==null?void 0:p.duration} mins`,value:p.id}},r=p=>p.filter(S=>!this.scheduledEvents.find(y=>y.id==S.id)),a=p=>{let S=R(B(l),{day:0}),y=R(B(S.date),{day:1}),O=this.getEventsForDate(S.date),T={},D=null;O?T=O:console.log("addInFutur EMPTY for >>...",S.date),p.forEach(v=>{if(D=this.getLocalEvt(v),T[v]){console.log("addInFutur...ALREADY PRESENT",v,S.date,D==null?void 0:D.title.trim()),this.doNotify(`Alternative '${D==null?void 0:D.title.trim()}' already present on ${S.date}. Moving it to next day`,"warning");let E=this.getEventsForDate(y.date);if(E)if(!E[v])E[v]={duration:D.duration,time:n};else{console.log("addInFutur...STILL PRESENT in next day:"+y.date,D.title.trim()),this.doNotify(`Boo Alt '${D==null?void 0:D.title.trim()}' also present on ${y.date} :(( ...Check BALANCE!`),this.addToBalance(D);return}else console.log("addInFutur next day EMPTY for >>...",y.date),E={},E[v]={duration:D.duration,time:n};this.store.saveDailySchedule(y.date,E),this.doNotify(`Saving ${D.title} in ${y.date}`,"positive","bottom")}else T[v]={duration:D.duration,time:n}}),console.log("addInFutur>>>",S.date,JSON.parse(JSON.stringify(T))),this.store.saveDailySchedule(S.date,T)},d=p=>{this.doRemove(t);let S=i.find(D=>D.id==p);console.log("remReplace...Add at:",n,S.title,"usually at:"+S.time),S=this.addPropsEventsTo(this.currentDate,[{...S,time:n}]);let y=this.overlapCheckEvtsAdd(S),O=Object.keys(y).length;if(O>0)return console.log(`chooseAlternatives::removeReplace:: OVERLAPS again from ${S.length} overlaps =${O}`,S,y),this.doNotify(`Extra Overlaps while adding ${S[0].title.trim()}`,"warning","top"),this.fixyOverlaps(y,null,"alts");let T=this.updateCurrentSchedule();console.log("chooseAlternatives::remReplace:SAMESTART",T),T.size>0&&this.fixSameStart(T),this.doSaveSchedule(),this.doNotify(`Added Alt replacement '${S[0].title}' at ${n}`,"positive","bottom")},h=p=>{this.doNotify(p)};if(i=r(i),i.length==0){h("Removing not allowed! Alternatives already present!");return}this.checkBoxDialog("Gotta pick alternatives","Select the first Evt to replace the removed and an Extra evt for later day (today)!",i.map(o),i[0].id,function(p){console.log("chooseAlternatives::opt",p),d(p.shift()),p.length>0?a(p):(console.log("chooseAlternatives::onOk...nothing to add?!?",i.length,p.length,i.length-p.length),h("No Alternative scheduled later :("))},function(){console.log("chooseAlternatives::onCancel")})},removeEvtInSchedule(t){let i=!1,s=()=>{if(this.doRemove(t),i){console.log("removeEvtInSchedule..autoSave for: "+t.title),delete this.usingMoods[t.id],this.doSaveSchedule(),this.disableSaveSchedule=!0;return}this.disableSaveSchedule=!1,this.showReloadBtn=this.hasEventsForDate};if(this.isViewingPast()){if(t.duration<30){this.doNotify("Removing from the past... Check BALANCE!"),this.addToBalance(t),i=!0,s();return}this.chooseAlternatives(t);return}if(!this.isViewingToday()&&!this.mobile){i=this.usingMoods[t.id],s(),console.log("Removed future evt");return}let n=`Remove "${t.title}" from schedule?`;this.usingMoods[t.id]&&(console.log("removeEvtInSchedule with MOOD?!?",this.usingMoods[t.id]),i=!0,n=n+" With Mood "+this.usingMoods[t.id]),this.confirmAction(n,"Remove",s,function(){console.log("Cancelled remove")})},updateCurrentSchedule(){const t=new Map;let i=new Set,s=new Set,n=new Set;return this.scheduledEvents.length<1?(this.dailyScheduled=t,this.endTimesSet=i,this.startTimesSet=n,s):(this.scheduledEvents.forEach(l=>{let o=R(B(l.date),{minute:k(l.time)}),r=R(o,{minute:l.duration});t.set(l.id,{...l,start:o,end:r,on:l.date,originalAt:l.time,for:l.duration,score:l.score}),i.add(r.time),n.has(o.time)?s.add({at:o.time,id:l.id}):n.add(o.time),(this.currentDate==z()||!this.isViewingPast())&&(this.canEnableEditScore(l.id,r),this.enableEndNowBtn(l.id,o,r))}),this.dailyScheduled=t,this.endTimesSet=i,this.startTimesSet=n,s)},addEvtPropsIntoSchedule(t){!this.addEvtInScheduleMaps(t)||this.scheduledEvents.push(t)},addEvtInScheduleMaps(t){if(this.dailyScheduled.has(t.id))return!1;let i=R(B(t.date),{minute:k(t.time)}),s=R(i,{minute:t.duration});return this.dailyScheduledMap.set((t.id,{...t,on:t.date,for:t.duration,start:i,end:s,score:t.score})),this.dailyScheduled.set(t.id,{...t,on:t.date,originalAt:t.time,for:t.duration,start:i,end:s,score:t.score}),this.endTimesSet.add(s.time),this.startTimesSet.add(i.time),(this.currentDate==z()||!this.isViewingPast())&&(this.canEnableEditScore(t.id,s),this.enableEndNowBtn(t.id,i,s)),!0},updateEvtInScheduleMaps(t,i){if(this.dailyScheduled.has(t)){let s=this.dailyScheduled.get(t),n=s.for,l=s.originalAt,o=s.start,r=s.end,a=R(i,{minute:n}),d=s.score;return this.dailyScheduled.set(t,{on:i.date,originalAt:l,for:n,start:i,end:a,score:d}),this.endTimesSet.delete(r.time)?this.endTimesSet.add(a.time):console.log("updateEvtInScheduleMaps-endTimesSet NOT FOUND?!?"),this.startTimesSet.delete(o.time)?this.startTimesSet.add(i.time):console.log("updateEvtInScheduleMaps-startTimesSet NOT FOUND?!?",t,i),(this.currentDate==z()||!this.isViewingPast())&&(this.canEnableEditScore(t,a),this.enableEndNowBtn(t,i,a)),!0}else return console.log("updateEvtInScheduleMaps--euh not found?ERROR?",t,i),!1},evtIsOverlappingTimes(t,i,s,n){let l=this.getTimeyNumber(t),o=this.getTimeyNumber(i),r=this.getTimeyNumber(s),a=this.getTimeyNumber(n);if(l===!1||r===!1||o===!1||a===!1)return console.log("ERROR... evtIsOverlappingTimes error",l,o,r,a),!1;let d=!1;return l>r&&l<a&&(d="bas"),o>r&&o<a&&(d="haut"),(r>=l&&o>=a||l>=r&&o<=a)&&(d="surrounding"),d},hasOverlappingEvent(t,i,s){const n=[];let l=i,o=R(l,{minute:s});return this.dailyScheduled.forEach((r,a,d)=>{if(a!=t){let h=this.evtIsOverlappingTimes(l,o,r.start,r.end);h&&n.push({target:t,targetStart:l,direction:h,inConflict:a})}}),n},overlapCheckEvtsAdd(t){let i={};for(let s=0;s<t.length;s++){let n=t[s],l=R(B(n.date),{minute:k(n.time)}),o=this.hasOverlappingEvent(n.id,l,n.duration);if(o.length>0){let r=0;do{let a=o[r];i[a.inConflict]||(i[a.inConflict]=[]),i[a.inConflict].push(a),r>0&&(a.inConflict in i&&(console.log("WOAH deleting inConflict",a.inConflict),delete i[a.inConflict]),o[r-1].inConflict in i&&(console.log("WOAH deleting PREV inConflict",o[r-1].inConflict),delete i[o[r-1].inConflict]),i[n.id]?(i[n.id].push(a),console.log("WOAH obj.id already present?",n.id)):i[n.id]=[a],i[n.id].unshift(o[r-1]),i.withID=!0)}while(++r<o.length)}else this.addEvtPropsIntoSchedule(n)}return i},whenFrmtTime(t){if(!t)return"";let i=t.split(":");return parseInt(i[0])>=12?t+"PM":t+"AM"},updatedEvtDetails(t){let i=this.parentGoalsMap().get(t.parentGoal);return i?(t.bgcolor=i.bgcolor,t.jeSuis?t.details=`Of '${i.title.trim()}' :: << ${t.jeSuis.join(",")} >>`:t.details=`Of '${i.title.trim()}' :: ${this.whenFrmtTime(t==null?void 0:t.time)} -> ${t==null?void 0:t.duration}min -- ${t!=null&&t.inDefaults?"Dft:":":"}${t!=null&&t.canMove?":Mv:":":"}${t!=null&&t.isAlternative?":Alt":":"}`):(console.log("ERROR?!? no parent goal for:",JSON.parse(JSON.stringify(t))),t.bgcolor="grey",t.title=`Ad-hoc:${t==null?void 0:t.title} (${this.parseScore(t==null?void 0:t.score)})`,t.details=`${t==null?void 0:t.title}: ${this.whenFrmtTime(t==null?void 0:t.time)} -- ${t==null?void 0:t.duration}min`),t.sortTime=R(B(t.date),{minute:k(t.time)}),t},addPropsEventsTo(t,i){if(!i)return this.doNotify("addPropsEventsTo BUT no goals to schedule..."),[];let s=[];return i.forEach(n=>{let l=this.getLocalEvt(n.id);if(l){let o=Object.assign({},{...l,date:t},n);s.push(this.updatedEvtDetails(o))}else console.log("ERROR in addPropsEventsTo...Evt:not present!",n)}),s},changeEvtTime(t,i,s,n=!1){let l=this.getScheduledEvent(t),o=null;if(l)o=l.time;else if(n){if(l=this.getLocalEvt(t),!l)return console.log("ERROR in changeEvtTime STILL NOT found?!?",e,t,i,n),!1;o=l.time}else return console.log("ERROR in changeEvtTime not found, not adding!",t,i,n),!1;let r=(h,p)=>{if(console.log(`changeEventTime::DoUpdateEvt:: ${p?"DOADD":"NOAdd"} (${h.id})'${h.title.trim()}' from ${o} to ${i.time} 
        
canMove:${h==null?void 0:h.canMove}, inDef:${h==null?void 0:h.inDefaults},skip? ${s}`),p){let S=this.addPropsEventsTo(this.currentDate,[{...h,time:i.time}]);this.addEvtPropsIntoSchedule(S[0]),this.showDefaultBtn(this.isViewingPast())}this.updateEvtInScheduleMaps(t,i),h.time=i.time,this.updatedEvtDetails(h)},a=(h,p)=>{if(console.log(`changeEventTime::KeepAsIs (${t})'${h.title.trim()}' to ${o} with ${p?"DOADD":"NOAdd"}`,i.time,"canMove:"+(h==null?void 0:h.canMove),"inDef:"+(h==null?void 0:h.inDefaults),"skip?"+s),p){if(o==""){this.doNotify(`'${h.title.trim()}' have unset default time! Not adding...`);return}let S=this.addPropsEventsTo(this.currentDate,[{...h,time:o}]);console.log("KeepAsIs::doAddy afterProps",JSON.parse(JSON.stringify(S))),this.addEvtPropsIntoSchedule(S[0]),this.showDefaultBtn(this.isViewingPast());return}else this.updateEvtInScheduleMaps(t,o),h.time=o,this.updatedEvtDetails(h),console.log("changeEventTime::keepAsIs:: !NOT! doAdd afterProps..",t,h.id,JSON.parse(JSON.stringify(l)))},d=(h,p,S)=>(console.log(`changeEvtTime::userChoice ${h} >> ${p.id} to ${i.time}...`),h=="ok"&&this.doSaveEvtProp(t,i.time,null),r(p,S),h);if((l==null?void 0:l.inDefaults)||!(l!=null&&l.canMove))if(s)r(l,n);else{if(o==i.time){console.log(`SAME TIME (${l.id})'${l.title.trim()}'..ASKIN with doAdd? ${n} for updateEvt...`,o,i.time),n&&r(l,n);return}let p=[`Evt "${l.title.trim()}" by default at ${this.whenFrmtTime(o)}.
\u2800
`,`Also Change default time to ${this.whenFrmtTime(i.time)}? 
\u2800
`,`Cancel or Dismiss to undo!
\u2800
`,`
\u2800
`,`No selection to schedule at default ${this.whenFrmtTime(o)}`].join(`
`);this.confirmTimeChange("Default Time Change!",p,"Change",`Temp.${n?"Add":"Move"}`,function(S){d(S,l,n)},function(){console.log(`changeEventTime::onCancel...>doing nothing for ${l.id})'${l.title.trim()}'`,n)},function(){a(l,n)})}else if(l!=null&&l.canMove)r(l,n);else{if(o==i.time){console.log(`SAME TIME! BEWARE~~ (${l.id})'${l.title.trim()}'...doAdd?${n}..skipAsk?:${s}..returning!!`,o);return}let p=[`Evt "${l.title.trim()}" Aint move from ${this.whenFrmtTime(o)}.
\u2800
`,`
\u2800
`,`Also Move time to ${this.whenFrmtTime(i.time)}? 
\u2800
`,`
\u2800
`,`Cancel or Dismiss to undo!
\u2800
`,`
\u2800
`,`No selection to add at default ${this.whenFrmtTime(o)}`].join(`
`);this.confirmTimeChange("Moving Evt's time",p,"Change",`Temp.${n?"Add":"Move"}`,function(S){d(S,l,n)},function(){console.log(`changeEventTime::onCancel..>doing nothing for ${l.id})'${l.title.trim()}'`,n)},function(){console.log(`changeEventTime::onDismiss..keep as is>> ${l.id})'${l.title.trim()}'`,n),a(l,n)})}},recurChangeTime(t,i,s,n=!1,l=!1){let o=this.dailyScheduled.get(t);if(o){let r=k(o.start.time)-k(s.time),a=`${r>0?"DOWN":"UP"}`,d=null;if(r>=0){d=R(s,{minute:parseInt(i.duration)+10});let S=R(s,{minute:parseInt(o.for)+10});console.log(`recurChangeTime::${t}...FORWARD ${a} for ${r} due to evt:${i.id} at ${s.time} 
        
 doAdd?:${l}, skipAsk:${n} > New>`,JSON.parse(JSON.stringify(d.time)),"alt:",S.time);let y=V(S,d);y>0&&(Math.floor(y/1e3/60)<=r?console.log(`recurChangeTime::${t}....with duration:${o.for} vs evtDura:${i.duration}...NOT using alternative!!`):(console.log(`recurChangeTime::DIFFY>>${y}...gonna use Alternative`,S.time),d=S))}else{d=R(s,{minute:-(parseInt(o.for)+10)});let S=R(s,{minute:-(parseInt(i.duration)+10)}),y=V(S,d);console.log(`recurChangeTime::${t}...BACKWARD ${a} for ${r} due to evt:${i.id} at ${s.time}
        
 doAdd?:${l}, skipAsk:${n} > New`,d.time,"alt:"+S.time,"diffy="+y)}let h=this.hasOverlappingEvent(t,d,o.for);if(h.length>0){let S=0,y=h.length,O=this.getScheduledEvent(t);O?this.doNotify(`Cascading time change while adding '${O==null?void 0:O.title.trim()}' due to "${i.title.trim()}"`,"warning","top"):console.log(`ERROR::recurChangeTime ${t} not found`);do{if(console.log(`WARNING CASCADING timeChange ${t}-${O==null?void 0:O.title} at: ${d.time} 'gon recurChangeTime::
          OLDie doAdd?:${l}, OLDie skipAsk:${n}..gon be true 
 now at: ${o.start.time}  till ${o.end.time}`,h[S]),h[S].inConflict==i.id){console.log(`EUUUH...::recurChangeTime::self overlap?!?${t} ...breaking!`,h[S]);break}this.scrollToTime(d),this.recurChangeTime(h[S].inConflict,O,d,!0)}while(++S<y)}this.changeEvtTime(t,d,n),console.log(`recurChangeTime::OVERLAPPED: ${t} ${a} to ${d.time} ...skipAsk:${n} >> doAdd:${l}`);let p=s;console.log(`recurChangeTime::TARGET:(${i.id})${i==null?void 0:i.title.trim()} going ${a} skipAsk:${n} >> doAdd:${l} to time>> ${p.time}`),this.changeEvtTime(i.id,p,n,l)}else console.log("ERROR..ERROR recurChangeTime:: overlapped event not found!",t)},fixyOverlaps(t,i=null,s=""){var E;const n=(g,f)=>{if(g!=null&&g.parentGoal){let c=this.parentGoalsMap().get(g.parentGoal);return f?`Of '${c==null?void 0:c.title.trim()}' with Prio(${c==null?void 0:c.priority})`:`Of '${c==null?void 0:c.title.trim()}'`}return console.log("prioLabel..ERROR no PARENT found?",g),""},l=(g,f)=>{switch(f){case"score":return`${n(g,!1)} > "${g.title.trim()}" with Score:: ${g.score} = ${this.parseScore(g.score)}`;case"prio":return`"${g.title.trim()}" ${n(g,!0)}`;default:return`"${g.title.trim()}" ${n(g,!0)} && Score:: ${g.score}`}},o=g=>{this.doNotify(g,"positive","top")},r=g=>{this.usingMoods[g]?(delete this.usingMoods[g],console.log("fixyOverlaps::updateMoodLabel>>..."+g,this.scheduleMoodsLabel)):console.log("fixyOverlaps::updateMoodLabel>>NO mood by "+g,s)},a=g=>{console.log(`fixyOverlaps::doRem ${g.id}:${g.title}`),r(g.id),this.doRemove(g)},d=(g,f,c)=>{if(console.log(`fixyOverlaps::removeReplace >> replacing>> ${g.id}) '${g.title.trim()}' WITH ${f.id}) ${f.title.trim()}`,c,"from>"+s),f=this.addPropsEventsTo(c.targetStart.date,[{...f,time:c.targetStart.time}]),i){if(console.log("fixyOverlaps::removeReplace...OVERRIDE from>>"+s),s=="onDrop"){a(g);return}console.log("fixyOverlaps::removeReplace....OVERRIDE updating..."+s),this.updateEvtInScheduleMaps(f[0].id,c.targetStart),console.log("fixyOverlaps",this.startTimesSet,this.endTimesSet,JSON.parse(JSON.stringify(this.scheduledEvents)));return}a(g);let m=this.overlapCheckEvtsAdd(f),u=Object.keys(m).length;if(u>0)return console.log(`${s}>fixyOverlaps::removeReplace:: OVERLAPS again from adding ${f.length} overlaps =${u}`,f,JSON.parse(JSON.stringify(m))),this.doNotify(`Extra Overlaps while adding ${f[0].title.trim()}`,"warning","top"),this.fixyOverlaps(m,i,s+"nah");let b=this.updateCurrentSchedule();b.size>0&&(console.log("fixyOverlaps::removeReplace::SameStart?!?",b),this.fixSameStart(b))},h=(g,f,c)=>{const m=R(B(this.currentDate),{minute:k(g.time)});if(console.log(`from:${s}--forceAdd: ${f.id})'${f.title}' at ${f.time}.
        
Changing >>${g.id} from ${g.time} `,c.targetStart.time),console.log(c,m),c.direction!=="surrounding")this.recurChangeTime(g.id,f,c.targetStart,!0,!0);else{console.log("fixyOverlaps::forceAdd: gonna overlapCheckEvtsAdd...."),f=this.addPropsEventsTo(c.targetStart.date,[{...f,time:c.targetStart.time}]);let b=this.overlapCheckEvtsAdd(f),C=Object.keys(b).length;if(C>0)return console.log(`from:${s}>fixyOverlaps::forceAdd:: OVERLAPS again of size:${C} from > `+f[0].title,JSON.parse(JSON.stringify(b))),this.doNotify(`Extra Overlaps while adding '${f[0].title.trim()}' `,"warning","top"),this.fixyOverlaps(b,i,s+"nah")}let u=this.updateCurrentSchedule();u.size>0&&(console.log("fixyOverlaps::forceAdd::SameStart?!?",u),this.fixSameStart(u)),this.disableSaveSchedule=!1,this.showDefaultBtn(this.isViewingPast())};let p=(g,f,c,m,u)=>{O.push(f),f==c.id?(d(m,c,u),o(`by ${g}, Scheduling '${c.title.trim()}'`)):(console.log(`onOkChoice::by ${g},chose scheduled ${f} ...with override?`,i,s),o(`by ${g}, Keeping scheduled '${m.title.trim()}'`),s.indexOf("byMood")>-1&&r(c.id),i&&a(c))},S=(g,f)=>{if(i){if(console.log("fixyOverlaps::cancelChoice::OVERRIDE...coolios!!from:"+s,g.title.trim()),s=="onDrop"){o("Umm...not moving then...."),this.disableSaveSchedule=!0,this.showReloadBtn=!1,this.showClearBtn=!1;return}a(g),o(`Keeping scheduled '${f.title.trim()}'`);return}s.indexOf("byMood")>-1&&(console.log("fixyOverlaps::cancelChoice::moody? from: "+s,g.title.trim()),r(g.id)),o(`Keeping scheduled '${f.title.trim()}'`)},y=g=>{console.log(g,"from>>"+s,this.scheduledEvents.length),this.showDefaultBtn(this.isViewingPast())},O=[],T=Object.keys(t).length;const D=(g,f,c,m)=>{if(g=="opt3"){let u="Pick one event...",b=[{label:l(f,"def"),value:f.id,color:"secondary"},{label:l(c,"def"),value:c.id}];this.radioChoiceDialog("",u,b,"",function(C){p("Event",C,f,c,m)},null,function(){y("fixyOverlaps::resolveChoice opt3>> by Event... dismissing")})}else if(g=="opt2"){let u="Pick event by Score",b=[{label:l(f,"score"),value:f.id,color:"secondary"},{label:l(c,"score"),value:c.id}];this.radioChoiceDialog("",u,b,"",function(C){p("Score",C,f,c,m)},null,function(){y("fixyOverlaps::resolveChoice opt2>> by Score... dismissing")})}else if(g=="opt1"){let u="Pick event by Priority",b=[{label:l(f,"prio"),value:f.id,color:"secondary"},{label:l(c,"prio"),value:c.id}];this.radioChoiceDialog("",u,b,"",function(C){p("Priority",C,f,c,m)},null,function(){y("fixyOverlaps::resolveChoice opt1>> by Priority... dismissing")})}else g=="opt0"?(console.log("resolveChoice::it's a dropppp...keeping as is...."),S(f,c)):h(c,f,m)},v=(g,f,c,m,u)=>{m.direction!=="surrounding"&&!u?s.indexOf("nah")>-1?console.log("fixyOverlaps::manualSolve NOT adding Force as from "+s):g.push({label:`Force in '${f.title.trim()}'`,value:"opt4"}):console.log("fixyOverlaps::manualSolve NO force option...direction!==surrounding?",m.direction!=="surrounding","autoSolve?: "+u,s);let b=` '${f.title.trim()}' Overlaps with Scheduled '${c.title.trim()}'.
        
Cancel to keep '${c.title.trim()}' at ${this.whenFrmtTime(c==null?void 0:c.time)}`;this.radioChoiceDialog("Resolve Overlapping Events",b,g,"opt1",function(C){D(C,f,c,m)},function(){console.log("fixyOverlaps::manualSolve::cancelChoice>> from: "+s,O),S(f,c)},function(){console.log("fixyOverlaps::onDismiss >"+s,O)})};for(let g in t){if(!t[g]||!t[g][0]){console.log("fixyOverlaps...unknown key found",g);continue}let f=[{label:"Choose one event",value:"opt3"}];s=="reloadScore"?f.unshift({label:"Choose by Priority",value:"opt1",color:"secondary"}):s=="findSamePrio"?f.unshift({label:"Choose by Score",value:"opt2"}):s=="onDrop"?f.unshift({label:"Leave as is!",value:"opt0"},{label:"Choose by Priority",value:"opt1",color:"secondary"},{label:"Choose by Score",value:"opt2"}):f.unshift({label:"Choose by Priority",value:"opt1",color:"secondary"},{label:"Choose by Score",value:"opt2"});let c=t[g];if(c.length>1){console.log("fixyOverlaps::WOAH WOAH...multiple overlaps!!"),"withID"in t?this.fixMultiConflicts(c,i,s):this.multiConflicts(c,i,s);continue}const m=c.pop();let u=this.getLocalEvt(m.target),b=this.getScheduledEvent(m.inConflict);if(!b||!u){console.log("fixyOverlaps...ERROR ERROR no evts found!!!",m);return}console.log(`fixyOverlaps::adding ${u.id}:${u.title.trim()}(${u.time})++${u.duration} AT >> ${(E=m==null?void 0:m.targetStart)==null?void 0:E.time} -- ${m.direction} 
      Overlap with ${b.id}:${b.title.trim()}(${b.time})++${b.duration}`,i,"from:"+s,"toHandle="+T);let C=u.title.trim().includes(b.title.trim()),_=b.title.trim().includes(u.title.trim()),Z=this.parentGoalsMap().get(u.parentGoal),L=this.parentGoalsMap().get(b.parentGoal),W=u.title.trim().includes(L.title.trim()),Q=b.title.trim().includes(Z.title.trim());(W||Q)&&console.log("fixyOverlaps:: WOAH PARENT AUTO schedule",W,Q,"Normal AUTO>>",C,_,"direction == surrounding? >>",m.direction=="surrounding"),C||_?(console.log("fixyOverlaps:: can AUTO schedule",C,_,"direction == surrounding? >>",m.direction=="surrounding"),this.scrollToTime(m==null?void 0:m.targetStart,"slow"),this.confirmAction(`"${u.title.trim()}" related to Scheduled "${b.title.trim()}".
        
Auto resolve Overlap?
        
Cancel/Dismiss for manual resolution.`,"Auto",function(){var ee;if(C){console.log("auto schedule with removeReplace..with ORIG TIMES>>",u.time,b.time,(ee=m==null?void 0:m.targetStart)==null?void 0:ee.time),d(b,u,m),o(`Scheduling Evt '${u.title.trim()}'`);return}else{console.log("auto schedule with cancelChoice >> from: ",s),S(u,b);return}},function(){console.log("Cancelling Auto-Solve...doing manual"),v(f,u,b,m,!0)})):v(f,u,b,m,!1)}},multiConflicts(t,i=null,s=""){var f;let n="",l=[],o=null,r=[],a=null,d=new Map,h=new Map,p=[{label:"Pick one event",value:"opt3"}];const S=c=>{let m=this.parentGoalsMap().get(c.parentGoal);return{label:`Of '${m==null?void 0:m.title.trim()}' "${c.title.trim()}" (${c.score}) for ${c==null?void 0:c.duration} mins`,value:c.id}},y=c=>{let m=0,u=null;for(let b of c)if(b.parentGoal){let C=this.parentGoalsMap().get(b.parentGoal);C?C.priority>m&&(m=C.priority,u=b):console.log("multiConflicts::findhighestPrio..ERROR no PARENT found?",b)}else console.log("multiConflicts::findhighestPrio..ERROR EVT not found?",b);return h.set(u.id,`By highest priority (${m}),`),u};let O=c=>{let m=0,u=null;for(let b of c){let C=this.parseScore(b.score);C>-1&&C>=m&&(m=C,u=b)}if(u)return console.log("multiConflicts::Largest Score interval",u.id,u==null?void 0:u.title.trim(),u.score),u;console.log("ERROR ERROR multiConflicts::highestScore...no current set?",m,u,c)},T=(c,m)=>{console.log(`multiConflicts::removeConflicts with toKeep=${c.length} out of total:${m.length}`);let u=[];if(m.forEach((C,_,Z)=>{if(c.find(L=>L.id==C.id)){let L=h.has(C.id)?h.get(C.id):"";if(console.log("multiConflicts::removeConflicts:KEEEP..TIME? by>"+L,C.id,C==null?void 0:C.title.trim(),C==null?void 0:C.time,a),C.id!=o.id){let W=this.addPropsEventsTo(this.currentDate,[{...C,time:a}]),Q=this.overlapCheckEvtsAdd(W);if(Object.keys(Q).length>0)u.push(Q);else{console.log("multiConflicts::removeConflicts--no other overlap",C==null?void 0:C.title.trim());let ee=`${L} Adding '${C==null?void 0:C.title.trim()}' at ${this.whenFrmtTime(a)}`;this.doNotify(ee,"positive","top")}}else console.log("multiConflicts::removeConflicts...already scheduled!!",C==null?void 0:C.title.trim()),this.doNotify(`${L} Keeping scheduled '${C==null?void 0:C.title.trim()}' `,"positive","top")}else C.id==o.id&&(console.log("multiConflicts::removeConflicts...removing scheduled!!",C.id,C.title),this.usingMoods[C.id]&&(delete this.usingMoods[C.id],console.log("multiConflicts::removeConflicts>>deleting Moody..."+C.id,this.scheduleMoodsLabel)),this.doRemove(C))}),u.length>0)return console.log(`${s}>multiConflicts::removeConflicts:: OVERLAPS again from ${c.length} overlaps =${u.length}`,u),this.doNotify("More Overlaps to fix!!!","warning","top"),this.fixyOverlaps(u[0],i,s+"nah");let b=this.updateCurrentSchedule();b.size>0&&(console.log("multiConflicts::removeConflicts::SAMESTART!!",b),this.fixSameStart(b))},D=c=>{this.radioChoiceDialog("","Choose the event to schedule",c.map(S),"",function(m){let u=c.find(b=>b.id==m);if(u)r.push(u),h.set(u.id,"By pick,");else{console.log("chooseEvt::ERROR NOT FOUND!!",m);return}return console.log(`chooseEvt::onOk >>${m} >> ${u==null?void 0:u.title.trim()}`),u},null,function(){r.length>0&&(console.log("chooseEvt::LAST LAST?",JSON.parse(JSON.stringify(r))),setTimeout(()=>{T(r,c)},0))})};const v=c=>{c.forEach(u=>{if(o.id==u.id)console.log("multiConflicts::forceAdd...SKIP scheduled",o.title);else{let b=d.has(u.id)?d.get(u.id):null;console.log(`multiConflicts::forceAdd...NEW:${u.id} '${u.title.trim()}' origAt: ${u.time}`,b.time),this.recurChangeTime(o.id,u,b,!0,!0)}});let m=this.updateCurrentSchedule();console.log("multiConflicts::forceAdd::DONE >>"+c.length+" addySize="+d.size,m,this.dailyScheduled),m.size>0&&this.fixSameStart(m)};s=="reloadScore"?p.unshift({label:"Resolve by Highest Priority",value:"opt1",color:"secondary"}):s=="findSamePrio"?p.unshift({label:"Resolve by Largest Score Interval (low Score)",value:"opt2"}):p.unshift({label:"Resolve by Highest Priority",value:"opt1",color:"secondary"},{label:"Resolve by Largest Score Interval (low Score)",value:"opt2"});let E=!1;for(let c of t){console.log("multiConflicts....handling:>",JSON.parse(JSON.stringify(c)));let m=this.getScheduledEvent(c.inConflict);if(!m){console.log("multiConflicts...ERROR ERROR no evts found!!!",c);return}o?o.id!=m.id&&console.log("multiConflicts...ERROR Not same inConflict",o.id,m.id):(o=m,a=(f=c==null?void 0:c.targetStart)==null?void 0:f.time);let u=this.getLocalEvt(c.target);if(!u){console.log("multiConflicts...ERROR ERROR local evt not found!!!",c);return}n+=` '${u==null?void 0:u.title.trim()}',`,l.push(u),d.set(c.target,c==null?void 0:c.targetStart),c.direction=="surrounding"?E=!0:E=E}E||p.push({label:"Force Schedule them in",value:"opt4"});let g=`${n} conflicts with scheduled '${o==null?void 0:o.title.trim()}' at ${this.whenFrmtTime(o==null?void 0:o.time)}.
    
Choose how to solve this...`;l.unshift(o),this.radioChoiceDialog("Overlap warning!!",g,p,"",function(c){if(c=="opt3")D(l);else if(c=="opt2"){let m=O(l);console.log("multiConflicts::ByScore",m.id,m==null?void 0:m.title.trim(),m.score),r.push(m),h.set(m.id,`By largest score interval (${m.score}),`)}else if(c=="opt1"){let m=y(l);console.log("multiConflicts::ByPriority",m.id,m==null?void 0:m.title.trim()),r.push(m)}else v(l)},null,function(){r.length>0&&(console.log("multiConflicts::MAIN LAST LAST?",r),setTimeout(()=>{T(r,l)},0))})},fixMultiConflicts(t,i=null,s=""){var E;let n="",l=null,o=[],r=[],a=new Map,d=null,h=[{label:"Pick one event",value:"opt3"}];const p=g=>{let f=this.parentGoalsMap().get(g.parentGoal);return{label:`Of '${f==null?void 0:f.title.trim()}' "${g.title.trim()}" (${g.score}) for ${g==null?void 0:g.duration} mins`,value:g.id}},S=g=>{let f=0,c=null;for(let m of g)if(m.parentGoal){let u=this.parentGoalsMap().get(m.parentGoal);u?u.priority>f&&(f=u.priority,c=m):console.log("fixMultiConflicts::findhighestPrio..ERROR no PARENT found?",m)}else console.log("fixMultiConflicts::findhighestPrio..ERROR EVT not found?",m);return a.set(c.id,`By highest priority (${f}),`),c};let y=g=>{let f=0,c=null;for(let m of g){let u=this.parseScore(m.score);u>-1&&u>=f&&(f=u,c=m)}if(c)return console.log("fixMultiConflicts::Largest score interval",c.id,c==null?void 0:c.title.trim(),c.score),c;console.log("ERROR ERROR fixMultiConflicts::highestScoreInterval...no current?",f,c,g)},O=(g,f)=>{let c=[];if(f.forEach((u,b,C)=>{if(g.find(_=>_.id==u.id))if(u.id==l.id)if(console.log("fixMultiConflicts::removeConflicts:inKeep toAdd at >"+d.time,u.id,u==null?void 0:u.title.trim(),u==null?void 0:u.time),s=="onDrop")console.log("removeConflicts...NOTHING to do as from"+s);else{let _=this.addPropsEventsTo(this.currentDate,[{...u,time:d.time}]),Z=a.has(u.id)?a.get(u.id):"",L=this.overlapCheckEvtsAdd(_);if(Object.keys(L).length>0)c.push(L);else{console.log("fixMultiConflicts::removeConflicts--no other overlap adding",u==null?void 0:u.title.trim());let W=`${Z} Adding '${u==null?void 0:u.title.trim()}' at ${this.whenFrmtTime(d.time)}`;this.doNotify(W,"positive","top")}}else{console.log("fixMultiConflicts::removeConflicts....Keeping scheduled Evt!!",d,u.id);let _=`${a.has(u.id)?a.get(u.id):""} Keeping scheduled '${u==null?void 0:u.title.trim()}'`;this.doNotify(_,"positive","top")}else u.id!=l.id?(console.log("fixMultiConflicts::removing scheduled...doNotify?",u.id,u.title,u.time),this.usingMoods[u.id]&&(delete this.usingMoods[u.id],console.log("fixMultiConflicts::removeConflicts>>deleting Moody..."+u.id,this.scheduleMoodsLabel)),this.doRemove(u)):console.log("fixMultiConflicts::NOT adding original target",l.id)}),c.length>0)return console.log(`${s}> fixMultiConflicts::removeConflict:: OVERLAPS again=${c.length}`,c),this.doNotify("More Overlaps to fix!!!","warning","top"),this.fixyOverlaps(c[0],i,s+"nah");let m=this.updateCurrentSchedule();m.size>0&&(console.log("fixMultiConflicts::removeConflicts::SAMESTART",m),this.fixSameStart(m))};const T=(g,f)=>{console.log(`At ${f.date}:${f.time} forceAdding:${g.id} ${g.title} from ${g.time} >>`+s,JSON.parse(JSON.stringify(l)),o.length,o[o.length-1]);let c=this.addPropsEventsTo(f.date,[{...g,time:f.time}]),m=this.overlapCheckEvtsAdd(c),u=Object.keys(m).length;if(u>0)return console.log(`${s} >fixMultiConflicts::forceAdd:: OVERLAPS again from ${l.length} overlaps =${u}`,JSON.parse(JSON.stringify(m))),this.doNotify(`Extra Overlaps while adding '${c[0].title.trim()}'`,"warning","top"),this.fixyOverlaps(m,i,s+"nah")};let D=g=>{this.radioChoiceDialog("","Choose the event to schedule",g.map(p),"",function(f){let c=g.find(m=>m.id==f);if(c)r.push(c),a.set(c.id,"By pick,");else{console.log("chooseEvt::ERROR NOT FOUND!!",f);return}return console.log(`chooseEvt::onOk >>${f} >> ${c==null?void 0:c.title.trim()}`),c},null,function(){r.length>0&&(console.log("chooseEvt::gon removeConflicts out of total="+g.length,JSON.parse(JSON.stringify(r))),setTimeout(()=>{O(r,g)},0))})};s=="reloadScore"?h.unshift({label:"Resolve by Highest Priority",value:"opt1",color:"secondary"}):s=="findSamePrio"?h.unshift({label:"Resolve by Largest Score Interval (low Score)",value:"opt2"}):h.unshift({label:"Resolve by Highest Priority",value:"opt1",color:"secondary"},{label:"Resolve by Largest Score Interval (low Score)",value:"opt2"});for(let g of t){console.log("fixMultiConflicts....handling:>",JSON.parse(JSON.stringify(g)));let f=this.getScheduledEvent(g.inConflict);if(!f){console.log("fixMultiConflicts...ERROR ERROR no evts found!!!",g);return}o.push(f),n+=` '${f==null?void 0:f.title.trim()}',`,d?d.time!=((E=g==null?void 0:g.targetStart)==null?void 0:E.time)&&console.log("fixMultiConflicts...ERROR Not same targetStart?!?",d,g==null?void 0:g.targetStart,g.direction):d=g==null?void 0:g.targetStart;let c=this.getLocalEvt(g.target);if(!c){console.log("fixMultiConflicts...ERROR ERROR local evt not found!!!",g);return}l=c,g.direction!=="surrounding"&&h.length<3&&h.push({label:`Force in '${l.title.trim()}'`,value:"opt4"})}let v=`'${l==null?void 0:l.title.trim()}' conflicts with scheduled ${n} 

      Choose how to solve this...`;o.unshift(l),this.radioChoiceDialog("Overlap warning!!",v,h,"",function(g){if(g=="opt3")D(o);else if(g=="opt2"){let f=y(o);console.log("fixMultiConflicts::ByScore",f.id,f==null?void 0:f.title.trim(),f.score),r.push(f),a.set(f.id,`By largest score interval (${f.score}),`)}else if(g=="opt1"){let f=S(o);console.log("fixMultiConflicts::ByPriority",f.id,f==null?void 0:f.title.trim()),r.push(f)}else console.log("fixMultiConflicts::forceAdd..."),T(l,d)},null,function(){r.length>0&&(console.log("fixMultiConflicts::MAIN gon removeConflicts from total="+o.length,JSON.parse(JSON.stringify(r))),setTimeout(()=>{O(r,o)},0))})},fixSameStart(t){const i=a=>{let d=0,h=null;for(let p of a){let S=this.getScheduledEvent(p);if(S){let y=this.parentGoalsMap().get(S.parentGoal);y?y.priority>d&&(d=y.priority,h=S):console.log("findhighestPrio..ERROR no PARENT found?",S)}else console.log("findhighestPrio..ERROR EVT not found?",p)}return o.set(h.id,`By highest priority (${d}),`),h},s=a=>{let d=this.parentGoalsMap().get(a.parentGoal);return{label:`Of '${d==null?void 0:d.title.trim()}' "${a.title.trim()}" (${a.score}) for ${a==null?void 0:a.duration} mins`,value:a.id}};let n=[],l=new Set,o=new Map,r=[{label:"Resolve by Highest Priority",value:"opt1",color:"secondary"},{label:"Resolve by Largest Score Interval (low Score)",value:"opt2"},{label:"Pick event",value:"opt3"}];for(let a of t){let d=this.retrieveSameStart(a.at);console.log("fixSameStart:conflict",JSON.parse(JSON.stringify(a)),JSON.parse(JSON.stringify(d)));let h=[],p="";for(let v of d){let E=this.getScheduledEvent(v);E?(h.push(E),p+=` '${E==null?void 0:E.title.trim()}',`,l.has(E)?console.log(`Set already contain ${E.id}~${E.title}..skipping`):l.add(E)):console.log("fixSameStart...ERROR not found?",v)}let S=v=>{let E=this.getScheduledEvent(v);return E?(n.push(E),o.set(E.id,"By pick,"),E):(console.log("fixSameStart::onOk:: ERROR ERROR?!?! Not found",v),E=this.getLocalEvt(v),E?(n.push(E),o.set(E.id,"By pick,"),E):(console.log("fixSameStart::onOk:: ERROR ERROR..still not found!!!",v),!1))},y=()=>{let v=0,E=null;for(let g of h){let f=this.parseScore(g.score);f>-1&&f>=v&&(v=f,E=g)}if(E)return console.log("fixSameStart::highestScore",E.id,E==null?void 0:E.title.trim(),E.score),n.push(E),o.set(E.id,`By largest score interval (${E.score}),`),E;console.log("ERROR ERROR fixSameStart::highestScore..nothing set?",v,e)},O=()=>{this.radioChoiceDialog("","Choose the event to schedule",h.map(s),"",function(v){let E=S(v);return console.log(`fixSameStart--chooseEvt::onOk >>${v} >> ${E==null?void 0:E.title.trim()}`),E},null,function(){n.length==t.size&&(console.log("fixSameStart--chooseEvt::onDismiss...PICKLAST"+n.length,n),setTimeout(()=>{T(n,l)},0))})},T=(v,E)=>{E.forEach((f,c,m)=>{if(v.find(u=>u.id==f.id)){console.log("fixSameStart::removeConflicts:KEEEP",f.id,f==null?void 0:f.title.trim());let b=`${o.has(f.id)?o.get(f.id):""} Keeping '${f==null?void 0:f.title.trim()}' at ${this.whenFrmtTime(f==null?void 0:f.time)}`;this.doNotify(b,"positive","top")}else this.usingMoods[f.id]&&(delete this.usingMoods[f.id],console.log("fixSameStart::removeConflicts>>deleting Moody..."+f.id,this.scheduleMoodsLabel)),this.doRemove(f)});let g=this.updateCurrentSchedule();g.size>0&&(console.log("fixSameStart::removeConflicts::SAMESTART",g),this.fixSameStart(g)),this.disableSaveSchedule=!1},D=`${p} scheduled at same ${this.whenFrmtTime(a.at)}.

      Choose how to solve this...`;this.radioChoiceDialog("Same start time!!",D,r,"opt1",function(v){if(v=="opt3")O();else{if(v=="opt2")return y();{let E=i(d);n.push(E)}}},null,function(){n.length==t.size&&(console.log("fixSameStart::onDismiss Main with size="+n.length,"conflicts="+l.size),setTimeout(()=>{T(n,l)},0))})}return!0},showDefaultBtn(t){let i=this.allEvents.some(s=>(s==null?void 0:s.inDefaults)&&(s==null?void 0:s.time)!=""&&!this.scheduledEvents.find(n=>n.id==s.id));this.updateButtons(t?!1:i,!t,!t)},getEventsForDatey(t,i){let s=(r,a)=>{"byMood"in a&&(this.usingMoods[r]=a.byMood);let d={};return a.notes!==void 0&&(d.notes=a.notes,d.atScore=a.atScore),d.id=parseInt(r),d.duration=a.duration,d.time=a.time,d},n=this.getEventsForDate(t);if(!n){console.log(`ERROR no evts found for today:${t} ?!?`,n);return}let l=Object.keys(n).map(r=>s(r,n[r])),o=this.addPropsEventsTo(t,l);return console.log(`OverlapCheckLoadToday ${t} loading:${o.length} into current:${this.scheduledEvents.length}`),i?this.overlapCheckEvtsAdd(o):(this.scheduledEvents=o,this.updateCurrentSchedule())},loadForDate(t,i,s){if(this.scheduledEvents=[],this.usingMoods={},this.updateCurrentSchedule(),i)if(this.isViewingToday()){let n=this.getEventsForDatey(t,!0);if(Object.keys(n).length>0){console.log("Overlaps toHandle >>",JSON.parse(JSON.stringify(n))),Object.keys(n).length>0?this.doNotify(`${t} with Some overlaps to fix!`,"warning","bottom"):this.doNotify(`Loaded schedule for ${t}`,"positive","bottom"),this.fixyOverlaps(n),this.showReloadBtn=i,this.showClearBtn=i,this.disableSaveSchedule=!1,this.evtStartedOrPassed(G(new Date)),this.showDefaultBtn(s);return}this.doNotify(`Loaded schedule for ${t}`,"positive","bottom"),this.evtStartedOrPassed(G(new Date)),this.disableSaveSchedule=!0,this.showReloadBtn=!1,this.showClearBtn=!i}else{let n=this.getEventsForDatey(t,!1);n.size>0&&!s?(console.log(`doLoadNotPresent..SAMESTART inPast?${s} on ${t}`,n.size),this.doNotify(`${t} with conflicts to fix!`,"warning","bottom"),this.fixSameStart(n)):(this.showReloadBtn=!1,this.disableSaveSchedule=!0,this.doNotify(`Loaded schedule for ${s?"past":"future"}:: ${t}`,"positive","bottom")),this.allowScoreEdit(s),this.showClearBtn=!s}else this.showReloadBtn=!1,this.showClearBtn=!1,this.disableSaveSchedule=!0;(s||t!==z())&&this.adjustCurrentTime(),this.reset(),this.showDefaultBtn(s)},reset(){this.draggedItem=null,this.targetDrop=null,this.touchedItem=null,this.chosenScore=null,this.chosenPrio=null,this.possibleRange=null},deepCopy(t){if(t===null||typeof t!="object")return t;if(Array.isArray(t))return t.map(s=>this.deepCopy(s));const i={};for(let s in t)t.hasOwnProperty(s)&&(i[s]=this.deepCopy(t[s]));return i},onRefresh(t){setTimeout(()=>{this.scheduledEvents=[],this.updateCurrentSchedule(),this.resetGoalEvts(!0),this.loadForDate(this.currentDate,this.hasEventsForDate,this.isViewingPast()),t()},1e3)},doSaveSchedule(){let t={};this.dailyScheduled.size<1?t=null:this.dailyScheduled.forEach((i,s,n)=>{t[s]={time:i.start.time,duration:i.for},this.usingMoods[s]&&(t[s].byMood=this.usingMoods[s]),i.notes!==void 0&&(i==null?void 0:i.notes)!==""&&(console.log("doSaveSchedule",s,i==null?void 0:i.notes,t[s].atScore,i==null?void 0:i.score),t[s].atScore=i==null?void 0:i.score,t[s].notes=i==null?void 0:i.notes)}),this.store.saveDailySchedule(this.currentDate,t),this.disableSaveSchedule=!0,this.showReloadBtn=!1,this.showClearBtn=t!=null,this.doNotify(`Schedule saved for ${this.currentDate}`,"positive","top")},addParentGoal(t,i,s="red-14",n=2){let l=[];this.parentGoalsMap().forEach((a,d,h)=>{let p=a.bgcolor;l.push(p)});let o=Je(),r=l.length;if(r>1){let a=r;for(;l.some(h=>o[a]==h);)console.log("addParentGoal::index with taken color...new random",a,o[a]),a=Math.floor(Math.random()*r);let d=o[a];s=d||s}return this.store.addMainGoal(t,i,s,n)},onAddHocEvent(t,i,s,n){if(this.possibleRange||(console.log("umm onAddHocEvent... not a range selection",this.startEndTimes),this.possibleRange=this.startEndTimes),t.trim()==""){this.doNotify("Empty Goal title..."),this.addEventDialog=!1,this.reset();return}let l=ue(this.possibleRange[0]),o=n>15?R(l,{minute:parseInt(n)}):R(ue(this.possibleRange[1]),{minute:15}),r=Math.floor(V(l,o)/1e3/60);console.log(`onAddHocEvent:${t} :${s}: from ${l.time} till ${o.time}.Duration:${r}`,n);let a=null;if(s=="self"){let d=this.addParentGoal(t,t,"purple-10",2);d?a=this.store.addSubGoal(d,t,"1on5",l.time,r,!0,!1,r<30):console.log("ERROR? no pID",d)}else if(i){console.log("with parentGoal "+i.id,i==null?void 0:i.title),a=this.store.addSubGoal(i.id,t,"1on5",l.time,r,!1,!1,r<30);//!canMove and notInDefaults. isAlternative when duration<30
}else{let d=this.store.getGoalByTitle("Misc");if(d){console.log("Woo!! Misc pGoal already exists!",d.id),a=this.store.addSubGoal(d.id,t,"1on5",l.time,r,!1,!1,r<30);//!canMove and notInDefaults.isAlternative when duration<30
}else{let h=this.addParentGoal("Misc","Miscellaneous","grey-10",2);h&&(console.log("NEW Misc pGoal created",h),a=this.store.addSubGoal(h,t,"1on5",l.time,r,!0,!1,r<30))}}if(a){this.resetGoalEvts(!0);let d=this.tooClose(l,r);if(d){console.log("onAddHocEvent::tooClose check FAIL!!",d),d===!0?this.doNotify(`'${t}' created But Not added as over midnight!`):this.doNotify(`'${t}' created But Not added as too close to a scheduled Evt!!`),this.addEventDialog=!1;return}let h=this.hasOverlappingEvent(a,l,r);if(h.length>0){let p={};for(let S=0;S<h.length;S++){let y=h[S];p[y==null?void 0:y.inConflict]?p[y==null?void 0:y.inConflict].push(y):p[y==null?void 0:y.inConflict]=[y],S>0&&(console.log(S+" WOAH WOAH,onAddHocEvent.. multiple overlaps with same target!",h[S].target),y.inConflict in p&&(console.log("WOAH deleting inConflict",y.inConflict),delete p[y.inConflict]),h[S-1].inConflict in p&&(console.log("WOAH deleting PREV inConflict",h[S-1].inConflict),delete p[h[S-1].inConflict]),p[y.target]?(p[y.target].push(y),console.log("WOAH obj.id already present?",y.target)):p[y.target]=[y],p[y.target].unshift(h[S-1]),p.withID=!0)}console.log("onAddHocEvent:: OVERLAPS >>",JSON.parse(JSON.stringify(p))),this.fixyOverlaps(p,null,"addNew")}else{let p=this.addPropsEventsTo(this.currentDate,[{id:a,time:l.time,title:t,score:"2on5",duration:r,canMove:!i}]);console.log(`onAddHocEvent, addEvtPropsIntoSchedule: ${a} at ${l.time}`),this.addEvtPropsIntoSchedule(p[0])}this.disableSaveSchedule=!1,this.showReloadBtn=this.hasEventsForDate,this.showClearBtn=!this.isViewingPast(),this.constructTree()}else console.log("BOO ERROR no subID:(",a),this.doNotify("Error creating and adding this event :(","negative");this.addEventDialog=!1},tooClose(t,i){let s=R(t,{minute:0}),n=this.getTimeNumber(s),l=R(t,{day:1}),o=new Date(l.date);o.setHours(24),o.setMinutes(0),o.setSeconds(0),o.setMilliseconds(0);let r=G(o),a=Math.floor(V(s,r)/1e3/60);if(a<i)return console.log("tooClose to midnight eh...:(",a),!0;let d=!1;return this.dailyScheduled.forEach((h,p,S)=>{let O=this.getTimeNumber(h.start)-n,T=V(s,h.start);Math.floor(T/1e3/60)<=10&&O>0&&(d=p)}),d},onPickEvent(t,i,s){if(this.addEventDialog=!1,!t){console.log("onPickEvent...ERROR nothing!",t,i,s),this.doNotify("No Goal selected..."),this.reset();return}let n=()=>{if(this.isViewingPast()){console.log("onPickEvent...inPast auto saveSchedule"),this.doSaveSchedule(),this.disableSaveSchedule=!0;return}if(o>0){if(console.log("onPickEvent::saveSchedule..overlaps: "+o,"useBalance?"+s),s){let a=this.currentBalance,d=a+parseInt(l==null?void 0:l.duration);console.log("onPickEvent::saveSchedule...useBalance",a,d),this.doNotify("oooh What is Owed PAID!gg! >>"+d,"positive","right"),this.store.setBalance(d),this.doSaveSchedule(),this.disableSaveSchedule=!0}}else console.log("onPickEvent::saveSchedule...no overlaps so no auto-save!!",o,s),this.disableSaveSchedule=!1},l=null,o=0;if(l){console.log("onPickEvent...NOT NEW?!?ERROR!",l,t);return}else{l=t;let r=this.isViewingPast()?!0:i;console.log(`onPickEvent::(${l.id})'${l.title.trim()}' from ${l.time} to ${this.targetDrop.timestamp.time} with force?${i} BUT Forcing?:${r}`);let a=this.tooClose(this.targetDrop.timestamp,l.duration);if(a){if(console.log("onPickEvent::tooClose check FAIL!",a),a===!0){this.doNotify("Picking event TOO close to midnight!"),this.reset();return}if(r)this.doNotify(`'${l.title.trim()}' TOO close to a scheduled Evt Buuut..FORCING!`);else{this.doNotify(`'${l.title.trim()}' Not added as TOO close to a scheduled Evt`),this.reset();return}}let d=this.hasOverlappingEvent(l.id,this.targetDrop.timestamp,l.duration);if(o=d.length,o>0){let h={};for(let p=0;p<o;p++){let S=d[p];h[S==null?void 0:S.inConflict]?h[S==null?void 0:S.inConflict].push(S):h[S==null?void 0:S.inConflict]=[S],p>0&&(console.log(p+" WOAH WOAH,onPickEvent.. multiple overlaps with same target?",d[p].target),S.inConflict in h&&(console.log("WOAH deleting inConflict",S.inConflict),delete h[S.inConflict]),d[p-1].inConflict in h&&(console.log("WOAH deleting PREV inConflict",d[p-1].inConflict),delete h[d[p-1].inConflict]),h[S.target]?(h[S.target].push(S),console.log("WOAH obj.id already present?",S.target)):h[S.target]=[S],h[S.target].unshift(d[p-1]),h.withID=!0)}console.log(`onPickEvent::OVERLAPS of size: ${o} and force:${r}`,JSON.parse(JSON.stringify(h))),this.fixyOverlaps(h,null,"onPickEvt")}else{if(s){let h=this.currentBalance,p=h+parseInt(l==null?void 0:l.duration);console.log("onPickEvent...useBalance",h,p),this.doNotify("oooh What is Owed PAID!gg! >>"+p,"positive","center"),this.store.setBalance(p)}this.changeEvtTime(l.id,this.targetDrop.timestamp,r,!0)}}setTimeout(n,o>0?5e3:0),this.showReloadBtn=this.hasEventsForDate,this.showClearBtn=!this.isViewingPast()},closingDialog(){this.addEventDialog=!1,this.reset()},onEndNow(t){const i=G(new Date);let s=this.hasEventsForDate;if(this.dailyScheduled.has(t)){let n=this.dailyScheduled.get(t),l=n.start,o=n.end;if(le(i,l,o,!0)){let r=this.getTimeNumber(o)-this.getTimeNumber(l),a=this.getTimeNumber(i)-this.getTimeNumber(l);const d=()=>{console.log(`Great, ${t} REDUCING duration from ${r} to:`,a);for(let p=0;p<this.scheduledEvents.length;p++){let S=this.scheduledEvents[p];S.id===t&&(S.duration=a)}this.dailyScheduled.set(t,{...n,for:a,end:i}),this.endTimesSet.delete(o.time)||console.log("ERROR endTimesSet item does not exist?!?",n,this.endTimesSet),this.endTimesSet.add(i.time),this.isDisabledScoreEdit[t]=!1,this.doSaveSchedule(),this.disableSaveSchedule=!0,this.showReloadBtn=s,this.showClearBtn=!this.isViewingPast&&this.scheduledEvents.length>0},h=()=>{console.log("onEndNow::removing and saving!"),this.doRemove(this.getLocalEvt(t)),this.doSaveSchedule()};a<10?(console.log(`onEndNow:: ${a} less than 10 mins...REMOVE?`),this.confirmAction(`Less than 10mins remove?
 Cancel to just EndNow`,"OK",h,d)):d()}else console.log("umm aint in the middle of this event! Nothing to do...ERROR?",i.time,l.time,o.time)}else{console.log("ERROR doEndNow not found!!!",t);return}},onSaveScore(t,i,s=""){let n=this.dailyScheduled.get(i);if(n){let l=this.parseScore(t);if(l<-1){l==-89?(console.log("onSaveScore parsing error",l,t),this.doNotify("Score Parsing Error... YOU FOO! ")):this.doNotify("Score Error: higher# on lower#");return}this.doSaveEvtProp(i,null,t);let o=this.getScheduledEvent(i),r=null;o?(r=o.score,o.score=t):console.log("onSaveScore ERROR not found",o,i),s!==""&&(console.log(`onSaveScore::note ${i}from ${r} to ${t} with note>>`,s),n.score=r||t,n.notes=s,this.doSaveSchedule())}else console.log(`ERROR onSaveScore could not find event ${i}?!?`)},onAddMins(t,i){if(this.dailyScheduled.has(t)){let s=this.dailyScheduled.get(t),n=s.end,l=R(n,{minute:parseInt(i)}),o=parseInt(i)+s.for;console.log(`onAddMins::${t} add ${i} from ${s.for} to> ${o}`,n.time,l.time);let r=this.hasOverlappingEvent(t,s.start,o);if(r.length>0){console.log("onAddMins::huh some OVERLAPS",r);let a={};for(let d=0;d<r.length;d++){let h=r[d];a[h==null?void 0:h.inConflict]?a[h==null?void 0:h.inConflict].push(h):a[h==null?void 0:h.inConflict]=[h],d>0&&(console.log(d+" WOAH WOAH,onAddMins..ERROR?!? multiple overlaps with same target?",r[d].target),h.inConflict in a&&(console.log("WOAH deleting inConflict",h.inConflict),delete a[h.inConflict]),r[d-1].inConflict in a&&(console.log("WOAH deleting PREV inConflict",r[d-1].inConflict),delete a[r[d-1].inConflict]),a[h.target]?(a[h.target].push(h),console.log("WOAH obj.id already present?",h.target)):a[h.target]=[h],a[h.target].unshift(r[d-1]),a.withID=!0)}console.log("onAddMins:: OVERLAPS >>",JSON.parse(JSON.stringify(a))),this.fixyOverlaps(a,null,"addMins")}else{for(let a=0;a<this.scheduledEvents.length;a++){let d=this.scheduledEvents[a];d.id===t&&(d.duration=o)}this.dailyScheduled.set(t,{...s,for:o,end:l}),this.endTimesSet.delete(n.time)||console.log("ERROR endTimesSet item does not exist?!?",s,this.endTimesSet),this.endTimesSet.add(l.time),this.doSaveSchedule()}}else{console.log("ERROR onAddMins EVT not found!!!",t);return}},onClearDay(){if(this.isViewingPast()){this.doNotify("Editing past is no no!");return}let t=this.hasEventsForDate;this.scheduledEvents=[],this.updateCurrentSchedule(),this.resetGoalEvts(!0);let i=t?"Cleared...Can still reload saved":"Cleared daily schedule";this.doNotify(i,"warning","top"),this.reset(),this.showReloadBtn=t,this.showLoadDefaults=!0,this.showClearBtn=!1,this.disableSaveSchedule=!t},onReloadSaved(){let t=this.hasEventsForDate,i=()=>{console.log("Aborting",this.currentDate,this.scheduledEvents,t),this.showReloadBtn=!this.isViewingPast()||t},s=()=>{this.scheduledEvents=[],this.updateCurrentSchedule(),this.loadForDate(this.currentDate,t,this.isViewingPast()),this.reset()};if(this.scheduledEvents.length>0&&!this.isViewingPast()){let n=t?"Reload? saved schedule of: "+this.currentDate:"Overwrite current Evts?";this.confirmAction(n,"OK",s,i)}else s();this.showReloadBtn=!1,this.showClearBtn=!this.isViewingPast()},onMoodAdd(){console.log("onMoodAdd>>>",this.filterString);let t=[];const i=this.filter.map(s=>s.toLowerCase());this.treeGoals.filter(s=>{if(s.children.length>0)return s.children.find(n=>{if((n==null?void 0:n.moods.length)>0&&(n==null?void 0:n.moods.some(l=>i.indexOf(l.toLowerCase())>-1))){let l=n==null?void 0:n.moods.filter(o=>{if(i.indexOf(o.toLowerCase())>-1)return o});return t.push({id:n.id,mood:l}),n}})}),t.length>0?(t=t.filter(s=>!this.scheduledEvents.find(n=>n.id==s.id)),t.length>0?this.scheduleByMood(t):this.doNotify(`Evts of Mood '${this.filterString}' already scheduled!`,"warning","top")):this.doNotify("Nothing to add :(","warning","top")},scheduleByMood(t){var l;let i=[];for(let o=0;o<t.length;o++){let r=this.getLocalEvt(t[o].id);r&&r.time!=""?(i.push(r),this.usingMoods[t[o].id]=(l=t[o])==null?void 0:l.mood):this.withDismissNotify(`Evt '${r==null?void 0:r.title}' has no set time for scheduling, Manually Add it!`,"warning","top",null,function(){console.log("scheduleByMood>>>no time eh >> "+(r==null?void 0:r.title))})}i=this.addPropsEventsTo(this.currentDate,i);let s=this.overlapCheckEvtsAdd(i);Object.keys(s).length>0&&this.fixyOverlaps(s,null,"byMood"),this.disableSaveSchedule=!i.length>0,this.showReloadBtn=i.length>0&&this.hasEventsForDate,this.showClearBtn=!this.isViewingPast()},unscheduledDefaults(){return this.resetGoalEvts(!0),this.allEvents.filter(t=>(t==null?void 0:t.inDefaults)&&(t==null?void 0:t.time)!=""&&!this.scheduledEvents.find(i=>i.id==t.id))},removeNoTimes(t,i){if(t.some(s=>s.time=="")){let s="";t=t.filter(n=>{if(n.time!="")return n;s+=`'${n==null?void 0:n.title}'. `}),this.withDismissNotify(`Evts ${s} without set time not scheduled, Manually Add them.`,"warning","top",null,function(){console.log(`${i}::dismiss >> `,s)})}return t},scheduleDefaults(t){let i=this.deepCopy(this.store.fetchDefaults()),s=this.unscheduledDefaults();console.log("unscheduledDefaults",s);let n=this.isViewingPast();if(this.showReloadBtn=this.hasEventsForDate,this.showClearBtn=!n&&i.length>0,this.isViewingToday()){let l=this.addPropsEventsTo(this.currentDate,i);if(t=="add"){let a=l.length;l=l.filter(d=>(d==null?void 0:d.inDefaults)&&!this.scheduledEvents.find(h=>h.id==d.id)),console.log(`scheduleDefaults..ADDIN from ${a} to ${l.length}`)}else this.scheduledEvents=[],this.updateCurrentSchedule();l=this.removeNoTimes(l,"scheduleDefaults"),console.log(`scheduleDefaults:${this.currentDate} with '${t}'`,l.length,this.scheduledEvents.length);let o=this.overlapCheckEvtsAdd(l),r=Object.keys(o).length;r>0&&(console.log(`scheduleDefaults overlaps on:${this.currentDate} from ${i.length} to ${l.length}. overlaps =${r}`),this.fixyOverlaps(o,null,"byDefaults")),this.evtStartedOrPassed(G(new Date)),this.showDefaultBtn(n),this.disableSaveSchedule=!(l.length>0);return}else{let l=this.addPropsEventsTo(this.currentDate,i);if(l=this.removeNoTimes(l,"scheduleDefaults"),t=="add"){let r=l.length;l=l.filter(d=>!this.scheduledEvents.find(h=>h.id==d.id)),console.log(`scheduleDefaults..ADDIN to ${this.currentDate} of ${this.scheduledEvents.length} from ${r} to `,l.length);let a=this.scheduledEvents.concat(l);this.scheduledEvents=a}else this.scheduledEvents=l;let o=this.updateCurrentSchedule();o.size>0&&console.log("scheduleDefaults..sameStart="+o.size),n?this.allowScoreEdit(!0):this.allowScoreEdit(!1)}this.showDefaultBtn(n),this.disableSaveSchedule=!(i.length>0)},onLoadDefault(){let t=()=>{console.log("Aborting",this.currentDate)},i=s=>{this.scheduleDefaults(s)};if(this.scheduledEvents.length>0){let s=this.unscheduledDefaults(),n=[{label:`Add ${s==null?void 0:s.length} Default Evts to current day schedule`,value:"add"},{label:"Overwrite and only schedule Defaults",value:"overwrite"}];this.radioChoiceDialog("Warning!!",`Date: ${this.currentDate} already have scheduled Events...`,n,"",function(l){i(l)},t)}else i("overwrite")},onChoosenPrio(t){let i=this.chosenPrio;i&&i==t?this.disablePrioBtn=!0:(this.chosenPrio=t,this.disablePrioBtn=!1)},onChoosenScore(t){let i=this.chosenScore;i&&i==t?this.disableScoreBtn=!0:(this.chosenScore=t,this.disableScoreBtn=!1)},scheduleOneEach(t){let i=this.deepCopy(this.storedSubGoals),s=i.filter(a=>!this.scheduledEvents.find(d=>d.id==a.id));const n=a=>i.filter(d=>d.parentGoal==a),l=a=>{let d=[];return this.parentGoalsMap().forEach((h,p,S)=>{let y=n(h.id);if(y.length>0){let O=null,T=y.length;if(a)O=y[Math.floor(Math.random()*T)];else{let D=0;for(;this.scheduledEvents.some(v=>y[T].id==v.id);)if(D++,T=Math.floor(Math.random()*y.length),console.log(`selectOneFromP::index ${T} scheduled...new random> At try> `+D,y.length),D>2){console.log("selectOneFromP::random...TOO MANY TRIES..ERROR?",D,T,y.length,y);break}O=y[T],console.log("selectOneFromP::NO Random at index: "+T,D,O)}d.push(O)}else console.log("scheduleOneEach::selectOneFromP...huh no subgoals for parentGoal",h)}),d};let o=this.isViewingToday(),r=[];if(t=="add"?(this.parentGoalsMap().forEach((a,d,h)=>{let p=s.find(S=>S.parentGoal==a.id);p?r.push(p):this.useGroupNotify(`No SubGoals for Parent: '${a==null?void 0:a.title}'`,a==null?void 0:a.bgcolor,"bottom")}),r=this.addPropsEventsTo(this.currentDate,r),r=this.removeNoTimes(r,"scheduleOneEach")):(this.scheduledEvents=[],this.updateCurrentSchedule(),r=l(!0),r=this.addPropsEventsTo(this.currentDate,r),r=this.removeNoTimes(r,"scheduleOneEach")),o){let a=this.overlapCheckEvtsAdd(r),d=Object.keys(a).length;d>0&&(console.log(`scheduleOneEach:: Overlaps on:${this.currentDate} from ${s.length} to ${r.length}. overlaps =${d}`),this.fixyOverlaps(a,null,"oneEach"))}else{let a=t=="overwrite";if(a)this.scheduledEvents=r;else{let h=this.scheduledEvents.concat(r);this.scheduledEvents=h}let d=this.updateCurrentSchedule();console.log("scheduleOneEach....sameStart="+d.size),d.size>0&&o&&this.fixSameStart(a)}this.isViewingPast()?this.allowScoreEdit(!0):this.allowScoreEdit(!1),this.disableSaveSchedule=!1,this.showReloadBtn=this.hasEventsForDate,this.showClearBtn=!0},onScheduleOneEach(){if(this.scheduledEvents.length>0){let t=[{label:"Add one Evt from Each parent Goals",value:"add"},{label:"Overwrite current with one random Evt from Each parent Goals",value:"overwrite"}];this.radioChoiceDialog("Warning!!",`Date: ${this.currentDate} already have scheduled Events...`,t,"",this.scheduleOneEach,function(){console.log("One of Each....Aborting")})}else this.scheduleOneEach("overwrite")},scheduleSamePrio(t){const i=()=>this.scheduledEvents.filter(l=>{var o;return((o=this.parentGoalsMap().get(l.parentGoal))==null?void 0:o.priority)==this.chosenPrio});let s=[],n=this.isViewingToday();if(t=="overwrite"||t=="add"){let l=this.deepCopy(this.storedSubGoals);for(let o of l){let r=this.parentGoalsMap().get(o.parentGoal);(r==null?void 0:r.priority)==this.chosenPrio&&s.push(o)}t=="add"?s=s.filter(o=>!this.scheduledEvents.find(r=>r.id==o.id)):(this.scheduledEvents=[],this.updateCurrentSchedule()),console.log(`scheduleSamePrio...${t} to size: ${this.scheduledEvents.length} some evts = ${s.length}`)}else s=i(),console.log("scheduleSamePrio..filtering!!",this.chosenPrio,s);if(n&&t!="filter"){if(s.length<1){this.doNotify(`Empty for Priority == ${this.chosenPrio} :(`,"warning","bottom");return}s=this.addPropsEventsTo(this.currentDate,s),s=this.removeNoTimes(s,"scheduleSamePrio");let l=this.overlapCheckEvtsAdd(s);if(Object.keys(l).length>0)console.log(`scheduleSamePrio:${this.chosenPrio}...overlaps`,JSON.parse(JSON.stringify(l))),this.fixyOverlaps(l,null,"findSamePrio");else{if(console.log("scheduleSamePrio >>No overlaps!!...",s.length),s.length<1){this.disableSaveSchedule=!0,this.showReloadBtn=!1,this.showClearBtn=!1;return}this.updateCurrentSchedule()}}else{if(t=="filter")this.scheduledEvents=s;else if(s=this.addPropsEventsTo(this.currentDate,s),s=this.removeNoTimes(s,"scheduleSamePrio"),t=="add"){let l=this.scheduledEvents.concat(s);this.scheduledEvents=l}else this.scheduledEvents=s;this.updateCurrentSchedule()}if(!this.scheduledEvents.length>0){this.doNotify(`Empty for Priority == ${this.chosenPrio} :(`,"warning","bottom"),this.disableSaveSchedule=!0,this.showReloadBtn=this.hasEventsForDate,this.showClearBtn=!1;return}this.disableSaveSchedule=!1,this.showReloadBtn=this.hasEventsForDate,this.showClearBtn=!0},doReloadWithPrio(){if(this.chosenPrio==null){this.doNotify("Ayo select a priority!");return}let t=()=>{console.log("doReloadWithPrio..cancelling"),this.reset()};if(this.scheduledEvents.length>0){let i=[{label:`Filter current Evts by priority == ${this.chosenPrio}`,value:"filter"},{label:`Add to schedule Evts with priority == ${this.chosenPrio}`,value:"add"},{label:`Overwrite current and schedule All of priority == ${this.chosenPrio}`,value:"overwrite"}];this.radioChoiceDialog("","Schedule change...",i,"",this.scheduleSamePrio,t)}else this.scheduleSamePrio("overwrite");this.showDefaultBtn(this.isViewingPast()),this.disablePrioBtn=!0},scheduleByScore(t){const i=()=>{let l=[];return this.scheduledEvents.forEach(o=>{let r=this.parseScore(o.score);r>-1&&r>=this.chosenScore&&l.push(o)}),l};let s=[],n=this.isViewingToday();if(t=="overwrite"||t=="add"){const l=this.store.fetchGoalsWithMinScore(this.chosenScore);t=="add"?s=l.filter(o=>!this.scheduledEvents.find(r=>r.id==o.id)):(s=l,this.scheduledEvents=[],this.updateCurrentSchedule())}else s=i(),console.log(`scheduleByScore AFTER flag ${t}`,this.scheduledEvents.length,JSON.parse(JSON.stringify(s))),JSON.parse(JSON.stringify(this.scheduledEvents));if(n&&t!="filter"){if(s.length<1){this.doNotify(`Empty for Score >= ${this.chosenScore} :(`,"warning","bottom");return}s=this.addPropsEventsTo(this.currentDate,s),s=this.removeNoTimes(s,"scheduleByScore"),console.log(`scheduleByScore::addPropsEventsTo today for '${t}'`,this.scheduledEvents.length,JSON.parse(JSON.stringify(s)));let l=this.overlapCheckEvtsAdd(s);if(Object.keys(l).length>0)console.log(`scheduleByScore ${this.chosenScore}...overlaps!!`,JSON.parse(JSON.stringify(l))),this.fixyOverlaps(l,!1,"reloadScore");else{if(console.log("scheduleByScore >>NO OVERLAPS!!!..."),s.length<1){this.disableSaveSchedule=!0,this.showReloadBtn=!1,this.showClearBtn=!1;return}this.updateCurrentSchedule()}}else{if(console.log(`scheduleByScore... with flag '${t}' on>`,this.currentDate,JSON.parse(JSON.stringify(this.scheduledEvents.length)),JSON.parse(JSON.stringify(s))),t=="filter")this.scheduledEvents=s;else if(s=this.addPropsEventsTo(this.currentDate,s),s=this.removeNoTimes(s,"scheduleByScore"),t=="add"){let l=this.scheduledEvents.concat(s);this.scheduledEvents=l}else this.scheduledEvents=s;this.updateCurrentSchedule()}if(!this.scheduledEvents.length>0){this.doNotify(`Empty for Score >= ${this.chosenScore} :(`,"warning","bottom"),this.disableSaveSchedule=!0,this.showReloadBtn=this.hasEventsForDate,this.showClearBtn=!1;return}this.disableSaveSchedule=!1,this.showReloadBtn=this.hasEventsForDate,this.showClearBtn=!0},doReloadWithScore(){if(this.chosenScore==null){this.doNotify("Ayo select a score!");return}let t=()=>{console.log("doReloadWithScore..cancelling",this.scheduledEvents),this.reset()};if(this.scheduledEvents.length>0){let i=[{label:`Filter current Evts by Interval Score >= ${this.chosenScore}`,value:"filter"},{label:`Add to schedule Evts with Interval Score >= ${this.chosenScore}`,value:"add"},{label:`Overwrite current and schedule All of Interval Score >= ${this.chosenScore}`,value:"overwrite"}];this.radioChoiceDialog("","Schedule change...",i,"",this.scheduleByScore,t)}else this.scheduleByScore("overwrite");this.showDefaultBtn(this.isViewingPast()),this.disableScoreBtn=!0},onChange(t){this.loadForDate(t.start,this.hasEventsForDate,this.isViewingPast())},onDragStart(t,i){if(this.isViewingPast()){this.doNotify("Editing past is no no!"),t.preventDefault();return}this.draggedItem=i},onDragEnter(t,i,s){return i==="goal-item"||(this.targetDrop=s),t.preventDefault(),!0},onDragOver(t,i,s){return t.preventDefault(),!0},onDragLeave(t,i,s){return!1},onDragEnd(t){},onDrop(t,i,s){let n=this.getScheduledEvent(this.draggedItem.id);if(!n){console.log("onDrop ERROR",n,this.draggedItem);return}let l=null;if(i==="interval")l=s.timestamp;else if(i==="goal-item"&&this.targetDrop)l=this.targetDrop.timestamp;else{console.log("Cannot drop here YO!!",t,i,s,this.targetDrop);return}if(!l){console.log("ERROR...no timestamp YO!!",t,i,s,this.targetDrop);return}this.doDroppy("onDrop",l,this.draggedItem)},onTouchStart(t,i){if(t.type=="touchstart"){this.draggedItem=i;let s=document.elementFromPoint(t.changedTouches[0].clientX,t.changedTouches[0].clientY);if(s.parentNode.classList.contains("my-event"))console.log("onTouchStart >>my-event-drag","isDisabledScoreEdit>> "+this.isDisabledScoreEdit[i.id],this.allowDialog[i.id]),s.parentNode.classList.add("my-event-drag"),this.touchedItem=s;else{let n=s.closest(".my-event");if(s=s.parentNode,s.parentNode.classList.contains("my-event"))console.log("onTouchStart >>PHEW..FOUND","isDisabledScoreEdit>> "+this.isDisabledScoreEdit[i.id],n),s.parentNode.classList.add("my-event-drag"),this.touchedItem=s;else{this.touchedItem=!1,console.log("onTouchStart:ERROR...Btn?",s,s.parentNode);return}}return t.preventDefault(),!0}console.log("onTouchStart::ERROR...UNKNOWN",t)},onTouchEvt(t,i){const s=l=>{let o=l.split(" "),r=o[o.length-2],a=R(B(this.currentDate),{minute:k(r)});return o[o.length-1]=="PM"?a.hour==12?a:R(B(this.currentDate),{hour:12,minute:k(r)}):a.hour==12?R(B(this.currentDate),{hour:-12,minute:k(r)}):a};let n=l=>{let o=l.closest(".my-event");o.classList.contains("my-event-drag")?o.classList.toggle("my-event-drag"):console.log("onTouchEvt::resetClass...AINT THERE!",o,l)};if(this.draggedItem||(console.log("onTouchEvt NULL Item ?!? >> "+t.type,this.draggedItem,this.touchedItem),i=this.draggedItem),t.type=="touchmove"){if(this.isViewingPast()){this.doNotify("Editing past is no no!"),t.preventDefault(),t.stopPropagation();return}let l=document.elementFromPoint(t.changedTouches[0].clientX,t.changedTouches[0].clientY);if(l.ariaLabel){let o=s(l.ariaLabel);if(this.targetDrop){let r=V(this.targetDrop,o);if(JSON.stringify(this.targetDrop)===JSON.stringify(o)&&r==0)return}this.targetDrop=o,t.preventDefault();return}else{let o=l.closest(".my-event");o&&!o.classList.contains("my-event-drag")&&console.log("onTouchEvt::move >>TO ADD AGAIN?!?",o,l,this.touchedItem)}return}if(t.type=="touchend"){let l=document.elementFromPoint(t.changedTouches[0].clientX,t.changedTouches[0].clientY);if(this.isViewingPast()){this.doNotify("Editing past is no no!"),n(this.touchedItem),t.preventDefault(),t.stopPropagation();return}if(this.touchedItem)if(l.parentNode.classList.contains("my-event-drag"))console.log("onTouchEvt::END >>removing my-event-drag",this.isDisabledScoreEdit[i.id],this.mobileEnableScore[i.id]),l.parentNode.classList.remove("my-event-drag");else{let o=this.touchedItem.parentNode.classList.contains("my-event-drag");o?this.touchedItem.parentNode.classList.remove("my-event-drag"):console.log("onTouchEvt::END... target NO my-event-drag?",o,l,l.parentNode)}else{console.log("onTouchEvt.....EUUH nothing?",this.touchedItem,l);return}if(l.ariaLabel){let o=s(l.ariaLabel);console.log("onTouchEvt::END",this.targetDrop,o),this.targetDrop=o,this.doDroppy("onTouch",this.targetDrop,this.draggedItem)}else console.log("onTouchEvt::END>>ERROR?OVERLAP?",t,l,l.parentNode,this.mobile,this.isDisabledScoreEdit[i.id],this.allowDialog[i.id]),l.classList.contains("title")&&(console.log("onTouchEvt::END--has title!",this.targetDrop),this.doDroppy("onTouch",this.targetDrop,this.draggedItem));t.preventDefault(),t.stopPropagation();return}console.log("onTouchEvt::UNKNOWN",t)},doDroppy(t,i,s){if(console.log("doDroppy: "+t,i,s),i&&s){let n=this.tooClose(i,s.duration);if(n&&(console.log("onDrop::tooClose to>>",n),n===!0)){this.doNotify("Dropping event TOO close to midnight!"),this.reset();return}let l=this.hasOverlappingEvent(s.id,i,s.duration),o={},r=l.length;if(r>0){let a=0;do{if(l[a].inConflict==l[a].target){console.log("EUUUH...self overlap?!?",l[a]);break}console.log("doDroppy...OVERLAP handlin::size="+r,l[a].direction);let d=l[a];o[d==null?void 0:d.inConflict]?o[d==null?void 0:d.inConflict].push(d):o[d==null?void 0:d.inConflict]=[d],a>0&&(console.log(a+" WOAH WOAH,doDroppy.. multiple overlaps with same target!",l[a].target),d.inConflict in o&&(console.log("WOAH deleting inConflict",d.inConflict),delete o[d.inConflict]),l[a-1].inConflict in o&&(console.log("WOAH deleting PREV inConflict",l[a-1].inConflict),delete o[l[a-1].inConflict]),o[d.target]?(o[d.target].push(d),console.log("WOAH obj.id already present?",d.target)):o[d.target]=[d],o[d.target].unshift(l[a-1]),o.withID=!0)}while(++a<r);console.log("doDroppy...OVERLAP with fixOverlap",o),this.fixyOverlaps(o,!0,"onDrop")}else this.changeEvtTime(s.id,i,!1),console.log(`doDroppy with No overlap complete (${s.id}) to ${i.time}`);this.disableSaveSchedule=!1,this.showReloadBtn=this.hasEventsForDate,this.showClearBtn=!0,this.reset()}else{console.log("doDroppy null ERROR?",i,this.targetDrop,s,this.draggedItem);return}},onTouchHold({evt:t,...i},s){if(!this.mobile)return console.log("onTouchHold>>NOT MOBILE",t.type,this.mobileEnableScore[s.id]),!0;let n=document.elementFromPoint(t.changedTouches[0].clientX,t.changedTouches[0].clientY),l=this.allowDialog[s.id];this.allowDialog[s.id]=this.mobileEnableScore[s.id],this.isViewingPast()?(console.log("onTouchHold>> INPAST: ",this.isDisabledScoreEdit[s.id],l,this.mobileEnableScore[s.id]),this.allowDialog[s.id]=!this.isDisabledScoreEdit[s.id]):console.log("onTouchHold>> INPRESENT: ",this.isDisabledScoreEdit[s.id],l,this.mobileEnableScore[s.id],this.allowDialog[s.id]);let o=n.closest(".my-event");n.classList.contains("title")&&n.parentNode.classList.contains("my-event-drag")?(console.log("onTouchHold...REMOVING my-event-drag",o),n.parentNode.classList.remove("my-event-drag")):o&&o.classList.contains("my-event-drag")?o.classList.toggle("my-event-drag"):(o=this.touchedItem.closest(".my-event"),o&&o.classList.contains("my-event-drag")?o.classList.toggle("my-event-drag"):console.log("ERROR...onTouchHold--class not found on Target!!",n,this.touchedItem)),this.isDisabledScoreEdit[s.id]&&!this.mobileEnableScore[s.id]&&this.onDblClickEvent(t,s)},onDblClickEvent(t,i){if(this.isViewingPast()){if(i.duration<30){console.log("onDblClickEvent..baah too smoll smoll",i.title,i.duration),this.doNotify("umm Removing from the past..Soo Check BALANCE!"),this.addToBalance(i),this.doRemove(i);return}this.chooseAlternatives(i),t.preventDefault();return}this.removeEvtInSchedule(i),t.preventDefault()},onClickDate(t){console.log("onClickDate",t)},onClickTime(t){console.log("onClickTime..event",t),this.addEventDialog=!0,this.targetDrop=t.scope},onClickInterval(t){console.log("onClickInterval",t)},onClickHeadIntervals(t){console.log("onClickHeadIntervals",t)},onClickHeadDay(t){console.log("onClickHeadDay",t)},onMouseEnter(t){console.log("onMouseAt",t)},onMouseLeave(t){console.log("onMouseLeave",JSON.stringify(t))},onMouseDownTime({scope:t,event:i}){if(be(i)){if(this.mobile===!0&&this.anchorTimestamp!==null&&this.otherTimestamp!==null&&K(this.anchorTimestamp)===K(this.otherTimestamp)){this.otherTimestamp=t.timestamp,this.mouseDown=!1;return}this.mouseDown=!0,this.anchorTimestamp=t.timestamp,this.otherTimestamp=t.timestamp}},onMouseUpTime({scope:t,event:i}){if(this.mobile!==!0&&be(i)&&(this.otherTimestamp=t.timestamp,this.mouseDown=!1),!this.mousedown){let s=this.startEndTimes;if(s[1]==s[0])return;this.possibleRange=s,console.log("onMouseUpTime range change",this.possibleRange)}},onMouseMoveTime({scope:t,event:i}){this.mobile!==!0&&this.mouseDown===!0&&(this.otherTimestamp=t.timestamp)},scrollToEvent(t){this.$refs.calendar.scrollToTime(t.time,350)},scrollToTime(t,i=null){var s;if(this.$refs.calendar){let n=R(t,{minute:-30});console.log("scrollToTime::gonna SCROLL",t.time,n.time,i),(s=this.$refs.calendar)==null||s.scrollToTime(n.time,i?i=="fast"?400:1e3:500)}else console.log("scrollToTime::NO SCROLLY",t.time,JSON.parse(JSON.stringify(this.$refs)))},onToday(){let t=()=>{this.$refs.calendar.moveToToday()},i=()=>{setTimeout(t,1e3),this.doSaveSchedule()};this.disableSaveSchedule?t():this.confirmAction(`Save day: ${this.currentDate} changes?`,"Save",i,t)},onPrev(){let t=()=>{this.$refs.calendar.prev()},i=()=>{setTimeout(t,1e3),this.doSaveSchedule()};this.disableSaveSchedule?t():this.confirmAction(`Save day: ${this.currentDate} changes?`,"Save",i,t)},onNext(){let t=()=>{this.$refs.calendar.next()},i=()=>{setTimeout(t,1e3),this.doSaveSchedule()};this.disableSaveSchedule?t():this.confirmAction(`Save day: ${this.currentDate} changes?`,"Save",i,t)}}},ne=t=>(Ie("data-v-211ce7dc"),t=t(),Ge(),t),it={class:"subcontent"},st={class:"q-px-md boxy"},ot={key:0},lt={key:1},nt={key:2},rt={key:3},at={key:4},dt={key:5},ht={class:"row justify-center"},ct=ne(()=>A("br",null,null,-1)),ut=ne(()=>A("br",null,null,-1)),ft={key:0,class:"q-pa-sm bg-grey-12",style:{"max-width":"400px"}},gt={class:"q-pa-sm row justify-center"},mt={class:"row justify-center"},pt=ne(()=>A("br",null,null,-1)),St={key:0,class:"q-gutter-md"},Et={class:"q-mr-sm text-weight-bold",size:"28px"},yt={key:0},vt={class:"text-weight-bold"},Ot={key:1,class:"text-weight-light text-black"},bt={key:1,class:"q-pa-md q-gutter-sm bg-grey-12",style:{"max-width":"400px"}},Ct={key:0,class:"row"},Tt={class:"row justify-center"},wt={class:"q-gutter-md",style:{display:"flex","max-width":"800px",width:"100%",height:"600px"}},Dt={style:{display:"flex","justify-content":"center","flex-wrap":"wrap",padding:"2px"}},Rt={class:"heady q-calendar__ellipsis"},Nt=["onDblclick","onDragstart","onTouchstart","onTouchmove","onTouchend"],Pt=ne(()=>A("br",null,null,-1));function $t(t,i,s,n,l,o){const r=F("sched-btn"),a=F("drop-dwn-btn"),d=F("navigation-bar"),h=F("goaly-end"),p=F("scoreEditDialog"),S=F("q-calendar-day"),y=F("sched-dialog");return N(),J(je,{padding:""},{default:$(()=>[A("div",it,[P(Oe,{modelValue:l.splitterPage,"onUpdate:modelValue":i[9]||(i[9]=O=>l.splitterPage=O),limits:[30,70]},{before:$(()=>[P(Oe,{modelValue:l.splitterLegend,"onUpdate:modelValue":i[3]||(i[3]=O=>l.splitterLegend=O),horizontal:"",limits:[20,80],style:{height:"100%"}},{before:$(()=>[A("div",st,[l.showReloadBtn?(N(),M("div",ot,[P(r,{"text-label":"Reload",class:"sched-btn","text-color":"green",onDoBtnAction:o.onReloadSaved},null,8,["onDoBtnAction"])])):x("",!0),l.showClearBtn?(N(),M("div",lt,[P(r,{"text-label":"Clear",class:"sched-btn","text-color":"lime-5",onDoBtnAction:o.onClearDay},null,8,["onDoBtnAction"])])):x("",!0),l.showLoadDefaults?(N(),M("div",nt,[P(r,{textLabel:o.defaultLabels,class:"sched-btn","text-color":"blue",onDoBtnAction:o.onLoadDefault},null,8,["textLabel","onDoBtnAction"])])):x("",!0),l.showScoreBtn?(N(),M("div",rt,[P(a,{class:"sched-drop-btn","text-color":"teal",disableBtn:l.disableScoreBtn,optionLabel:o.chosenScoreLabel,daOptions:l.scoreOptions,onDoReload:o.doReloadWithScore,onChooseOption:o.onChoosenScore},null,8,["disableBtn","optionLabel","daOptions","onDoReload","onChooseOption"])])):x("",!0),l.showPrio?(N(),M("div",at,[P(a,{class:"sched-drop-btn","text-color":"teal",disableBtn:l.disablePrioBtn,optionLabel:o.chosenPrioLabel,daOptions:o.allMainGPrio(),onDoReload:o.doReloadWithPrio,onChooseOption:o.onChoosenPrio},null,8,["disableBtn","optionLabel","daOptions","onDoReload","onChooseOption"])])):x("",!0),l.showOneEach?(N(),M("div",dt,[P(r,{"text-label":"One Each",class:"sched-btn","text-color":"brown",onDoBtnAction:o.onScheduleOneEach},null,8,["onDoBtnAction"])])):x("",!0)]),A("div",ht,[P(pe,{class:"q-mt-md","text-color":o.saveScheduleDisabled?"grey":"blue",elevated:"",push:"",align:"evenly",label:"SaveSchedule",disable:o.saveScheduleDisabled,onClick:o.doSaveSchedule,"no-caps":""},null,8,["text-color","disable","onClick"]),P(pe,{class:"q-mt-md","text-color":"green",elevated:"",push:"",align:"evenly",label:"TreeLegend",onClick:i[0]||(i[0]=O=>l.showTree=!l.showTree),"no-caps":""})]),ct]),after:$(()=>[ut,l.treeGoals.length>0?(N(),M("div",ft,[A("div",gt,I(o.labelGoals("s")),1),A("div",mt,[P(oe,{color:"secondary","multi-line":""},{default:$(()=>[U(I(o.labelGoals("b"))+" mins ",1)]),_:1})]),P(ke),pt,o.showTreeForm?(N(),M("div",St,[P(We,{label:"'je-suis'",hint:"Keyword >> Enter","hide-hint":"",ref:"filterRef",modelValue:l.filter,"onUpdate:modelValue":i[1]||(i[1]=O=>l.filter=O),"use-input":"","use-chips":"",multiple:"",disable:o.isViewingPast(),"hide-dropdown-icon":"","input-debounce":"0","new-value-mode":"add-unique",class:"q-gutter-sm"},{"selected-item":$(O=>[P(He,{removable:"",dense:"",onRemove:T=>O.removeAtIndex(O.index),tabindex:O.tabindex,"text-color":"black",class:"q-ma-none",style:{width:"80px"}},{default:$(()=>[U(I(O.opt),1)]),_:2},1032,["onRemove","tabindex"])]),append:$(()=>[l.filter.length>0?(N(),J(Se,{key:0,name:"clear",class:"cursor-pointer",onClick:o.resetFilter},null,8,["onClick"])):x("",!0)]),_:1},8,["modelValue","disable"]),P(Ke,{nodes:l.treeGoals,"node-key":"label",filter:o.filterString,"filter-method":o.myFilterMethod,expanded:l.expanded,"onUpdate:expanded":i[2]||(i[2]=O=>l.expanded=O),"no-connectors":"",dense:""},{"default-header":$(O=>[A("div",{class:se(o.classyColor(O.node))},[O.node.isChildren?x("",!0):(N(),J(Se,{key:0,name:O.node.icon||O.expanded?"expand_less":"expand_more",size:"28px",right:""},null,8,["name"])),A("div",Et,I(O.node.label),1)],2)]),"default-body":$(O=>[O.node.isChildren?(N(),M("div",yt,[A("span",vt," >> "+I(O.node.details),1)])):(N(),M("span",Ot,I(O.node.details),1))]),_:1},8,["nodes","filter","filter-method","expanded"])])):x("",!0),l.filter.length>0?(N(),M("div",bt,[P(r,{"text-label":"Add Moods",class:"q-mt-xl sched-btn","text-color":"red",onDoBtnAction:o.onMoodAdd},null,8,["onDoBtnAction"])])):x("",!0)])):x("",!0)]),_:1},8,["modelValue"])]),separator:$(()=>[P(_e,{color:"primary",class:"q-px-md","text-color":"white",size:"40px",icon:"drag_indicator",style:{position:"relative",top:"70%"}})]),after:$(()=>[P(qe,{onRefresh:o.onRefresh},{default:$(()=>[P(d,{onToday:o.onToday,onPrev:o.onPrev,onNext:o.onNext},null,8,["onToday","onPrev","onNext"])]),_:1},8,["onRefresh"]),o.scheduleMoodsLabel!=""?(N(),M("div",Ct,[P(oe,{color:"secondary","multi-line":""},{default:$(()=>[U(I(o.scheduleMoodsLabel),1)]),_:1})])):x("",!0),A("div",Tt,[A("div",wt,[P(S,{ref:"calendar",view:"day",modelValue:l.currentDate,"onUpdate:modelValue":i[8]||(i[8]=O=>l.currentDate=O),"drag-enter-func":o.onDragEnter,"drag-over-func":o.onDragOver,"drag-leave-func":o.onDragLeave,"drop-func":o.onDrop,animated:"",bordered:"",hoverable:"","no-active-date":"","transition-next":"slide-left","transition-prev":"slide-right","time-clicks-clamped":"","interval-minutes":15,"interval-count":96,"interval-height":28,"selected-start-end-dates":o.startEndTimes,onChange:o.onChange,onClickDate:o.onClickDate,onClickTime:o.onClickTime,onClickInterval:o.onClickInterval,onClickHeadIntervals:o.onClickHeadIntervals,onClickHeadDay:o.onClickHeadDay,onMousedownTime:o.onMouseDownTime,onMouseupTime:o.onMouseUpTime,onMousemoveTime:o.onMouseMoveTime},{"head-day-event":$(({scope:{timestamp:O}})=>[A("div",Dt,[(N(!0),M(Y,null,Ee(o.eventsMap[O.date],T=>(N(),M(Y,{key:T.id},[T.time?(N(),J(oe,{key:1,class:se(o.badgeClasses(T,"header")),style:X([o.badgeStyles(T,"header"),{margin:"1px",width:"10px","max-width":"10px",height:"10px","max-height":"10px",cursor:"pointer"}]),onClick:D=>o.scrollToEvent(T)},{default:$(()=>[P(ye,null,{default:$(()=>[U(I("("+T.id+") "+T.title+" - "+T.time+" >> "+T.duration+"min"),1)]),_:2},1024)]),_:2},1032,["class","style","onClick"])):(N(),J(oe,{key:0,class:se(o.badgeClasses(T,"header")),style:X([o.badgeStyles(T,"header"),{width:"100%",cursor:"pointer",height:"12px","font-size":"10px",margin:"1px"}])},{default:$(()=>[A("div",Rt,[U(I(T.title)+" ",1),P(ye,null,{default:$(()=>[U(I(T.details),1)]),_:2},1024)])]),_:2},1032,["class","style"]))],64))),128))])]),"day-container":$(({scope:{days:O}})=>[o.hasDate(O)?(N(),M(Y,{key:0},[A("div",{class:"day-view-current-time-indicator",style:X(o.style)},null,4),A("div",{class:"day-view-current-time-line",style:X(o.style)},null,4)],64)):x("",!0)]),"day-body":$(({scope:{timestamp:O,timeStartPos:T,timeDurationHeight:D}})=>[(N(!0),M(Y,null,Ee(o.getDateEvents(O.date),v=>(N(),M(Y,{key:v.id},[v.time!==void 0?(N(),M("div",{key:0,class:se(["my-event",o.badgeClasses(v,"body")]),style:X(o.badgeStyles(v,"body",T,D)),draggable:!0,onDblclick:he(E=>o.onDblClickEvent(E,v),["prevent"]),onDragstart:he(E=>o.onDragStart(E,v),["stop"]),onDragend:i[4]||(i[4]=he((...E)=>o.onDragEnd&&o.onDragEnd(...E),["stop"])),onDrop:i[5]||(i[5]=E=>o.onDrop(E,"goal-item",t.scope)),onDragenter:i[6]||(i[6]=E=>o.onDragEnter(E,"goal-item",t.scope)),onDragover:i[7]||(i[7]=E=>o.onDragOver(E,"goal-item",t.scope)),onTouchstart:E=>o.onTouchStart(E,v),onTouchmove:E=>o.onTouchEvt(E,v),onTouchend:E=>o.onTouchEvt(E,v)},[Le(P(h,{disabledScore:l.isDisabledScoreEdit[v.id],title:v.title,id:v.id,startTime:v.time,score:v.score,details:v.details,notes:v.notes,happeningNow:l.hasStarted[v.id]?l.hasStarted[v.id]:!1,onEndNow:o.onEndNow,onSaveScore:o.onSaveScore,onAddMins:o.onAddMins,onDeleteNow:E=>o.removeEvtInSchedule(v)},null,8,["disabledScore","title","id","startTime","score","details","notes","happeningNow","onEndNow","onSaveScore","onAddMins","onDeleteNow"]),[[Ze,E=>o.onTouchHold(E,v),"400:12:15",{mouse:!0}]]),l.allowDialog[v.id]?(N(),J(p,{key:0,title:v.title,id:v.id,startTime:v.time,score:v.score,details:v.details,notes:v.notes,"show-dialog":l.allowDialog[v.id],onSaveScore:o.onSaveScore,onDeleteNow:E=>o.removeEvtInSchedule(v)},null,8,["title","id","startTime","score","details","notes","show-dialog","onSaveScore","onDeleteNow"])):x("",!0)],46,Nt)):x("",!0)],64))),128))]),_:1},8,["modelValue","drag-enter-func","drag-over-func","drag-leave-func","drop-func","selected-start-end-dates","onChange","onClickDate","onClickTime","onClickInterval","onClickHeadIntervals","onClickHeadDay","onMousedownTime","onMouseupTime","onMousemoveTime"])])]),Pt,l.addEventDialog?(N(),J(y,{key:1,parentGoals:o.storedCompPG,canBeScheduled:o.canbeScheduled,balance:o.currentBalance,onAddAdHocEvent:o.onAddHocEvent,onOnPickEvent:o.onPickEvent,onEuhHidin:o.closingDialog},null,8,["parentGoals","canBeScheduled","balance","onAddAdHocEvent","onOnPickEvent","onEuhHidin"])):x("",!0)]),_:1},8,["modelValue"])])]),_:1})}var Gt=Be(tt,[["render",$t],["__scopeId","data-v-211ce7dc"]]);export{Gt as default};
