import{z as P,a1 as B,r as g,H as q,A as m,B as S,C as h,I as f,D as d,K as p,L as J,M as w,a2 as L,a3 as N,Q,E as T,G as E,a4 as C,F as v,a5 as k,_ as z,a6 as G}from"./index.1bde7470.js";import{u as K,a as $,Q as H,b as D,c as F}from"./goalStorage.eaf7c117.js";import{Q as V}from"./QBadge.295c4452.js";import{i as W,Q as U}from"./isMobile.3d7b0ad3.js";import{Q as Y}from"./index.86ea5f6b.js";import{t as X,F as Z,a as _,p as O,b as A,N as I,O as ee,P as te}from"./QCalendarTask.13a7f0cd.js";import{a as se,b as ae}from"./utiFunc.f569f737.js";import{N as b}from"./actions.9a4d5535.js";const oe={name:"weekCalendar",components:{NavigationBar:B(()=>z(()=>import("./NavigationBar.22cf37af.js"),["assets/NavigationBar.22cf37af.js","assets/NavigationBar.bf3d18d0.css","assets/index.1bde7470.js","assets/index.f80becc5.css"])),QCalendar:Y},data(){return K(),{store:$(),calendar:g(null),currentDate:g(X()),events:[],treeGoals:g([]),expanded:g([]),showTree:g(!1),moods:g({}),mobile:g(!1),todayEvts:g({}),mostEvts:g(5),intervalMins:g(15),intervals:g(48),earliestStart:g(0),testEarliest:g(null)}},beforeMount(){this.mobile=W(),this.loadEvts(),this.constructTree(),this.dayNotifData()},mounted(){console.log("mounted")},computed:{storedGoalsMap(){const s=new Map;let e=this.store.getSubGoals;return e?(e.forEach(t=>{s.set(t.id,t)}),s):(console.log("GoalsMap is empty or null",e),s)},label(){return this.showTree?"Hide Legend":"Show Legend"},allEvents(){return this.store.getAllDates},parentGoalsMap(){const s=new Map;let e=this.store.getMainGoals;return e?(e.forEach(t=>{s.set(t.id,t)}),s):(console.log("parentGoalsMap is empty or null",e),s)},eventsMap(){const s={};return this.events.forEach(e=>{if(s[e.date]||(s[e.date]=[]),s[e.date].push(e),e.days){console.log(`eventsMap multiple days? event for ${e.date}`,e.days);let t=Z(e.date),l=e.days;do t=_(t,{day:1}),s[t.date]||(s[t.date]=[]),s[t.date].push(e);while(--l>0)}}),s}},methods:{reload(){this.loadEvts(!0)},loadEvts(s=!1){var i,a,r,u;let e=this.parentGoalsMap,t=this.storedGoalsMap,l=this.store.getAllDates;if(t&&e){if(l){s&&(this.events=[],this.moods={});for(let o in l){let n=l[o];o==this.currentDate&&(this.todayEvts=n);for(let c in n){let y=t.get(parseInt(c));if(y){let j=e.get(y.parentGoal),x=_(A(o),{minute:O(n[c].time)}),R=_(x,{minute:parseInt(n[c].duration)}),M="";n[c].notes!==void 0&&((i=n[c])==null?void 0:i.notes)!==""?M=[`${x.time} - ${R.time}`,`${(r=(a=n[c])==null?void 0:a.atScore)!=null?r:""} >> ${y.score}`,`${(u=n[c])==null?void 0:u.notes}`].join(`
\r`):M=`${x.time} - ${R.time}`,n[c].byMood!==void 0&&(this.moods[o]||(this.moods[o]=[]),this.moods[o].push(...n[c].byMood)),this.testEarliest||(console.log(`loadEvts::testEarliest>> ${y.id}: `+y.title,JSON.stringify(o),JSON.stringify(x.time)),this.testEarliest=x),this.events.push({id:y.id,title:y.title,details:M,time:n[c].time,duration:n[c].duration,date:o,bgcolor:j.bgcolor,sortTime:x})}}}}}else{console.log("ERROR--no parent or goals!!REVIEW**");return}},dayNotifData(){if(this.mobile){let s=this.storedGoalsMap;b.getSkippedNotifs({date:this.currentDate}).then(e=>{var l,i;let t=e.skipped;if(Array.isArray(t)&&t.length>0)if(Object.keys(this.todayEvts).length>0){console.log("WoooResults>> ",JSON.stringify(t),JSON.stringify(this.todayEvts));let a=[];for(let r in this.todayEvts)t.find(u=>u==r)&&(delete this.todayEvts[r],a.push((i=(l=s.get(parseInt(r)))==null?void 0:l.title)!=null?i:""),console.log("dayNotifData::deleteSkipped>> "+r,JSON.stringify(a)));this.store.saveDailySchedule(this.currentDate,this.todayEvts),a.forEach(r=>{this.$q.notify({color:"warning",position:"top",message:`'${r}' Evt Skipped!`,caption:`${this.currentDate} Schedule updated with removal`,icon:"thumb_down",timeout:t.length>1?2e3:3e3})}),b.clearStoreKey({key:"skip"}).then(r=>{console.log("dayNotifData::clearSkipKey",JSON.stringify(r)),this.reload()})}else console.log("GONCLEAR storage::mismatch!!"),b.clearStorage().then(a=>{console.log("dayNotifData::clearStorage",JSON.stringify(a))})}).catch(e=>{console.log("dayNotifData::getSkippedNotifs>>ERROR",e)}),b.getNotes().then(e=>{var t,l;if("notes"in e){let i=e.notes;const a=[];if(Array.isArray(i)){let r=[];for(let u of i)if(u.id in this.todayEvts){let o=Object.assign({},{...this.todayEvts[u.id],notes:u.note});console.log("dayNotifData::Setting Note>>",JSON.stringify(o),JSON.stringify(this.todayEvts[u.id])),this.todayEvts[u.id]=o,r.push((l=(t=s.get(parseInt(u.id)))==null?void 0:t.title)!=null?l:""),a.push(u.id)}else console.log("getNotes>>ERROR note Evts not found "+u.id,JSON.stringify(u),JSON.stringify(this.todayEvts));this.store.saveDailySchedule(this.currentDate,this.todayEvts),this.$q.notify({color:"positive",position:"top",message:`${r.join()} Evts had notes added!!`,icon:"thumb_up",timeout:3e3})}else console.log("getNotes>>ERROR not array",JSON.stringify(i),Array.isArray(i));b.clearStoreKey({key:"notey",ids:a}).then(r=>{console.log("dayNotifData::clearNoteKey",JSON.stringify(r)),this.reload()})}}),b.getStarted().then(e=>{if(console.log("dayNotifData::getStarted",JSON.stringify(e)),"started"in e){let t=e.started;Array.isArray(t)&&t.length>0&&b.clearStoreKey({key:"start"})}})}},constructTree(){this.treeGoals=this.store.fetchGoalsTree()},getEvents(s){let e=(l,i)=>{let a=te(l.sortTime,i.sortTime);if(a>0)return-1;if(a==0)return 0;if(a<0)return 1};const t=this.eventsMap[s]||[];if(t.length===1)t[0].side="full";else if(t.length===2){const l=_(A(t[0].date),{minute:O(t[0].time)}),i=_(l,{minute:t[0].duration}),a=_(A(t[1].date),{minute:O(t[1].time)}),r=_(a,{minute:t[1].duration});I(a,l,i,!0)||I(r,l,i,!0)?(t[0].side="left",t[1].side="right"):(t[0].side="full",t[1].side="full")}return t.length>this.mostEvts&&(console.log(`getEvents hiiigh ${s}`,t.length,this.mobile),this.mostEvts=this.mobile?t.length+5:t.length),t.sort(e),t},isEarlier(s){var l;let e=this.getTimeyNumber(s),t=this.getTimeyNumber(this.testEarliest);console.log(`isEarlier::testEarliest>> ${(l=s==null?void 0:s.time)!=null?l:"EMPTY"}: ${this.testEarliest.time}`,JSON.stringify(e),JSON.stringify(t))},getTimeyNumber(s){return s!==null?ee(s):!1},classyColor(s){return`row items-center ${s.isChildren?"text-":"text-white bg-"}${s.color} `},badgeClasses(s,e){return se(s,e)},badgeStyles(s,e,t=void 0,l=void 0){return ae(s,e,t,l)},scrollToEvent(s){this.$refs.calendar.scrollToTime(s.time,350)},onToday(){this.$refs.calendar.moveToToday()},onPrev(){this.$refs.calendar.prev()},onNext(){this.$refs.calendar.next()},onClickHeadDay({scope:s,event:e}){var a,r;let t=s.timestamp.date,l=this.moods[t],i=(r=(a=this.eventsMap[t])==null?void 0:a.length)!=null?r:0;l?this.$q.notify({color:"positive",position:"top",message:`${i} Scheduled with Moods: ${l.join()}`,icon:"tag_faces",multiLine:!0,timeout:3e3}):this.$q.notify({color:"white",textColor:"black",position:"top",message:i>0?`${i} Scheduled without Any Mood!`:"Empty and NO mood!!",icon:i>0?"mood":"sentiment_neutral",iconColor:i>0?"positive":"red",multiLine:!0,timeout:3e3})},onChange(s){this.mostEvts=5}}},ie={class:"q-px-md"},le={class:"row justify-center"},ne={class:"q-px-md",style:{display:"flex","max-width":"800px",width:"100%",height:"500px"}},re={style:{display:"flex","justify-content":"center","flex-wrap":"wrap",padding:"2px"}},de={class:"title q-calendar__ellipsis"},he={class:"title q-calendar__ellipsis"},ue={class:"lineyy"},me={key:0,class:"q-pa-md"},ce={key:0,class:"q-pa-md bg-grey-12",style:{"max-width":"400px"}},ye={class:"q-mr-sm text-weight-bold",size:"28px"},fe={key:0},ge={class:"text-weight-bold liney"},pe={key:1,class:"text-weight-light text-black liney"},ve={key:1,class:"column justify-center items-center"};function Ee(s,e,t,l,i,a){const r=q("navigation-bar"),u=q("q-calendar");return m(),S(H,{padding:""},{default:h(()=>[f("div",ie,[d(r,{onToday:a.onToday,onPrev:a.onPrev,onNext:a.onNext},null,8,["onToday","onPrev","onNext"]),e[3]||(e[3]=f("i",{class:"row justify-center q-pa-sm"},"Click on Day header for that day's Moods ",-1)),f("div",le,[f("div",ne,[d(u,{ref:"calendar",modelValue:i.currentDate,"onUpdate:modelValue":e[0]||(e[0]=o=>i.currentDate=o),view:"week",dark:"",animated:"",hoverable:"",bordered:"","transition-prev":"slide-right","transition-next":"slide-left","no-active-date":"","interval-minutes":30,"interval-count":48,"interval-height":i.mostEvts*3,onChange:a.onChange,onClickHeadDay:a.onClickHeadDay},{"head-day-event":h(({scope:{timestamp:o}})=>[f("div",re,[(m(!0),p(w,null,J(a.eventsMap[o.date],n=>(m(),p(w,{key:n.id},[n.time?(m(),S(V,{key:1,class:C(a.badgeClasses(n,"header")),style:G([a.badgeStyles(n,"header"),{margin:"1px",width:"10px","max-width":"10px",height:"10px","max-height":"10px",cursor:"pointer"}]),onClick:c=>a.scrollToEvent(n)},{default:h(()=>[d(D,null,{default:h(()=>[v(E(n.time+" - "+n.title),1)]),_:2},1024)]),_:2},1032,["class","style","onClick"])):(m(),S(V,{key:0,class:C(a.badgeClasses(n,"header")),style:G([a.badgeStyles(n,"header"),{width:"100%",cursor:"pointer",height:"12px","font-size":"10px",margin:"1px"}])},{default:h(()=>[f("div",de,[v(E(n.title)+" ",1),d(D,null,{default:h(()=>[v(E(n.details),1)]),_:2},1024)])]),_:2},1032,["class","style"]))],64))),128))])]),"day-body":h(({scope:{timestamp:o,timeStartPos:n,timeDurationHeight:c}})=>[(m(!0),p(w,null,J(a.getEvents(o.date),y=>(m(),p(w,{key:y.id},[y.time!==void 0?(m(),p("div",{key:0,class:C(["my-event",a.badgeClasses(y,"body")]),style:G(a.badgeStyles(y,"body",n,c))},[f("span",he,[v(E(y.title)+" ",1),d(D,null,{default:h(()=>[f("div",ue,E(y.details),1)]),_:2},1024)])],6)):T("",!0)],64))),128))]),_:1},8,["modelValue","interval-height","onChange","onClickHeadDay"])])])]),d(L,{modelValue:i.showTree,"onUpdate:modelValue":e[1]||(e[1]=o=>i.showTree=o),label:a.label,color:"teal",class:"q-pa-md"},null,8,["modelValue","label"]),d(F,null,{default:h(()=>[i.showTree?(m(),p("div",me,[i.treeGoals.length>0?(m(),p("div",ce,[e[4]||(e[4]=f("div",{class:"row justify-center"}," Goals & Goal Events ",-1)),d(N),e[5]||(e[5]=f("br",null,null,-1)),d(U,{nodes:i.treeGoals,"node-key":"label",expanded:i.expanded,"onUpdate:expanded":e[2]||(e[2]=o=>i.expanded=o),"no-connectors":"",dense:"",accordion:""},{"default-header":h(o=>[f("div",{class:C(a.classyColor(o.node))},[o.node.isChildren?T("",!0):(m(),S(Q,{key:0,name:o.expanded?"expand_less":"expand_more",size:"28px",class:"q-mr-sm"},null,8,["name"])),f("div",ye,E(o.node.label),1),d(Q,{name:o.node.icon},null,8,["name"])],2)]),"default-body":h(o=>[o.node.isChildren?(m(),p("div",fe,[f("span",ge," >> "+E(o.node.details),1),o.node.moods.length>0?(m(),S(D,{key:0},{default:h(()=>[v(E("Moods::> "+o.node.moods.join(",")),1)]),_:2},1024)):T("",!0)])):(m(),p("span",pe,E(o.node.details),1))]),_:1},8,["nodes","expanded"])])):(m(),p("div",ve,[e[11]||(e[11]=f("br",null,null,-1)),d(k,null,{default:h(()=>e[6]||(e[6]=[v(" 1. Add some Goals first. A schedulable goal is one with a parent Goal--can have multiple related goals with the same parent. ")])),_:1}),d(N),d(k,null,{default:h(()=>e[7]||(e[7]=[v(" 2. Go to Schedule to see a daily schedule. Drag scheduled events to new timeslots or click in calendar to add an event. ")])),_:1}),d(N),d(k,null,{default:h(()=>e[8]||(e[8]=[v(" 3. Reload a saved daily schedule or defaults or choose minimal score events to schedule. Fix any scheduling conflicts. ")])),_:1}),d(N),d(k,null,{default:h(()=>e[9]||(e[9]=[v(" 4. Save the daily schedule (dont forget to update their score as needed!) ")])),_:1}),d(N),d(k,null,{default:h(()=>e[10]||(e[10]=[v(" 5. Check out the summary of all goals here! ")])),_:1})]))])):T("",!0)]),_:1})]),_:1})}var Ce=P(oe,[["render",Ee],["__scopeId","data-v-8b914bb0"]]);export{Ce as default};
