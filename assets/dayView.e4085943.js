import{j as ie,r as C,c as Y,ak as ke,n as Ae,an as Be,h as M,g as Ee,Q as B,d as Z,_ as W,F as O,M as k,J as x,S as G,I as S,H as T,W as K,ao as ye,ap as oe,P as le,G as I,K as P,k as be,aq as we,a6 as Me,ar as _e,as as Ge,w as fe,b as Ie,R as Ce,at as Ve,au as Le,av as Fe,aw as qe,$ as Je,N as he,O as J,f as xe,ax as me,V as _,X as ne,Y as ae,ay as De,az as ce,ai as He,am as se,E as F,aA as Ue,U as ee}from"./index.a6f70d05.js";import{Q as $e,a as Qe,b as We,c as ze,d as je,e as Oe,f as Ke,g as Ye,h as Xe}from"./goalForm.49dea9e3.js";import{c as ue,a as Ze,b as et,p as tt,Q as ge}from"./utiFunc.746be919.js";import{N as ot,t as U,p as re,a as N,j as z,k as de,T as st,b as Q,c as V,i as te,C as pe,U as L,V as j,Q as it}from"./NavigationBar.f017aa5b.js";import{a as lt}from"./QCalendar.6d965adf.js";/* empty css                             */import{u as nt}from"./goalStorage.24481bc4.js";import{u as at}from"./use-quasar.b68b184f.js";const rt=()=>!!/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);function X(t,o=new WeakMap){if(Object(t)!==t)return t;if(o.has(t))return o.get(t);const s=t instanceof Date?new Date(t):t instanceof RegExp?new RegExp(t.source,t.flags):t instanceof Set?new Set:t instanceof Map?new Map:typeof t.constructor!="function"?Object.create(null):t.prototype!==void 0&&typeof t.prototype.constructor=="function"?t:new t.constructor;if(typeof t.constructor=="function"&&typeof t.valueOf=="function"){const l=t.valueOf();if(Object(l)!==l){const i=new t.constructor(l);return o.set(t,i),i}}return o.set(t,s),t instanceof Set?t.forEach(l=>{s.add(X(l,o))}):t instanceof Map&&t.forEach((l,i)=>{s.set(i,X(l,o))}),Object.assign(s,...Object.keys(t).map(l=>({[l]:X(t[l],o)})))}var dt=ie({name:"QPopupEdit",props:{modelValue:{required:!0},title:String,buttons:Boolean,labelSet:String,labelCancel:String,color:{type:String,default:"primary"},validate:{type:Function,default:()=>!0},autoSave:Boolean,cover:{type:Boolean,default:!0},disable:Boolean},emits:["update:modelValue","save","cancel","beforeShow","show","beforeHide","hide"],setup(t,{slots:o,emit:s}){const{proxy:l}=Ee(),{$q:i}=l,a=C(null),n=C(""),r=C("");let h=!1;const d=Y(()=>ke({initialValue:n.value,validate:t.validate,set:f,cancel:g,updatePosition:D},"value",()=>r.value,c=>{r.value=c}));function f(){t.validate(r.value)!==!1&&(E()===!0&&(s("save",r.value,n.value),s("update:modelValue",r.value)),w())}function g(){E()===!0&&s("cancel",r.value,n.value),w()}function D(){Ae(()=>{a.value.updatePosition()})}function E(){return Be(r.value,n.value)===!1}function w(){h=!0,a.value.hide()}function b(){h=!1,n.value=X(t.modelValue),r.value=X(t.modelValue),s("beforeShow")}function u(){s("show")}function m(){h===!1&&E()===!0&&(t.autoSave===!0&&t.validate(r.value)===!0?(s("save",r.value,n.value),s("update:modelValue",r.value)):s("cancel",r.value,n.value)),s("beforeHide")}function v(){s("hide")}function $(){const c=o.default!==void 0?[].concat(o.default(d.value)):[];return t.title&&c.unshift(M("div",{class:"q-dialog__title q-mt-sm q-mb-sm"},t.title)),t.buttons===!0&&c.push(M("div",{class:"q-popup-edit__buttons row justify-center no-wrap"},[M(B,{flat:!0,color:t.color,label:t.labelCancel||i.lang.label.cancel,onClick:g}),M(B,{flat:!0,color:t.color,label:t.labelSet||i.lang.label.set,onClick:f})])),c}return Object.assign(l,{set:f,cancel:g,show(c){a.value!==null&&a.value.show(c)},hide(c){a.value!==null&&a.value.hide(c)},updatePosition:D}),()=>{if(t.disable!==!0)return M($e,{ref:a,class:"q-popup-edit",cover:t.cover,onBeforeShow:b,onShow:u,onBeforeHide:m,onHide:v,onEscapeKey:g},$)}}});const ht=Z({name:"GoalyEnd",props:{disabledScore:Boolean,title:String,id:Number,startTime:String,details:String,score:String,happeningNow:Boolean},data(){const t=C(""),o=C(!1);return{errorMessageScore:t,errorScore:o}},emits:["saveScore","endNow","deleteNow"],computed:{aScore:{get(){return this.score},set(t){console.log("aScore getting set",t,this.id),this.aScorey(t)&&this.$emit("saveScore",t,this.id)},cancel(){console.log("aScore remove?",this.id)}},userIconStyle(){return{color:this.disabledScore===!0?"red":"blue",cursor:"pointer"}},endNowBtnStyle(){return{display:this.disabledScore===!0&&this.happeningNow===!0?"block":"none","text-align":"right","margin-left":"32em",height:"auto"}}},watch:{title(t){console.log("titleValue:",t)}},methods:{onDelete(){this.$emit("deleteNow",this.id)},wannaEnd(){console.log("eeeuh wish to end for",this.id,this.disabledScore,this.happeningNow),this.$emit("endNow",this.id)},aScorey(t){return t.length<4||!t.includes("on")?(this.errorScore=!0,this.errorMessageScore=`Error: ${t} Unsaved.Must format as: #on#`,!1):(this.errorScore=!1,this.errorMessageScore="",!0)}}}),ct={class:"title q-calendar__ellipsis"};function ut(t,o,s,l,i,a){return O(),k("div",ct,[x(G(`${t.title} (${t.score})`)+" ",1),S(ue,null,{default:T(()=>[x(G(t.details),1)]),_:1}),S(B,{"no-caps":"",class:"button",label:"End-Now",style:K(t.endNowBtnStyle),onClick:t.wannaEnd},null,8,["style","onClick"]),S(dt,{modelValue:t.aScore,"onUpdate:modelValue":o[0]||(o[0]=n=>t.aScore=n),disable:t.disabledScore,"auto-save":""},{default:T(n=>[S(ye,{modelValue:n.value,"onUpdate:modelValue":r=>n.value=r,dense:"",hint:"format: #on#",error:t.errorScore,"error-message":t.errorMessageScore},{after:T(()=>[S(B,{flat:"",dense:"",color:"positive",icon:"check_circle",onClick:oe(n.set,["stop","prevent"])},null,8,["onClick"]),S(le,{vertical:!0}),S(B,{label:"Del",flat:"",dense:"",color:"negative",icon:"delete_forever",onClick:t.onDelete},null,8,["onClick"])]),_:2},1032,["modelValue","onUpdate:modelValue","error","error-message"])]),_:1},8,["modelValue","disable"])])}var ft=W(ht,[["render",ut],["__scopeId","data-v-cd100f9a"]]);const mt=Z({name:"schedBtn",props:{textLabel:String},emits:["doBtnAction"],methods:{onClicked(){this.$emit("doBtnAction")}}});function gt(t,o,s,l,i,a){return O(),I(B,{color:"",elevated:"",onClick:t.onClicked,"no-caps":""},{default:T(()=>[P("div",null,G(t.textLabel),1)]),_:1},8,["onClick"])}var pt=W(mt,[["render",gt],["__scopeId","data-v-f8dc388e"]]),vt=ie({name:"QBtnGroup",props:{unelevated:Boolean,outline:Boolean,flat:Boolean,rounded:Boolean,square:Boolean,push:Boolean,stretch:Boolean,glossy:Boolean,spread:Boolean},setup(t,{slots:o}){const s=Y(()=>{const l=["unelevated","outline","flat","rounded","square","push","stretch","glossy"].filter(i=>t[i]===!0).map(i=>`q-btn-group--${i}`).join(" ");return`q-btn-group row no-wrap${l.length>0?" "+l:""}`+(t.spread===!0?" q-btn-group--spread":" inline")});return()=>M("div",{class:s.value},be(o.default))}});const St=Object.keys(we),Et=t=>St.reduce((o,s)=>{const l=t[s];return l!==void 0&&(o[s]=l),o},{});var yt=ie({name:"QBtnDropdown",props:{...we,...Me,modelValue:Boolean,split:Boolean,dropdownIcon:String,contentClass:[Array,String,Object],contentStyle:[Array,String,Object],cover:Boolean,persistent:Boolean,noRouteDismiss:Boolean,autoClose:Boolean,menuAnchor:{type:String,default:"bottom end"},menuSelf:{type:String,default:"top end"},menuOffset:Array,disableMainBtn:Boolean,disableDropdown:Boolean,noIconAnimation:Boolean,toggleAriaLabel:String},emits:["update:modelValue","click","beforeShow","show","beforeHide","hide"],setup(t,{slots:o,emit:s}){const{proxy:l}=Ee(),i=C(t.modelValue),a=C(null),n=_e(),r=Y(()=>{const c={"aria-expanded":i.value===!0?"true":"false","aria-haspopup":"true","aria-controls":n,"aria-label":t.toggleAriaLabel||l.$q.lang.label[i.value===!0?"collapse":"expand"](t.label)};return(t.disable===!0||t.split===!1&&t.disableMainBtn===!0||t.disableDropdown===!0)&&(c["aria-disabled"]="true"),c}),h=Y(()=>"q-btn-dropdown__arrow"+(i.value===!0&&t.noIconAnimation===!1?" rotate-180":"")+(t.split===!1?" q-btn-dropdown__arrow-container":"")),d=Y(()=>Ge(t)),f=Y(()=>Et(t));fe(()=>t.modelValue,c=>{a.value!==null&&a.value[c?"show":"hide"]()}),fe(()=>t.split,$);function g(c){i.value=!0,s("beforeShow",c)}function D(c){s("show",c),s("update:modelValue",!0)}function E(c){i.value=!1,s("beforeHide",c)}function w(c){s("hide",c),s("update:modelValue",!1)}function b(c){s("click",c)}function u(c){Ve(c),$(),s("click",c)}function m(c){a.value!==null&&a.value.toggle(c)}function v(c){a.value!==null&&a.value.show(c)}function $(c){a.value!==null&&a.value.hide(c)}return Object.assign(l,{show:v,hide:$,toggle:m}),Ie(()=>{t.modelValue===!0&&v()}),()=>{const c=[M(Ce,{class:h.value,name:t.dropdownIcon||l.$q.iconSet.arrow.dropdown})];return t.disableDropdown!==!0&&c.push(M($e,{ref:a,id:n,class:t.contentClass,style:t.contentStyle,cover:t.cover,fit:!0,persistent:t.persistent,noRouteDismiss:t.noRouteDismiss,autoClose:t.autoClose,anchor:t.menuAnchor,self:t.menuSelf,offset:t.menuOffset,separateClosePopup:!0,transitionShow:t.transitionShow,transitionHide:t.transitionHide,transitionDuration:t.transitionDuration,onBeforeShow:g,onShow:D,onBeforeHide:E,onHide:w},o.default)),t.split===!1?M(B,{class:"q-btn-dropdown q-btn-dropdown--simple",...f.value,...r.value,disable:t.disable===!0||t.disableMainBtn===!0,noWrap:!0,round:!1,onClick:b},{default:()=>be(o.label,[]).concat(c),loading:o.loading}):M(vt,{class:"q-btn-dropdown q-btn-dropdown--split no-wrap q-btn-item",rounded:t.rounded,square:t.square,...d.value,glossy:t.glossy,stretch:t.stretch},()=>[M(B,{class:"q-btn-dropdown--current",...f.value,disable:t.disable===!0||t.disableMainBtn===!0,noWrap:!0,round:!1,onClick:u},{default:o.label,loading:o.loading}),M(B,{class:"q-btn-dropdown__arrow-container q-anchor--skip",...r.value,...d.value,disable:t.disable===!0||t.disableDropdown===!0,rounded:t.rounded,color:t.color,textColor:t.textColor,dense:t.dense,size:t.size,padding:t.padding,ripple:t.ripple},()=>c)])}}});function ve(t){if(t===!1)return 0;if(t===!0||t===void 0)return 1;const o=parseInt(t,10);return isNaN(o)?0:o}var bt=Le({name:"close-popup",beforeMount(t,{value:o}){const s={depth:ve(o),handler(l){s.depth!==0&&setTimeout(()=>{const i=Fe(t);i!==void 0&&qe(i,l,s.depth)})},handlerKey(l){Je(l,13)===!0&&s.handler(l)}};t.__qclosepopup=s,t.addEventListener("click",s.handler),t.addEventListener("keyup",s.handlerKey)},updated(t,{value:o,oldValue:s}){o!==s&&(t.__qclosepopup.depth=ve(o))},beforeUnmount(t){const o=t.__qclosepopup;t.removeEventListener("click",o.handler),t.removeEventListener("keyup",o.handlerKey),delete t.__qclosepopup}});const wt=Z({name:"schedDropBtn",props:{optionLabel:String,disableBtn:Boolean,daOptions:Array},emits:["doReload","chooseOption"],methods:{onClicked(){this.$emit("doReload")},onSelect(t){this.$emit("chooseOption",t)}}});function Ct(t,o,s,l,i,a){return O(),I(yt,{split:"",color:"",elevated:"","disable-main-btn":t.disableBtn,label:t.optionLabel,onClick:t.onClicked,"no-caps":""},{default:T(()=>[S(Qe,null,{default:T(()=>[(O(!0),k(J,null,he(t.daOptions,n=>xe((O(),I(We,{key:n,clickable:"",onClick:r=>t.onSelect(n)},{default:T(()=>[S(ze,null,{default:T(()=>[S(je,null,{default:T(()=>[x(G(n),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"])),[[bt]])),128))]),_:1})]),_:1},8,["disable-main-btn","label","onClick"])}var Dt=W(wt,[["render",Ct],["__scopeId","data-v-86c49dde"]]);const $t=M("div",{class:"q-space"});var Te=ie({name:"QSpace",setup(){return()=>$t}});const Ot={name:"adHocEvent",props:{mainGoals:Array},data(){return{aTitle:"",daP:null,own:"misc",duration:15}},emits:["saveEvent","doCancel"],computed:{pGoals:{get(){return this.mainGoals}},evName:{get(){return this.aTitle},set(t){this.aTitle=t}},labely:{get(){return this.own=="misc"?this.daP==null?"Defaut Misc. PGoal":"Of Parent Goal":"Select Parent Goal"}}},methods:{goalyColor(t){return this.daP==null?"":t=="c"?"bg-"+this.daP.bgcolor:this.daP.bgcolor},onClicked(){this.$emit("saveEvent",this.aTitle,this.daP,this.own,this.duration),this.own="own",this.daP=null,this.duration=15}}},Tt=t=>(ne("data-v-d5b4b8b4"),t=t(),ae(),t),Rt=Tt(()=>P("div",{class:"text-h3"},"Ad hoc Event",-1)),Pt={class:"q-ml-md"},Nt={class:"radio-select"},kt={key:0},At={class:"q-mx-md",style:{"text-align":"center"}};function Bt(t,o,s,l,i,a){return O(),k(J,null,[Rt,S(Te),S(le),P("div",Pt,[S(ye,{modelValue:a.evName,"onUpdate:modelValue":o[0]||(o[0]=n=>a.evName=n),filled:"",label:"A Goal","lazy-rules":"","item-aligned":"",rules:[n=>n&&n.length>0||"Please type a goal"]},null,8,["modelValue","rules"]),P("div",Nt,[S(me,{class:"q-mx-md",modelValue:i.own,"onUpdate:modelValue":o[1]||(o[1]=n=>i.own=n),val:"misc",label:"Misc"},null,8,["modelValue"]),S(me,{class:"q-mx-md",modelValue:i.own,"onUpdate:modelValue":o[2]||(o[2]=n=>i.own=n),val:"self",label:"By Self"},null,8,["modelValue"])]),a.pGoals?(O(),k("div",kt,[S(Oe,{class:"q-gutter-md",modelValue:i.daP,"onUpdate:modelValue":o[3]||(o[3]=n=>i.daP=n),options:a.pGoals,"option-value":"id","option-label":"title",disable:i.own!="misc",label:a.labely,popupContentClass:"q-px-md","options-selected-class":a.goalyColor("c"),"label-color":a.goalyColor("l")},null,8,["modelValue","options","disable","label","options-selected-class","label-color"])])):_("",!0),P("div",null,[x(" duration "),S(Ke,{min:15,max:120,thickness:.22,step:5,modelValue:i.duration,"onUpdate:modelValue":o[4]||(o[4]=n=>i.duration=n),"show-value":"",label:"Duration",size:"75px",color:"teal","track-color":"grey-3",class:"q-ma-md"},null,8,["thickness","modelValue"])])]),P("div",At,[S(B,{flat:"",align:"center",label:"Cancel",color:"primary",onClick:o[5]||(o[5]=n=>t.$emit("doCancel"))}),S(B,{elevated:"",color:"primary",onClick:a.onClicked},{default:T(()=>[x(" Add ")]),_:1},8,["onClick"])])],64)}var Mt=W(Ot,[["render",Bt],["__scopeId","data-v-d5b4b8b4"]]);const _t={name:"selectEvent",props:{canBeScheduled:Array},data(){return{doForce:!1,toAddE:null}},emits:["onPickEvent","doCancel"],computed:{allScheduled:{get(){return this.canBeScheduled}},toAdd:{get(){return this.toAddE},set(t){this.toAddE=t}}},methods:{onAddClicked(){this.$emit("onPickEvent",this.toAdd,this.doForce),this.doForce=!1,this.toAdd=null},goalyColor(t){var o,s;return this.toAdd==null?"":t=="c"?"bg-"+((o=this.toAdd)==null?void 0:o.color):(s=this.toAdd)==null?void 0:s.color},labely(){var t;return this.toAdd==null?"Sub Goal":"Of: "+((t=this.toAdd)==null?void 0:t.pg)}}},Re=t=>(ne("data-v-463b8fae"),t=t(),ae(),t),Gt={class:"q-pa-md row items-start"},It=Re(()=>P("div",{class:"text-h3"},"Select event",-1)),Vt={class:"q-mx-md event-select"},Lt=Re(()=>P("div",{class:"q-mx-md",style:{"text-align":"center"}}," Add ",-1));function Ft(t,o,s,l,i,a){return O(),k("div",Gt,[S(se,null,{default:T(()=>[S(De,null,{default:T(()=>[It]),_:1}),S(le),P("div",Vt,[S(Oe,{modelValue:a.toAdd,"onUpdate:modelValue":o[0]||(o[0]=n=>a.toAdd=n),options:a.allScheduled,class:"q-gutter-md","option-value":"id","option-label":"title","item-aligned":"",popupContentClass:"q-px-md",label:a.labely(),"options-selected-class":a.goalyColor("c"),"label-color":a.goalyColor("l")},null,8,["modelValue","options","label","options-selected-class","label-color"])]),S(ce,{align:"center"},{default:T(()=>[S(He,{dense:"",modelValue:i.doForce,"onUpdate:modelValue":o[1]||(o[1]=n=>i.doForce=n),label:"Force",color:"teal",class:"q-pa-sm"},null,8,["modelValue"])]),_:1}),S(ce,{align:"center"},{default:T(()=>[S(B,{flat:"",label:"Cancel",color:"primary",onClick:o[2]||(o[2]=n=>t.$emit("doCancel"))}),S(B,{elevated:"",color:"primary",onClick:a.onAddClicked},{default:T(()=>[Lt]),_:1},8,["onClick"])]),_:1})]),_:1})])}var qt=W(_t,[["render",Ft],["__scopeId","data-v-463b8fae"]]);const Jt=Z({name:"schedDialog",components:{adHocEvent:Mt,selectEvent:qt},props:{parentGoals:Array,canBeScheduled:Array},data(){return{showPickDialog:C(!1),showAdHocDialog:C(!1),show:C(!0)}},emits:["onAddNewEvent","onPickEvent","euhHidin"],computed:{showDefaultOption:{get(){return this.show},set(t){this.show=t}},showPickyDialog:{get(){return this.showPickDialog},set(t){this.showPickDialog=t}},showAddyDialog:{get(){return this.showAdHocDialog},set(t){this.showAdHocDialog=t}},allScheduled:{get(){return this.canBeScheduled.forEach(t=>{let o=this.parentGoals.find(s=>s.id==t.parentGoal);o?t.color=o.bgcolor:t.color="",t.pg=o==null?void 0:o.title.trim()}),this.canBeScheduled}}},methods:{onAddClicked(t,o){this.$emit("onPickEvent",t,o),this.reset()},addNewEvent(t,o,s,l){this.$emit("onAddNewEvent",t,o,s,l),this.reset()},onChooseExisting(){this.showPickyDialog=!this.showPickyDialog},onChooseAdHoc(){this.showAddyDialog=!this.showAddyDialog},gonHide(){this.$emit("euhHidin")},onCancelBtn(){let t=this.showPickyDialog;this.showAddyDialog,t?this.showPickyDialog=!this.showPickyDialog:this.showAddyDialog=!this.showAddyDialog},reset(){this.showAddyDialog=!1,this.showPickyDialog=!1}}}),xt=t=>(ne("data-v-1ea3ab32"),t=t(),ae(),t),Ht={class:"q-ma-md event-select"},Ut={class:"q-ma-md event-select"},Qt=xt(()=>P("div",{class:"text-h6"},"Ad hoc or Existing event",-1));function Wt(t,o,s,l,i,a){const n=F("select-event"),r=F("ad-hoc-event");return O(),I(Ue,{modelValue:t.showDefaultOption,"onUpdate:modelValue":o[0]||(o[0]=h=>t.showDefaultOption=h),"transition-show":"rotate","transition-hide":"rotate","no-esc-dismiss":"",onBeforeHide:t.gonHide},{default:T(()=>[t.showPickyDialog?(O(),I(se,{key:0},{default:T(()=>[P("div",Ht,[S(n,{canBeScheduled:t.allScheduled,onOnPickEvent:t.onAddClicked,onDoCancel:t.onCancelBtn},null,8,["canBeScheduled","onOnPickEvent","onDoCancel"])])]),_:1})):t.showAddyDialog?(O(),I(se,{key:1},{default:T(()=>[P("div",Ut,[S(r,{mainGoals:t.parentGoals,onSaveEvent:t.addNewEvent,onDoCancel:t.onCancelBtn},null,8,["mainGoals","onSaveEvent","onDoCancel"]),S(Te)])]),_:1})):(O(),I(se,{key:2},{default:T(()=>[S(De,null,{default:T(()=>[Qt]),_:1}),S(ce,{align:"center"},{default:T(()=>[S(B,{flat:"",label:"Add hoc",color:"primary",onClick:t.onChooseAdHoc},null,8,["onClick"]),S(B,{flat:"",label:"Existing",color:"primary",onClick:t.onChooseExisting},null,8,["onClick"])]),_:1})]),_:1}))]),_:1},8,["modelValue","onBeforeHide"])}var zt=W(Jt,[["render",Wt],["__scopeId","data-v-1ea3ab32"]]);function Se(t){return t.button===0}const jt=Z({name:"dayCalendar",components:{NavigationBar:ot,QCalendarDay:lt,addGoalForm:Ye,GoalyEnd:ft,schedBtn:pt,schedDropBtn:Dt,schedDialog:zt},data(){return C(null),C(null),C(null),C(null),C(null),at(),{currentDate:C(U()),scoreOptions:C([1,2,3,4,5]),chosenScore:C(null),chosenPrio:C(null),scheduledEvents:[],dailyScheduled:C(new Map),endTimesSet:C(new Set),startTimesSet:C(new Set),disablePrioBtn:C(!0),disableScoreBtn:C(!0),calendar:C(null),store:nt(),anchorTimestamp:C(null),otherTimestamp:C(null),mouseDown:C(!1),mobile:C(!0),timeStartPos:C(0),showGoalForm:C(!1),addEventDialog:C(!1),disabledScoreEvts:C({}),hasStarted:C({}),disableSaveSchedule:C(!0),showReloadBtn:C(!1),showLoadDefaults:C(!0),showScoreBtn:C(!1),showPrio:C(!1),showClearBtn:C(!1),treeGoals:C([]),expanded:C([]),parentGs:C(null)}},beforeMount(){this.mobile=rt(),this.resetGoalEvts(!0),this.constructTree()},beforeUnmount(){clearInterval(this.intervalId)},mounted(){this.adjustCurrentTime(),this.intervalId=setInterval(()=>{this.adjustCurrentTime()},6e4)},computed:{chosenScoreLabel(){return this.chosenScore==null?"By Score":`Score >= ${this.chosenScore}`},chosenPrioLabel(){return this.chosenPrio==null?"By Priority":`Prio = ${this.chosenPrio}`},style(){return{top:this.timeStartPos+"px"}},showForm(){return this.showGoalForm||(this.constructTree(),console.log("newTree..")),this.showGoalForm},doDisableSaveSchedule(){return this.disableSaveSchedule},hasEventsForDate(){return this.store.hasEventsForDate(this.currentDate)},eventsMap(){const t={};return this.scheduledEvents.forEach(o=>{if(t[o.date]||(t[o.date]=[]),t[o.date].push(o),o.days){console.log(`eventsMap multiple days? event for ${o.date}`,o.days);let s=re(o.date),l=o.days;do s=N(s,{day:1}),t[s.date]||(t[s.date]=[]),t[s.date].push(o);while(--l>0)}}),t},canbeScheduled(){let t=this.deepCopy(this.storedEvents),o=t.filter(l=>!this.scheduledEvents.find(i=>i.id==l.id)),s=(l,i)=>{if(l.parentGoal>i.parentGoal)return 1;if(l.parentGoal==i.parentGoal)return 0;if(l.parentGoal<i.parentGoal)return-1};return o.length==0?(t.sort(s),t):(o.sort(s),o)},storedEvents(){return this.store.getSubGoals},storedAlternatives(){return this.store.fetchAlternativeEvts()},startEndTimes(){const t=[];return this.anchorDayTimeIdentifier!==!1&&this.otherDayTimeIdentifier!==!1&&(this.anchorDayTimeIdentifier<=this.otherDayTimeIdentifier?t.push(z(this.anchorTimestamp),z(this.otherTimestamp)):t.push(z(this.otherTimestamp),z(this.anchorTimestamp))),t},anchorDayTimeIdentifier(){return this.anchorTimestamp!==null?de(this.anchorTimestamp):!1},otherDayTimeIdentifier(){return this.otherTimestamp!==null?de(this.otherTimestamp):!1},storedCompPG(){return this.storedPG()}},methods:{parentGoalsMap(){const t=new Map;let o=this.storedPG();return o?(o.forEach(s=>{t.set(s.id,s)}),t):(console.log("parentGoalsMap is empty or null",o),t)},storedPG(){return this.parentGs==this.store.getMainGoals?(console.log("storedPG SAME!!!!"),this.parentGs):(this.parentGs=this.store.getMainGoals,this.parentGs)},constructTree(){this.treeGoals=this.store.fetchGoalsTree()},badgeClasses(t,o){return Ze(t,o)},badgeStyles(t,o,s=void 0,l=void 0){return et(t,o,s,l)},classyColor(t){return`row items-center ${t.isChildren?"text-":"text-white bg-"}${t.color} `},getTimeNumber(t){return t!==null?de(t):!1},getTimeyNumber(t){return t!==null?st(t):!1},labelGoals(){let t=0;for(const o in this.treeGoals)t+=this.treeGoals[o].children.length;return`In Schedule: ${this.scheduledEvents.length} out of ${t}`},getDateEvents(t){const o=this.eventsMap[t]||[];if(o.length===1)o[0].side="full";else if(o.length===2){const s=N(V(o[0].date),{minute:Q(o[0].time)}),l=N(s,{minute:o[0].duration}),i=N(V(o[1].date),{minute:Q(o[1].time)}),a=N(i,{minute:o[1].duration});te(i,s,l,!0)||te(a,s,l,!0)?(console.log("getDateEvents...LENGTH==2..LEFT/RIGHT 'TWIX",s,l,i,a),o[0].side="left",o[1].side="right"):(o[0].side="full",o[1].side="full")}return o},hasDate(t){return this.currentDate?t.find(o=>o.date===this.currentDate):!1},getEventsForDate(t){return this.store.getEventsForDate(t)},isViewingToday(){return U()==this.currentDate},isViewingPast(){let t=U();if(this.currentDate&&this.currentDate==t)return!1;let o=pe(V(t));return!(pe(V(this.currentDate))>=o)},adjustCurrentTime(){const t=L(new Date);if(this.currentDate!==t.date){this.timeStartPos=-10,this.currentTime="";return}this.currentDate=t.date,this.currentTime=t.time,this.timeStartPos=this.$refs.calendar.timeStartPos(t.time,!1);let o=this.endTimesSet&&this.endTimesSet.has(t.time),s=this.startTimesSet&&this.startTimesSet.has(t.time);(o||s)&&this.doEnableEndNowBtn(this.currentTime,o,s)},setGoalsPrio(){let t=this.store.fetchAllPrio();return!t.size>0?(console.log("ERROR...no Priority goals?",t),[]):Array.from(t.values())},resetGoalEvts(t=!1){if(this.scheduledEvents==this.allEvents&&console.log("resetGoalEvts SAME"),t){let o=this.deepCopy(this.storedEvents);return this.allEvents=[...o],o}return this.allEvents},getLocalEvt(t){for(let o=0;o<this.allEvents.length;o++)if(this.allEvents[o].id===t)return this.allEvents[o];return null},getScheduledEvent(t){for(let o=0;o<this.scheduledEvents.length;o++)if(this.scheduledEvents[o].id==t)return this.scheduledEvents[o];return null},doSaveEvtProp(t,o=null,s=null){this.store.saveSubProp(t,o,s)},evtStartedOrPassed(t){const o=[];let s=N(t,{minute:0}),l=this.getTimeNumber(s);return this.dailyScheduled.forEach((i,a,n)=>{let r=this.getTimeNumber(i.start),h=this.getTimeNumber(i.end);if(r!==!1&&h!==!1){let d=l>=r&&l<h,f=l>=h;(d||f)&&o.push(a),d&&(this.hasStarted[a]=!0),this.enableEvtScoreEdit(a,f)}else console.log(`ERROR?!:${a} has no start/end?.`,i)}),o},allowScoreEdit(t){this.dailyScheduled.forEach((o,s,l)=>{this.disabledScoreEvts[s]=!t})},enableEvtScoreEdit(t,o){this.disabledScoreEvts[t]=!o},canEnableEditScore(t,o){const s=L(new Date);j(s,o)>0?this.disabledScoreEvts[t]=!0:(this.disabledScoreEvts[t]=!1,this.hasStarted[t]=!1)},parseScore(t){const o=t.split(/on/);return o.length!=2?(console.log(`parseScore error?${t}`,o),-1):o[1]-o[0]},doEnableEndNowBtn(t,o,s){for(let[l,i]of this.dailyScheduled)(o?i.end.time:i.start.time)==t&&(this.hasStarted[l]=!o,this.disabledScoreEvts[l]=!o)},enableEndNowBtn(t,o,s){const l=L(new Date);te(l,o,s,!0)?this.hasStarted[t]=!0:this.hasStarted[t]=!1},retrieveSameStart(t){let o=[];for(let[s,l]of this.dailyScheduled)l.start.time==t&&o.push(s);return o},confirmTimeChange(t,o,s,l,i,a,n=null){this.$q.dialog({title:t,message:o,cancel:!1,ok:s,options:{type:"radio",model:"",items:[{label:s+" and "+l,value:"ok"},{label:l,value:"alt"}]},class:"overflow:visible",style:""}).onOk(r=>{if(r==""){console.log("confirmTimeChange onOk with no selection >>onDismiss"),this.doNotify("No selection made...Defaulting","positive","bottom"),n?n():console.log("confirmTimeChange:: No Dismiss func to execute!");return}return i(r)}).onCancel(()=>{console.log("confirmTimeChange>> executeCancel..."),a()})},confirmAction(t,o,s,l,i=null){this.$q.dialog({title:"Warning",cancel:!0,ok:o,message:t}).onOk(()=>{s()}).onCancel(()=>{l()}).onDismiss(()=>{if(i){console.log("confirmAction with dismiss!!"),i();return}})},radioChoiceDialog(t,o,s,l,i=null,a=null,n=null){this.$q.dialog({title:t,cancel:!!a,persistent:!0,message:o,options:{type:"radio",model:l,items:s}}).onOk(r=>{i&&(r==""?this.radioChoiceDialog(t,o,s,l,i,a,n):i(r))}).onCancel(()=>{a&&a()}).onDismiss(()=>{n&&n()})},checkBoxDialog(t,o,s,l,i=null,a=null,n=null){let r=s.length;this.$q.dialog({title:t,message:o,options:{type:"checkbox",model:[],isValid:h=>h.length>0&&h.length<=r,items:s},cancel:!0,persistent:!0}).onOk(h=>{i(h)}).onCancel(()=>{a&&a()}).onDismiss(()=>{n&&n()})},doNotify(t,o=void 0,s="top"){this.$q.notify({color:o!==void 0?o:"negative",position:s,message:t,icon:o==null?"report_problem":"thumb_up"})},updateButtons(t=null,o=null,s=null){this.showLoadDefaults=t!=null?t:this.showLoadDefaults,this.showScoreBtn=o!=null?o:this.showScoreBtn,this.showPrio=s!=null?s:this.showPrio},resetButtons(t,o){this.updateButtons(!t,!o,!o)},doRemove(t){let o=this.scheduledEvents.length,s=0;for(s;s<o;s++)if(this.scheduledEvents[s].id==t.id){this.scheduledEvents.splice(s,1);let l=null;if(this.dailyScheduled.has(t.id)?(l=this.dailyScheduled.get(t.id),this.dailyScheduled.delete(t.id)):console.log("doRemove ::> dailyScheduled has no such item?@? ERROR",t),l){let i=this.startTimesSet.delete(l.start.time),a=this.endTimesSet.delete(l.end.time);(!i||!a)&&console.log(`doRemove ::> ERROR? scheduleSets has no such item?@? start:${i}...end:${a}`,l,t.id+" "+(t==null?void 0:t.title.trim())+" "+(t==null?void 0:t.details))}break}},chooseAlternatives(t){let o=this.storedAlternatives,s=L(new Date),l=t.time,i=s.date;const a=d=>({label:d.title.trim()+" for "+d.duration+"min. at "+d.time+"("+d.score+")",value:d.id}),n=d=>d.filter(f=>!this.scheduledEvents.find(g=>g.id==f.id)),r=d=>{let f=N(V(i),{day:0}),g=N(V(f.date),{day:1}),D=this.getEventsForDate(f.date),E={};D?E=D:console.log("addInFutur EMPTY for >>...",f.date),d.forEach(w=>{let b=this.getLocalEvt(w);if(E[w]){console.log("addInFutur...ALREADY PRESENT",w,JSON.parse(JSON.stringify(b))),this.doNotify(`Alternative '${b==null?void 0:b.title.trim()}'already present on ${f.date}. Moving it to next day`,"warning");let u=this.getEventsForDate(g.date);u?u[w]?(console.log("addInFutur...ALREADY PRESENT",b,JSON.parse(JSON.stringify(u))),this.doNotify(`Alternative '${b==null?void 0:b.title.trim()}'also present on ${g.date}....smh`)):u[w]={duration:b.duration,time:l}:(console.log("addInFutur next day EMPTY for >>...",g.date),u={},u[w]={duration:b.duration,time:l}),this.store.saveDailySchedule(g.date,u)}else E[w]={duration:b.duration,time:l}}),this.store.saveDailySchedule(f.date,E)},h=d=>{this.doRemove(t);let f=o.find(D=>D.id==d);console.log("remReplace...Add at:",l,JSON.parse(JSON.stringify(f))),f=this.addPropsEventsTo(this.currentDate,[{...f,time:l}]),this.addEvtPropsIntoSchedule(f[0]);let g=this.updateCurrentSchedule();console.log("chooseAlternatives::remReplace:END",g),this.doSaveSchedule()};if(o=n(o),o.length==0){this.doNotify("Removing not allowed! Alternatives already present!");return}this.checkBoxDialog("Gotta pick alternatives","Select the first Evt to replace the removed and an Extra evt for later!",o.map(a),o[0].id,function(d){console.log("chooseAlternatives::opt",d),h(d.shift()),d.length>0?r(d):this.doNotify("Removing not allowed! Alternatives already scheduled!")},function(){console.log("chooseAlternatives::onCancel")})},removeEvtInSchedule(t,o=null){if(this.isViewingPast()){if(t.duration<30){console.log("removeEvtInSchedule...baah too smoll smoll",t.title,t.duration),this.doNotify("Removing from the past is a no no!");return}this.chooseAlternatives(t);return}let s=()=>{this.doRemove(t),this.disableSaveSchedule=!1,this.showReloadBtn=this.hasEventsForDate};if(!this.isViewingToday()){s(),console.log("Removed future evt");return}let l=`Remove "${t.title}" from schedule?`;this.confirmAction(l,"Remove",s,function(){console.log("Cancelled remove")})},updateCurrentSchedule(){const t=new Map;let o=new Set,s=new Set,l=new Set;return this.scheduledEvents.length<1?(this.dailyScheduled=t,this.endTimesSet=o,this.startTimesSet=l,s):(this.scheduledEvents.forEach(i=>{let a=N(V(i.date),{minute:Q(i.time)}),n=N(a,{minute:i.duration});t.set(i.id,{start:a,end:n,on:i.date,originalAt:i.time,for:i.duration,score:i.score}),o.add(n.time),l.has(a.time)?s.add({at:a.time,id:i.id}):l.add(a.time),(this.currentDate==U()||!this.isViewingPast())&&(this.canEnableEditScore(i.id,n),this.enableEndNowBtn(i.id,a,n))}),this.dailyScheduled=t,this.endTimesSet=o,this.startTimesSet=l,s)},addEvtPropsIntoSchedule(t){let o=this.addEvtInScheduleMaps(t);if(!o){console.log(`addEvtPropsIntoSchedule:${t.title}..ERROR...NOT added?!?`,o);return}this.scheduledEvents.push(t)},addEvtInScheduleMaps(t){if(this.dailyScheduled.has(t.id))return console.log("addEvtInScheduleMaps with evt already added...ERROR?",t),!1;let o=N(V(t.date),{minute:Q(t.time)}),s=N(o,{minute:t.duration});return this.dailyScheduled.set(t.id,{on:t.date,originalAt:t.time,for:t.duration,start:o,end:s,score:t.score}),this.endTimesSet.add(s.time),this.startTimesSet.add(o.time),(this.currentDate==U()||!this.isViewingPast())&&(this.canEnableEditScore(t.id,s),this.enableEndNowBtn(t.id,o,s)),!0},updateEvtInScheduleMaps(t,o){if(this.dailyScheduled.has(t)){let s=this.dailyScheduled.get(t),l=s.for,i=s.originalAt,a=s.start,n=s.end,r=N(o,{minute:l}),h=s.score;return this.dailyScheduled.set(t,{on:o.date,originalAt:i,for:l,start:o,end:r,score:h}),this.endTimesSet.delete(n.time)?this.endTimesSet.add(r.time):console.log("updateEvtInScheduleMaps-endTimesSet NOT FOUND?!?"),this.startTimesSet.delete(a.time)?this.startTimesSet.add(o.time):console.log("updateEvtInScheduleMaps-startTimesSet NOT FOUND?!?",t,o),(this.currentDate==U()||!this.isViewingPast())&&(this.canEnableEditScore(t,r),this.enableEndNowBtn(t,o,r)),!0}else return console.log("updateEvtInScheduleMaps--euh not found?ERROR?",t,o),!1},evtIsOverlappingTimes(t,o,s,l){let i=this.getTimeyNumber(t),a=this.getTimeyNumber(o),n=this.getTimeyNumber(s),r=this.getTimeyNumber(l);if(i===!1||n===!1||a===!1||r===!1)return console.log("ERROR... evtIsOverlappingTimes error",i,a,n,r),!1;let h=!1;return i>n&&i<=r&&(h="bas"),a>n&&a<=r&&(h="haut"),(n>=i&&a>=r||i>n&&a<r)&&(h="surrounding"),h},hasOverlappingEvent(t,o,s){const l=[];let i=o,a=N(i,{minute:s});return this.dailyScheduled.forEach((n,r,h)=>{if(r!=t){let d=this.evtIsOverlappingTimes(i,a,n.start,n.end);d&&l.push({target:t,targetStart:i,direction:d,inConflict:r})}}),l},overlapCheckEvtsAdd(t){let o={};for(let s=0;s<t.length;s++){let l=t[s],i=N(V(l.date),{minute:Q(l.time)}),a=this.hasOverlappingEvent(l.id,i,l.duration);if(a.length>0){let n=0;do{let r=a[n];o[r.inConflict]||(o[r.inConflict]=[]),o[r.inConflict].push(r),n>0&&console.log("WOAH WOAH, multiple overlaps with same obj!",n,l,a[n])}while(++n<a.length)}else this.addEvtPropsIntoSchedule(l)}return o},updatedEvtDetails(t){let o=l=>{if(!l)return"";let i=l.split(":");return parseInt(i[0])>=12?"PM":"AM"},s=this.parentGoalsMap().get(t.parentGoal);return s?(t.bgcolor=s.bgcolor,t.details=`${t==null?void 0:t.time}${o(t==null?void 0:t.time)} -> ${t==null?void 0:t.duration}min -- ${t!=null&&t.inDefaults?"Dft:":":"}${t!=null&&t.canMove?":Mv:":":"}${t!=null&&t.isAlternative?":Alt":":"}`):(console.log("ERROR?!? no parent goal for:",JSON.parse(JSON.stringify(t))),t.bgcolor="grey",t.title=`Ad-hoc:${t==null?void 0:t.title} (${this.parseScore(t==null?void 0:t.score)})`,t.details=`${t==null?void 0:t.title}: ${t==null?void 0:t.time}${o(t==null?void 0:t.time)} -- ${t==null?void 0:t.duration}min`),t},addPropsEventsTo(t,o){if(!o)return this.doNotify("addPropsEventsTo BUT no goals to schedule..."),[];let s=[];return o.forEach(l=>{let i=this.getLocalEvt(l.id);i?(i.duration=l.duration,i.time=l.time,i.date=t,s.push(this.updatedEvtDetails(i))):console.log("ERROR in addPropsEventsTo...Evt:not present!",l)}),s},changeEvtTime(t,o,s,l=!1){let i=this.getScheduledEvent(t),a=null;if(i)a=i.time;else if(console.log(`changeEventTime::ADDIN ${t} as aint in schedule with doAdd:${l}`,o.time),l){if(i=this.getLocalEvt(t),!i)return console.log("ERROR in changeEvtTime STILL NOT found?!?",e,t,o,l),!1;a=i.time}else return console.log("ERROR in changeEvtTime not found, not adding!",t,o,l),!1;let n=(d,f)=>{if(console.log(`changeEventTime::DoUpdateEvt:: ${f?"DOADD":"NOAdd"} (${d.id})'${d.title.trim()}' at->${d.time} from ${a} to ${o.time} `,"canMove:"+(d==null?void 0:d.canMove),"inDef:"+(d==null?void 0:d.inDefaults),"skip?"+s),f){let g=this.addPropsEventsTo(this.currentDate,[{...d,time:o.time}]);this.addEvtPropsIntoSchedule(g[0]);return}this.updateEvtInScheduleMaps(t,o),d.time=o.time,this.updatedEvtDetails(d)},r=(d,f)=>{if(console.log(`changeEventTime::KeepAsIs (${t}..${d.id})'${d.title.trim()}' to ${a} with ${f?"DOADD":"NOAdd"}`,o.time,"canMove:"+(d==null?void 0:d.canMove),"inDef:"+(d==null?void 0:d.inDefaults),"skip?"+s),f){let g=this.addPropsEventsTo(this.currentDate,[{...d,time:a}]);console.log("KeepAsIs::doAddy afterProps",JSON.parse(JSON.stringify(g[0].time))),this.addEvtPropsIntoSchedule(g[0])}else this.updateEvtInScheduleMaps(t,a),d.time=a,this.updatedEvtDetails(d),console.log("changeEventTime::keepAsIs:: !NOT! doAdd afterProps..",t,d.id)},h=(d,f,g)=>(console.log(`changeEvtTime::userChoice ${d} >> ${f.id} to ${o.time}...`),d=="ok"&&this.doSaveEvtProp(t,o.time,null),n(f,g),d);if((i==null?void 0:i.inDefaults)||!(i!=null&&i.canMove))if(s)n(i,l);else{if(a==o.time){console.log(`SAME TIME (${i.id})'${i.title.trim()}'..ASKIN with doAdd? ${l} for updateEvt...`,a,o.time),l&&n(i,l);return}let d=(o==null?void 0:o.hour)>=12?"PM":"AM",f=a.split(":"),g=parseInt(f[0])>=12?"PM":"AM",E=[`Evt '${i.title.trim()}' by default at ${a}${g}.
\u2800
`,`
\u2800
`,`
\u2800
`,`Also Change default time to ${o.time}${d}? 
\u2800
`,`
\u2800
`,`
\u2800
`,`Cancel or Dismiss to undo!
\u2800
`,`
\u2800
`,`
\u2800
`,`No selection to schedule at default's ${a}${g}`].join(`
`);this.confirmTimeChange("Default Time Change!",E,"Change",`Temp.${l?"Add":"Move"}`,function(w){h(w,i,l)},function(){console.log(`changeEventTime::onCancel...>doing nothing for ${i.id})'${i.title.trim()}'`,l)},function(){console.log(`changeEventTime::onDismiss...keeping as is>> ${i.id})'${i.title.trim()}'`,l),r(i,l)})}else if(i!=null&&i.canMove)n(i,l);else{if(a==o.time){console.log(`SAME TIME! BEWARE~~ (${i.id})'${i.title.trim()}'...doAdd?${l}..skipAsk?:${s}..returning!!`,a);return}let d=(o==null?void 0:o.hour)>=12?"PM":"AM",f=a.split(":"),g=parseInt(f[0])>=12?"PM":"AM",E=[`Evt '${i.title.trim()}' Not move from ${a}${g}.
\u2800
`,`
\u2800
`,`
\u2800
`,`Also Move time to ${o.time}${d}? 
\u2800
`,`
\u2800
`,`
\u2800
`,`Cancel or Dismiss to undo!
\u2800
`,`
\u2800
`,`
\u2800
`,`No selection to add at default ${a}${g} `].join(`
`);this.confirmTimeChange("Moving Evt's time",E,"Change",`Temp.${l?"Add":"Move"}`,function(w){h(w,i,l)},function(){console.log(`changeEventTime::onCancel..>doing nothing for ${i.id})'${i.title.trim()}'`,l)},function(){console.log(`changeEventTime::onDismiss..keep as is>> ${i.id})'${i.title.trim()}'`,l),r(i,l)})}},recurChangeTime(t,o,s,l=!1,i=!1){let a=this.dailyScheduled.get(t);if(a){let n=Q(a.start.time)-Q(s.time),r=`${n>0?"DOWN":"UP"}`,h=null;if(n>=0){h=N(s,{minute:parseInt(o.duration)+10});let g=N(s,{minute:parseInt(a.for)+10});console.log(`recurChangeTime::${t}...FORWARD ${r} for ${n} due to evt:${o.id} at ${s.time} 
 doAdd?:${i}, skipAsk:${l} > New>`,JSON.parse(JSON.stringify(h.time)),"alt:",g.time);let D=j(g,h);D>0&&(console.log(`recurChangeTime::DIFFY>>${D}...gonna use Alternative`,g.time),h=g)}else{h=N(s,{minute:-(parseInt(a.for)+10)});let g=N(s,{minute:-(parseInt(o.duration)+10)}),D=j(g,h);console.log(`recurChangeTime::${t}...BACKWARD ${r} for ${n} due to evt:${o.id} at ${s.time}.doAdd?:${i}, skipAsk:${l} > New`,JSON.parse(JSON.stringify(h.time)),"alt:"+g.time,"diffy="+D)}let d=this.hasOverlappingEvent(t,h,a.for);if(d.length>0){console.log(`WARNING WARNING::more Overlaps::recurChangeTime ${t} at ${h.time}`,d.length,d);let g=0,D=d.length,E=this.getScheduledEvent(t);do{if(console.log(`CASCADING timeChange ${t}-${E==null?void 0:E.title} 'gon recurChangeTime::
          OLDie doAdd?:${i}, OLDie skipAsk:${l}..gon be true`,d[g],`
 now at:`+a.start.time+" till "+a.end.time),d[g].inConflict==o.id){console.log(`EUUUH...::recurChangeTime::self overlap?!?${t}`,d[g]);break}this.recurChangeTime(d[g].inConflict,E,h,!0)}while(++g<D)}console.log(`recurChangeTime::OVERLAPPED: ${t} ${r} to ${h.time} ...skipAsk:${l} >> doAdd:${i}`),this.changeEvtTime(t,h,l);let f=s;console.log(`recurChangeTime::TARGET:(${o.id})${o==null?void 0:o.title.trim()} going ${r} skipAsk:${l} >> doAdd:${i} to time>> ${f.time}`),this.changeEvtTime(o.id,f,l,i)}else console.log("ERROR..ERROR recurChangeTime:: overlapped event not found!",t)},fixyOverlaps(t,o=null,s=""){var v,$;let l=Object.keys(t).length,i=[],a=[];const n=c=>{if(c!=null&&c.parentGoal){let p=this.parentGoalsMap().get(c.parentGoal);return p==null?void 0:p.priority}return console.log("findPrio..ERROR no PARENT found?",c),null},r=c=>c.title.trim()+" Priority = "+n(c)+" && Score:: "+c.score,h=c=>{this.doNotify(c,"positive","bottom")},d=c=>{a.push(c),this.doRemove(c)},f=c=>{i.push(c)},g=(c,p,y)=>{if(f(p),console.log(`removeReplace >> ${c.title.trim()} WITH ${p.title.trim()}`,s,y),p=this.addPropsEventsTo(y.targetStart.date,[{...p,time:y.targetStart.time}]),o){console.log("fixyOverlaps:removeReplace...override>>from:"+s,JSON.parse(JSON.stringify(p))),this.updateEvtInScheduleMaps(p[0].id,y.targetStart),console.log("fixyOverlaps",this.startTimesSet,this.endTimesSet);return}d(c),this.addEvtPropsIntoSchedule(p[0]);let R=this.updateCurrentSchedule();console.log("fixyOverlaps::removeReplace::DONE",R),R.size>0&&this.fixConflicts(R)},D=(c,p,y)=>{var A;let R=y.direction=="haut";f(p),console.log(`At ${(A=y==null?void 0:y.targetStart)==null?void 0:A.time} forceAdd changing evtID:${c.id} from ${c.time} goFwd>>${R}`,p,y,s),this.recurChangeTime(c.id,p,y.targetStart,!0,!0)};let E=(c,p,y,R,A)=>{p==y.id?g(R,y,A):(console.log(`by ${c},chose scheduled ${p}`,o),o&&d(y),f(R))},w=(c,p)=>{h(`Cancelling to keep scheduled '${p.title.trim()}'`),f(p),o&&(console.log("huh OVERRIDE...fixyOverlaps::coolios removing>from:"+s,c.title.trim()),d(c))},b=c=>{console.log(c,JSON.parse(JSON.stringify(a)),JSON.parse(JSON.stringify(i)),l)};const u=(c,p,y,R)=>{if(c=="opt3"){let A="Pick one event...",q=[{label:r(p),value:p.id},{label:r(y),value:y.id}];this.radioChoiceDialog("",A,q,"",function(H){E("Event",H,p,y,R)},function(){w(p,y)},function(){b("fixyOverlaps::opt3>>chooseEvt onDismiss by Event,remvd > Kept")})}else if(c=="opt2"){let A="Pick event by Score",q=[{label:`"${p.title.trim()}" with Score:: ${p.score} = ${this.parseScore(p.score)}`,value:p.id},{label:`"${y.title.trim()}" with Score:: ${y.score} = ${this.parseScore(y.score)}`,value:y.id}];this.radioChoiceDialog("",A,q,"",function(H){E("Score",H,p,y,R)},function(){w(p,y)},function(){b("fixyOverlaps::opt2>>chooseEvt onDismiss by Score,remvd > Kept")})}else if(c=="opt1"){let A="Pick event by Priority",q=[{label:`"${p.title.trim()}" with Priority = ${n(p)}`,value:p.id},{label:`"${y.title.trim()}" with Priority = ${n(y)}`,value:y.id}];this.radioChoiceDialog("",A,q,"",function(H){E("Priority",H,p,y,R)},function(){w(p,y)},function(){b("fixyOverlaps::opt1>>chooseEvt onDismiss by Priority,remvd > Kept")})}else D(y,p,R)};let m=[{label:"Choose one event",value:"opt3"}];s=="reloadScore"?m.unshift({label:"Choose by Priority",value:"opt1",color:"secondary"}):s=="findSamePrio"?m.unshift({label:"Choose by Score",value:"opt2"}):m.unshift({label:"Choose by Priority",value:"opt1",color:"secondary"},{label:"Choose by Score",value:"opt2"});for(let c in t){if(!t[c]||!t[c][0]){console.log("fixyOverlaps...ERROR no local found",c);continue}let p=t[c];if(p.length>1){console.log("fixyOverlaps::WOAH WOAH...multiple overlaps!!"),this.multiConflicts(p,s);continue}const y=p.pop();let R=this.getLocalEvt(y.target),A=this.getScheduledEvent(y.inConflict);if(!A||!R){console.log("fixyOverlaps...ERROR ERROR no evts found!!!",y);return}console.log(`fixyOverlaps::adding ${R.id}:${R.title.trim()}(${R.time})++${R.duration} AT >> ${(v=y==null?void 0:y.targetStart)==null?void 0:v.time} --${y.direction} 
      
 Overlap with ${A.id}:${A.title.trim()}++${A.duration}`,o,"from:"+s);let q=m;y.direction!=="surrounding"&&q.push({label:`Force in '${R.title.trim()}' at ${($=y==null?void 0:y.targetStart)==null?void 0:$.time}?`,value:"opt4"});let H=`'${R.title.trim()}' Overlaps with Scheduled '${A.title.trim()}'.
      
Resolve or Cancel to keep '${A.title.trim()}'`;this.radioChoiceDialog("Overlapping Events",H,q,"opt1",function(Ne){u(Ne,R,A,y)},function(){w(R,A)},function(){console.log("fixyOverlaps::onDismiss,remvd > Kept",JSON.parse(JSON.stringify(a)),JSON.parse(JSON.stringify(i)),l,s),(i.length==l||a.length==l)&&console.log(`fixyOverlaps::DONE?!? k=${i.length},rm=${a.length}`,l)})}},multiConflicts(t,o=""){var w,b,u;let s="",l=[],i=null,a=[],n=null,r=[{label:"Pick one event",value:"opt3"}];const h=m=>({label:m.title.trim()+" with ("+m.score+") for "+(m==null?void 0:m.duration)+"mins",value:m.id}),d=m=>{let v=0,$=null;for(let c of m)if(c.parentGoal){let p=this.parentGoalsMap().get(c.parentGoal);p?p.priority>v&&(v=p.priority,$=c):console.log("findhighestPrio..ERROR no PARENT found?",c)}else console.log("findhighestPrio..ERROR EVT not found?",c);return console.log("multiConflicts::findhighestPrio...",$==null?void 0:$.title.trim(),v),$};let f=m=>{let v=0,$=null;for(let c of m){let p=this.parseScore(c.score);p>-1&&p>=v?(v=p,$=c):console.log("multiConflicts::ERROR...parseScore?",p,c)}if($)return console.log("multiConflicts::Score Chosen..lowest?",$.id,$==null?void 0:$.title.trim(),$.score),$},g=(m,v)=>{console.log(`multiConflicts::removeConflicts with toKeep=${m.length} out of total:${v.length}`),v.forEach((c,p,y)=>{if(m.find(R=>R.id==c.id))if(console.log("multiConflicts::removeConflicts:KEEEP",c.id,c==null?void 0:c.title.trim(),n),c.id!=i.id){let R=this.addPropsEventsTo(this.currentDate,[{...c,time:n}]);this.addEvtPropsIntoSchedule(R[0])}else console.log("multiConflicts::removeConflicts...already scheduled!!",n,c);else c.id==i.id&&(console.log("multiConflicts::removeConflicts...removing scheduled!!",c.id,c.title),this.doRemove(c))});let $=this.updateCurrentSchedule();console.log("multiConflicts::removeConflicts::DONE",$),$.size>0&&this.fixConflicts($)},D=m=>{this.radioChoiceDialog("","Choose the event to schedule",m.map(h),"",function(v){console.log("chooseEvt::chose",v);let $=m.find(c=>c.id==v);if($)a.push($);else{console.log("chooseEvt::ERROR NOT FOUND!!",v);return}return console.log(`chooseEvt::onOk >>${v} >> ${$==null?void 0:$.title.trim()}`),$},null,function(){a.length>0&&(console.log("chooseEvt::LAST LAST?",JSON.parse(JSON.stringify(a))),setTimeout(()=>{g(a,m)},0))})};o=="reloadScore"?r.unshift({label:"Resolve by Highest Priority",value:"opt1",color:"secondary"}):o=="findSamePrio"?r.unshift({label:"Resolve by lowest Score Interval",value:"opt2"}):r.unshift({label:"Resolve by Highest Priority",value:"opt1",color:"secondary"},{label:"Resolve by lowest Score Interval",value:"opt2"});for(let m of t){console.log("multiConflicts....handling:>",JSON.parse(JSON.stringify(m)));let v=this.getScheduledEvent(m.inConflict);if(!v){console.log("multiConflicts...ERROR ERROR no evts found!!!",m);return}if(!i)i=v,n=(w=m==null?void 0:m.targetStart)==null?void 0:w.time;else if(i.id!=v.id){console.log("multiConflicts...ERROR Not same inConflict",v.id);return}let $=this.getLocalEvt(m.target);if(!$){console.log("multiConflicts...ERROR ERROR local evt not found!!!",m);return}s+=` '${$==null?void 0:$.title.trim()}',`,l.push($),((b=m==null?void 0:m.targetStart)==null?void 0:b.time)!=n&&console.log("multiConflicts...oh WELL timey timey",n,(u=m==null?void 0:m.targetStart)==null?void 0:u.time,m.direction)}let E=`${s} conflicts with scheduled '${i==null?void 0:i.title.trim()}'

      Choose how to solve this...`;l.unshift(i),this.radioChoiceDialog("Overlap warning!!",E,r,"",function(m){if(m=="opt3")D(l);else if(m=="opt2"){let v=f(l);console.log("multiConflicts::opt2",v.id,v==null?void 0:v.title.trim(),v.score),a.push(v)}else{let v=d(l);console.log("multiConflicts::opt1",v.id,v==null?void 0:v.title.trim(),v.score),a.push(v)}},null,function(){a.length>0&&(console.log("multiConflicts::MAIN LAST LAST?",JSON.parse(JSON.stringify(a))),setTimeout(()=>{g(a,l)},0))})},fixConflicts(t){console.log("fixConflicts...Start",t,t.size);const o=n=>{let r=0,h=null;for(let d of n){let f=this.getScheduledEvent(d);if(f){let g=this.parentGoalsMap().get(f.parentGoal);g?g.priority>r&&(r=g.priority,h=f):console.log("findhighestPrio..ERROR no PARENT found?",f)}else console.log("findhighestPrio..ERROR EVT not found?",d)}return console.log("fixConflicts::findhighestPrio...",h==null?void 0:h.title.trim(),r),h},s=n=>({label:n.title+" at "+n.score,value:n.id});let l=[],i=new Set,a=[{label:"Resolve by Highest Priority",value:"opt1",color:"secondary"},{label:"Resolve by lowest Score Interval",value:"opt2"},{label:"Pick event",value:"opt3"}];for(let n of t){let r=this.retrieveSameStart(n.at);console.log("fixConflicts:conflict",JSON.parse(JSON.stringify(n)),JSON.parse(JSON.stringify(r)));let h=[],d="";for(let b of r){let u=this.getScheduledEvent(b);u?(h.push(u),d+=` '${u==null?void 0:u.title.trim()}',`,i.has(u)?console.log(`Set already contain ${u.id}~${u.title}..skipping`):i.add(u)):console.log("fixConflicts...ERROR not found?",b)}let f=b=>{console.log("onOk::Chosen Manually",b);let u=this.getScheduledEvent(b);return u?(l.push(u),u):(console.log("fixConflicts::onOk:: ERROR?!?! Not found",b),u=this.getLocalEvt(b),u?(l.push(u),u):(console.log("fixConflicts::onOk:: ERROR ERROR..still not found!!!",b),!1))},g=()=>{let b=0,u=null;for(let m of h){let v=this.parseScore(m.score);v>-1&&v>=b?(b=v,u=m):console.log("fixConflicts::ERROR...parseScore?",v,m)}if(u)return console.log("fixConflicts::Score Chosen..lowest?",u.id,u==null?void 0:u.title.trim(),u.details,u.score),l.push(u),u},D=()=>{this.radioChoiceDialog("","Choose the event to schedule",h.map(s),"",function(b){let u=f(b);return console.log(`fixConflicts--chooseEvt::onOk >>${b} >> ${u==null?void 0:u.title.trim()}`),u},null,function(){console.log("fixConflicts--chooseEvt::onDismiss...PICK>>",l.length),l.length==t.size&&(console.log("fixConflicts--chooseEvt::LAST LAST?",JSON.parse(JSON.stringify(l)),i),setTimeout(()=>{E(l,i),console.log("fixConflicts::setTimeout::chooseEvt::DONE",l.length)},0))})},E=(b,u)=>{u.forEach((v,$,c)=>{b.find(p=>p.id==v.id)?console.log("fixConflicts::removeConflicts:KEEEP",v.id,v==null?void 0:v.title.trim()):this.doRemove(v)});let m=this.updateCurrentSchedule();console.log("fixConflicts::removeConflicts::DONE",m),m.size>0&&this.fixConflicts(m)},w=`${d} scheduled at same ${n.at}.

      Choose how to solve this...`;this.radioChoiceDialog("Overlap warning!!",w,a,"opt1",function(b){if(b=="opt3")D(),console.log("fixConflicts::opt3",JSON.parse(JSON.stringify(l)));else{if(b=="opt2")return g();{let u=o(r);console.log("fixConflicts::opt1",u.id,u==null?void 0:u.title.trim(),u.details,u.score),l.push(u)}}},null,function(){console.log("fixConflicts::onDismiss Main >>",l.length),l.length==t.size&&(console.log("fixConflicts::MAIN LAST LAST?",JSON.parse(JSON.stringify(l)),i),setTimeout(()=>{E(l,i),console.log("fixConflicts::setTimeout::MAIN::DONE",l.length)},0))})}return!0},loadForDate(t,o,s){let l=(n,r)=>({id:parseInt(n),duration:r.duration,time:r.time}),i=()=>{let n=this.getEventsForDate(t);if(!n){console.log(`ERROR no evts found for ${t}...`,n);return}console.log(`doLoadNotPresent ${t}::evts=${Object.keys(n).length}`);let r=Object.keys(n).map(d=>l(d,n[d]));this.scheduledEvents=this.addPropsEventsTo(t,r);let h=this.updateCurrentSchedule();h.size>0&&!s?(console.log(`doLoadNotPresent..FIX overlaps for ${t} in past:${s}`,h),this.doNotify(`${s?"past":"future"}: ${t} with Some overlaps to fix!`,"warning","bottom"),this.fixConflicts(h)):(this.showReloadBtn=!1,this.disableSaveSchedule=!0,this.doNotify(`Loaded schedule for ${s?"past":"future"}:: ${t}`,"positive","bottom"))},a=()=>{let n=this.getEventsForDate(t);if(!n){console.log(`ERROR no evts found for today:${t} ?!?`,n);return}let r=Object.keys(n).map(f=>l(f,n[f])),h=this.addPropsEventsTo(t,r);console.log(`OverlapCheckLoadToday ${t} loading:${h.length} into current:${this.scheduledEvents.length} == ${this.dailyScheduled.size}`);let d=this.overlapCheckEvtsAdd(h);return Object.keys(d).length>0?this.doNotify(`${t} with Some overlaps to fix!`,"warning","bottom"):this.doNotify(`Loaded schedule for ${t}`,"positive","bottom"),d};if(this.scheduledEvents=[],this.updateCurrentSchedule(),o)if(this.isViewingToday()){let n=a();if(Object.keys(n).length>0){console.log("Overlaps toHandle >>",JSON.parse(JSON.stringify(n))),this.fixyOverlaps(n),this.showReloadBtn=o,this.showClearBtn=o,this.disableSaveSchedule=!1,this.evtStartedOrPassed(L(new Date)),this.resetButtons(o,s);return}this.evtStartedOrPassed(L(new Date)),this.disableSaveSchedule=!0}else i(),this.allowScoreEdit(s),this.showClearBtn=!s;else this.showReloadBtn=!1,this.showClearBtn=!1,this.disableSaveSchedule=!0;(s||t!==U())&&(console.log("adjusting time for past/future",t,this.scheduledEvents.length),this.adjustCurrentTime()),this.reset(),this.resetButtons(o,s)},scheduleDefaults(t){let o=this.deepCopy(this.store.fetchDefaults()),s=this.isViewingPast();if(this.showReloadBtn=this.hasEventsForDate,this.showClearBtn=!s&&o.length>0,this.resetButtons(!0,s),this.disableSaveSchedule=!(o.length>0),this.isViewingToday()){let l=this.addPropsEventsTo(this.currentDate,o);if(t=="add"){let a=l.length;l=l.filter(n=>!this.scheduledEvents.find(r=>r.id==n.id)),console.log(`scheduleDefaults..ADDIN from ${a} to ${l.length}`,l)}console.log(`scheduleDefaults:${this.currentDate} with ${t}`,l.length);let i=this.overlapCheckEvtsAdd(l);Object.keys(i).length>0&&(console.log(`scheduleDefaults overlaps on:${this.currentDate} ${o.length} == ${l.length} ?!? of size:${Object.keys(i).length}`),this.fixyOverlaps(i)),this.evtStartedOrPassed(L(new Date));return}else{let l=this.addPropsEventsTo(this.currentDate,o);if(t=="add"){let a=l.length;l=l.filter(r=>!this.scheduledEvents.find(h=>h.id==r.id)),console.log(`scheduleDefaults..ADDIN to ${this.currentDate} of ${this.scheduledEvents.length} from ${a} to `,l.length);let n=this.scheduledEvents.concat(l);this.scheduledEvents=n}else this.scheduledEvents=l;let i=this.updateCurrentSchedule();console.log("scheduleDefaults..sameStart?",i),s?this.allowScoreEdit(!0):this.allowScoreEdit(!1)}},reset(){this.draggedItem=null,this.targetDrop=null,this.chosenScore=null,this.chosenPrio=null,this.possibleRange=null},deepCopy(t){if(t===null||typeof t!="object")return t;if(Array.isArray(t))return t.map(s=>this.deepCopy(s));const o={};for(let s in t)t.hasOwnProperty(s)&&(o[s]=this.deepCopy(t[s]));return o},onRefresh(t){setTimeout(()=>{this.scheduledEvents=[],this.updateCurrentSchedule(),this.resetGoalEvts(!0),this.loadForDate(this.currentDate,this.hasEventsForDate,this.isViewingPast()),t()},1e3)},doSaveSchedule(){let t={};this.dailyScheduled.size<1?t=null:this.dailyScheduled.forEach((o,s,l)=>{t[s]={duration:o.for,time:o.start.time}}),this.store.saveDailySchedule(this.currentDate,t),this.disableSaveSchedule=!0,this.showReloadBtn=!1,this.showClearBtn=t!=null,this.doNotify(`doSaveSchedule for ${this.currentDate}`,"positive","top")},addParentGoal(t,o,s="red-14",l=2){let i=[];this.parentGoalsMap().forEach((r,h,d)=>{let f=r.bgcolor;i.push(f)});let a=tt(),n=i.length;if(n>1){let r=n+1;for(;i.some(d=>a[r]==d);)console.log("addParentGoal::index with taken color...new random",r,a[r]),r=Math.floor(Math.random()*n);let h=a[r];console.log(`addParentGoal::bgcolor..index ${r} from ${s} to: `,h),s=h||s}return this.store.addMainGoal(t,o,s,l)},onAddNewEvent(t,o,s,l){if(this.possibleRange||(console.log("umm onAddNewEvent... not a range selection",this.startEndTimes),this.possibleRange=this.startEndTimes),t.trim()==""){this.doNotify("Empty Goal title..."),this.addEventDialog=!1,this.reset();return}let i=re(this.possibleRange[0]),a=l>15?N(i,{minute:parseInt(l)}):N(re(this.possibleRange[1]),{minute:15}),n=Math.floor(j(i,a)/1e3/60);console.log(`onAddNewEvent:${t} :${s}: from ${i.time} till ${a.time}.Duration:${n}`,l);let r=null;if(s=="self"){let h=this.addParentGoal(t,t,"purple-10",2);h?(console.log("SELF parent Goal created",h),r=this.store.addSubGoal(h,t,"1on5",i.time,n,!0,!1,n<30)):console.log("ERROR? no pID",h)}else if(o){console.log("with parentGoal "+o.id,o==null?void 0:o.title),r=this.store.addSubGoal(o.id,t,"1on5",i.time,n,!1,!1,n<30);//!canMove and notInDefaults. isAlternative when duration<30
}else{let h=this.store.getGoalByTitle("Misc");if(h){console.log("Woo!! Misc pGoal already exists!",h.id),r=this.store.addSubGoal(h.id,t,"1on5",i.time,n,!1,!1,n<30);//!canMove and notInDefaults.isAlternative when duration<30
}else{let d=this.addParentGoal("Misc","Miscellaneous","grey-10",2);d&&(console.log("NEW Misc pGoal created",d),r=this.store.addSubGoal(d,t,"1on5",i.time,n,!0,!1,n<30))}}if(r){this.resetGoalEvts(!0);let h=this.tooClose(i,n);if(h){console.log("onAddNewEvent::tooClose check FAIL!!",h),h===!0?this.doNotify(`'${t}' created But Not added as over midnight!`):this.doNotify(`'${t}' created But Not added as too close to a scheduled Evt!!`),this.addEventDialog=!1;return}let d=this.hasOverlappingEvent(r,i,n);if(d.length>0){let f={};for(let g=0;g<d.length;g++){let D=d[g];f[D==null?void 0:D.inConflict]?f[D==null?void 0:D.inConflict].push(D):f[D==null?void 0:D.inConflict]=[D]}console.log("onAddNewEvt:: OVERLAPS handling",JSON.parse(JSON.stringify(f))),this.fixyOverlaps(f)}else{let f=this.addPropsEventsTo(this.currentDate,[{id:r,time:i.time,title:t,score:"2on5",duration:n,canMove:!o}]);console.log(`onAddNewEvt, addEvtPropsIntoSchedule: ${r} at ${i.time}`),this.addEvtPropsIntoSchedule(f[0])}this.disableSaveSchedule=!1,this.showReloadBtn=this.hasEventsForDate,this.showClearBtn=!this.isViewingPast(),this.constructTree()}else console.log("BOO ERROR no subID:(",r),this.doNotify("Error creating and adding this event :(","negative");this.addEventDialog=!1},tooClose(t,o){let s=N(t,{minute:0}),l=this.getTimeNumber(s),i=new Date;i.setHours(24),i.setMinutes(0),i.setSeconds(0),i.setMilliseconds(0);let a=L(i),n=Math.floor(j(s,a)/1e3/60);if(n<o)return console.log("tooClose to midnight eh...:(",n,o),!0;let r=!1;return this.dailyScheduled.forEach((h,d,f)=>{let D=this.getTimeNumber(h.start)-l,E=j(s,h.start),w=Math.floor(E/1e3/60);w<=10&&D>0&&(console.log("tooClose...:("+d,D,E,w),r=d)}),r},onPickEvent(t,o){if(this.addEventDialog=!1,!t){console.log("onPickEvent...ERROR nothing!",t,o),this.doNotify("No Goal selected..."),this.reset();return}let s=this.getScheduledEvent(t.id);if(s){console.log("onPickEvent...NOT NEW?!?ERROR!",s,t);return}else{s=t;let l=this.isViewingPast()?!0:o;console.log(`onPickEvent:: (${s.id})'${s.title.trim()}' from ${s.time} to ${this.targetDrop.timestamp.time} with force?${o} BUT Forcing?:${l}`);let i=this.tooClose(this.targetDrop.timestamp,s.duration);if(i){if(console.log("onPickEvent::tooClose check FAIL!",i),i===!0){this.doNotify("Picking event TOO close to midnight!"),this.reset();return}if(l)this.doNotify(`'${s.title.trim()}' TOO close to a scheduled Evt...forcing!`);else{this.doNotify(`'${s.title.trim()}' Not added as TOO close to a scheduled Evt`),this.reset();return}}let a=this.hasOverlappingEvent(s.id,this.targetDrop.timestamp,s.duration),n=a.length;if(n>0){console.log("onPickEvent::overlaps!!!",JSON.parse(JSON.stringify(a)));let r={};for(let h=0;h<n;h++){let d=a[h];r[d==null?void 0:d.inConflict]?r[d==null?void 0:d.inConflict].push(d):r[d==null?void 0:d.inConflict]=[d]}console.log(`onPickEvent::OVERLAPS of size: ${n} and force:${l}`,JSON.parse(JSON.stringify(r))),this.fixyOverlaps(r)}else console.log("onPickEvent NO overlaps...changing to targetDrop with ",l),this.changeEvtTime(s.id,this.targetDrop.timestamp,l,!0)}this.disableSaveSchedule=!1,this.showReloadBtn=this.hasEventsForDate,this.showClearBtn=!this.isViewingPast()},closingDialog(){console.log("closingDialog...scheduleDialog"),this.addEventDialog=!1,this.reset()},onEndNow(t){const o=L(new Date);let s=this.hasEventsForDate;if(this.dailyScheduled.has(t)){let l=this.dailyScheduled.get(t),i=l.start,a=l.end;if(te(o,i,a,!0)){let n=this.getTimeNumber(a)-this.getTimeNumber(i),r=this.getTimeNumber(o)-this.getTimeNumber(i);console.log(`Great, ${t} REDUCING duration from ${n} to:`,r);for(let h=0;h<this.scheduledEvents.length;h++){let d=this.scheduledEvents[h];d.id===t&&(d.duration=r)}this.dailyScheduled.set(t,{...l,for:r,end:o}),this.endTimesSet.delete(a.time)||console.log("ERROR endTimesSet item does not exist?!?",l,this.endTimesSet),this.endTimesSet.add(o.time)}else console.log("umm aint in the middle of this event! Nothing to do...ERROR?",o.time,i.time,a.time)}else{console.log("ERROR doEndNow not found!!!",t);return}this.disabledScoreEvts[t]=!1,this.disableSaveSchedule=!1,this.showReloadBtn=s,this.showClearBtn=!this.isViewingPast&&this.scheduledEvents.length>0},onSaveScore(t,o){let s=this.dailyScheduled.get(o);if(s){if(this.getLocalEvt(o),this.parseScore(t)<-1){this.doNotify("Score Error: higher# on lower#");return}s.score=t,this.doSaveEvtProp(o,null,t);let i=this.getScheduledEvent(o);i?i.score=t:console.log("onSaveScore ERROR not found",i,o)}else console.log(`ERROR onSaveScore could not find event ${o}?!?`)},onClearDay(){if(this.isViewingPast()){this.doNotify("Editing past is no no!");return}this.scheduledEvents=[],this.updateCurrentSchedule(),this.resetGoalEvts(!0),this.doNotify("Cleared daily schedule","warning","top"),this.reset();let t=this.hasEventsForDate;this.showReloadBtn=t,this.showLoadDefaults=!0,this.showClearBtn=!1,this.disableSaveSchedule=!t},onReloadSaved(){let t=this.hasEventsForDate,o=()=>{console.log("Aborting",this.currentDate,this.scheduledEvents,t),this.showReloadBtn=!this.isViewingPast()||t},s=()=>{this.scheduledEvents=[],this.updateCurrentSchedule(),this.loadForDate(this.currentDate,t,this.isViewingPast()),this.reset()};this.scheduledEvents.length>0?this.confirmAction("Overwrite current Evts?","OK",s,o):s(),this.showReloadBtn=!1,this.showClearBtn=!this.isViewingPast()},onLoadDefault(){let t=()=>{console.log("Aborting",this.currentDate)},o=s=>{this.scheduleDefaults(s)};if(this.scheduledEvents.length>0){let s=[{label:"Add Defaults to current day schedule",value:"add"},{label:"Overwrite and only schedule Defaults",value:"overwrite"}];this.radioChoiceDialog("Warning!!",`Day: ${this.currentDate} already have scheduled Events...`,s,"",function(l){console.log("OK LoadDefaults",l),o(l)},t)}else o("overwrite")},choosePrio(t){let o=this.chosenPrio;o&&o==t?this.disablePrioBtn=!0:(this.chosenPrio=t,this.disablePrioBtn=!1)},chooseScore(t){let o=this.chosenScore;o&&o==t?this.disableScoreBtn=!0:(this.chosenScore=t,this.disableScoreBtn=!1)},findSamePrio(t){const o=()=>this.scheduledEvents.filter(i=>{var a;return((a=this.parentGoalsMap().get(i.parentGoal))==null?void 0:a.priority)==this.chosenPrio});let s=[],l=this.isViewingToday();if(t=="overwrite"||t=="add"){let i=this.deepCopy(this.storedEvents);for(let a of i){let n=this.parentGoalsMap().get(a.parentGoal);(n==null?void 0:n.priority)==this.chosenPrio&&s.push(a)}t=="add"?s=s.filter(a=>!this.scheduledEvents.find(n=>n.id==a.id)):(this.scheduledEvents=[],this.updateCurrentSchedule()),console.log(`findSamePrio...${t} ADDIN to size: ${this.scheduledEvents.length} some evts = ${s.length}`)}else s=o(),console.log("findSamePrio..filtering!!",this.chosenPrio,s);if(l&&t!="filter"){s=this.addPropsEventsTo(this.currentDate,s);let i=this.overlapCheckEvtsAdd(s);Object.keys(i).length>0?(console.log(`findSamePrio${this.chosenPrio}...overlaps`,JSON.parse(JSON.stringify(i))),this.fixyOverlaps(i,null,"findSamePrio")):(console.log("findSamePrio >>No overlaps!!...",s.length),this.updateCurrentSchedule())}else{if(t=="filter")this.scheduledEvents=s;else if(s=this.addPropsEventsTo(this.currentDate,s),t=="add"){let i=this.scheduledEvents.concat(s);this.scheduledEvents=i}else this.scheduledEvents=s;this.updateCurrentSchedule()}if(!this.scheduledEvents.length>0){this.doNotify(`Empty for Priority == ${this.chosenPrio} :(`,"warning","bottom"),this.disableSaveSchedule=!0,this.showReloadBtn=this.hasEventsForDate,this.showClearBtn=!1;return}this.disableSaveSchedule=!1,this.showReloadBtn=this.hasEventsForDate,this.showClearBtn=!0},onReloadWithPrio(){if(this.chosenPrio==null){this.doNotify("Ayo select a priority!");return}let t=()=>{console.log("onReloadWithPrio..cancelling"),this.reset()};if(this.scheduledEvents.length>0){let o=[{label:`Filter current by priority == ${this.chosenPrio}`,value:"filter"},{label:`Add to current Evts with priority == ${this.chosenPrio}`,value:"add"},{label:`Overwrite and schedule All by priority == ${this.chosenPrio}`,value:"overwrite"}];this.radioChoiceDialog("","Schedule change...",o,"",this.findSamePrio,t)}else this.findSamePrio("overwrite");this.resetButtons(this.hasEventsForDate,this.isViewingPast()),this.disablePrioBtn=!0},reloadEvtsWithScore(t){const o=()=>{let i=[];return this.scheduledEvents.forEach(a=>{let n=this.parseScore(a.score);n>-1&&n>=this.chosenScore&&i.push(a)}),i};let s=[],l=this.isViewingToday();if(t=="overwrite"||t=="add"){const i=this.store.fetchGoalsWithMinScore(this.chosenScore);t=="add"?s=i.filter(a=>!this.scheduledEvents.find(n=>n.id==a.id)):(s=i,this.scheduledEvents=[],this.updateCurrentSchedule())}else s=o(),console.log(`reloadEvtsWithScore AFTER flag ${t}`,this.scheduledEvents.length,JSON.parse(JSON.stringify(s))),JSON.parse(JSON.stringify(this.scheduledEvents));if(l&&t!="filter"){s=this.addPropsEventsTo(this.currentDate,s),console.log(`reloadEvtsWithScore::addPropsEventsTo today for '${t}'`,this.scheduledEvents.length,JSON.parse(JSON.stringify(s)));let i=this.overlapCheckEvtsAdd(s);Object.keys(i).length>0?(console.log(`onReloadWithScore ${this.chosenScore}...overlaps!!`,JSON.parse(JSON.stringify(i))),this.fixyOverlaps(i,!1,"reloadScore")):(console.log("onReloadWithScore >>NO OVERLAPS!!!..."),this.updateCurrentSchedule())}else{if(console.log(`reloadEvtsWithScore... with flag '${t}' on>`,this.currentDate,JSON.parse(JSON.stringify(this.scheduledEvents.length)),JSON.parse(JSON.stringify(s))),t=="filter")this.scheduledEvents=s;else if(s=this.addPropsEventsTo(this.currentDate,s),t=="add"){let i=this.scheduledEvents.concat(s);this.scheduledEvents=i}else this.scheduledEvents=s;this.updateCurrentSchedule()}if(!this.scheduledEvents.length>0){this.doNotify(`Empty for Score >= ${this.chosenScore} :(`,"warning","bottom"),this.disableSaveSchedule=!0,this.showReloadBtn=this.hasEventsForDate,this.showClearBtn=!1;return}this.disableSaveSchedule=!1,this.showReloadBtn=this.hasEventsForDate,this.showClearBtn=!0},onReloadWithScore(){if(this.chosenScore==null){this.doNotify("Ayo select a score!");return}let t=()=>{console.log("onReloadWithScore..cancelling",this.scheduledEvents),this.reset()};if(this.scheduledEvents.length>0){let o=[{label:`Filter current by Interval Score >= ${this.chosenScore}`,value:"filter"},{label:`Add to current Evts with Interval Score >= ${this.chosenScore}`,value:"add"},{label:`Overwrite and schedule All by Interval Score >= ${this.chosenScore}`,value:"overwrite"}];this.radioChoiceDialog("","Schedule change...",o,"",this.reloadEvtsWithScore,t)}else this.reloadEvtsWithScore("overwrite");this.resetButtons(this.hasEventsForDate,this.isViewingPast()),this.disableScoreBtn=!0},onChange(t){this.loadForDate(t.start,this.hasEventsForDate,this.isViewingPast())},onDragStart(t,o){if(this.isViewingPast()){this.doNotify("Editing past is no no!"),t.preventDefault();return}this.draggedItem=o},onDragEnter(t,o,s){return o==="goal-item"||(this.targetDrop=s),t.preventDefault(),!0},onDragOver(t,o,s){return t.preventDefault(),!0},onDragLeave(t,o,s){return!1},onDragEnd(t){console.log("onDragEnd",this.startTimesSet,this.endTimesSet)},onDrop(t,o,s){let l=this.getScheduledEvent(this.draggedItem.id);if(!l){console.log("onDrop ERROR",l,this.draggedItem);return}let i=null;if(o==="interval")i=s.timestamp;else if(o==="goal-item"&&this.targetDrop)i=this.targetDrop.timestamp;else{console.log("Cannot drop here YO!!",t,o,s,this.targetDrop);return}if(!i){console.log("ERROR...no timestamp YO!!",t,o,s,this.targetDrop);return}let a=this.tooClose(i,l.duration);if(a&&(console.log("onDrop::tooClose check FAIL!",a),a===!0)){this.doNotify("Dropping event TOO close to midnight!"),this.reset();return}let n=this.hasOverlappingEvent(l.id,i,l.duration),r=n.length;if(r>0){console.log("onDrop...OVERLAP!",r);let h=0;do{if(n[h].inConflict==n[h].target){console.log("EUUUH...self overlap?!?",n[h]);break}if(console.log("onDrop...overlap handlin::",n[h],n[h].direction),n[h].direction=="surrounding"){let d={};d[n[h].inConflict]=n[h],console.log("onDrop...SURROUNDING fixOverlap::",JSON.parse(JSON.stringify(d))),this.fixyOverlaps(d,!0)}else this.recurChangeTime(n[h].inConflict,l,i,!0)}while(++h<r)}else this.changeEvtTime(l.id,i,!1),console.log(`${l.id} onDrop no overlap complete to ${i.time}`);this.disableSaveSchedule=!1,this.showReloadBtn=this.hasEventsForDate,this.showClearBtn=!0,this.reset()},onDblClickEvent(t,o){if(this.isViewingPast()){if(o.duration<30){console.log("onDblClickEvent..baah too smoll smoll",o.title,o.duration),this.doNotify("Removing from the past is a no no!");return}this.chooseAlternatives(o),t.preventDefault();return}this.removeEvtInSchedule(o)},onClickDate(t){console.log("onClickDate",t)},onClickTime(t){console.log("onClickTime..event",t),this.addEventDialog=!0,this.targetDrop=t.scope},onClickInterval(t){console.log("onClickInterval",t)},onClickHeadIntervals(t){console.log("onClickHeadIntervals",t)},onClickHeadDay(t){console.log("onClickHeadDay",t)},onMouseEnter(t){console.log("onMouseAt",t)},onMouseLeave(t){console.log("onMouseLeave",JSON.stringify(t))},onMouseDownTime({scope:t,event:o}){if(Se(o)){if(this.mobile===!0&&this.anchorTimestamp!==null&&this.otherTimestamp!==null&&z(this.anchorTimestamp)===z(this.otherTimestamp)){this.otherTimestamp=t.timestamp,this.mouseDown=!1;return}this.mouseDown=!0,this.anchorTimestamp=t.timestamp,this.otherTimestamp=t.timestamp}},onMouseUpTime({scope:t,event:o}){if(this.mobile!==!0&&Se(o)&&(this.otherTimestamp=t.timestamp,this.mouseDown=!1),!this.mousedown){let s=this.startEndTimes;if(s[1]==s[0])return;this.possibleRange=s,console.log("onMouseUpTime range change",this.possibleRange)}},onMouseMoveTime({scope:t,event:o}){this.mobile!==!0&&this.mouseDown===!0&&(this.otherTimestamp=t.timestamp)},scrollToEvent(t){this.$refs.calendar.scrollToTime(t.time,350)},onToday(){let t=()=>{this.$refs.calendar.moveToToday()},o=()=>{setTimeout(t,1e3),this.doSaveSchedule()};this.disableSaveSchedule?t():this.confirmAction(`Save day: ${this.currentDate} changes?`,"Save",o,t)},onPrev(){let t=()=>{this.$refs.calendar.prev()},o=()=>{setTimeout(t,1e3),this.doSaveSchedule()};this.disableSaveSchedule?t():this.confirmAction(`Save day: ${this.currentDate} changes?`,"Save",o,t)},onNext(){let t=()=>{this.$refs.calendar.next()},o=()=>{setTimeout(t,1e3),this.doSaveSchedule()};this.disableSaveSchedule?t():this.confirmAction(`Save day: ${this.currentDate} changes?`,"Save",o,t)}}}),Pe=t=>(ne("data-v-ccd72dec"),t=t(),ae(),t),Kt={key:0,class:"q-gutter-md"},Yt={key:1,class:"subcontent"},Xt={class:"float-right"},Zt={key:0},eo={key:1},to={key:2},oo={key:3},so={key:4},io={class:"row justify-center"},lo={style:{display:"flex","max-width":"800px",width:"100%",height:"400px"}},no={style:{display:"flex","justify-content":"center","flex-wrap":"wrap",padding:"2px"}},ao={class:"title q-calendar__ellipsis"},ro=["onDblclick","onDragstart"],ho={class:"row justify-center"},co=Pe(()=>P("br",null,null,-1)),uo={key:0,class:"q-pa-xl bg-grey-12",style:{"max-width":"400px"}},fo={class:"row justify-center"},mo=Pe(()=>P("br",null,null,-1)),go={class:"q-mr-sm text-weight-bold",size:"28px"},po={key:0},vo={class:"text-weight-bold"},So={key:1,class:"text-weight-light text-black"};function Eo(t,o,s,l,i,a){const n=F("add-goal-form"),r=F("navigation-bar"),h=F("sched-btn"),d=F("sched-drop-btn"),f=F("goaly-end"),g=F("q-calendar-day"),D=F("sched-dialog");return O(),k(J,null,[t.showForm?(O(),k("div",Kt,[S(B,{class:"q-pl-xl justify-center",color:"","text-color":"green",elevated:"",label:"HideForm",onClick:o[0]||(o[0]=E=>t.showGoalForm=!t.showGoalForm),"no-caps":""}),S(n)])):_("",!0),t.showForm?_("",!0):(O(),k("div",Yt,[S(Xe,{onRefresh:t.onRefresh},{default:T(()=>[S(r,{onToday:t.onToday,onPrev:t.onPrev,onNext:t.onNext},null,8,["onToday","onPrev","onNext"]),P("div",Xt,[t.showReloadBtn?(O(),k("div",Zt,[S(h,{"text-label":"Reload",class:"q-mt-xl","text-color":"green",onDoBtnAction:t.onReloadSaved},null,8,["onDoBtnAction"])])):_("",!0),t.showClearBtn?(O(),k("div",eo,[S(h,{"text-label":"Clear",class:"q-mt-xl","text-color":"lime-5",onDoBtnAction:t.onClearDay},null,8,["onDoBtnAction"])])):_("",!0),t.showLoadDefaults?(O(),k("div",to,[S(h,{"text-label":"Defaults",class:"q-mt-xl","text-color":"blue",onDoBtnAction:t.onLoadDefault},null,8,["onDoBtnAction"])])):_("",!0),t.showScoreBtn?(O(),k("div",oo,[S(d,{class:"q-mt-xl","text-color":"teal",disableBtn:t.disableScoreBtn,optionLabel:t.chosenScoreLabel,daOptions:t.scoreOptions,onDoReload:t.onReloadWithScore,onChooseOption:t.chooseScore},null,8,["disableBtn","optionLabel","daOptions","onDoReload","onChooseOption"])])):_("",!0),t.showPrio?(O(),k("div",so,[S(d,{class:"q-mt-xl","text-color":"teal",disableBtn:t.disablePrioBtn,optionLabel:t.chosenPrioLabel,daOptions:t.setGoalsPrio(),onDoReload:t.onReloadWithPrio,onChooseOption:t.choosePrio},null,8,["disableBtn","optionLabel","daOptions","onDoReload","onChooseOption"])])):_("",!0)])]),_:1},8,["onRefresh"]),P("div",io,[P("div",lo,[S(g,{ref:"calendar",view:"day",modelValue:t.currentDate,"onUpdate:modelValue":o[5]||(o[5]=E=>t.currentDate=E),"drag-enter-func":t.onDragEnter,"drag-over-func":t.onDragOver,"drag-leave-func":t.onDragLeave,"drop-func":t.onDrop,animated:"",bordered:"",hoverable:"","no-active-date":"","transition-next":"slide-left","transition-prev":"slide-right","time-clicks-clamped":"","interval-minutes":15,"interval-count":96,"interval-height":28,"selected-start-end-dates":t.startEndTimes,onChange:t.onChange,onClickDate:t.onClickDate,onClickTime:t.onClickTime,onClickInterval:t.onClickInterval,onClickHeadIntervals:t.onClickHeadIntervals,onClickHeadDay:t.onClickHeadDay,onMousedownTime:t.onMouseDownTime,onMouseupTime:t.onMouseUpTime,onMousemoveTime:t.onMouseMoveTime},{"head-day-event":T(({scope:{timestamp:E}})=>[P("div",no,[(O(!0),k(J,null,he(t.eventsMap[E.date],w=>(O(),k(J,{key:w.id},[w.time?(O(),I(ge,{key:1,class:ee(t.badgeClasses(w,"header")),style:K([t.badgeStyles(w,"header"),{margin:"1px",width:"10px","max-width":"10px",height:"10px","max-height":"10px",cursor:"pointer"}]),onClick:b=>t.scrollToEvent(w)},{default:T(()=>[S(ue,null,{default:T(()=>[x(G("("+w.id+")"+w.title+" - "+w.time),1)]),_:2},1024)]),_:2},1032,["class","style","onClick"])):(O(),I(ge,{key:0,class:ee(t.badgeClasses(w,"header")),style:K([t.badgeStyles(w,"header"),{width:"100%",cursor:"pointer",height:"12px","font-size":"10px",margin:"1px"}])},{default:T(()=>[P("div",ao,[x(G(w.title)+" ",1),S(ue,null,{default:T(()=>[x(G(w.details),1)]),_:2},1024)])]),_:2},1032,["class","style"]))],64))),128))])]),"day-container":T(({scope:{days:E}})=>[t.hasDate(E)?(O(),k(J,{key:0},[P("div",{class:"day-view-current-time-indicator",style:K(t.style)},null,4),P("div",{class:"day-view-current-time-line",style:K(t.style)},null,4)],64)):_("",!0)]),"day-body":T(({scope:{timestamp:E,timeStartPos:w,timeDurationHeight:b}})=>[(O(!0),k(J,null,he(t.getDateEvents(E.date),u=>(O(),k(J,{key:u.id},[u.time!==void 0?(O(),k("div",{key:0,class:ee(["my-event",t.badgeClasses(u,"body")]),style:K(t.badgeStyles(u,"body",w,b)),draggable:!0,onDblclick:oe(m=>t.onDblClickEvent(m,u),["prevent"]),onDragstart:oe(m=>t.onDragStart(m,u),["stop"]),onDragend:o[1]||(o[1]=oe((...m)=>t.onDragEnd&&t.onDragEnd(...m),["stop"])),onDrop:o[2]||(o[2]=m=>t.onDrop(m,"goal-item",t.scope)),onDragenter:o[3]||(o[3]=m=>t.onDragEnter(m,"goal-item",t.scope)),onDragover:o[4]||(o[4]=m=>t.onDragOver(m,"goal-item",t.scope))},[S(f,{disabledScore:t.disabledScoreEvts[u.id],title:u.title,id:u.id,startTime:u.time,score:u.score,details:u.details,happeningNow:t.hasStarted[u.id]?t.hasStarted[u.id]:!1,onEndNow:t.onEndNow,onSaveScore:t.onSaveScore,onDeleteNow:m=>t.removeEvtInSchedule(u,m)},null,8,["disabledScore","title","id","startTime","score","details","happeningNow","onEndNow","onSaveScore","onDeleteNow"])],46,ro)):_("",!0)],64))),128))]),_:1},8,["modelValue","drag-enter-func","drag-over-func","drag-leave-func","drop-func","selected-start-end-dates","onChange","onClickDate","onClickTime","onClickInterval","onClickHeadIntervals","onClickHeadDay","onMousedownTime","onMouseupTime","onMousemoveTime"])]),t.addEventDialog?(O(),I(D,{key:0,parentGoals:t.storedCompPG,canBeScheduled:t.canbeScheduled,onOnAddNewEvent:t.onAddNewEvent,onOnPickEvent:t.onPickEvent,onEuhHidin:t.closingDialog},null,8,["parentGoals","canBeScheduled","onOnAddNewEvent","onOnPickEvent","onEuhHidin"])):_("",!0)]),P("div",ho,[S(B,{class:"q-mt-xl",color:"Green","text-color":"blue",elevated:"",label:"SaveSchedule",disable:t.doDisableSaveSchedule,onClick:t.doSaveSchedule,"no-caps":""},null,8,["disable","onClick"]),S(B,{class:"q-mt-xl",color:"","text-color":"green",elevated:"",label:"ShowForm",onClick:o[6]||(o[6]=E=>t.showGoalForm=!t.showGoalForm),"no-caps":""})]),co,t.treeGoals.length>0?(O(),k("div",uo,[P("div",fo,G(t.labelGoals()),1),S(le),mo,S(it,{nodes:t.treeGoals,"node-key":"label",expanded:t.expanded,"onUpdate:expanded":o[7]||(o[7]=E=>t.expanded=E),"no-connectors":"",dense:"","default-expand-all":""},{"default-header":T(E=>[P("div",{class:ee(t.classyColor(E.node))},[S(Ce,{name:E.node.icon||"arrow",size:"28px",class:"q-mr-sm"},null,8,["name"]),P("div",go,G(E.node.label),1)],2)]),"default-body":T(E=>[E.node.isChildren?(O(),k("div",po,[P("span",vo," >> "+G(E.node.details),1)])):(O(),k("span",So,G(E.node.details),1))]),_:1},8,["nodes","expanded"])])):_("",!0)]))],64)}var Ro=W(jt,[["render",Eo],["__scopeId","data-v-ccd72dec"]]);export{Ro as default};
