import{j as ne,r as $,c as X,ak as Ge,n as _e,an as Ve,h as G,g as be,Q as M,d as te,_ as Q,F as T,M as B,K as A,S as V,I as w,H as P,J as U,P as ee,W as Y,ao as $e,ap as se,G as L,k as Oe,aq as Re,a6 as Ie,ar as Le,as as xe,w as ve,b as Fe,R as De,at as qe,au as Je,av as We,aw as He,$ as ze,N as ue,O as H,f as Ue,ax as Se,V as _,X as re,Y as ae,ay as Te,az as fe,ai as Qe,am as le,E as q,aA as je,U as oe}from"./index.6f12c392.js";import{Q as Pe,a as Ke,b as Ye,c as Xe,d as Ze,e as Ne,f as et,g as tt,h as ot}from"./goalForm.1eab7e4a.js";import{c as ge,a as it,b as st,p as lt,Q as Ee}from"./utiFunc.c7d15e5d.js";import{N as nt,t as z,p as he,a as k,j,k as ce,T as rt,b as W,c as I,i as ie,C as ye,U as F,V as K,Q as at}from"./NavigationBar.45bc93bb.js";import{a as dt}from"./QCalendar.19dedb25.js";/* empty css                             */import{u as ht}from"./goalStorage.57245ced.js";import{u as ct}from"./use-quasar.cc009517.js";const ut=()=>!!/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);function Z(t,o=new WeakMap){if(Object(t)!==t)return t;if(o.has(t))return o.get(t);const i=t instanceof Date?new Date(t):t instanceof RegExp?new RegExp(t.source,t.flags):t instanceof Set?new Set:t instanceof Map?new Map:typeof t.constructor!="function"?Object.create(null):t.prototype!==void 0&&typeof t.prototype.constructor=="function"?t:new t.constructor;if(typeof t.constructor=="function"&&typeof t.valueOf=="function"){const l=t.valueOf();if(Object(l)!==l){const s=new t.constructor(l);return o.set(t,s),s}}return o.set(t,i),t instanceof Set?t.forEach(l=>{i.add(Z(l,o))}):t instanceof Map&&t.forEach((l,s)=>{i.set(s,Z(l,o))}),Object.assign(i,...Object.keys(t).map(l=>({[l]:Z(t[l],o)})))}var ft=ne({name:"QPopupEdit",props:{modelValue:{required:!0},title:String,buttons:Boolean,labelSet:String,labelCancel:String,color:{type:String,default:"primary"},validate:{type:Function,default:()=>!0},autoSave:Boolean,cover:{type:Boolean,default:!0},disable:Boolean},emits:["update:modelValue","save","cancel","beforeShow","show","beforeHide","hide"],setup(t,{slots:o,emit:i}){const{proxy:l}=be(),{$q:s}=l,n=$(null),r=$(""),d=$("");let c=!1;const a=X(()=>Ge({initialValue:r.value,validate:t.validate,set:u,cancel:S,updatePosition:E},"value",()=>d.value,h=>{d.value=h}));function u(){t.validate(d.value)!==!1&&(y()===!0&&(i("save",d.value,r.value),i("update:modelValue",d.value)),b())}function S(){y()===!0&&i("cancel",d.value,r.value),b()}function E(){_e(()=>{n.value.updatePosition()})}function y(){return Ve(d.value,r.value)===!1}function b(){c=!0,n.value.hide()}function D(){c=!1,r.value=Z(t.modelValue),d.value=Z(t.modelValue),i("beforeShow")}function R(){i("show")}function C(){c===!1&&y()===!0&&(t.autoSave===!0&&t.validate(d.value)===!0?(i("save",d.value,r.value),i("update:modelValue",d.value)):i("cancel",d.value,r.value)),i("beforeHide")}function g(){i("hide")}function f(){const h=o.default!==void 0?[].concat(o.default(a.value)):[];return t.title&&h.unshift(G("div",{class:"q-dialog__title q-mt-sm q-mb-sm"},t.title)),t.buttons===!0&&h.push(G("div",{class:"q-popup-edit__buttons row justify-center no-wrap"},[G(M,{flat:!0,color:t.color,label:t.labelCancel||s.lang.label.cancel,onClick:S}),G(M,{flat:!0,color:t.color,label:t.labelSet||s.lang.label.set,onClick:u})])),h}return Object.assign(l,{set:u,cancel:S,show(h){n.value!==null&&n.value.show(h)},hide(h){n.value!==null&&n.value.hide(h)},updatePosition:E}),()=>{if(t.disable!==!0)return G(Pe,{ref:n,class:"q-popup-edit",cover:t.cover,onBeforeShow:D,onShow:R,onBeforeHide:C,onHide:g,onEscapeKey:S},f)}}});const gt=te({name:"GoalyEnd",props:{disabledScore:Boolean,title:String,id:Number,startTime:String,details:String,score:String,happeningNow:Boolean},data(){const t=$(""),o=$(!1);return{errorMessageScore:t,errorScore:o}},emits:["saveScore","endNow","deleteNow","addMins"],computed:{aScore:{get(){return this.score},set(t){this.aScorey(t)&&this.$emit("saveScore",t,this.id)},cancel(){console.log("aScore remove?",this.id)}},userIconStyle(){return{color:this.disabledScore===!0?"red":"blue",cursor:"pointer"}},endNowBtnStyle(){return{display:this.disabledScore===!0&&this.happeningNow===!0?"flex":"none","text-align":"center","margin-left":"32em",height:"auto"}}},watch:{title(t){console.log("titleValue:",t)}},methods:{onDelete(){this.$emit("deleteNow",this.id)},wannaEnd(){this.$emit("endNow",this.id)},wannaAdd(t){this.$emit("addMins",this.id,t)},aScorey(t){return t.length<4||!t.includes("on")?(this.errorScore=!0,this.errorMessageScore=`Error: ${t} Unsaved.Must format as: #on#`,!1):(this.errorScore=!1,this.errorMessageScore="",!0)}}}),mt={class:"title q-calendar__ellipsis"},pt={class:"q-pl-md"};function vt(t,o,i,l,s,n){return T(),B("div",mt,[A("div",pt,V(` ${t.title} (${t.score})`),1),w(ge,null,{default:P(()=>[U(V("("+t.id+") "+t.details),1)]),_:1}),A("div",{style:Y(t.endNowBtnStyle)},[w(M,{"no-caps":"",label:"Add5",onClick:o[0]||(o[0]=r=>t.wannaAdd(5))}),w(M,{"no-caps":"",label:"Add10",class:"q-mx-md",onClick:o[1]||(o[1]=r=>t.wannaAdd(10))}),w(ee,{vertical:!0}),w(M,{"no-caps":"",label:"End-Now",onClick:t.wannaEnd},null,8,["onClick"])],4),w(ft,{modelValue:t.aScore,"onUpdate:modelValue":o[2]||(o[2]=r=>t.aScore=r),disable:t.disabledScore,"auto-save":""},{default:P(r=>[w($e,{modelValue:r.value,"onUpdate:modelValue":d=>r.value=d,dense:"",hint:"format: #on#",error:t.errorScore,"error-message":t.errorMessageScore},{after:P(()=>[w(M,{flat:"",dense:"",color:"positive",icon:"check_circle",onClick:se(r.set,["stop","prevent"])},null,8,["onClick"]),w(ee,{vertical:!0}),w(M,{label:"Del",flat:"",dense:"",color:"negative",icon:"delete_forever",onClick:t.onDelete},null,8,["onClick"])]),_:2},1032,["modelValue","onUpdate:modelValue","error","error-message"])]),_:1},8,["modelValue","disable"])])}var St=Q(gt,[["render",vt],["__scopeId","data-v-c867a700"]]);const Et=te({name:"schedBtn",props:{textLabel:String},emits:["doBtnAction"],methods:{onClicked(){this.$emit("doBtnAction")}}});function yt(t,o,i,l,s,n){return T(),L(M,{color:"",elevated:"",onClick:t.onClicked,"no-caps":""},{default:P(()=>[A("div",null,V(t.textLabel),1)]),_:1},8,["onClick"])}var wt=Q(Et,[["render",yt],["__scopeId","data-v-f8dc388e"]]),Ct=ne({name:"QBtnGroup",props:{unelevated:Boolean,outline:Boolean,flat:Boolean,rounded:Boolean,square:Boolean,push:Boolean,stretch:Boolean,glossy:Boolean,spread:Boolean},setup(t,{slots:o}){const i=X(()=>{const l=["unelevated","outline","flat","rounded","square","push","stretch","glossy"].filter(s=>t[s]===!0).map(s=>`q-btn-group--${s}`).join(" ");return`q-btn-group row no-wrap${l.length>0?" "+l:""}`+(t.spread===!0?" q-btn-group--spread":" inline")});return()=>G("div",{class:i.value},Oe(o.default))}});const bt=Object.keys(Re),$t=t=>bt.reduce((o,i)=>{const l=t[i];return l!==void 0&&(o[i]=l),o},{});var Ot=ne({name:"QBtnDropdown",props:{...Re,...Ie,modelValue:Boolean,split:Boolean,dropdownIcon:String,contentClass:[Array,String,Object],contentStyle:[Array,String,Object],cover:Boolean,persistent:Boolean,noRouteDismiss:Boolean,autoClose:Boolean,menuAnchor:{type:String,default:"bottom end"},menuSelf:{type:String,default:"top end"},menuOffset:Array,disableMainBtn:Boolean,disableDropdown:Boolean,noIconAnimation:Boolean,toggleAriaLabel:String},emits:["update:modelValue","click","beforeShow","show","beforeHide","hide"],setup(t,{slots:o,emit:i}){const{proxy:l}=be(),s=$(t.modelValue),n=$(null),r=Le(),d=X(()=>{const h={"aria-expanded":s.value===!0?"true":"false","aria-haspopup":"true","aria-controls":r,"aria-label":t.toggleAriaLabel||l.$q.lang.label[s.value===!0?"collapse":"expand"](t.label)};return(t.disable===!0||t.split===!1&&t.disableMainBtn===!0||t.disableDropdown===!0)&&(h["aria-disabled"]="true"),h}),c=X(()=>"q-btn-dropdown__arrow"+(s.value===!0&&t.noIconAnimation===!1?" rotate-180":"")+(t.split===!1?" q-btn-dropdown__arrow-container":"")),a=X(()=>xe(t)),u=X(()=>$t(t));ve(()=>t.modelValue,h=>{n.value!==null&&n.value[h?"show":"hide"]()}),ve(()=>t.split,f);function S(h){s.value=!0,i("beforeShow",h)}function E(h){i("show",h),i("update:modelValue",!0)}function y(h){s.value=!1,i("beforeHide",h)}function b(h){i("hide",h),i("update:modelValue",!1)}function D(h){i("click",h)}function R(h){qe(h),f(),i("click",h)}function C(h){n.value!==null&&n.value.toggle(h)}function g(h){n.value!==null&&n.value.show(h)}function f(h){n.value!==null&&n.value.hide(h)}return Object.assign(l,{show:g,hide:f,toggle:C}),Fe(()=>{t.modelValue===!0&&g()}),()=>{const h=[G(De,{class:c.value,name:t.dropdownIcon||l.$q.iconSet.arrow.dropdown})];return t.disableDropdown!==!0&&h.push(G(Pe,{ref:n,id:r,class:t.contentClass,style:t.contentStyle,cover:t.cover,fit:!0,persistent:t.persistent,noRouteDismiss:t.noRouteDismiss,autoClose:t.autoClose,anchor:t.menuAnchor,self:t.menuSelf,offset:t.menuOffset,separateClosePopup:!0,transitionShow:t.transitionShow,transitionHide:t.transitionHide,transitionDuration:t.transitionDuration,onBeforeShow:S,onShow:E,onBeforeHide:y,onHide:b},o.default)),t.split===!1?G(M,{class:"q-btn-dropdown q-btn-dropdown--simple",...u.value,...d.value,disable:t.disable===!0||t.disableMainBtn===!0,noWrap:!0,round:!1,onClick:D},{default:()=>Oe(o.label,[]).concat(h),loading:o.loading}):G(Ct,{class:"q-btn-dropdown q-btn-dropdown--split no-wrap q-btn-item",rounded:t.rounded,square:t.square,...a.value,glossy:t.glossy,stretch:t.stretch},()=>[G(M,{class:"q-btn-dropdown--current",...u.value,disable:t.disable===!0||t.disableMainBtn===!0,noWrap:!0,round:!1,onClick:R},{default:o.label,loading:o.loading}),G(M,{class:"q-btn-dropdown__arrow-container q-anchor--skip",...d.value,...a.value,disable:t.disable===!0||t.disableDropdown===!0,rounded:t.rounded,color:t.color,textColor:t.textColor,dense:t.dense,size:t.size,padding:t.padding,ripple:t.ripple},()=>h)])}}});function we(t){if(t===!1)return 0;if(t===!0||t===void 0)return 1;const o=parseInt(t,10);return isNaN(o)?0:o}var Rt=Je({name:"close-popup",beforeMount(t,{value:o}){const i={depth:we(o),handler(l){i.depth!==0&&setTimeout(()=>{const s=We(t);s!==void 0&&He(s,l,i.depth)})},handlerKey(l){ze(l,13)===!0&&i.handler(l)}};t.__qclosepopup=i,t.addEventListener("click",i.handler),t.addEventListener("keyup",i.handlerKey)},updated(t,{value:o,oldValue:i}){o!==i&&(t.__qclosepopup.depth=we(o))},beforeUnmount(t){const o=t.__qclosepopup;t.removeEventListener("click",o.handler),t.removeEventListener("keyup",o.handlerKey),delete t.__qclosepopup}});const Dt=te({name:"schedDropBtn",props:{optionLabel:String,disableBtn:Boolean,daOptions:Array},emits:["doReload","chooseOption"],methods:{onClicked(){this.$emit("doReload")},onSelect(t){this.$emit("chooseOption",t)}}});function Tt(t,o,i,l,s,n){return T(),L(Ot,{split:"",color:"",elevated:"","disable-main-btn":t.disableBtn,label:t.optionLabel,onClick:t.onClicked,"no-caps":""},{default:P(()=>[w(Ke,null,{default:P(()=>[(T(!0),B(H,null,ue(t.daOptions,r=>Ue((T(),L(Ye,{key:r,clickable:"",onClick:d=>t.onSelect(r)},{default:P(()=>[w(Xe,null,{default:P(()=>[w(Ze,null,{default:P(()=>[U(V(r),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"])),[[Rt]])),128))]),_:1})]),_:1},8,["disable-main-btn","label","onClick"])}var Pt=Q(Dt,[["render",Tt],["__scopeId","data-v-86c49dde"]]);const Nt=G("div",{class:"q-space"});var Ae=ne({name:"QSpace",setup(){return()=>Nt}});const At={name:"adHocEvent",props:{mainGoals:Array},data(){return{aTitle:"",daP:null,own:"misc",duration:15}},emits:["saveEvent","doCancel"],computed:{pGoals:{get(){return this.mainGoals}},evName:{get(){return this.aTitle},set(t){this.aTitle=t}},labely:{get(){return this.own=="misc"?this.daP==null?"Defaut Misc. PGoal":"Of Parent Goal":"Select Parent Goal"}}},methods:{goalyColor(t){return this.daP==null?"":t=="c"?"bg-"+this.daP.bgcolor:this.daP.bgcolor},onClicked(){this.$emit("saveEvent",this.aTitle,this.daP,this.own,this.duration),this.own="own",this.daP=null,this.duration=15}}},kt=t=>(re("data-v-d5b4b8b4"),t=t(),ae(),t),Bt=kt(()=>A("div",{class:"text-h3"},"Ad hoc Event",-1)),Mt={class:"q-ml-md"},Gt={class:"radio-select"},_t={key:0},Vt={class:"q-mx-md",style:{"text-align":"center"}};function It(t,o,i,l,s,n){return T(),B(H,null,[Bt,w(Ae),w(ee),A("div",Mt,[w($e,{modelValue:n.evName,"onUpdate:modelValue":o[0]||(o[0]=r=>n.evName=r),filled:"",label:"A Goal","lazy-rules":"","item-aligned":"",rules:[r=>r&&r.length>0||"Please type a goal"]},null,8,["modelValue","rules"]),A("div",Gt,[w(Se,{class:"q-mx-md",modelValue:s.own,"onUpdate:modelValue":o[1]||(o[1]=r=>s.own=r),val:"misc",label:"Misc"},null,8,["modelValue"]),w(Se,{class:"q-mx-md",modelValue:s.own,"onUpdate:modelValue":o[2]||(o[2]=r=>s.own=r),val:"self",label:"By Self"},null,8,["modelValue"])]),n.pGoals?(T(),B("div",_t,[w(Ne,{class:"q-gutter-md",modelValue:s.daP,"onUpdate:modelValue":o[3]||(o[3]=r=>s.daP=r),options:n.pGoals,"option-value":"id","option-label":"title",disable:s.own!="misc",label:n.labely,popupContentClass:"q-px-md","options-selected-class":n.goalyColor("c"),"label-color":n.goalyColor("l")},null,8,["modelValue","options","disable","label","options-selected-class","label-color"])])):_("",!0),A("div",null,[U(" duration "),w(et,{min:15,max:120,thickness:.22,step:5,modelValue:s.duration,"onUpdate:modelValue":o[4]||(o[4]=r=>s.duration=r),"show-value":"",label:"Duration",size:"75px",color:"teal","track-color":"grey-3",class:"q-ma-md"},null,8,["thickness","modelValue"])])]),A("div",Vt,[w(M,{flat:"",align:"center",label:"Cancel",color:"primary",onClick:o[5]||(o[5]=r=>t.$emit("doCancel"))}),w(M,{elevated:"",color:"primary",onClick:n.onClicked},{default:P(()=>[U(" Add ")]),_:1},8,["onClick"])])],64)}var Lt=Q(At,[["render",It],["__scopeId","data-v-d5b4b8b4"]]);const xt={name:"selectEvent",props:{canBeScheduled:Array},data(){return{doForce:!1,toAddE:null}},emits:["onPickEvent","doCancel"],computed:{allScheduled:{get(){return this.canBeScheduled}},toAdd:{get(){return this.toAddE},set(t){this.toAddE=t}}},methods:{onAddClicked(){this.$emit("onPickEvent",this.toAdd,this.doForce),this.doForce=!1,this.toAdd=null},goalyColor(t){var o,i;return this.toAdd==null?"":t=="c"?"bg-"+((o=this.toAdd)==null?void 0:o.color):(i=this.toAdd)==null?void 0:i.color},labely(){var t;return this.toAdd==null?"Sub Goal":"Of: "+((t=this.toAdd)==null?void 0:t.pg)}}},ke=t=>(re("data-v-463b8fae"),t=t(),ae(),t),Ft={class:"q-pa-md row items-start"},qt=ke(()=>A("div",{class:"text-h3"},"Select event",-1)),Jt={class:"q-mx-md event-select"},Wt=ke(()=>A("div",{class:"q-mx-md",style:{"text-align":"center"}}," Add ",-1));function Ht(t,o,i,l,s,n){return T(),B("div",Ft,[w(le,null,{default:P(()=>[w(Te,null,{default:P(()=>[qt]),_:1}),w(ee),A("div",Jt,[w(Ne,{modelValue:n.toAdd,"onUpdate:modelValue":o[0]||(o[0]=r=>n.toAdd=r),options:n.allScheduled,class:"q-gutter-md","option-value":"id","option-label":"title","item-aligned":"",popupContentClass:"q-px-md",label:n.labely(),"options-selected-class":n.goalyColor("c"),"label-color":n.goalyColor("l")},null,8,["modelValue","options","label","options-selected-class","label-color"])]),w(fe,{align:"center"},{default:P(()=>[w(Qe,{dense:"",modelValue:s.doForce,"onUpdate:modelValue":o[1]||(o[1]=r=>s.doForce=r),label:"Force",color:"teal",class:"q-pa-sm"},null,8,["modelValue"])]),_:1}),w(fe,{align:"center"},{default:P(()=>[w(M,{flat:"",label:"Cancel",color:"primary",onClick:o[2]||(o[2]=r=>t.$emit("doCancel"))}),w(M,{elevated:"",color:"primary",onClick:n.onAddClicked},{default:P(()=>[Wt]),_:1},8,["onClick"])]),_:1})]),_:1})])}var zt=Q(xt,[["render",Ht],["__scopeId","data-v-463b8fae"]]);const Ut=te({name:"schedDialog",components:{adHocEvent:Lt,selectEvent:zt},props:{parentGoals:Array,canBeScheduled:Array},data(){return{showPickDialog:$(!1),showAdHocDialog:$(!1),show:$(!0)}},emits:["onAddNewEvent","onPickEvent","euhHidin"],computed:{showDefaultOption:{get(){return this.show},set(t){this.show=t}},showPickyDialog:{get(){return this.showPickDialog},set(t){this.showPickDialog=t}},showAddyDialog:{get(){return this.showAdHocDialog},set(t){this.showAdHocDialog=t}},allScheduled:{get(){return this.canBeScheduled.forEach(t=>{let o=this.parentGoals.find(i=>i.id==t.parentGoal);o?t.color=o.bgcolor:t.color="",t.pg=o==null?void 0:o.title.trim()}),this.canBeScheduled}}},methods:{onAddClicked(t,o){this.$emit("onPickEvent",t,o),this.reset()},addNewEvent(t,o,i,l){this.$emit("onAddNewEvent",t,o,i,l),this.reset()},onChooseExisting(){this.showPickyDialog=!this.showPickyDialog},onChooseAdHoc(){this.showAddyDialog=!this.showAddyDialog},gonHide(){this.$emit("euhHidin")},onCancelBtn(){let t=this.showPickyDialog;this.showAddyDialog,t?this.showPickyDialog=!this.showPickyDialog:this.showAddyDialog=!this.showAddyDialog},reset(){this.showAddyDialog=!1,this.showPickyDialog=!1}}}),Qt=t=>(re("data-v-1ea3ab32"),t=t(),ae(),t),jt={class:"q-ma-md event-select"},Kt={class:"q-ma-md event-select"},Yt=Qt(()=>A("div",{class:"text-h6"},"Ad hoc or Existing event",-1));function Xt(t,o,i,l,s,n){const r=q("select-event"),d=q("ad-hoc-event");return T(),L(je,{modelValue:t.showDefaultOption,"onUpdate:modelValue":o[0]||(o[0]=c=>t.showDefaultOption=c),"transition-show":"rotate","transition-hide":"rotate","no-esc-dismiss":"",onBeforeHide:t.gonHide},{default:P(()=>[t.showPickyDialog?(T(),L(le,{key:0},{default:P(()=>[A("div",jt,[w(r,{canBeScheduled:t.allScheduled,onOnPickEvent:t.onAddClicked,onDoCancel:t.onCancelBtn},null,8,["canBeScheduled","onOnPickEvent","onDoCancel"])])]),_:1})):t.showAddyDialog?(T(),L(le,{key:1},{default:P(()=>[A("div",Kt,[w(d,{mainGoals:t.parentGoals,onSaveEvent:t.addNewEvent,onDoCancel:t.onCancelBtn},null,8,["mainGoals","onSaveEvent","onDoCancel"]),w(Ae)])]),_:1})):(T(),L(le,{key:2},{default:P(()=>[w(Te,null,{default:P(()=>[Yt]),_:1}),w(fe,{align:"center"},{default:P(()=>[w(M,{flat:"",label:"Add hoc",color:"primary",onClick:t.onChooseAdHoc},null,8,["onClick"]),w(M,{flat:"",label:"Existing",color:"primary",onClick:t.onChooseExisting},null,8,["onClick"])]),_:1})]),_:1}))]),_:1},8,["modelValue","onBeforeHide"])}var Zt=Q(Ut,[["render",Xt],["__scopeId","data-v-1ea3ab32"]]);function Ce(t){return t.button===0}const eo=te({name:"dayCalendar",components:{NavigationBar:nt,QCalendarDay:dt,addGoalForm:tt,GoalyEnd:St,schedBtn:wt,schedDropBtn:Pt,schedDialog:Zt},data(){return $(null),$(null),$(null),$(null),$(null),ct(),{currentDate:$(z()),scoreOptions:$([1,2,3,4,5]),chosenScore:$(null),chosenPrio:$(null),scheduledEvents:[],dailyScheduled:$(new Map),endTimesSet:$(new Set),startTimesSet:$(new Set),disablePrioBtn:$(!0),disableScoreBtn:$(!0),calendar:$(null),store:ht(),anchorTimestamp:$(null),otherTimestamp:$(null),mouseDown:$(!1),mobile:$(!0),timeStartPos:$(0),showGoalForm:$(!1),addEventDialog:$(!1),disabledScoreEvts:$({}),hasStarted:$({}),disableSaveSchedule:$(!0),showReloadBtn:$(!1),showLoadDefaults:$(!0),showScoreBtn:$(!1),showPrio:$(!1),showClearBtn:$(!1),treeGoals:$([]),expanded:$([]),parentGs:$(null)}},beforeMount(){this.mobile=ut(),this.resetGoalEvts(!0),this.constructTree()},beforeUnmount(){clearInterval(this.intervalId)},mounted(){this.adjustCurrentTime(),this.intervalId=setInterval(()=>{this.adjustCurrentTime()},6e4)},computed:{chosenScoreLabel(){return this.chosenScore==null?"By Score":`Score >= ${this.chosenScore}`},chosenPrioLabel(){return this.chosenPrio==null?"By Priority":`Prio = ${this.chosenPrio}`},style(){return{top:this.timeStartPos+"px"}},showForm(){return this.showGoalForm||this.constructTree(),this.showGoalForm},doDisableSaveSchedule(){return this.disableSaveSchedule},hasEventsForDate(){return this.store.hasEventsForDate(this.currentDate)},eventsMap(){const t={};return this.scheduledEvents.forEach(o=>{if(t[o.date]||(t[o.date]=[]),t[o.date].push(o),o.days){console.log(`eventsMap multiple days? event for ${o.date}`,o.days);let i=he(o.date),l=o.days;do i=k(i,{day:1}),t[i.date]||(t[i.date]=[]),t[i.date].push(o);while(--l>0)}}),t},canbeScheduled(){let t=this.deepCopy(this.storedEvents),o=t.filter(l=>!this.scheduledEvents.find(s=>s.id==l.id)),i=(l,s)=>{if(l.parentGoal>s.parentGoal)return 1;if(l.parentGoal==s.parentGoal)return 0;if(l.parentGoal<s.parentGoal)return-1};return o.length==0?(t.sort(i),t):(o.sort(i),o)},storedEvents(){return this.store.getSubGoals},storedAlternatives(){return this.store.fetchAlternativeEvts()},startEndTimes(){const t=[];return this.anchorDayTimeIdentifier!==!1&&this.otherDayTimeIdentifier!==!1&&(this.anchorDayTimeIdentifier<=this.otherDayTimeIdentifier?t.push(j(this.anchorTimestamp),j(this.otherTimestamp)):t.push(j(this.otherTimestamp),j(this.anchorTimestamp))),t},anchorDayTimeIdentifier(){return this.anchorTimestamp!==null?ce(this.anchorTimestamp):!1},otherDayTimeIdentifier(){return this.otherTimestamp!==null?ce(this.otherTimestamp):!1},storedCompPG(){return this.storedPG()}},methods:{parentGoalsMap(){const t=new Map;let o=this.storedPG();return o?(o.forEach(i=>{t.set(i.id,i)}),t):(console.log("parentGoalsMap is empty or null",o),t)},storedPG(){return this.parentGs==this.store.getMainGoals?(console.log("storedPG SAME!!!!"),this.parentGs):(this.parentGs=this.store.getMainGoals,this.parentGs)},constructTree(){this.treeGoals=this.store.fetchGoalsTree()},badgeClasses(t,o){return it(t,o)},badgeStyles(t,o,i=void 0,l=void 0){return st(t,o,i,l)},classyColor(t){return`row items-center ${t.isChildren?"text-":"text-white bg-"}${t.color} `},getTimeNumber(t){return t!==null?ce(t):!1},getTimeyNumber(t){return t!==null?rt(t):!1},labelGoals(){let t=0;for(const o in this.treeGoals)t+=this.treeGoals[o].children.length;return`Scheduled => ${this.scheduledEvents.length} out of ${t}`},getDateEvents(t){const o=this.eventsMap[t]||[];if(o.length===1)o[0].side="full";else if(o.length===2){const i=k(I(o[0].date),{minute:W(o[0].time)}),l=k(i,{minute:o[0].duration}),s=k(I(o[1].date),{minute:W(o[1].time)}),n=k(s,{minute:o[1].duration});ie(s,i,l,!0)||ie(n,i,l,!0)?(console.log("getDateEvents...LENGTH==2..LEFT/RIGHT 'TWIX"),o[0].side="left",o[1].side="right"):(o[0].side="full",o[1].side="full")}return o},hasDate(t){return this.currentDate?t.find(o=>o.date===this.currentDate):!1},getEventsForDate(t){return this.store.getEventsForDate(t)},isViewingToday(){return z()==this.currentDate},isViewingPast(){let t=z();if(this.currentDate&&this.currentDate==t)return!1;let o=ye(I(t));return!(ye(I(this.currentDate))>=o)},adjustCurrentTime(){const t=F(new Date);if(this.currentDate!==t.date){this.timeStartPos=-10,this.currentTime="";return}this.currentDate=t.date,this.currentTime=t.time,this.timeStartPos=this.$refs.calendar.timeStartPos(t.time,!1);let o=this.endTimesSet&&this.endTimesSet.has(t.time),i=this.startTimesSet&&this.startTimesSet.has(t.time);(o||i)&&this.doEnableEndNowBtn(this.currentTime,o,i)},setGoalsPrio(){let t=this.store.fetchAllPrio();return!t.size>0?(console.log("ERROR...no Priority goals?",t),[]):Array.from(t.values())},resetGoalEvts(t=!1){if(this.scheduledEvents==this.allEvents&&console.log("resetGoalEvts SAME"),t){let o=this.deepCopy(this.storedEvents);return this.allEvents=[...o],o}return this.allEvents},getLocalEvt(t){for(let o=0;o<this.allEvents.length;o++)if(this.allEvents[o].id===t)return this.allEvents[o];return null},getScheduledEvent(t){for(let o=0;o<this.scheduledEvents.length;o++)if(this.scheduledEvents[o].id==t)return this.scheduledEvents[o];return null},doSaveEvtProp(t,o=null,i=null){this.store.saveSubProp(t,o,i)},evtStartedOrPassed(t){const o=[];let i=k(t,{minute:0}),l=this.getTimeNumber(i);return this.dailyScheduled.forEach((s,n,r)=>{let d=this.getTimeNumber(s.start),c=this.getTimeNumber(s.end);if(d!==!1&&c!==!1){let a=l>=d&&l<c,u=l>=c;(a||u)&&o.push(n),a&&(this.hasStarted[n]=!0),this.enableEvtScoreEdit(n,u)}else console.log(`ERROR?!:${n} has no start/end?.`,s)}),o},allowScoreEdit(t){this.dailyScheduled.forEach((o,i,l)=>{this.disabledScoreEvts[i]=!t})},enableEvtScoreEdit(t,o){this.disabledScoreEvts[t]=!o},canEnableEditScore(t,o){const i=F(new Date);K(i,o)>0?this.disabledScoreEvts[t]=!0:(this.disabledScoreEvts[t]=!1,this.hasStarted[t]=!1)},parseScore(t){const o=t.split(/on/);return o.length!=2?(console.log(`parseScore error?${t}`,o),-1):o[1]-o[0]},doEnableEndNowBtn(t,o,i){for(let[l,s]of this.dailyScheduled)(o?s.end.time:s.start.time)==t&&(this.hasStarted[l]=!o,this.disabledScoreEvts[l]=!o)},enableEndNowBtn(t,o,i){const l=F(new Date);ie(l,o,i,!0)?this.hasStarted[t]=!0:this.hasStarted[t]=!1},retrieveSameStart(t){let o=[];for(let[i,l]of this.dailyScheduled)l.start.time==t&&o.push(i);return o},confirmTimeChange(t,o,i,l,s,n,r=null){this.$q.dialog({title:t,message:o,cancel:!1,ok:i,options:{type:"radio",model:"",items:[{label:i+" and "+l,value:"ok"},{label:l,value:"alt"}]},class:"overflow-wrap: break-word;",style:""}).onOk(d=>{if(d==""){console.log("confirmTimeChange onOk with no selection >>onDismiss"),this.doNotify("No selection made...Defaulting","positive","bottom"),r?r():console.log("confirmTimeChange:: No Dismiss func to execute!");return}return s(d)}).onCancel(()=>{console.log("confirmTimeChange>> executeCancel..."),n()})},confirmAction(t,o,i,l,s=null){this.$q.dialog({title:"Warning",cancel:!0,ok:o,message:t}).onOk(()=>{i()}).onCancel(()=>{l()}).onDismiss(()=>{if(s){console.log("confirmAction with dismiss!!"),s();return}})},radioChoiceDialog(t,o,i,l,s=null,n=null,r=null){this.$q.dialog({title:t,cancel:!!n,persistent:!0,message:o,options:{type:"radio",model:l,items:i}}).onOk(d=>{s&&(d==""?this.radioChoiceDialog(t,o,i,l,s,n,r):s(d))}).onCancel(()=>{n&&n()}).onDismiss(()=>{r&&r()})},checkBoxDialog(t,o,i,l,s=null,n=null,r=null){let d=i.length,c=d>2?2:d;this.$q.dialog({title:t,message:o,options:{type:"checkbox",model:[],isValid:a=>a.length>0&&a.length==c,items:i},cancel:!0,persistent:!0}).onOk(a=>{s(a)}).onCancel(()=>{n&&n()}).onDismiss(()=>{r&&r()})},doNotify(t,o=void 0,i="top"){this.$q.notify({color:o!==void 0?o:"negative",position:i,message:t,icon:o==null?"report_problem":"thumb_up"})},updateButtons(t=null,o=null,i=null){this.showLoadDefaults=t!=null?t:this.showLoadDefaults,this.showScoreBtn=o!=null?o:this.showScoreBtn,this.showPrio=i!=null?i:this.showPrio},doRemove(t){let o=this.scheduledEvents.length;if(!t){console.log("ERROR doRemove, NO item to delete?!?",t);return}let i=0;for(i;i<o;i++)if(this.scheduledEvents[i].id==t.id){this.scheduledEvents.splice(i,1);let l=null;if(this.dailyScheduled.has(t.id)?(l=this.dailyScheduled.get(t.id),this.dailyScheduled.delete(t.id)):console.log("doRemove ::> dailyScheduled has no such item?@? ERROR",t),l){let s=this.startTimesSet.delete(l.start.time),n=this.endTimesSet.delete(l.end.time);(!s||!n)&&console.log(`doRemove ::> ERROR? scheduleSets has no such item?@? start:${s}...end:${n}`,l,t.id+" "+(t==null?void 0:t.title.trim())+" "+(t==null?void 0:t.details))}break}},chooseAlternatives(t){let o=this.storedAlternatives,i=F(new Date),l=t.time,s=i.date;const n=u=>{let S=this.parentGoalsMap().get(u.parentGoal);return{label:`Of '${S==null?void 0:S.title.trim()}' "${u.title.trim()}" (${u.score}) for ${u==null?void 0:u.duration} mins`,value:u.id}},r=u=>u.filter(S=>!this.scheduledEvents.find(E=>E.id==S.id)),d=u=>{let S=k(I(s),{day:0}),E=k(I(S.date),{day:1}),y=this.getEventsForDate(S.date),b={},D=null;y?b=y:console.log("addInFutur EMPTY for >>...",S.date),u.forEach(R=>{if(D=this.getLocalEvt(R),b[R]){console.log("addInFutur...ALREADY PRESENT",R,S.date,D==null?void 0:D.title.trim()),this.doNotify(`Alternative '${D==null?void 0:D.title.trim()}' already present on ${S.date}. Moving it to next day`,"warning");let C=this.getEventsForDate(E.date);if(C)if(!C[R])C[R]={duration:D.duration,time:l};else{console.log("addInFutur...STILL PRESENT in next day:"+E.date,D.title.trim()),this.doNotify(`Alternative '${D==null?void 0:D.title.trim()}' also present on ${E.date}....Not added :(`);return}else console.log("addInFutur next day EMPTY for >>...",E.date),C={},C[R]={duration:D.duration,time:l};this.store.saveDailySchedule(E.date,C),this.doNotify(`Saving ${D.title} in ${E.date}`,"positive","bottom")}else b[R]={duration:D.duration,time:l}}),console.log("addInFutur>>>",S.date,JSON.parse(JSON.stringify(b))),this.store.saveDailySchedule(S.date,b)},c=u=>{this.doRemove(t);let S=o.find(D=>D.id==u);console.log("remReplace...Add at:",l,S.title,"usually at:"+S.time),S=this.addPropsEventsTo(this.currentDate,[{...S,time:l}]);let E=this.overlapCheckEvtsAdd(S),y=Object.keys(E).length;if(y>0)return console.log(`chooseAlternatives::removeReplace:: OVERLAPS again from ${S.length} overlaps =${y}`,S,E),this.fixyOverlaps(E);let b=this.updateCurrentSchedule();console.log("chooseAlternatives::remReplace:SAMESTART",b),this.doSaveSchedule(),this.doNotify(`Added Alt replacement '${S[0].title}' at ${l}`,"positive","bottom")},a=u=>{this.doNotify(u)};if(o=r(o),o.length==0){a("Removing not allowed! Alternatives already present!");return}this.checkBoxDialog("Gotta pick alternatives","Select the first Evt to replace the removed and an Extra evt for later day (today)!",o.map(n),o[0].id,function(u){console.log("chooseAlternatives::opt",u),c(u.shift()),u.length>0?d(u):(console.log("chooseAlternatives::onOk...nothing to add?!?",o.length,u.length,o.length-u.length),a("No Alternative scheduled later :("))},function(){console.log("chooseAlternatives::onCancel")})},removeEvtInSchedule(t,o=null){if(this.isViewingPast()){if(t.duration<30){this.doNotify("Removing from the past too smoll smoll is no no!");return}this.chooseAlternatives(t);return}let i=()=>{this.doRemove(t),this.disableSaveSchedule=!1,this.showReloadBtn=this.hasEventsForDate};if(!this.isViewingToday()){i(),console.log("Removed future evt");return}let l=`Remove "${t.title}" from schedule?`;this.confirmAction(l,"Remove",i,function(){console.log("Cancelled remove")})},updateCurrentSchedule(){const t=new Map;let o=new Set,i=new Set,l=new Set;return this.scheduledEvents.length<1?(this.dailyScheduled=t,this.endTimesSet=o,this.startTimesSet=l,i):(this.scheduledEvents.forEach(s=>{let n=k(I(s.date),{minute:W(s.time)}),r=k(n,{minute:s.duration});t.set(s.id,{start:n,end:r,on:s.date,originalAt:s.time,for:s.duration,score:s.score}),o.add(r.time),l.has(n.time)?i.add({at:n.time,id:s.id}):l.add(n.time),(this.currentDate==z()||!this.isViewingPast())&&(this.canEnableEditScore(s.id,r),this.enableEndNowBtn(s.id,n,r))}),this.dailyScheduled=t,this.endTimesSet=o,this.startTimesSet=l,i)},addEvtPropsIntoSchedule(t){let o=this.addEvtInScheduleMaps(t);if(!o){console.log(`addEvtPropsIntoSchedule:${t.title}..ERROR...NOT added?!?`,o);return}this.scheduledEvents.push(t)},addEvtInScheduleMaps(t){if(this.dailyScheduled.has(t.id))return console.log("addEvtInScheduleMaps with evt already added...ERROR?",t),!1;let o=k(I(t.date),{minute:W(t.time)}),i=k(o,{minute:t.duration});return this.dailyScheduled.set(t.id,{on:t.date,originalAt:t.time,for:t.duration,start:o,end:i,score:t.score}),this.endTimesSet.add(i.time),this.startTimesSet.add(o.time),(this.currentDate==z()||!this.isViewingPast())&&(this.canEnableEditScore(t.id,i),this.enableEndNowBtn(t.id,o,i)),!0},updateEvtInScheduleMaps(t,o){if(this.dailyScheduled.has(t)){let i=this.dailyScheduled.get(t),l=i.for,s=i.originalAt,n=i.start,r=i.end,d=k(o,{minute:l}),c=i.score;return this.dailyScheduled.set(t,{on:o.date,originalAt:s,for:l,start:o,end:d,score:c}),this.endTimesSet.delete(r.time)?this.endTimesSet.add(d.time):console.log("updateEvtInScheduleMaps-endTimesSet NOT FOUND?!?"),this.startTimesSet.delete(n.time)?this.startTimesSet.add(o.time):console.log("updateEvtInScheduleMaps-startTimesSet NOT FOUND?!?",t,o),(this.currentDate==z()||!this.isViewingPast())&&(this.canEnableEditScore(t,d),this.enableEndNowBtn(t,o,d)),!0}else return console.log("updateEvtInScheduleMaps--euh not found?ERROR?",t,o),!1},evtIsOverlappingTimes(t,o,i,l){let s=this.getTimeyNumber(t),n=this.getTimeyNumber(o),r=this.getTimeyNumber(i),d=this.getTimeyNumber(l);if(s===!1||r===!1||n===!1||d===!1)return console.log("ERROR... evtIsOverlappingTimes error",s,n,r,d),!1;let c=!1;return s>r&&s<=d&&(c="bas"),n>r&&n<=d&&(c="haut"),(r>=s&&n>=d||s>r&&n<d)&&(c="surrounding"),c},hasOverlappingEvent(t,o,i){const l=[];let s=o,n=k(s,{minute:i});return this.dailyScheduled.forEach((r,d,c)=>{if(d!=t){let a=this.evtIsOverlappingTimes(s,n,r.start,r.end);a&&l.push({target:t,targetStart:s,direction:a,inConflict:d})}}),l},overlapCheckEvtsAdd(t){let o={};for(let i=0;i<t.length;i++){let l=t[i],s=k(I(l.date),{minute:W(l.time)}),n=this.hasOverlappingEvent(l.id,s,l.duration);if(n.length>0){let r=0;do{let d=n[r];o[d.inConflict]||(o[d.inConflict]=[]),o[d.inConflict].push(d),r>0&&(console.log("WOAH WOAH, multiple overlaps with same obj!"+r,l,n),d.inConflict in o&&(console.log("WOAH deleting inConflict",d.inConflict),delete o[d.inConflict]),n[r-1].inConflict in o&&(console.log("WOAH deleting PREV inConflict",n[r-1].inConflict),delete o[n[r-1].inConflict]),o[l.id]?(o[l.id].push(d),console.log("WOAH obj.id already present?",l.id)):o[l.id]=[d],o[l.id].unshift(n[r-1]),o.withID=!0)}while(++r<n.length)}else this.addEvtPropsIntoSchedule(l)}return o},updatedEvtDetails(t){let o=l=>{if(!l)return"";let s=l.split(":");return parseInt(s[0])>=12?l+"PM":l+"AM"},i=this.parentGoalsMap().get(t.parentGoal);return i?(t.bgcolor=i.bgcolor,t.details=`Of '${i.title.trim()}' :: ${o(t==null?void 0:t.time)} -> ${t==null?void 0:t.duration}min -- ${t!=null&&t.inDefaults?"Dft:":":"}${t!=null&&t.canMove?":Mv:":":"}${t!=null&&t.isAlternative?":Alt":":"}`):(console.log("ERROR?!? no parent goal for:",JSON.parse(JSON.stringify(t))),t.bgcolor="grey",t.title=`Ad-hoc:${t==null?void 0:t.title} (${this.parseScore(t==null?void 0:t.score)})`,t.details=`${t==null?void 0:t.title}: ${o(t==null?void 0:t.time)} -- ${t==null?void 0:t.duration}min`),t},addPropsEventsTo(t,o){if(!o)return this.doNotify("addPropsEventsTo BUT no goals to schedule..."),[];let i=[];return o.forEach(l=>{let s=this.getLocalEvt(l.id);s?(s.duration=l.duration,s.time=l.time,s.date=t,i.push(this.updatedEvtDetails(s))):console.log("ERROR in addPropsEventsTo...Evt:not present!",l)}),i},changeEvtTime(t,o,i,l=!1){let s=this.getScheduledEvent(t),n=null;if(s)n=s.time;else if(console.log(`changeEventTime::ADDIN ${t} with doAdd:${l} and skip:${i}`,o.time),l){if(s=this.getLocalEvt(t),!s)return console.log("ERROR in changeEvtTime STILL NOT found?!?",e,t,o,l),!1;n=s.time}else return console.log("ERROR in changeEvtTime not found, not adding!",t,o,l),!1;let r=(a,u)=>{if(console.log(`changeEventTime::DoUpdateEvt:: ${u?"DOADD":"NOAdd"} (${a.id})'${a.title.trim()}' from ${n} to ${o.time} 
        
canMove:${a==null?void 0:a.canMove}, inDef:${a==null?void 0:a.inDefaults},skip? ${i}`),u){let S=this.addPropsEventsTo(this.currentDate,[{...a,time:o.time}]);this.addEvtPropsIntoSchedule(S[0]),this.showDefBtn(this.isViewingPast());return}this.updateEvtInScheduleMaps(t,o),a.time=o.time,this.updatedEvtDetails(a)},d=(a,u)=>{if(console.log(`changeEventTime::KeepAsIs (${t})'${a.title.trim()}' to ${n} with ${u?"DOADD":"NOAdd"}`,o.time,"canMove:"+(a==null?void 0:a.canMove),"inDef:"+(a==null?void 0:a.inDefaults),"skip?"+i),u){if(n==""){this.doNotify(`'${a.title.trim()}' have unset default time! Not adding...`);return}let S=this.addPropsEventsTo(this.currentDate,[{...a,time:n}]);console.log("KeepAsIs::doAddy afterProps",JSON.parse(JSON.stringify(S))),this.addEvtPropsIntoSchedule(S[0]),this.showDefBtn(this.isViewingPast());return}else this.updateEvtInScheduleMaps(t,n),a.time=n,this.updatedEvtDetails(a),console.log("changeEventTime::keepAsIs:: !NOT! doAdd afterProps..",t,a.id)},c=(a,u,S)=>(console.log(`changeEvtTime::userChoice ${a} >> ${u.id} to ${o.time}...`),a=="ok"&&this.doSaveEvtProp(t,o.time,null),r(u,S),a);if((s==null?void 0:s.inDefaults)||!(s!=null&&s.canMove))if(i)r(s,l);else{if(n==o.time){console.log(`SAME TIME (${s.id})'${s.title.trim()}'..ASKIN with doAdd? ${l} for updateEvt...`,n,o.time),l&&r(s,l);return}let a=(o==null?void 0:o.hour)>=12?"PM":"AM",u=n.split(":"),S=parseInt(u[0])>=12?"PM":"AM",y=[`Evt "${s.title.trim()}" by default at ${n}${S}.
\u2800
`,`Also Change default time to ${o.time}${a}? 
\u2800
`,`Cancel or Dismiss to undo!
\u2800
`,`
\u2800
`,`No selection to schedule at default ${n}${S}`].join(`
`);this.confirmTimeChange("Default Time Change!",y,"Change",`Temp.${l?"Add":"Move"}`,function(b){c(b,s,l)},function(){console.log(`changeEventTime::onCancel...>doing nothing for ${s.id})'${s.title.trim()}'`,l)},function(){d(s,l)})}else if(s!=null&&s.canMove)r(s,l);else{if(n==o.time){console.log(`SAME TIME! BEWARE~~ (${s.id})'${s.title.trim()}'...doAdd?${l}..skipAsk?:${i}..returning!!`,n);return}let a=(o==null?void 0:o.hour)>=12?"PM":"AM",u=n.split(":"),S=parseInt(u[0])>=12?"PM":"AM",y=[`Evt "${s.title.trim()}" Aint move from ${n}${S}.
\u2800
`,`
\u2800
`,`Also Move time to ${o.time}${a}? 
\u2800
`,`
\u2800
`,`Cancel or Dismiss to undo!
\u2800
`,`
\u2800
`,`No selection to add at default ${n}${S}`].join(`
`);this.confirmTimeChange("Moving Evt's time",y,"Change",`Temp.${l?"Add":"Move"}`,function(b){c(b,s,l)},function(){console.log(`changeEventTime::onCancel..>doing nothing for ${s.id})'${s.title.trim()}'`,l)},function(){console.log(`changeEventTime::onDismiss..keep as is>> ${s.id})'${s.title.trim()}'`,l),d(s,l)})}},recurChangeTime(t,o,i,l=!1,s=!1){let n=this.dailyScheduled.get(t);if(n){let r=W(n.start.time)-W(i.time),d=`${r>0?"DOWN":"UP"}`,c=null;if(r>=0){c=k(i,{minute:parseInt(o.duration)+10});let S=k(i,{minute:parseInt(n.for)+10});console.log(`recurChangeTime::${t}...FORWARD ${d} for ${r} due to evt:${o.id} at ${i.time} 
        
 doAdd?:${s}, skipAsk:${l} > New>`,JSON.parse(JSON.stringify(c.time)),"alt:",S.time);let E=K(S,c);E>0&&(Math.floor(E/1e3/60)<=r?console.log(`recurChangeTime::${t}....with duration:${n.for} vs evtDura:${o.duration}...NOT using alternative!!`):(console.log(`recurChangeTime::DIFFY>>${E}...gonna use Alternative`,S.time),c=S))}else{c=k(i,{minute:-(parseInt(n.for)+10)});let S=k(i,{minute:-(parseInt(o.duration)+10)}),E=K(S,c);console.log(`recurChangeTime::${t}...BACKWARD ${d} for ${r} due to evt:${o.id} at ${i.time}
        
 doAdd?:${s}, skipAsk:${l} > New`,c.time,"alt:"+S.time,"diffy="+E)}let a=this.hasOverlappingEvent(t,c,n.for);if(a.length>0){let S=0,E=a.length,y=this.getScheduledEvent(t);y?this.doNotify(`Cascading time change while adding '${y==null?void 0:y.title.trim()}' due to "${o.title.trim()}"`,"warning","top"):console.log(`ERROR::recurChangeTime ${t} not found`);do{if(console.log(`WARNING CASCADING timeChange ${t}-${y==null?void 0:y.title} at: ${c.time} 'gon recurChangeTime::
          OLDie doAdd?:${s}, OLDie skipAsk:${l}..gon be true 
 now at: ${n.start.time}  till ${n.end.time}`,a[S]),a[S].inConflict==o.id){console.log(`EUUUH...::recurChangeTime::self overlap?!?${t} ...breaking!`,a[S]);break}this.scrollToTime(c),this.recurChangeTime(a[S].inConflict,y,c,!0)}while(++S<E)}this.changeEvtTime(t,c,l),console.log(`recurChangeTime::OVERLAPPED: ${t} ${d} to ${c.time} ...skipAsk:${l} >> doAdd:${s}`);let u=i;console.log(`recurChangeTime::TARGET:(${o.id})${o==null?void 0:o.title.trim()} going ${d} skipAsk:${l} >> doAdd:${s} to time>> ${u.time}`),this.changeEvtTime(o.id,u,l,s)}else console.log("ERROR..ERROR recurChangeTime:: overlapped event not found!",t)},fixyOverlaps(t,o=null,i=""){var C;const l=(g,f)=>{if(g!=null&&g.parentGoal){let h=this.parentGoalsMap().get(g.parentGoal);return f?`Of '${h==null?void 0:h.title.trim()}' with Prio(${h==null?void 0:h.priority})`:`Of '${h==null?void 0:h.title.trim()}'`}return console.log("findPrio..ERROR no PARENT found?",g),""},s=(g,f)=>{switch(f){case"score":return`${l(g,!1)} > "${g.title.trim()}" with Score:: ${g.score} = ${this.parseScore(g.score)}`;case"prio":return`"${g.title.trim()}" ${l(g,!0)}`;default:return`"${g.title.trim()}" ${l(g,!0)} && Score:: ${g.score}`}},n=g=>{this.doNotify(g,"positive","top")},r=g=>{console.log(`fixyOverlaps::doRem ${g.id}:${g.title}`),this.doRemove(g)},d=(g,f,h)=>{if(console.log(`fixyOverlaps::removeReplace >> replacing>> ${g.id}) '${g.title.trim()}' WITH ${f.id}) ${f.title.trim()}`,h),f=this.addPropsEventsTo(h.targetStart.date,[{...f,time:h.targetStart.time}]),o){if(console.log("fixyOverlaps::removeReplace...OVERRIDE from>>"+i),i=="onDrop"){r(g);return}console.log("fixyOverlaps::removeReplace....OVERRIDE updating..."+i),this.updateEvtInScheduleMaps(f[0].id,h.targetStart),console.log("fixyOverlaps",this.startTimesSet,this.endTimesSet,JSON.parse(JSON.stringify(this.scheduledEvents)));return}r(g);let m=this.overlapCheckEvtsAdd(f),v=Object.keys(m).length;if(v>0)return console.log(`fixyOverlaps::removeReplace:: OVERLAPS again from ${f.length} overlaps =${v}`,f,JSON.parse(JSON.stringify(m))),this.doNotify(`Extra Overlaps while adding ${f[0].title.trim()}`,"warning","top"),this.fixyOverlaps(m);let p=this.updateCurrentSchedule();console.log("fixyOverlaps::removeReplace::DONE",p),p.size>0&&this.fixSameStart(p)},c=(g,f,h)=>{const m=k(I(this.currentDate),{minute:W(g.time)});console.log(`forceAdd :${f.id} ${f.title} at ${f.time}.
        
Changing >>${g.id} from ${g.time} `+i,h.targetStart.time,m),f=this.addPropsEventsTo(h.targetStart.date,[{...f,time:h.targetStart.time}]);let v=this.overlapCheckEvtsAdd(f),p=Object.keys(v).length;if(p>0)return console.log(`fixyOverlaps::forceAdd:: OVERLAPS again from ${f.length} overlaps =${p}`,JSON.parse(JSON.stringify(v))),this.doNotify(`Extra Overlaps while adding '${f[0].title.trim()}' `,"warning","top"),this.fixyOverlaps(v);this.showDefBtn(this.isViewingPast())};let a=(g,f,h,m,v)=>{E.push(f),f==h.id?(d(m,h,v),n(`by ${g}, Scheduling '${h.title.trim()}'`)):(console.log(`by ${g},chose scheduled ${f} ...with override?`,o,i),n(`by ${g}, Keeping scheduled '${m.title.trim()}'`),o&&r(h))},u=(g,f)=>{if(o){if(console.log("fixyOverlaps::cancel::OVERRIDE...coolios!!from:"+i,g.title.trim()),i=="onDrop"){n("Umm...not moving then....");return}r(g)}n(`Cancelling to keep scheduled '${f.title.trim()}'`)},S=(g,f)=>{console.log(g,f,"from>>"+i,this.scheduledEvents.length),this.showDefBtn(this.isViewingPast())},E=[],y=Object.keys(t).length;const b=(g,f,h,m)=>{if(g=="opt3"){let v="Pick one event...",p=[{label:s(f,"def"),value:f.id,color:"secondary"},{label:s(h,"def"),value:h.id}];this.radioChoiceDialog("",v,p,"",function(N){a("Event",N,f,h,m)},null,function(){S("fixyOverlaps::chooseEvt opt3>> by Event... dismissing")})}else if(g=="opt2"){let v="Pick event by Score",p=[{label:s(f,"score"),value:f.id,color:"secondary"},{label:s(h,"score"),value:h.id}];this.radioChoiceDialog("",v,p,"",function(N){a("Score",N,f,h,m)},null,function(){S("fixyOverlaps::chooseEvt opt2>> by Score... dismissing")})}else if(g=="opt1"){let v="Pick event by Priority",p=[{label:s(f,"prio"),value:f.id,color:"secondary"},{label:s(h,"prio"),value:h.id}];this.radioChoiceDialog("",v,p,"",function(N){a("Priority",N,f,h,m)},null,function(){S("fixyOverlaps::chooseEvt opt1>> by Priority... dismissing")})}else g=="opt0"?(console.log("chooseEvt::by it's a dropppp...keeping as is...."),u(f,h)):c(h,f,m)};let D=g=>{if(!g)return"";let f=g.split(":");return parseInt(f[0])>=12?g+"PM":g+"AM"};const R=(g,f,h,m)=>{m.direction!=="surrounding"&&g.push({label:`Force in '${f.title.trim()}'`,value:"opt4"});let v=`"${f.title.trim()}" Overlaps with Scheduled "${h.title.trim()}".
        
Cancel to keep "${h.title.trim()}" at ${D(h==null?void 0:h.time)}`;this.radioChoiceDialog("Resolve Overlapping Events",v,g,"opt1",function(p){b(p,f,h,m)},function(){console.log("fixyOverlaps::onCancel>",E),u(f,h)},function(){S("fixyOverlaps::onDismiss,remvd > Kept",E)})};for(let g in t){if(!t[g]||!t[g][0]){console.log("fixyOverlaps...unknown key found",g);continue}let f=t[g];if(f.length>1){console.log("fixyOverlaps::WOAH WOAH...multiple overlaps!!"),"withID"in t?this.fixMultiConflicts(f,o,i):this.multiConflicts(f,o,i);continue}let h=[{label:"Choose one event",value:"opt3"}];i=="reloadScore"?h.unshift({label:"Choose by Priority",value:"opt1",color:"secondary"}):i=="findSamePrio"?h.unshift({label:"Choose by Score",value:"opt2"}):i=="onDrop"?h.unshift({label:"Leave as is!",value:"opt0"},{label:"Choose by Priority",value:"opt1",color:"secondary"},{label:"Choose by Score",value:"opt2"}):h.unshift({label:"Choose by Priority",value:"opt1",color:"secondary"},{label:"Choose by Score",value:"opt2"});const m=f.pop();let v=this.getLocalEvt(m.target),p=this.getScheduledEvent(m.inConflict);if(!p||!v){console.log("fixyOverlaps...ERROR ERROR no evts found!!!",m);return}console.log(`fixyOverlaps::adding ${v.id}:${v.title.trim()}(${v.time})++${v.duration} AT >> ${(C=m==null?void 0:m.targetStart)==null?void 0:C.time} -- ${m.direction} 
      Overlap with ${p.id}:${p.title.trim()}(${p.time})++${p.duration}`,o,"from:"+i,"toHandle="+y);let N=v.title.trim().includes(p.title.trim()),O=p.title.trim().includes(v.title.trim());N||O?(console.log("fixyOverlaps:: can AUTO schedule",N,O,"direction != surrounding? >",m.direction!=="surrounding"),this.scrollToTime(m==null?void 0:m.targetStart,"slow"),this.confirmAction(`"${v.title.trim()}" related to Scheduled "${p.title.trim()}".
        
Auto resolve Overlap?
        
Cancel/Dismiss for manual resolution.`,"Auto",function(){var x;if(N){console.log("auto schedule with removeReplace..with TIMES>>",v.time,(x=m==null?void 0:m.targetStart)==null?void 0:x.time),d(p,v,m),n(`Scheduling Evt '${v.title.trim()}'`);return}else{console.log("auto schedule with cancelChoice"),u(v,p);return}},function(){console.log("Cancelling Auto-Solve...doing manual"),R(h,v,p,m)})):R(h,v,p,m)}},multiConflicts(t,o=null,i=""){var h;let l="",s=[],n=null,r=[],d=null,c=new Map,a=new Map,u=[{label:"Pick one event",value:"opt3"}];const S=m=>{let v=this.parentGoalsMap().get(m.parentGoal);return{label:`Of '${v==null?void 0:v.title.trim()}' "${m.title.trim()}" (${m.score}) for ${m==null?void 0:m.duration} mins`,value:m.id}},E=m=>{let v=0,p=null;for(let N of m)if(N.parentGoal){let O=this.parentGoalsMap().get(N.parentGoal);O?O.priority>v&&(v=O.priority,p=N):console.log("multiConflicts::findhighestPrio..ERROR no PARENT found?",N)}else console.log("multiConflicts::findhighestPrio..ERROR EVT not found?",N);return a.set(p.id,`By highest priority (${v}),`),p};let y=m=>{let v=0,p=null;for(let N of m){let O=this.parseScore(N.score);O>-1&&O>=v&&(v=O,p=N)}if(p)return console.log("multiConflicts::Largest Score interval",p.id,p==null?void 0:p.title.trim(),p.score),p;console.log("ERROR ERROR multiConflicts::highestScore...no current set?",v,p,m)},b=(m,v)=>{console.log(`multiConflicts::removeConflicts with toKeep=${m.length} out of total:${v.length}`);let p=[];if(v.forEach((O,x,me)=>{if(m.find(J=>J.id==O.id)){let J=a.has(O.id)?a.get(O.id):"";if(console.log("multiConflicts::removeConflicts:KEEEP by>"+J,O.id,O==null?void 0:O.title.trim(),O==null?void 0:O.time,d),O.id!=n.id){let de=this.addPropsEventsTo(this.currentDate,[{...O,time:d}]),pe=this.overlapCheckEvtsAdd(de);if(Object.keys(pe).length>0)p.push(pe);else{console.log("multiConflicts::removeConflicts--no other overlap",O==null?void 0:O.title.trim());let Me=`${J} Adding '${O==null?void 0:O.title.trim()}' at ${C(d)}`;this.doNotify(Me,"positive","top")}}else console.log("multiConflicts::removeConflicts...already scheduled!!",O==null?void 0:O.title.trim()),this.doNotify(`${J} Keeping scheduled '${O==null?void 0:O.title.trim()}' `,"positive","top")}else O.id==n.id&&(console.log("multiConflicts::removeConflicts...removing scheduled!!",O.id,O.title),this.doRemove(O))}),p.length>0)return console.log(`multiConflicts::removeConflicts:: OVERLAPS again from ${m.length} overlaps =${p.length}`,p),this.doNotify("More Overlaps to fix!!!","warning","top"),this.fixyOverlaps(p[0]);let N=this.updateCurrentSchedule();N.size>0&&(console.log("multiConflicts::removeConflicts::SAMESTART!!",N),this.fixSameStart(N))},D=m=>{this.radioChoiceDialog("","Choose the event to schedule",m.map(S),"",function(v){let p=m.find(N=>N.id==v);if(p)r.push(p),a.set(p.id,"By pick,");else{console.log("chooseEvt::ERROR NOT FOUND!!",v);return}return console.log(`chooseEvt::onOk >>${v} >> ${p==null?void 0:p.title.trim()}`),p},null,function(){r.length>0&&(console.log("chooseEvt::LAST LAST?",JSON.parse(JSON.stringify(r))),setTimeout(()=>{b(r,m)},0))})};const R=m=>{m.forEach(p=>{if(n.id==p.id)console.log("multiConflicts::forceAdd...SKIP scheduled",n.title);else{let N=c.has(p.id)?c.get(p.id):null;console.log(`multiConflicts::forceAdd...NEW:${p.id} '${p.title.trim()}' origAt: ${p.time}`,N.time),this.recurChangeTime(n.id,p,N,!0,!0)}});let v=this.updateCurrentSchedule();return console.log("multiConflicts::forceAdd::DONE >>"+m.length+" addySize="+c.size,v,this.dailyScheduled),!0};let C=m=>{if(!m)return"";let v=m.split(":");return parseInt(v[0])>=12?m+"PM":m+"AM"};i=="reloadScore"?u.unshift({label:"Resolve by Highest Priority",value:"opt1",color:"secondary"}):i=="findSamePrio"?u.unshift({label:"Resolve by Largest Score Interval (low Score)",value:"opt2"}):u.unshift({label:"Resolve by Highest Priority",value:"opt1",color:"secondary"},{label:"Resolve by Largest Score Interval (low Score)",value:"opt2"});let g=!1;for(let m of t){console.log("multiConflicts....handling:>",JSON.parse(JSON.stringify(m)));let v=this.getScheduledEvent(m.inConflict);if(!v){console.log("multiConflicts...ERROR ERROR no evts found!!!",m);return}n?n.id!=v.id&&console.log("multiConflicts...ERROR Not same inConflict",n.id,v.id):(n=v,d=(h=m==null?void 0:m.targetStart)==null?void 0:h.time);let p=this.getLocalEvt(m.target);if(!p){console.log("multiConflicts...ERROR ERROR local evt not found!!!",m);return}l+=` '${p==null?void 0:p.title.trim()}',`,s.push(p),c.set(m.target,m==null?void 0:m.targetStart),m.direction=="surrounding"?g=!0:g=g}g||u.push({label:"Force Schedule them in",value:"opt4"});let f=`${l} conflicts with scheduled '${n==null?void 0:n.title.trim()}' at ${C(n==null?void 0:n.time)}.
    
Choose how to solve this...`;s.unshift(n),this.radioChoiceDialog("Overlap warning!!",f,u,"",function(m){if(m=="opt3")D(s);else if(m=="opt2"){let v=y(s);console.log("multiConflicts::ByScore",v.id,v==null?void 0:v.title.trim(),v.score),r.push(v),a.set(v.id,`By largest score interval (${v.score}),`)}else if(m=="opt1"){let v=E(s);console.log("multiConflicts::ByPriority",v.id,v==null?void 0:v.title.trim()),r.push(v)}else R(s)},null,function(){r.length>0&&(console.log("multiConflicts::MAIN LAST LAST?",r),setTimeout(()=>{b(r,s)},0))})},fixMultiConflicts(t,o=null,i=""){var g;let l="",s=null,n=[],r=[],d=new Map,c=null,a=[{label:"Pick one event",value:"opt3"}];const u=f=>{let h=this.parentGoalsMap().get(f.parentGoal);return{label:`Of '${h==null?void 0:h.title.trim()}' "${f.title.trim()}" (${f.score}) for ${f==null?void 0:f.duration} mins`,value:f.id}},S=f=>{let h=0,m=null;for(let v of f)if(v.parentGoal){let p=this.parentGoalsMap().get(v.parentGoal);p?p.priority>h&&(h=p.priority,m=v):console.log("fixMultiConflicts::findhighestPrio..ERROR no PARENT found?",v)}else console.log("fixMultiConflicts::findhighestPrio..ERROR EVT not found?",v);return d.set(m.id,`By highest priority (${h}),`),m};let E=f=>{let h=0,m=null;for(let v of f){let p=this.parseScore(v.score);p>-1&&p>=h&&(h=p,m=v)}if(m)return console.log("fixMultiConflicts::Largest score interval",m.id,m==null?void 0:m.title.trim(),m.score),m;console.log("ERROR ERROR fixMultiConflicts::highestScoreInterval...no current?",h,m,f)},y=f=>{if(!f)return"";let h=f.split(":");return parseInt(h[0])>=12?f+"PM":f+"AM"},b=(f,h)=>{let m=[];if(h.forEach((p,N,O)=>{if(f.find(x=>x.id==p.id))if(p.id==s.id)if(console.log("fixMultiConflicts::removeConflicts:inKeep toAdd at >"+c.time,p.id,p==null?void 0:p.title.trim(),p==null?void 0:p.time),i=="onDrop")console.log("removeConflicts...NOTHING to do as from"+i);else{let x=this.addPropsEventsTo(this.currentDate,[{...p,time:c.time}]),me=d.has(p.id)?d.get(p.id):"",J=this.overlapCheckEvtsAdd(x);if(Object.keys(J).length>0)m.push(J);else{console.log("fixMultiConflicts::removeConflicts--no other overlap adding",p==null?void 0:p.title.trim());let de=`${me} Adding '${p==null?void 0:p.title.trim()}' at ${y(c.time)}`;this.doNotify(de,"positive","top")}}else{console.log("fixMultiConflicts::removeConflicts....Keeping scheduled Evt!!",c,p.id);let x=`${d.has(p.id)?d.get(p.id):""} Keeping scheduled '${p==null?void 0:p.title.trim()}'`;this.doNotify(x,"positive","top")}else p.id!=s.id?(console.log("fixMultiConflicts::removing scheduled...doNotify?",p.id,p.title,p.time),this.doRemove(p)):console.log("fixMultiConflicts::NOT adding original target",s.id)}),m.length>0)return console.log(`fixMultiConflicts::removeConflict:: OVERLAPS again=${m.length}`,m),this.doNotify("More Overlaps to fix!!!","warning","top"),this.fixyOverlaps(m[0]);let v=this.updateCurrentSchedule();v.size>0&&(console.log("fixMultiConflicts::removeConflicts::SAMESTART",v),this.fixSameStart(v))};const D=(f,h)=>{console.log(`At ${h.date}:${h.time} forceAdding:${f.id} ${f.title} from ${f.time} >>`+i,JSON.parse(JSON.stringify(s)),n.length,n[n.length-1]);let m=this.addPropsEventsTo(h.date,[{...f,time:h.time}]),v=this.overlapCheckEvtsAdd(m),p=Object.keys(v).length;if(p>0)return console.log(`fixMultiConflicts::forceAdd:: OVERLAPS again from ${s.length} overlaps =${p}`,JSON.parse(JSON.stringify(v))),this.doNotify(`Extra Overlaps while adding '${m[0].title.trim()}'`,"warning","top"),this.fixyOverlaps(v)};let R=f=>{this.radioChoiceDialog("","Choose the event to schedule",f.map(u),"",function(h){let m=f.find(v=>v.id==h);if(m)r.push(m),d.set(m.id,"By pick,");else{console.log("chooseEvt::ERROR NOT FOUND!!",h);return}return console.log(`chooseEvt::onOk >>${h} >> ${m==null?void 0:m.title.trim()}`),m},null,function(){r.length>0&&(console.log("chooseEvt::gon removeConflicts out of total="+f.length,JSON.parse(JSON.stringify(r))),setTimeout(()=>{b(r,f)},0))})};i=="reloadScore"?a.unshift({label:"Resolve by Highest Priority",value:"opt1",color:"secondary"}):i=="findSamePrio"?a.unshift({label:"Resolve by Largest Score Interval (low Score)",value:"opt2"}):a.unshift({label:"Resolve by Highest Priority",value:"opt1",color:"secondary"},{label:"Resolve by Largest Score Interval (low Score)",value:"opt2"});for(let f of t){console.log("fixMultiConflicts....handling:>",JSON.parse(JSON.stringify(f)));let h=this.getScheduledEvent(f.inConflict);if(!h){console.log("fixMultiConflicts...ERROR ERROR no evts found!!!",f);return}n.push(h),l+=` '${h==null?void 0:h.title.trim()}',`,c?c.time!=((g=f==null?void 0:f.targetStart)==null?void 0:g.time)&&console.log("fixMultiConflicts...ERROR Not same targetStart?!?",c,f==null?void 0:f.targetStart,f.direction):c=f==null?void 0:f.targetStart;let m=this.getLocalEvt(f.target);if(!m){console.log("fixMultiConflicts...ERROR ERROR local evt not found!!!",f);return}s=m,f.direction!=="surrounding"&&a.length<3&&a.push({label:`Force in '${s.title.trim()}'`,value:"opt4"})}let C=`'${s==null?void 0:s.title.trim()}' conflicts with scheduled ${l} 

      Choose how to solve this...`;n.unshift(s),this.radioChoiceDialog("Overlap warning!!",C,a,"",function(f){if(f=="opt3")R(n);else if(f=="opt2"){let h=E(n);console.log("fixMultiConflicts::ByScore",h.id,h==null?void 0:h.title.trim(),h.score),r.push(h),d.set(h.id,`By largest score interval (${h.score}),`)}else if(f=="opt1"){let h=S(n);console.log("fixMultiConflicts::ByPriority",h.id,h==null?void 0:h.title.trim()),r.push(h)}else console.log("fixMultiConflicts::forceAdd..."),D(s,c)},null,function(){r.length>0&&(console.log("fixMultiConflicts::MAIN gon removeConflicts from total="+n.length,JSON.parse(JSON.stringify(r))),setTimeout(()=>{b(r,n)},0))})},fixSameStart(t){const o=c=>{let a=0,u=null;for(let S of c){let E=this.getScheduledEvent(S);if(E){let y=this.parentGoalsMap().get(E.parentGoal);y?y.priority>a&&(a=y.priority,u=E):console.log("findhighestPrio..ERROR no PARENT found?",E)}else console.log("findhighestPrio..ERROR EVT not found?",S)}return console.log("fixSameStart::findhighestPrio...",u==null?void 0:u.title.trim(),a),r.set(u.id,`By highest priority (${a}),`),u},i=c=>{let a=this.parentGoalsMap().get(c.parentGoal);return{label:`Of '${a==null?void 0:a.title.trim()}' "${c.title.trim()}" (${c.score}) for ${c==null?void 0:c.duration} mins`,value:c.id}};let l=c=>{if(!c)return"";let a=c.split(":");return parseInt(a[0])>=12?c+"PM":c+"AM"},s=[],n=new Set,r=new Map,d=[{label:"Resolve by Highest Priority",value:"opt1",color:"secondary"},{label:"Resolve by Largest Score Interval (low Score)",value:"opt2"},{label:"Pick event",value:"opt3"}];for(let c of t){let a=this.retrieveSameStart(c.at);console.log("fixSameStart:conflict",JSON.parse(JSON.stringify(c)),JSON.parse(JSON.stringify(a)));let u=[],S="";for(let C of a){let g=this.getScheduledEvent(C);g?(u.push(g),S+=` '${g==null?void 0:g.title.trim()}',`,n.has(g)?console.log(`Set already contain ${g.id}~${g.title}..skipping`):n.add(g)):console.log("fixSameStart...ERROR not found?",C)}let E=C=>{let g=this.getScheduledEvent(C);return g?(s.push(g),r.set(g.id,"By pick,"),g):(console.log("fixSameStart::onOk:: ERROR ERROR?!?! Not found",C),g=this.getLocalEvt(C),g?(s.push(g),r.set(g.id,"By pick,"),g):(console.log("fixSameStart::onOk:: ERROR ERROR..still not found!!!",C),!1))},y=()=>{let C=0,g=null;for(let f of u){let h=this.parseScore(f.score);h>-1&&h>=C&&(C=h,g=f)}if(g)return console.log("fixSameStart::highestScore",g.id,g==null?void 0:g.title.trim(),g.score),s.push(g),r.set(g.id,`By largest score interval (${g.score}),`),g;console.log("ERROR ERROR fixSameStart::highestScore..nothing set?",C,e)},b=()=>{this.radioChoiceDialog("","Choose the event to schedule",u.map(i),"",function(C){let g=E(C);return console.log(`fixSameStart--chooseEvt::onOk >>${C} >> ${g==null?void 0:g.title.trim()}`),g},null,function(){s.length==t.size&&(console.log("fixSameStart--chooseEvt::onDismiss...PICKLAST"+s.length,s),setTimeout(()=>{D(s,n)},0))})},D=(C,g)=>{g.forEach((h,m,v)=>{if(C.find(p=>p.id==h.id)){console.log("fixSameStart::removeConflicts:KEEEP",h.id,h==null?void 0:h.title.trim());let N=`${r.has(h.id)?r.get(h.id):""} Keeping '${h==null?void 0:h.title.trim()}' at ${l(h==null?void 0:h.time)}`;this.doNotify(N,"positive","top")}else this.doRemove(h)});let f=this.updateCurrentSchedule();console.log("fixSameStart::removeConflicts::DONE",f),f.size>0&&this.fixSameStart(f),this.disableSaveSchedule=!1},R=`${S} scheduled at same ${l(c.at)}.

      Choose how to solve this...`;this.radioChoiceDialog("Same start time!!",R,d,"opt1",function(C){if(C=="opt3")b();else{if(C=="opt2")return y();{let g=o(a);console.log("fixSameStart::opt1",g.id,g==null?void 0:g.title.trim(),g.score),s.push(g)}}},null,function(){s.length==t.size&&(console.log("fixSameStart::onDismiss Main with size="+s.length,"conflicts="+n.size),setTimeout(()=>{D(s,n)},0))})}return!0},showDefBtn(t){let o=this.allEvents.some(i=>(i==null?void 0:i.inDefaults)&&!this.scheduledEvents.find(l=>l.id==i.id));this.updateButtons(t?!1:o,!t,!t)},loadForDate(t,o,i){let l=(r,d)=>({id:parseInt(r),duration:d.duration,time:d.time}),s=()=>{let r=this.getEventsForDate(t);if(!r){console.log(`ERROR no evts found for ${t}...`,r);return}console.log(`doLoadNotPresent ${t}::evts=${Object.keys(r).length}`);let d=Object.keys(r).map(a=>l(a,r[a]));this.scheduledEvents=this.addPropsEventsTo(t,d);let c=this.updateCurrentSchedule();c.size>0&&!i?(console.log(`doLoadNotPresent..OVERLAPS in past?${i} on ${t}`,c.size),this.doNotify(`${t} with conflicts to fix!`,"warning","bottom"),this.fixSameStart(c)):(this.showReloadBtn=!1,this.disableSaveSchedule=!0,this.doNotify(`Loaded schedule for ${i?"past":"future"}:: ${t}`,"positive","bottom"))},n=()=>{let r=this.getEventsForDate(t);if(!r){console.log(`ERROR no evts found for today:${t} ?!?`,r);return}let d=Object.keys(r).map(u=>l(u,r[u])),c=this.addPropsEventsTo(t,d);console.log(`OverlapCheckLoadToday ${t} loading:${c.length} into current:${this.scheduledEvents.length}`);let a=this.overlapCheckEvtsAdd(c);return Object.keys(a).length>0?this.doNotify(`${t} with Some overlaps to fix!`,"warning","bottom"):this.doNotify(`Loaded schedule for ${t}`,"positive","bottom"),a};if(this.scheduledEvents=[],this.updateCurrentSchedule(),o)if(this.isViewingToday()){let r=n();if(Object.keys(r).length>0){console.log("Overlaps toHandle >>",JSON.parse(JSON.stringify(r))),this.fixyOverlaps(r),this.showReloadBtn=o,this.showClearBtn=o,this.disableSaveSchedule=!1,this.evtStartedOrPassed(F(new Date)),this.showDefBtn(i);return}this.evtStartedOrPassed(F(new Date)),this.disableSaveSchedule=!0,this.showReloadBtn=!1}else s(),this.allowScoreEdit(i),this.showClearBtn=!i;else this.showReloadBtn=!1,this.showClearBtn=!1,this.disableSaveSchedule=!0;(i||t!==z())&&this.adjustCurrentTime(),this.reset(),this.showDefBtn(i)},reset(){this.draggedItem=null,this.targetDrop=null,this.chosenScore=null,this.chosenPrio=null,this.possibleRange=null},deepCopy(t){if(t===null||typeof t!="object")return t;if(Array.isArray(t))return t.map(i=>this.deepCopy(i));const o={};for(let i in t)t.hasOwnProperty(i)&&(o[i]=this.deepCopy(t[i]));return o},onRefresh(t){setTimeout(()=>{this.scheduledEvents=[],this.updateCurrentSchedule(),this.resetGoalEvts(!0),this.loadForDate(this.currentDate,this.hasEventsForDate,this.isViewingPast()),t()},1e3)},doSaveSchedule(){let t={};this.dailyScheduled.size<1?t=null:this.dailyScheduled.forEach((o,i,l)=>{t[i]={duration:o.for,time:o.start.time}}),this.store.saveDailySchedule(this.currentDate,t),this.disableSaveSchedule=!0,this.showReloadBtn=!1,this.showClearBtn=t!=null,this.doNotify(`Schedule saved for ${this.currentDate}`,"positive","top")},addParentGoal(t,o,i="red-14",l=2){let s=[];this.parentGoalsMap().forEach((d,c,a)=>{let u=d.bgcolor;s.push(u)});let n=lt(),r=s.length;if(r>1){let d=r+1;for(;s.some(a=>n[d]==a);)console.log("addParentGoal::index with taken color...new random",d,n[d]),d=Math.floor(Math.random()*r);let c=n[d];console.log(`addParentGoal::bgcolor..index ${d} from ${i} to: `,c),i=c||i}return this.store.addMainGoal(t,o,i,l)},onAddNewEvent(t,o,i,l){if(this.possibleRange||(console.log("umm onAddNewEvent... not a range selection",this.startEndTimes),this.possibleRange=this.startEndTimes),t.trim()==""){this.doNotify("Empty Goal title..."),this.addEventDialog=!1,this.reset();return}let s=he(this.possibleRange[0]),n=l>15?k(s,{minute:parseInt(l)}):k(he(this.possibleRange[1]),{minute:15}),r=Math.floor(K(s,n)/1e3/60);console.log(`onAddNewEvent:${t} :${i}: from ${s.time} till ${n.time}.Duration:${r}`,l);let d=null;if(i=="self"){let c=this.addParentGoal(t,t,"purple-10",2);c?(console.log("SELF parent Goal created",c),d=this.store.addSubGoal(c,t,"1on5",s.time,r,!0,!1,r<30)):console.log("ERROR? no pID",c)}else if(o){console.log("with parentGoal "+o.id,o==null?void 0:o.title),d=this.store.addSubGoal(o.id,t,"1on5",s.time,r,!1,!1,r<30);//!canMove and notInDefaults. isAlternative when duration<30
}else{let c=this.store.getGoalByTitle("Misc");if(c){console.log("Woo!! Misc pGoal already exists!",c.id),d=this.store.addSubGoal(c.id,t,"1on5",s.time,r,!1,!1,r<30);//!canMove and notInDefaults.isAlternative when duration<30
}else{let a=this.addParentGoal("Misc","Miscellaneous","grey-10",2);a&&(console.log("NEW Misc pGoal created",a),d=this.store.addSubGoal(a,t,"1on5",s.time,r,!0,!1,r<30))}}if(d){this.resetGoalEvts(!0);let c=this.tooClose(s,r);if(c){console.log("onAddNewEvent::tooClose check FAIL!!",c),c===!0?this.doNotify(`'${t}' created But Not added as over midnight!`):this.doNotify(`'${t}' created But Not added as too close to a scheduled Evt!!`),this.addEventDialog=!1;return}let a=this.hasOverlappingEvent(d,s,r);if(a.length>0){let u={};for(let S=0;S<a.length;S++){let E=a[S];u[E==null?void 0:E.inConflict]?u[E==null?void 0:E.inConflict].push(E):u[E==null?void 0:E.inConflict]=[E],S>0&&(console.log(S+" WOAH WOAH,onAddNewEvent.. multiple overlaps with same target!",a[S].target),E.inConflict in u&&(console.log("WOAH deleting inConflict",E.inConflict),delete u[E.inConflict]),a[S-1].inConflict in u&&(console.log("WOAH deleting PREV inConflict",a[S-1].inConflict),delete u[a[S-1].inConflict]),u[E.target]?(u[E.target].push(E),console.log("WOAH obj.id already present?",E.target)):u[E.target]=[E],u[E.target].unshift(a[S-1]),u.withID=!0)}console.log("onAddNewEvt:: OVERLAPS >>",JSON.parse(JSON.stringify(u))),this.fixyOverlaps(u,null,"addNew")}else{let u=this.addPropsEventsTo(this.currentDate,[{id:d,time:s.time,title:t,score:"2on5",duration:r,canMove:!o}]);console.log(`onAddNewEvt, addEvtPropsIntoSchedule: ${d} at ${s.time}`),this.addEvtPropsIntoSchedule(u[0])}this.disableSaveSchedule=!1,this.showReloadBtn=this.hasEventsForDate,this.showClearBtn=!this.isViewingPast(),this.constructTree()}else console.log("BOO ERROR no subID:(",d),this.doNotify("Error creating and adding this event :(","negative");this.addEventDialog=!1},tooClose(t,o){let i=k(t,{minute:0}),l=this.getTimeNumber(i),s=k(t,{day:1}),n=new Date(s.date);n.setHours(24),n.setMinutes(0),n.setSeconds(0),n.setMilliseconds(0);let r=F(n),d=Math.floor(K(i,r)/1e3/60);if(d<o)return console.log("tooClose to midnight eh...:(",d,s,n),!0;let c=!1;return this.dailyScheduled.forEach((a,u,S)=>{let y=this.getTimeNumber(a.start)-l,b=K(i,a.start);Math.floor(b/1e3/60)<=10&&y>0&&(c=u)}),c},onPickEvent(t,o){if(this.addEventDialog=!1,!t){console.log("onPickEvent...ERROR nothing!",t,o),this.doNotify("No Goal selected..."),this.reset();return}let i=this.getScheduledEvent(t.id);if(i){console.log("onPickEvent...NOT NEW?!?ERROR!",i,t);return}else{i=t;let l=this.isViewingPast()?!0:o;console.log(`onPickEvent::(${i.id})'${i.title.trim()}' from ${i.time} to ${this.targetDrop.timestamp.time} with force?${o} BUT Forcing?:${l}`);let s=this.tooClose(this.targetDrop.timestamp,i.duration);if(s){if(console.log("onPickEvent::tooClose check FAIL!",s),s===!0){this.doNotify("Picking event TOO close to midnight!"),this.reset();return}if(l)this.doNotify(`'${i.title.trim()}' TOO close to a scheduled Evt...forcing!`);else{this.doNotify(`'${i.title.trim()}' Not added as TOO close to a scheduled Evt`),this.reset();return}}let n=this.hasOverlappingEvent(i.id,this.targetDrop.timestamp,i.duration),r=n.length;if(r>0){console.log("onPickEvent::overlaps!!!",JSON.parse(JSON.stringify(n)));let d={};for(let c=0;c<r;c++){let a=n[c];d[a==null?void 0:a.inConflict]?d[a==null?void 0:a.inConflict].push(a):d[a==null?void 0:a.inConflict]=[a],c>0&&(console.log(c+" WOAH WOAH,onPickEvent.. multiple overlaps with same target?",n[c].target),a.inConflict in d&&(console.log("WOAH deleting inConflict",a.inConflict),delete d[a.inConflict]),n[c-1].inConflict in d&&(console.log("WOAH deleting PREV inConflict",n[c-1].inConflict),delete d[n[c-1].inConflict]),d[a.target]?(d[a.target].push(a),console.log("WOAH obj.id already present?",a.target)):d[a.target]=[a],d[a.target].unshift(n[c-1]),d.withID=!0)}console.log(`onPickEvent::OVERLAPS of size: ${r} and force:${l}`,JSON.parse(JSON.stringify(d))),this.fixyOverlaps(d,null,"onPickEvt")}else console.log("onPickEvent NO overlaps...changing to targetDrop with ",l),this.changeEvtTime(i.id,this.targetDrop.timestamp,l,!0)}this.disableSaveSchedule=!1,this.showReloadBtn=this.hasEventsForDate,this.showClearBtn=!this.isViewingPast()},closingDialog(){this.addEventDialog=!1,this.reset()},onEndNow(t){const o=F(new Date);let i=this.hasEventsForDate;if(this.dailyScheduled.has(t)){let l=this.dailyScheduled.get(t),s=l.start,n=l.end;if(ie(o,s,n,!0)){let r=this.getTimeNumber(n)-this.getTimeNumber(s),d=this.getTimeNumber(o)-this.getTimeNumber(s);console.log(`onEndNow::${t}`,s.time,n.time,d);const c=()=>{console.log(`Great, ${t} REDUCING duration from ${r} to:`,d);for(let u=0;u<this.scheduledEvents.length;u++){let S=this.scheduledEvents[u];S.id===t&&(S.duration=d)}this.dailyScheduled.set(t,{...l,for:d,end:o}),this.endTimesSet.delete(n.time)||console.log("ERROR endTimesSet item does not exist?!?",l,this.endTimesSet),this.endTimesSet.add(o.time),this.disabledScoreEvts[t]=!1,this.disableSaveSchedule=!1,this.showReloadBtn=i,this.showClearBtn=!this.isViewingPast&&this.scheduledEvents.length>0},a=()=>{console.log("onEndNow::removing and saving!"),this.doRemove(this.getLocalEvt(t)),this.doSaveSchedule()};d<10?(console.log(`onEndNow:: ${d} less than 10 mins...REMOVE?`),this.confirmAction(`Less than 10mins remove?
 Cancel to just EndNow`,"OK",a,c)):c()}else console.log("umm aint in the middle of this event! Nothing to do...ERROR?",o.time,s.time,n.time)}else{console.log("ERROR doEndNow not found!!!",t);return}},onSaveScore(t,o){let i=this.dailyScheduled.get(o);if(i){if(this.getLocalEvt(o),this.parseScore(t)<-1){this.doNotify("Score Error: higher# on lower#");return}i.score=t,this.doSaveEvtProp(o,null,t);let s=this.getScheduledEvent(o);s?s.score=t:console.log("onSaveScore ERROR not found",s,o)}else console.log(`ERROR onSaveScore could not find event ${o}?!?`)},onAddMins(t,o){if(this.dailyScheduled.has(t)){let i=this.dailyScheduled.get(t),l=i.end,s=k(l,{minute:parseInt(o)}),n=parseInt(o)+i.for;console.log(`onAddMins::${t} add ${o} from ${i.for} to> ${n}`,l.time);let r=this.hasOverlappingEvent(t,i.start,n);if(r.length>0){console.log("onAddMins::huh some OVERLAPS",r);let d={};for(let c=0;c<r.length;c++){let a=r[c];d[a==null?void 0:a.inConflict]?d[a==null?void 0:a.inConflict].push(a):d[a==null?void 0:a.inConflict]=[a],c>0&&(console.log(c+" WOAH WOAH,onAddMins..ERROR?!? multiple overlaps with same target?",r[c].target),a.inConflict in d&&(console.log("WOAH deleting inConflict",a.inConflict),delete d[a.inConflict]),r[c-1].inConflict in d&&(console.log("WOAH deleting PREV inConflict",r[c-1].inConflict),delete d[r[c-1].inConflict]),d[a.target]?(d[a.target].push(a),console.log("WOAH obj.id already present?",a.target)):d[a.target]=[a],d[a.target].unshift(r[c-1]),d.withID=!0)}console.log("onAddMins:: OVERLAPS >>",JSON.parse(JSON.stringify(d))),this.fixyOverlaps(d,null,"addMins")}else{console.log(`Great, ${t} Ending at:${s.time}`);for(let d=0;d<this.scheduledEvents.length;d++){let c=this.scheduledEvents[d];c.id===t&&(c.duration=n)}this.dailyScheduled.set(t,{...i,for:n,end:s}),this.endTimesSet.delete(l.time)||console.log("ERROR endTimesSet item does not exist?!?",i,this.endTimesSet),this.endTimesSet.add(s.time),this.doSaveSchedule()}}else{console.log("ERROR onAddMins EVT not found!!!",t);return}},onClearDay(){if(this.isViewingPast()){this.doNotify("Editing past is no no!");return}let t=this.hasEventsForDate;this.scheduledEvents=[],this.updateCurrentSchedule(),this.resetGoalEvts(!0);let o=t?"Cleared...Can still reload saved":"Cleared daily schedule";this.doNotify(o,"warning","top"),this.reset(),this.showReloadBtn=t,this.showLoadDefaults=!0,this.showClearBtn=!1,this.disableSaveSchedule=!t},onReloadSaved(){let t=this.hasEventsForDate,o=()=>{console.log("Aborting",this.currentDate,this.scheduledEvents,t),this.showReloadBtn=!this.isViewingPast()||t},i=()=>{this.scheduledEvents=[],this.updateCurrentSchedule(),this.loadForDate(this.currentDate,t,this.isViewingPast()),this.reset()};if(this.scheduledEvents.length>0&&!this.isViewingPast()){let l=t?"Reload? saved schedule of: "+this.currentDate:"Overwrite current Evts?";this.confirmAction(l,"OK",i,o)}else i();this.showReloadBtn=!1,this.showClearBtn=!this.isViewingPast()},scheduleDefaults(t){let o=this.deepCopy(this.store.fetchDefaults()),i=this.isViewingPast();if(this.showReloadBtn=this.hasEventsForDate,this.showClearBtn=!i&&o.length>0,this.isViewingToday()){let l=this.addPropsEventsTo(this.currentDate,o);if(t=="add"){let r=l.length;l=l.filter(d=>!this.scheduledEvents.find(c=>c.id==d.id)),console.log(`scheduleDefaults..ADDIN from ${r} to ${l.length}`)}else this.scheduledEvents=[],this.updateCurrentSchedule();l.some(r=>r.time=="")&&(l=l.filter(r=>r.time!=""),this.doNotify("Some defaults Evts without default time not included","warning","top")),console.log(`scheduleDefaults:${this.currentDate} with '${t}'`,l.length,this.scheduledEvents.length);let s=this.overlapCheckEvtsAdd(l),n=Object.keys(s).length;n>0&&(console.log(`scheduleDefaults overlaps on:${this.currentDate} from ${o.length} to ${l.length}. overlaps =${n}`),this.fixyOverlaps(s)),this.evtStartedOrPassed(F(new Date)),this.showDefBtn(i),this.disableSaveSchedule=!(l.length>0);return}else{let l=this.addPropsEventsTo(this.currentDate,o);if(t=="add"){let n=l.length;l=l.filter(d=>!this.scheduledEvents.find(c=>c.id==d.id)),console.log(`scheduleDefaults..ADDIN to ${this.currentDate} of ${this.scheduledEvents.length} from ${n} to `,l.length);let r=this.scheduledEvents.concat(l);this.scheduledEvents=r}else this.scheduledEvents=l;let s=this.updateCurrentSchedule();s.size>0&&console.log("scheduleDefaults..sameStart="+s.size),i?this.allowScoreEdit(!0):this.allowScoreEdit(!1)}this.showDefBtn(i),this.disableSaveSchedule=!(o.length>0)},unscheduledDefaults(){return this.resetGoalEvts(!0),this.allEvents.filter(t=>(t==null?void 0:t.inDefaults)&&!this.scheduledEvents.find(o=>o.id==t.id))},onLoadDefault(){let t=()=>{console.log("Aborting",this.currentDate)},o=i=>{this.scheduleDefaults(i)};if(this.scheduledEvents.length>0){let i=this.unscheduledDefaults();console.log("unscheduledDefaults",i==null?void 0:i.length);let l=[{label:`Add ${i==null?void 0:i.length} Default Evts to current day schedule`,value:"add"},{label:"Overwrite and only schedule Defaults",value:"overwrite"}];this.radioChoiceDialog("Warning!!",`Date: ${this.currentDate} already have scheduled Events...`,l,"",function(s){o(s)},t)}else o("overwrite")},choosePrio(t){let o=this.chosenPrio;o&&o==t?this.disablePrioBtn=!0:(this.chosenPrio=t,this.disablePrioBtn=!1)},chooseScore(t){let o=this.chosenScore;o&&o==t?this.disableScoreBtn=!0:(this.chosenScore=t,this.disableScoreBtn=!1)},findSamePrio(t){const o=()=>this.scheduledEvents.filter(s=>{var n;return((n=this.parentGoalsMap().get(s.parentGoal))==null?void 0:n.priority)==this.chosenPrio});let i=[],l=this.isViewingToday();if(t=="overwrite"||t=="add"){let s=this.deepCopy(this.storedEvents);for(let n of s){let r=this.parentGoalsMap().get(n.parentGoal);(r==null?void 0:r.priority)==this.chosenPrio&&i.push(n)}t=="add"?i=i.filter(n=>!this.scheduledEvents.find(r=>r.id==n.id)):(this.scheduledEvents=[],this.updateCurrentSchedule()),console.log(`findSamePrio...${t} to size: ${this.scheduledEvents.length} some evts = ${i.length}`)}else i=o(),console.log("findSamePrio..filtering!!",this.chosenPrio,i);if(l&&t!="filter"){i=this.addPropsEventsTo(this.currentDate,i);let s=this.overlapCheckEvtsAdd(i);if(Object.keys(s).length>0)console.log(`findSamePrio${this.chosenPrio}...overlaps`,JSON.parse(JSON.stringify(s))),this.fixyOverlaps(s,null,"findSamePrio");else{if(console.log("findSamePrio >>No overlaps!!...",i.length),i.length<1){this.disableSaveSchedule=!0,this.showReloadBtn=!1,this.showClearBtn=!1;return}this.updateCurrentSchedule()}}else{if(t=="filter")this.scheduledEvents=i;else if(i=this.addPropsEventsTo(this.currentDate,i),t=="add"){let s=this.scheduledEvents.concat(i);this.scheduledEvents=s}else this.scheduledEvents=i;this.updateCurrentSchedule()}if(!this.scheduledEvents.length>0){this.doNotify(`Empty for Priority == ${this.chosenPrio} :(`,"warning","bottom"),this.disableSaveSchedule=!0,this.showReloadBtn=this.hasEventsForDate,this.showClearBtn=!1;return}this.disableSaveSchedule=!1,this.showReloadBtn=this.hasEventsForDate,this.showClearBtn=!0},onReloadWithPrio(){if(this.chosenPrio==null){this.doNotify("Ayo select a priority!");return}let t=()=>{console.log("onReloadWithPrio..cancelling"),this.reset()};if(this.scheduledEvents.length>0){let o=[{label:`Filter current Evts by priority == ${this.chosenPrio}`,value:"filter"},{label:`Add to schedule Evts with priority == ${this.chosenPrio}`,value:"add"},{label:`Overwrite current and schedule All of priority == ${this.chosenPrio}`,value:"overwrite"}];this.radioChoiceDialog("","Schedule change...",o,"",this.findSamePrio,t)}else this.findSamePrio("overwrite");this.showDefBtn(this.isViewingPast()),this.disablePrioBtn=!0},reloadEvtsWithScore(t){const o=()=>{let s=[];return this.scheduledEvents.forEach(n=>{let r=this.parseScore(n.score);r>-1&&r>=this.chosenScore&&s.push(n)}),s};let i=[],l=this.isViewingToday();if(t=="overwrite"||t=="add"){const s=this.store.fetchGoalsWithMinScore(this.chosenScore);t=="add"?i=s.filter(n=>!this.scheduledEvents.find(r=>r.id==n.id)):(i=s,this.scheduledEvents=[],this.updateCurrentSchedule())}else i=o(),console.log(`reloadEvtsWithScore AFTER flag ${t}`,this.scheduledEvents.length,JSON.parse(JSON.stringify(i))),JSON.parse(JSON.stringify(this.scheduledEvents));if(l&&t!="filter"){i=this.addPropsEventsTo(this.currentDate,i),console.log(`reloadEvtsWithScore::addPropsEventsTo today for '${t}'`,this.scheduledEvents.length,JSON.parse(JSON.stringify(i)));let s=this.overlapCheckEvtsAdd(i);if(Object.keys(s).length>0)console.log(`onReloadWithScore ${this.chosenScore}...overlaps!!`,JSON.parse(JSON.stringify(s))),this.fixyOverlaps(s,!1,"reloadScore");else{if(console.log("onReloadWithScore >>NO OVERLAPS!!!..."),i.length<1){this.disableSaveSchedule=!0,this.showReloadBtn=!1,this.showClearBtn=!1;return}this.updateCurrentSchedule()}}else{if(console.log(`reloadEvtsWithScore... with flag '${t}' on>`,this.currentDate,JSON.parse(JSON.stringify(this.scheduledEvents.length)),JSON.parse(JSON.stringify(i))),t=="filter")this.scheduledEvents=i;else if(i=this.addPropsEventsTo(this.currentDate,i),t=="add"){let s=this.scheduledEvents.concat(i);this.scheduledEvents=s}else this.scheduledEvents=i;this.updateCurrentSchedule()}if(!this.scheduledEvents.length>0){this.doNotify(`Empty for Score >= ${this.chosenScore} :(`,"warning","bottom"),this.disableSaveSchedule=!0,this.showReloadBtn=this.hasEventsForDate,this.showClearBtn=!1;return}this.disableSaveSchedule=!1,this.showReloadBtn=this.hasEventsForDate,this.showClearBtn=!0},onReloadWithScore(){if(this.chosenScore==null){this.doNotify("Ayo select a score!");return}let t=()=>{console.log("onReloadWithScore..cancelling",this.scheduledEvents),this.reset()};if(this.scheduledEvents.length>0){let o=[{label:`Filter current Evts by Interval Score >= ${this.chosenScore}`,value:"filter"},{label:`Add to schedule Evts with Interval Score >= ${this.chosenScore}`,value:"add"},{label:`Overwrite current and schedule All of Interval Score >= ${this.chosenScore}`,value:"overwrite"}];this.radioChoiceDialog("","Schedule change...",o,"",this.reloadEvtsWithScore,t)}else this.reloadEvtsWithScore("overwrite");this.showDefBtn(this.isViewingPast()),this.disableScoreBtn=!0},onChange(t){this.loadForDate(t.start,this.hasEventsForDate,this.isViewingPast())},onDragStart(t,o){if(this.isViewingPast()){this.doNotify("Editing past is no no!"),t.preventDefault();return}this.draggedItem=o},onDragEnter(t,o,i){return o==="goal-item"||(this.targetDrop=i),t.preventDefault(),!0},onDragOver(t,o,i){return t.preventDefault(),!0},onDragLeave(t,o,i){return!1},onDragEnd(t){console.log("onDragEnd",t)},onDrop(t,o,i){let l=this.getScheduledEvent(this.draggedItem.id);if(!l){console.log("onDrop ERROR",l,this.draggedItem);return}let s=null;if(o==="interval")s=i.timestamp;else if(o==="goal-item"&&this.targetDrop)s=this.targetDrop.timestamp;else{console.log("Cannot drop here YO!!",t,o,i,this.targetDrop);return}if(!s){console.log("ERROR...no timestamp YO!!",t,o,i,this.targetDrop);return}let n=this.tooClose(s,l.duration);if(n&&(console.log("onDrop::tooClose to>>",n),n===!0)){this.doNotify("Dropping event TOO close to midnight!"),this.reset();return}let r=this.hasOverlappingEvent(l.id,s,l.duration),d={},c=r.length;if(c>0){let a=0;do{if(r[a].inConflict==r[a].target){console.log("EUUUH...self overlap?!?",r[a]);break}console.log("onDrop...OVERLAP handlin::size="+c,r[a].direction);let u=r[a];d[u==null?void 0:u.inConflict]?d[u==null?void 0:u.inConflict].push(u):d[u==null?void 0:u.inConflict]=[u],a>0&&(console.log(a+" WOAH WOAH,onDrop.. multiple overlaps with same target!",r[a].target),u.inConflict in d&&(console.log("WOAH deleting inConflict",u.inConflict),delete d[u.inConflict]),r[a-1].inConflict in d&&(console.log("WOAH deleting PREV inConflict",r[a-1].inConflict),delete d[r[a-1].inConflict]),d[u.target]?(d[u.target].push(u),console.log("WOAH obj.id already present?",u.target)):d[u.target]=[u],d[u.target].unshift(r[a-1]),d.withID=!0)}while(++a<c);console.log("onDrop...OVERLAP with fixOverlap",d),this.fixyOverlaps(d,!0,"onDrop")}else this.changeEvtTime(l.id,s,!1),console.log(`onDrop with No overlap complete (${l.id}) to ${s.time}`);this.disableSaveSchedule=!1,this.showReloadBtn=this.hasEventsForDate,this.showClearBtn=!0,this.reset()},onDblClickEvent(t,o){if(this.isViewingPast()){if(o.duration<30){console.log("onDblClickEvent..baah too smoll smoll",o.title,o.duration),this.doNotify("Removing from the past is a no no!");return}this.chooseAlternatives(o),t.preventDefault();return}this.removeEvtInSchedule(o)},onClickDate(t){console.log("onClickDate",t)},onClickTime(t){console.log("onClickTime..event",t),this.addEventDialog=!0,this.targetDrop=t.scope},onClickInterval(t){console.log("onClickInterval",t)},onClickHeadIntervals(t){console.log("onClickHeadIntervals",t)},onClickHeadDay(t){console.log("onClickHeadDay",t)},onMouseEnter(t){console.log("onMouseAt",t)},onMouseLeave(t){console.log("onMouseLeave",JSON.stringify(t))},onMouseDownTime({scope:t,event:o}){if(Ce(o)){if(this.mobile===!0&&this.anchorTimestamp!==null&&this.otherTimestamp!==null&&j(this.anchorTimestamp)===j(this.otherTimestamp)){this.otherTimestamp=t.timestamp,this.mouseDown=!1;return}this.mouseDown=!0,this.anchorTimestamp=t.timestamp,this.otherTimestamp=t.timestamp}},onMouseUpTime({scope:t,event:o}){if(this.mobile!==!0&&Ce(o)&&(this.otherTimestamp=t.timestamp,this.mouseDown=!1),!this.mousedown){let i=this.startEndTimes;if(i[1]==i[0])return;this.possibleRange=i,console.log("onMouseUpTime range change",this.possibleRange)}},onMouseMoveTime({scope:t,event:o}){this.mobile!==!0&&this.mouseDown===!0&&(this.otherTimestamp=t.timestamp)},scrollToEvent(t){this.$refs.calendar.scrollToTime(t.time,350)},scrollToTime(t,o=null){var i;if(this.$refs.calendar){let l=k(t,{minute:-30});console.log("scrollToTime::gonna SCROLL",t.time,l.time,o),(i=this.$refs.calendar)==null||i.scrollToTime(l.time,o?o=="fast"?400:1e3:500)}else console.log("scrollToTime::NO SCROLLY",t.time,JSON.parse(JSON.stringify(this.$refs)))},onToday(){let t=()=>{this.$refs.calendar.moveToToday()},o=()=>{setTimeout(t,1e3),this.doSaveSchedule()};this.disableSaveSchedule?t():this.confirmAction(`Save day: ${this.currentDate} changes?`,"Save",o,t)},onPrev(){let t=()=>{this.$refs.calendar.prev()},o=()=>{setTimeout(t,1e3),this.doSaveSchedule()};this.disableSaveSchedule?t():this.confirmAction(`Save day: ${this.currentDate} changes?`,"Save",o,t)},onNext(){let t=()=>{this.$refs.calendar.next()},o=()=>{setTimeout(t,1e3),this.doSaveSchedule()};this.disableSaveSchedule?t():this.confirmAction(`Save day: ${this.currentDate} changes?`,"Save",o,t)}}}),Be=t=>(re("data-v-1167947a"),t=t(),ae(),t),to={key:0,class:"q-gutter-md"},oo={key:1,class:"subcontent"},io={class:"float-right"},so={key:0},lo={key:1},no={key:2},ro={key:3},ao={key:4},ho={class:"row justify-center"},co={style:{display:"flex","max-width":"800px",width:"100%",height:"500px"}},uo={style:{display:"flex","justify-content":"center","flex-wrap":"wrap",padding:"2px"}},fo={class:"title q-calendar__ellipsis"},go=["onDblclick","onDragstart"],mo={class:"row justify-center"},po=Be(()=>A("br",null,null,-1)),vo={key:0,class:"q-pa-xl bg-grey-12",style:{"max-width":"400px"}},So={class:"row justify-center"},Eo=Be(()=>A("br",null,null,-1)),yo={class:"q-mr-sm text-weight-bold",size:"28px"},wo={key:0},Co={class:"text-weight-bold"},bo={key:1,class:"text-weight-light text-black"};function $o(t,o,i,l,s,n){const r=q("add-goal-form"),d=q("navigation-bar"),c=q("sched-btn"),a=q("sched-drop-btn"),u=q("goaly-end"),S=q("q-calendar-day"),E=q("sched-dialog");return T(),B(H,null,[t.showForm?(T(),B("div",to,[w(M,{class:"q-pl-xl justify-center",color:"","text-color":"green",elevated:"",label:"HideForm",onClick:o[0]||(o[0]=y=>t.showGoalForm=!t.showGoalForm),"no-caps":""}),w(r)])):_("",!0),t.showForm?_("",!0):(T(),B("div",oo,[w(ot,{onRefresh:t.onRefresh},{default:P(()=>[w(d,{onToday:t.onToday,onPrev:t.onPrev,onNext:t.onNext},null,8,["onToday","onPrev","onNext"]),A("div",io,[t.showReloadBtn?(T(),B("div",so,[w(c,{"text-label":"Reload",class:"q-mt-xl","text-color":"green",onDoBtnAction:t.onReloadSaved},null,8,["onDoBtnAction"])])):_("",!0),t.showClearBtn?(T(),B("div",lo,[w(c,{"text-label":"Clear",class:"q-mt-xl","text-color":"lime-5",onDoBtnAction:t.onClearDay},null,8,["onDoBtnAction"])])):_("",!0),t.showLoadDefaults?(T(),B("div",no,[w(c,{"text-label":"Defaults",class:"q-mt-xl","text-color":"blue",onDoBtnAction:t.onLoadDefault},null,8,["onDoBtnAction"])])):_("",!0),t.showScoreBtn?(T(),B("div",ro,[w(a,{class:"q-mt-xl","text-color":"teal",disableBtn:t.disableScoreBtn,optionLabel:t.chosenScoreLabel,daOptions:t.scoreOptions,onDoReload:t.onReloadWithScore,onChooseOption:t.chooseScore},null,8,["disableBtn","optionLabel","daOptions","onDoReload","onChooseOption"])])):_("",!0),t.showPrio?(T(),B("div",ao,[w(a,{class:"q-mt-xl","text-color":"teal",disableBtn:t.disablePrioBtn,optionLabel:t.chosenPrioLabel,daOptions:t.setGoalsPrio(),onDoReload:t.onReloadWithPrio,onChooseOption:t.choosePrio},null,8,["disableBtn","optionLabel","daOptions","onDoReload","onChooseOption"])])):_("",!0)])]),_:1},8,["onRefresh"]),A("div",ho,[A("div",co,[w(S,{ref:"calendar",view:"day",modelValue:t.currentDate,"onUpdate:modelValue":o[5]||(o[5]=y=>t.currentDate=y),"drag-enter-func":t.onDragEnter,"drag-over-func":t.onDragOver,"drag-leave-func":t.onDragLeave,"drop-func":t.onDrop,animated:"",bordered:"",hoverable:"","no-active-date":"","transition-next":"slide-left","transition-prev":"slide-right","time-clicks-clamped":"","interval-minutes":15,"interval-count":96,"interval-height":28,"selected-start-end-dates":t.startEndTimes,onChange:t.onChange,onClickDate:t.onClickDate,onClickTime:t.onClickTime,onClickInterval:t.onClickInterval,onClickHeadIntervals:t.onClickHeadIntervals,onClickHeadDay:t.onClickHeadDay,onMousedownTime:t.onMouseDownTime,onMouseupTime:t.onMouseUpTime,onMousemoveTime:t.onMouseMoveTime},{"head-day-event":P(({scope:{timestamp:y}})=>[A("div",uo,[(T(!0),B(H,null,ue(t.eventsMap[y.date],b=>(T(),B(H,{key:b.id},[b.time?(T(),L(Ee,{key:1,class:oe(t.badgeClasses(b,"header")),style:Y([t.badgeStyles(b,"header"),{margin:"1px",width:"10px","max-width":"10px",height:"10px","max-height":"10px",cursor:"pointer"}]),onClick:D=>t.scrollToEvent(b)},{default:P(()=>[w(ge,null,{default:P(()=>[U(V("("+b.id+") "+b.title+" - "+b.time),1)]),_:2},1024)]),_:2},1032,["class","style","onClick"])):(T(),L(Ee,{key:0,class:oe(t.badgeClasses(b,"header")),style:Y([t.badgeStyles(b,"header"),{width:"100%",cursor:"pointer",height:"12px","font-size":"10px",margin:"1px"}])},{default:P(()=>[A("div",fo,[U(V(b.title)+" ",1),w(ge,null,{default:P(()=>[U(V(b.details),1)]),_:2},1024)])]),_:2},1032,["class","style"]))],64))),128))])]),"day-container":P(({scope:{days:y}})=>[t.hasDate(y)?(T(),B(H,{key:0},[A("div",{class:"day-view-current-time-indicator",style:Y(t.style)},null,4),A("div",{class:"day-view-current-time-line",style:Y(t.style)},null,4)],64)):_("",!0)]),"day-body":P(({scope:{timestamp:y,timeStartPos:b,timeDurationHeight:D}})=>[(T(!0),B(H,null,ue(t.getDateEvents(y.date),R=>(T(),B(H,{key:R.id},[R.time!==void 0?(T(),B("div",{key:0,class:oe(["my-event",t.badgeClasses(R,"body")]),style:Y(t.badgeStyles(R,"body",b,D)),draggable:!0,onDblclick:se(C=>t.onDblClickEvent(C,R),["prevent"]),onDragstart:se(C=>t.onDragStart(C,R),["stop"]),onDragend:o[1]||(o[1]=se((...C)=>t.onDragEnd&&t.onDragEnd(...C),["stop"])),onDrop:o[2]||(o[2]=C=>t.onDrop(C,"goal-item",t.scope)),onDragenter:o[3]||(o[3]=C=>t.onDragEnter(C,"goal-item",t.scope)),onDragover:o[4]||(o[4]=C=>t.onDragOver(C,"goal-item",t.scope))},[w(u,{disabledScore:t.disabledScoreEvts[R.id],title:R.title,id:R.id,startTime:R.time,score:R.score,details:R.details,happeningNow:t.hasStarted[R.id]?t.hasStarted[R.id]:!1,onEndNow:t.onEndNow,onSaveScore:t.onSaveScore,onAddMins:t.onAddMins,onDeleteNow:C=>t.removeEvtInSchedule(R,C)},null,8,["disabledScore","title","id","startTime","score","details","happeningNow","onEndNow","onSaveScore","onAddMins","onDeleteNow"])],46,go)):_("",!0)],64))),128))]),_:1},8,["modelValue","drag-enter-func","drag-over-func","drag-leave-func","drop-func","selected-start-end-dates","onChange","onClickDate","onClickTime","onClickInterval","onClickHeadIntervals","onClickHeadDay","onMousedownTime","onMouseupTime","onMousemoveTime"])]),t.addEventDialog?(T(),L(E,{key:0,parentGoals:t.storedCompPG,canBeScheduled:t.canbeScheduled,onOnAddNewEvent:t.onAddNewEvent,onOnPickEvent:t.onPickEvent,onEuhHidin:t.closingDialog},null,8,["parentGoals","canBeScheduled","onOnAddNewEvent","onOnPickEvent","onEuhHidin"])):_("",!0)]),A("div",mo,[w(M,{class:"q-mt-xl",color:"Green","text-color":"blue",elevated:"",label:"SaveSchedule",disable:t.doDisableSaveSchedule,onClick:t.doSaveSchedule,"no-caps":""},null,8,["disable","onClick"]),w(M,{class:"q-mt-xl",color:"","text-color":"green",elevated:"",label:"ShowForm",onClick:o[6]||(o[6]=y=>t.showGoalForm=!t.showGoalForm),"no-caps":""})]),po,t.treeGoals.length>0?(T(),B("div",vo,[A("div",So,V(t.labelGoals()),1),w(ee),Eo,w(at,{nodes:t.treeGoals,"node-key":"label",expanded:t.expanded,"onUpdate:expanded":o[7]||(o[7]=y=>t.expanded=y),"no-connectors":"",dense:"","default-expand-all":""},{"default-header":P(y=>[A("div",{class:oe(t.classyColor(y.node))},[w(De,{name:y.node.icon||"arrow",size:"28px",class:"q-mr-sm"},null,8,["name"]),A("div",yo,V(y.node.label),1)],2)]),"default-body":P(y=>[y.node.isChildren?(T(),B("div",wo,[A("span",Co," >> "+V(y.node.details),1)])):(T(),B("span",bo,V(y.node.details),1))]),_:1},8,["nodes","expanded"])])):_("",!0)]))],64)}var Bo=Q(eo,[["render",$o],["__scopeId","data-v-1167947a"]]);export{Bo as default};
