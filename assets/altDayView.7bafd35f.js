import{j as st,U as nt,W as rt,r as k,c as de,w as Ve,n as at,h as pe,k as Ne,ay as dt,D as ht,g as Ye,az as ct,ad as Pe,v as ut,aA as ft,aa as ye,aC as Fe,ab as Ae,Z as gt,d as mt,_ as Xe,E as M,F as Q,G as L,H as A,M as x,K as J,a1 as Oe,bs as St,bt as pt,a0 as Ze,I as H,bu as yt,N as De,a3 as vt,bq as bt,$ as se,L as ie,O as F,J as oe,Q as $e,a2 as ve,bv as Ot,R as he,P as Me,a5 as me,a4 as ne,aS as _e,f as Dt,a6 as Ct,a7 as Et}from"./index.2c41191f.js";import{w as V,c as re,p as Tt,a as Rt,b as wt,d as Nt,Q as be}from"./utiFunc.66dd79fc.js";import{T as Pt,Q as At,a as $t}from"./QSelect.13f9b917.js";import{c as ke,a as Mt,u as _t,Q as Ie}from"./goalStorage.b43d9204.js";import{t as Ce,E as He,b as Y,a as _,p as j,d as te,U as ae,i as Be,V as kt,m as Le,l as ce,c as Ue,Q as It,e as Bt}from"./QCalendarTask.a1ce4fb1.js";import{a as Lt}from"./QCalendar.8094c9b7.js";/* empty css                             */import"./touch.70a9dd44.js";import"./QItem.49a304e8.js";var qe=st({name:"QSplitter",props:{...nt,modelValue:{type:Number,required:!0},reverse:Boolean,unit:{type:String,default:"%",validator:i=>["%","px"].includes(i)},limits:{type:Array,validator:i=>i.length!==2||typeof i[0]!="number"||typeof i[1]!="number"?!1:i[0]>=0&&i[0]<=i[1]},emitImmediately:Boolean,horizontal:Boolean,disable:Boolean,beforeClass:[Array,String,Object],afterClass:[Array,String,Object],separatorClass:[Array,String,Object],separatorStyle:[Array,String,Object]},emits:["update:modelValue"],setup(i,{slots:e,emit:t}){const{proxy:{$q:o}}=Ye(),l=rt(i,o),s=k(null),n={before:k(null),after:k(null)},r=de(()=>`q-splitter no-wrap ${i.horizontal===!0?"q-splitter--horizontal column":"q-splitter--vertical row"} q-splitter--${i.disable===!0?"disabled":"workable"}`+(l.value===!0?" q-splitter--dark":"")),a=de(()=>i.horizontal===!0?"height":"width"),g=de(()=>i.reverse!==!0?"before":"after"),p=de(()=>i.limits!==void 0?i.limits:i.unit==="%"?[10,90]:[50,1/0]);function d(c){return(i.unit==="%"?c:Math.round(c))+i.unit}const h=de(()=>({[g.value]:{[a.value]:d(i.modelValue)}}));let D,u,C,E,v;function R(c){if(c.isFirst===!0){const b=s.value.getBoundingClientRect()[a.value];D=i.horizontal===!0?"up":"left",u=i.unit==="%"?100:b,C=Math.min(u,p.value[1],Math.max(p.value[0],i.modelValue)),E=(i.reverse!==!0?1:-1)*(i.horizontal===!0?1:o.lang.rtl===!0?-1:1)*(i.unit==="%"?b===0?0:100/b:1),s.value.classList.add("q-splitter--active");return}if(c.isFinal===!0){v!==i.modelValue&&t("update:modelValue",v),s.value.classList.remove("q-splitter--active");return}const S=C+E*(c.direction===D?-1:1)*c.distance[i.horizontal===!0?"y":"x"];v=Math.min(u,p.value[1],Math.max(p.value[0],S)),n[g.value].value.style[a.value]=d(v),i.emitImmediately===!0&&i.modelValue!==v&&t("update:modelValue",v)}const f=de(()=>[[Pt,R,void 0,{[i.horizontal===!0?"vertical":"horizontal"]:!0,prevent:!0,stop:!0,mouse:!0,mouseAllDir:!0}]]);function y(c,S){c<S[0]?t("update:modelValue",S[0]):c>S[1]&&t("update:modelValue",S[1])}return Ve(()=>i.modelValue,c=>{y(c,p.value)}),Ve(()=>i.limits,()=>{at(()=>{y(i.modelValue,p.value)})}),()=>{const c=[pe("div",{ref:n.before,class:["q-splitter__panel q-splitter__before"+(i.reverse===!0?" col":""),i.beforeClass],style:h.value.before},Ne(e.before)),pe("div",{class:["q-splitter__separator",i.separatorClass],style:i.separatorStyle,"aria-disabled":i.disable===!0?"true":void 0},[dt("div",{class:"q-splitter__separator-area absolute-full"},Ne(e.separator),"sep",i.disable!==!0,()=>f.value)]),pe("div",{ref:n.after,class:["q-splitter__panel q-splitter__after"+(i.reverse===!0?"":" col"),i.afterClass],style:h.value.after},Ne(e.after))];return pe("div",{class:r.value,ref:s},ht(e.default,c))}}}),xt=ct({name:"touch-hold",beforeMount(i,e){const{modifiers:t}=e;if(t.mouse!==!0&&Pe.has.touch!==!0)return;const o={handler:e.value,noop:ut,mouseStart(s){typeof o.handler=="function"&&ft(s)===!0&&(ye(o,"temp",[[document,"mousemove","move","passiveCapture"],[document,"click","end","notPassiveCapture"]]),o.start(s,!0))},touchStart(s){if(s.target!==void 0&&typeof o.handler=="function"){const n=s.target;ye(o,"temp",[[n,"touchmove","move","passiveCapture"],[n,"touchcancel","end","notPassiveCapture"],[n,"touchend","end","notPassiveCapture"]]),o.start(s)}},start(s,n){o.origin=Fe(s);const r=Date.now();Pe.is.mobile===!0&&(document.body.classList.add("non-selectable"),ke(),o.styleCleanup=a=>{o.styleCleanup=void 0;const g=()=>{document.body.classList.remove("non-selectable")};a===!0?(ke(),setTimeout(g,10)):g()}),o.triggered=!1,o.sensitivity=n===!0?o.mouseSensitivity:o.touchSensitivity,o.timer=setTimeout(()=>{o.timer=void 0,ke(),o.triggered=!0,o.handler({evt:s,touch:n!==!0,mouse:n===!0,position:o.origin,duration:Date.now()-r})},o.duration)},move(s){const{top:n,left:r}=Fe(s);o.timer!==void 0&&(Math.abs(r-o.origin.left)>=o.sensitivity||Math.abs(n-o.origin.top)>=o.sensitivity)&&(clearTimeout(o.timer),o.timer=void 0)},end(s){Ae(o,"temp"),o.styleCleanup!==void 0&&o.styleCleanup(o.triggered),o.triggered===!0?s!==void 0&&gt(s):o.timer!==void 0&&(clearTimeout(o.timer),o.timer=void 0)}},l=[600,5,7];if(typeof e.arg=="string"&&e.arg.length>0&&e.arg.split(":").forEach((s,n)=>{const r=parseInt(s,10);r&&(l[n]=r)}),[o.duration,o.touchSensitivity,o.mouseSensitivity]=l,i.__qtouchhold=o,t.mouse===!0){const s=t.mouseCapture===!0||t.mousecapture===!0?"Capture":"";ye(o,"main",[[i,"mousedown","mouseStart",`passive${s}`]])}Pe.has.touch===!0&&ye(o,"main",[[i,"touchstart","touchStart",`passive${t.capture===!0?"Capture":""}`],[i,"touchend","noop","notPassiveCapture"]])},updated(i,e){const t=i.__qtouchhold;t!==void 0&&e.oldValue!==e.value&&(typeof e.value!="function"&&t.end(),t.handler=e.value)},beforeUnmount(i){const e=i.__qtouchhold;e!==void 0&&(Ae(e,"main"),Ae(e,"temp"),e.timer!==void 0&&clearTimeout(e.timer),e.styleCleanup!==void 0&&e.styleCleanup(),delete i.__qtouchhold)}});const Gt=()=>!!/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);let fe,z;function Vt(){fe={},z=Mt()}function Ft(){fe.pGoalsMap==null;const i=new Map;let e=et();return e?(e.forEach(t=>{i.set(t.id,t)}),fe.pGoalsMap=i,i):(console.log("Repo:: parentGoalsMap is empty or null",e),i)}function Ht(i){return z.hasEventsForDate(i)}function je(i){return z.getEventsForDate(i)}function et(){return z.getMainGoals}function Ut(){return fe.subGoals==null&&(fe.subGoals=z.getSubGoals),fe.subGoals}function qt(){return z.fetchAlternativeEvts()}function jt(){return z.currentBalance()}function zt(){return z.fetchGoalsTree()}function Wt(){let i=z.fetchAllPrio();return!i.size>0?(console.log("ERROR...no Priority goals?",i),[]):Array.from(i.values()).sort()}function ze(i){return z.fetchGoalsUpToMaxScore(i)}function We(i,e=null,t=null){z.saveSubProp(i,e,t)}function Jt(){return z.getGoalByTitle("Misc")}function Je(i){z.setBalance(i)}function Qe(i,e){z.saveDailySchedule(i,e)}function Qt(i,e,t,o){return z.addMainGoal(i,e,t,o)}function ue(i,e,t,o,l,s,n,r,a){return z.addSubGoal(i,e,t,o,l,s,n,r,a)}function Kt(i,e,t=null){let o=i,l=e.id,s=e,n=t,r=i.duration,a=i.time,g=null,p=null;return{id:l,duration:r,time:a,date:()=>g,datey:d,score:h(),atScore:o.atScore,getGoal:()=>s,getPGoal:()=>n,data:()=>o,setData:c=>o=c,setMoods:c=>p=c,getMoods:E,setNotes:c=>c,hasNote:D,setDura:c=>r=c,setTime:c=>a=c,setDate:c=>g=c,durationChanged:u,timeChanged:C,parsedScore:v,withPropsEventsTo:f,addPropsEventsTo:y};function d(){return g}function h(){return o.atScore||e.score}function D(){return i.notes!==void 0}function u(){return i.duration!==e.duration}function C(){return i.time!==e.time}function E(){return"byMood"in o&&(p=o.byMood),p}function v(){const c=h().split(/on/);return c.length!=2?-89:c[1]-c[0]}function R(c){if(!c)return"";let S=c.split(":");return parseInt(S[0])>=12?c+"PM":c+"AM"}function f(c,S=null){let O=Object.assign({},{...this});return O.bgcolor=c.bgcolor,O.jeSuis?O.details=`Of '${c.title.trim()}' :: << ${O.jeSuis.join(",")} >>`:O.details=`Of '${c.title.trim()}' :: ${R(O==null?void 0:O.time)} -> ${O==null?void 0:O.duration}min -- ${O!=null&&O.inDefaults?"Dft:":":"}${O!=null&&O.canMove?":Mv:":":"}${O!=null&&O.isAlternative?":Alt":":"}`,console.log("withProps",JSON.parse(JSON.stringify(O)),O.datey(),O.date(),O.title,O.details),O}function y(c){if(!n){console.log("addProps:: ERROR no parentGoal",this.data);return}this.data,getGoal();let S=Object.assign({},{...sav});return S.bgcolor=t.bgcolor,S.jeSuis?S.details=`Of '${t.title.trim()}' :: << ${S.jeSuis.join(",")} >>`:S.details=`Of '${t.title.trim()}' :: ${R(S==null?void 0:S.time)} -> ${S==null?void 0:S.duration}min -- ${S!=null&&S.inDefaults?"Dft:":":"}${S!=null&&S.canMove?":Mv:":":"}${S!=null&&S.isAlternative?":Alt":":"}`,console.log("addProps",JSON.parse(JSON.stringify(S)),S.datey(),S.date(),S.title,S.details),S}}class Yt{constructor(e,t){this.showReloadBtn=!1,this.showClearBtn=!1,this.showLoadDefaults=!0,this.showScoreBtn=!0,this.showPrioBtn=!0,this.showOneEachBtn=!1,this.disablePrioBtn=!0,this.disableScoreBtn=!0,this.disableSaveSchedule=!0,this.chosenScore=null,this.chosenPrio=null,this._dailyScheduled=new Map,this._endTimesSet=new Set,this._startTimesSet=new Set,this.savedRawEvts=[],this.usingMoods={},this.isDisabledScoreEdit={},this.hasStarted={},this.mobileEnableScore={},this.showMobileDialog={},this.currentDate=e,this.mobile=t,Vt()}allPGoals(){return et()}getAllEvts(){return this._dailyScheduled}showEvtNoteScoreMobile(e){return this.mobileEnableScore[e]&&this.showMobileDialog[e]}toggleEvtNoteScoreMobile(e){(this.isViewingPast()||this.isViewingToday())&&(this.showMobileDialog[e]=!0)}euhHidin(e){this.showMobileDialog[e]=!1}getCurrentSchedTimesSets(){return{endSet:this._endTimesSet,startSet:this._startTimesSet}}isViewingPast(){let e=Ce();if(this.currentDate&&this.currentDate==e)return!1;let t=He(Y(e));return!(He(Y(this.currentDate))>=t)}isViewingToday(){return Ce()==this.currentDate}toggle(){this.showReloadBtn=!this.showReloadBtn}getProps(){return{showReloadBtn:this.showReloadBtn,showClearBtn:this.showClearBtn,showLoadDefaults:this.showLoadDefaults,showScoreBtn:this.showScoreBtn,showPrioBtn:this.showPrioBtn,showOneEachBtn:this.showOneEachBtn,disablePrioBtn:this.disablePrioBtn,disableScoreBtn:this.disableScoreBtn,chosenScore:this.chosenScore,chosenPrio:this.chosenPrio}}saveBtnEnabled(){return this.disableSaveSchedule}fetchGoalsTree(){return zt()}getCurrentBalance(){return jt()}getAllPrio(){return Wt()}getSubGoals(){return Ut()}getCurrentMoods(){return this.usingMoods}getSubGoalByID(e){let t=this.getSubGoals(),o=parseInt(e);for(let l=0;l<t.length;l++)if(t[l].id===o)return t[l];return null}getOriginalEvtTime(e){let t=this.getSubGoalByID(e);return t?t.time:""}getStoredRawEvt(e){return this.savedRawEvts&&e in this.savedRawEvts?this.savedRawEvts[e]:null}getAltEvts(){return qt()}getEventsForDate(e){return je(e)}updateDaySchedule(e,t){Qe(e,t)}parentGoalsMap(){return Ft()}parentGoalById(e){return this.parentGoalsMap().has(e)?this.parentGoalsMap().get(e):null}findSchedEvent(e){return this._dailyScheduled.has(e)?this._dailyScheduled.get(e):null}hasEventsForDate(){return Ht(this.currentDate)}scheduledEventsMap(){const e={};return this._dailyScheduled.forEach((t,o,l)=>{let s=t.date;e[s]||(e[s]=[]),e[s].push(t)}),e}schedEvtWithProps(e,t,o){if(!e.getPGoal()){console.log("schedEvtWithProps:: ERROR no parentGoal",e.data);return}let l=e.data(),s=e.getGoal(),n=e.getPGoal(),r={...s};(e.timeChanged()||e.durationChanged())&&(r.time=l.time,r.duration=l.duration),e.setDate(this.currentDate);let a=e.getMoods();if(a){//!==
this.usingMoods[r.id]=a}r.date=this.currentDate,r.bgcolor=n.bgcolor,r.icon=n.icon,r.start=t,r.end=o;let g=`Of '${n.title.trim()}' :: ${V(r==null?void 0:r.time)} -> ${r==null?void 0:r.duration}min -- ${r!=null&&r.inDefaults?"Dft:":":"}${r!=null&&r.canMove?":Mv:":":"}${r!=null&&r.isAlternative?":Alt":":"}`;return r.jeSuis&&r.jeSuis.length>0&&(g+=a?` <>Mood:'${a}' >>${r.jeSuis.join(",")}`:` << ${r.jeSuis.join(",")} >>`),r.details=g,e.hasNote()&&(r.notes=l.notes),r}doProppy(e,t){let o=this.parentGoalById(e.parentGoal);if(!o){console.log("doProppy:: ERROR no Pgoal found ?!?",e);return}let l=_(Y(t),{minute:j(e.time)}),s=_(l,{minute:e.duration}),n=Object.assign({},{...e,date:t,bgcolor:o.bgcolor,start:l,end:s,icon:o.icon});return e.jeSuis&&e.jeSuis.length>0?n.details=`Of '${o.title.trim()}' :: << ${e.jeSuis.join(",")} >>`:n.details=`Of '${o.title.trim()}' :: ${V(e==null?void 0:e.time)} -> ${e==null?void 0:e.duration}min -- ${e!=null&&e.inDefaults?"Dft:":":"}${e!=null&&e.canMove?":Mv:":":"}${e!=null&&e.isAlternative?":Alt":":"}`,"byMood"in e&&(console.log("doProppy::BYMOOD found!! "+n.id,JSON.parse(JSON.stringify(e))),this.usingMoods[n.id]=e.byMood),n}updateDetz(e){var l,s;let o=`Of '${(s=(l=this.parentGoalById(e.parentGoal))==null?void 0:l.title)==null?void 0:s.trim()}' :: ${V(e==null?void 0:e.time)} -> ${e==null?void 0:e.duration}min -- ${e!=null&&e.inDefaults?"Dft:":":"}${e!=null&&e.canMove?":Mv:":":"}${e!=null&&e.isAlternative?":Alt":":"}`;return e.jeSuis&&e.jeSuis.length>0&&(o+=this.usingMoods[e.id]?` <> Mood:'${this.usingMoods[e.id]}' >>${e.jeSuis.join(",")}`:` << ${e.jeSuis.join(",")} >>`),e.details=o,e}massageManyToOneOverlaps(e){let t=[],o=()=>{let r=[];return e.filter(a=>{a[0]=="withID"&&r.push(a[1])}),r},l=e.filter(r=>r[0]!="withID"),s=o(),n=[];for(let r=0;r<l.length;r++){let a=l[r][0];if(s.some(p=>p==a))n.push(...l[r][1]);else if(t.find(d=>d[0]==a)){let d=t.findIndex(h=>h[0]==a);t[d]=[a,[...t[d][1],...l[r][1]]]}else t.push([a,[...l[r][1]]])}if(t.length<1&&n.length>0)return this.doLog("massageManyToOneOverlaps::ONETOMANY!! returning original >> "+t.length+" vs "+n.length,e),e;if(n.length>0){this.doLog("massageManyToOneOverlaps::ADD SAMEY",n);let r=null,a=[];for(let p=0;p<n.length;p++){let d=n[p];t.find(D=>D[0]==d.inConflict)||(d.target!=r?(t.push([d.inConflict,[d]]),a.push(d.target)):console.log("massageManyToOneOverlaps::INCONF same current target? ERROR?",r,d))}let g=s.filter(p=>!a.some(d=>d==p));if(g.length>0){let p=0;do{let d=g[p],h=n.filter(D=>D.target==d);console.log("massageManyToOneOverlaps::ADDING",d,h),t.push([d,[...h]]),t.find(D=>D[0]=="withID")?console.log("WOAH WOAH massageManyToOneOverlaps::WITHID already present?!!ERROR ",t):t.push(["withID",d])}while(++p<g.length)}}return this.doLog("massageManyToOneOverlaps::RETURNING",t),t}massageOneToMany(e){let t=[],o={};for(let l=0;l<e.length;l++){let s=e[l],n=t.find(r=>r[0]==s.inConflict);if(n){let r=t.findIndex(a=>a[0]==s.inConflict);t[r]=[s.inConflict,[...n[1],s]]}else if(!o[s.target])o[s.target]=[],o[s.target].push(s),t.push([s.inConflict,[s]]);else{let r=t.find(a=>a[0]=="withID");if(r){let a=t.findIndex(p=>p[0]=="withID"),g=t.findIndex(p=>p[0]==s.target);t[g]=[s.target,[...t[g][1],s]],s.target==r[1]||(t[a]=["withID",[t[a][1],s.target]])}else{let a=t.pop();t.push([s.target,[...a[1],s]]),t.push(["withID",s.target])}}}return t}addGoalsToSchedule(e,t){let o=[];return e.sort(function(l,s){return j(l.time)-j(s.time)}),e.forEach(l=>{let s=this.addToSchedule(l,t,!1);if(!s)console.log("addGoalsToSchedule:: ERROR Evt NOT added",s,t,l.id,l.title,l.time);else if(Array.isArray(s)){let n=s.length>1&&s.find(a=>a[0]=="withID"),r={e:l,ov:s[0],withID:n};o.push(r)}}),this.recheckOverlaps(o)}addToSchedule(e,t,o=!1){if(this._dailyScheduled.has(e.id))return console.log("addToSchedule--NOT added! present?!!?",t,e.title),!1;{let l=_(Y(this.currentDate),{minute:j(e.time)}),s=_(l,{minute:e.duration});if(t){let a=this.hasOverlappingEvent(e.id,l,s);if(a.length>0)return this.massageOneToMany(a)}let n=o?this.schedEvtWithProps(e,l,s):this.doProppy(e,this.currentDate);n.sortTime=l;let r={...n,start:l,end:s};return this._dailyScheduled.set(n.id,r),this._endTimesSet.add(s.time),this._startTimesSet.add(l.time),this.enableNoteScoreEdit(n.id,l,s),!0}}reAddScheduled(e){let t=this.findSchedEvent(e),o=this.getStoredRawEvt(e);console.log(`reAddScheduled for ${e} ${t?"":"ERROR NOT IN?"}`,t,o)}doSortingByTime(e){let t=(l,s)=>{let n=j(l[1].time),r=j(s[1].time);return n<r?-1:r>n?1:0};const o=[];for(let l in e)o.push([l,e[l]]);return o.sort(t),this.doLog("doSortingByTime---After",o),Object.fromEntries(o)}anotherSorting(e){return Object.entries(e).sort(([,o],[,l])=>j(o.time)-j(l.time))}enrichAddToSchedule(){let e=[],t=this.isViewingToday();console.log("enrichAddToSchedule",Object.keys(this.savedRawEvts).length,"overlapCheck:"+t);let o=this.anotherSorting(this.savedRawEvts);for(let l=0;l<o.length;l++){let s=o[l][0],n=o[l][1],r=this.getSubGoalByID(s);if(!r){console.log(`enrichAddToSchedule:: ERROR No goal found for key: ${s}...skipping!`);continue}let a=this.parentGoalById(r.parentGoal),g=Kt(n,r,a),p=this.addToSchedule(g,t,!0);if(!p)console.log("enrichAddToSchedule..ERROR?!? not added",p,r);else if(Array.isArray(p)){let d=p.length>1&&p.find(D=>D[0]=="withID"),h={e:g,ov:p[0],withID:d};e.push(h)}}return this.recheckOverlaps(e)}recheckOverlaps(e){let t=[];const o=s=>{let n=t.find(r=>r[0]==s[0]);if(n){let r=t.findIndex(a=>a[0]==s[0]);t[r]=[s[0],[...n[1],...s[1]]]}else t.push(s)};let l=null;for(let s=0;s<e.length;s++){let n=e[s].e,r=e[s].ov;if(r[1].length>1){e[s].withID?(t.push(r),t.push(e[s].withID)):this.doLog("recheckOverlaps::MULTI Overlaps!!...umm NOT withID?!?ERROR?",e[s]);continue}let a=e.filter(h=>h.ov[0]==r[0]);if(a.length>1){if(e[s].withID&&this.doLog("recheckOverlaps::filter >>Multiple withID?!?ERROR?"+n.id+" "+r[0],a),r[0]==l)continue;let h=0;do o(a[h].ov);while(++h<a.length);l=r[0];continue}let g=_(Y(this.currentDate),{minute:j(n.time)}),p=_(g,{minute:n.duration}),d=this.hasOverlappingEvent(n.id,g,p);d.length>0?d.length>r[1].length?(console.log("recheckOverlaps::EXTRA for "+n.id,a.length,JSON.parse(JSON.stringify(d)),JSON.parse(JSON.stringify(r[1]))),t.push(...this.massageOneToMany(d))):o(r):console.log("recheckOverlaps::ERROR>>hasOverlappingEvent no overlap?!?",n.id,d)}return t}loadEvtsForDay(e){return e||this.resetSchedule(!0),this.savedRawEvts=je(this.currentDate),this.savedRawEvts?{overlaps:this.enrichAddToSchedule(),canContinue:!1}:{overlaps:null,canContinue:!0}}onChangeViewDate(e){let t=e==this.currentDate;return this.currentDate=e,this.enableActionBtns(),this.loadEvtsForDay(t)}resetSchedule(e=!1){this.savedRawEvts=[],this._dailyScheduled=new Map,this._endTimesSet=new Set,this._startTimesSet=new Set,e&&(this.usingMoods={}),this.showReloadBtn=!1,this.showClearBtn=!1,this.disableSaveSchedule=!0}unscheduledDefaults(){return this.getSubGoals().filter(t=>(t==null?void 0:t.inDefaults)&&(t==null?void 0:t.time)!=""&&!this._dailyScheduled.has(t.id));//!this.actualEvts.find(x => x.id == evt.id))
}unscheduledDefaultEvts(){return this.unscheduledDefaults().length}unscheduled(){return this.getSubGoals().filter(t=>!this._dailyScheduled.has(t.id));//!this.actualEvts.find(item => item.id == x.id)
}subGoalsOfParent(e){return this.getSubGoals().filter(o=>o.parentGoal==e)}chosenScoreLabel(){return this.chosenScore==null?"By Score":`Score <= ${this.chosenScore}`}chosenPrioLabel(){return this.chosenPrio==null?"By Priority":`Prio == ${this.chosenPrio}`}filterSchedToCurrentPrio(){let e=[];return this._dailyScheduled.forEach((t,o,l)=>{var s;((s=this.parentGoalById(t.parentGoal))==null?void 0:s.priority)==this.chosenPrio&&e.push(t)}),e}calculatePrioEvts(){let e=this.getSubGoals().filter(o=>{var l;return((l=this.parentGoalById(o.parentGoal))==null?void 0:l.priority)==this.chosenPrio}),t=e.filter(o=>!this._dailyScheduled.has(o.id));//!this.actualEvts.find(item => item.id == x.id)) //add those not scheduled
this.byPrio={prio:this.chosenPrio,toAdd:t,reset:e,filter:this.filterSchedToCurrentPrio()}}onChoosenPrio(e){let t=this.chosenPrio;t&&t==e?this.disablePrioBtn=!0:(this.chosenPrio=e,this.disablePrioBtn=!1,this.calculatePrioEvts())}scheduleSamePrio(e,t=!1){const o=r=>{console.log("scheduleSamePrio::RECALCULATE?!?",r,this.chosenPrio,JSON.parse(JSON.stringify(this.byPrio)));let a=this.getSubGoals().filter(g=>{var p;return((p=this.parentGoalById(g.parentGoal))==null?void 0:p.priority)==this.chosenPrio});return r=="reset"?a:a.filter(g=>!this._dailyScheduled.has(g.id));//!this.actualEvts.find(item => item.id == x.id)
};let l=[];if(e=="filter"?(l=this.filterSchedToCurrentPrio(),this.resetSchedule()):(this.byPrio?e=="add"?l=this.byPrio.toAdd:l=this.byPrio.reset:l=o(e),e!="add"&&this.resetSchedule()),l.length<1)return{overlaps:null,canContinue:!1};let s=this.addGoalsToSchedule(l,!t),n=s.length;return this.updateCurrentMoods(),this.toggleActionBtns(l.length-n>0,"byPrio"),{overlaps:s,canContinue:!(n>0),added:l.length-n}}filterSchedToCurrentScore(){let e=[];return this._dailyScheduled.forEach((t,o,l)=>{let s=re(t.score);s>-1&&s<=this.chosenScore&&e.push(t)}),e}calculateScoreEvts(){let e=ze(this.chosenScore),t=e.filter(o=>!this._dailyScheduled.has(o.id));//!this.actualEvts.find(item => item.id == x.id)
this.byScore={score:this.chosenScore,toAdd:t,reset:e,filter:this.filterSchedToCurrentScore()}}onChoosenScore(e){let t=this.chosenScore;t&&t==e?this.disableScoreBtn=!0:(this.chosenScore=e,this.disableScoreBtn=!1,this.calculateScoreEvts())}scheduleByScore(e,t=!1){const o=r=>{console.log("scheduleByScore::RECALCULATE?!?",r,this.chosenScore,JSON.parse(JSON.stringify(this.byScore)));let a=ze(this.chosenScore);return r=="reset"?a:a.filter(g=>!this._dailyScheduled.has(g.id))};let l=[];if(e=="filter"?(l=this.filterSchedToCurrentScore(),this.resetSchedule()):(this.byScore?e=="add"?l=this.byScore.toAdd:l=this.byScore.reset:l=o(e),e!="add"&&this.resetSchedule()),l.length<1)return{overlaps:null,canContinue:!1};let s=this.addGoalsToSchedule(l,!t),n=s.length;return this.updateCurrentMoods(),this.toggleActionBtns(n>0,"byScore"),{overlaps:s,canContinue:!(n>0),added:l.length-n}}scheduleOneEach(e,t=!1,o=null){const l=g=>{let p=[];return this.parentGoalsMap().forEach((d,h,D)=>{let u=this.subGoalsOfParent(d.id);if(u.length>0){let C=null,E=u.length;if(g)C=u[Math.floor(Math.random()*E)];else{let v=0;for(;this._dailyScheduled.has(u[E].id);)if(v++,E=Math.floor(Math.random()*u.length),console.log(`selectOneFromP::index ${E} scheduled...new random> At try> `+v,u.length),v>2){console.log("selectOneFromP::random...TOO MANY TRIES..ERROR?",v,E,u.length,u);break}C=u[E],console.log("selectOneFromP::NO Random at index: "+E,v,C)}p.push(C)}else o&&o(`No Evt goal for Parent: '${d==null?void 0:d.title}'`,"warning")}),p},s=()=>{let g=this.unscheduled(),p=[];return this.parentGoalsMap().forEach((d,h,D)=>{let u=g.filter(E=>E.parentGoal==d.id),C=u.length;if(C>0){let E=u[Math.floor(Math.random()*C)];p.push(E)}else{let E=this.subGoalsOfParent(d.id).length>0,v=E?`All goals for Parent: '${d==null?void 0:d.title}' already scheduled`:`Parent: '${d==null?void 0:d.title}' has No Goals :(`;o&&o(v,E?"info":"warning")}}),p};let n=[];if(e=="add"?(n=s(),console.log("scheduleOneEach...TOADD>> "+n.length)):(this.resetSchedule(),n=l(!0)),n.length<1)return console.log("Empty for OneEach :("),{overlaps:null,canContinue:!1};let r=this.addGoalsToSchedule(n,!t),a=r.length;return this.updateCurrentMoods(),this.toggleActionBtns(n.length-a>0,"oneEach"),{overlaps:r,canContinue:!(a>0),added:n.length}}scheduleByMood(e){var s;let t=[];for(let n=0;n<e.length;n++){let r=this.getSubGoalByID(e[n].id);r&&r.time!=""&&(t.push(r),this.usingMoods[e[n].id]=(s=e[n])==null?void 0:s.mood)}if(t.length<1)return this.doLog("scheduleByMood::Error? as Empty Moods with toAdd ",e),{overlaps:null,canContinue:!1};let o=this.addGoalsToSchedule(t,this.isViewingToday()),l=o.length;return l>0||this.toggleActionBtns(t.length>0,"ByMood"),{overlaps:o,canContinue:!(l>0),added:t.length}}scheduleDefaults(e,t=!1){let o=null;e=="add"?o=this.unscheduledDefaults():(this.resetSchedule(),o=this.unscheduledDefaults()),this.showReloadBtn=this.hasEventsForDate(),this.showClearBtn=!this.isViewingPast()&&o.length>0;let l=this.addGoalsToSchedule(o,!t),s=l.length;return this.updateCurrentMoods(),this.toggleActionBtns(o.length-s>0,"defaults"),{overlaps:l,canContinue:!(s>0),added:o.length-s}}saveNewGoal(e,t,o,l,s){if(l=="self"){let n=this.addParentGoal(t,t,"red-14",2);return n?ue(n,t,"1on5",e.time,s,!0,!1,s<30):(console.log("ERROR? no pID",n),n===0?ue(n,t,"1on5",e.time,s,!0,!1,s<30):null)}else if(o){return console.log("with parentGoal "+o.id,o==null?void 0:o.title),ue(o.id,t,"1on5",e.time,s,!1,!1,s<30);//!canMove and notInDefaults. isAlternative when duration<30
}else{let n=Jt();if(n)return ue(n.id,t,"1on5",e.time,s,!1,!1,s<30);{let r=this.addParentGoal("Misc","Miscellaneous","grey-10",2);return r?ue(r,t,"1on5",e.time,s,!0,!1,s<30):(console.log("ERROR? no pID",r),r===0?ue(r,t,"1on5",e.time,s,!0,!1,s<30):null)}}}addParentGoal(e,t,o,l=2){let s=[];this.parentGoalsMap().forEach((r,a,g)=>{let p=r.bgcolor;s.push(p)});let n=Tt().filter(r=>!s.some(a=>a==r));if(n.length>1){let r=Math.floor(Math.random()*n.length),a=n[r];console.log(`addParentGoal::bgcolor..index ${r} from ${o} to:`,a),o=a}else console.log("addParentGoal::NONE available",n,AllColors);return Qt(e,t,o,l)}addMinsToEvt(e,t,o=null){const l=(d,h,D)=>{let u=d.end,C=this.updateDetz({...d,duration:h,end:D});return this._dailyScheduled.set(e,C),this._endTimesSet.delete(u.time)||console.log("ERROR endTimesSet item does not exist?!?"+u.time,d,this._endTimesSet),this._endTimesSet.add(D.time),o&&o(`${t} mins added to '${d==null?void 0:d.title}' Saving...`,"info"),this.saveDaySchedule(),{overlaps:null,canContinue:!0}};let s=this.findSchedEvent(e);if(!s){console.log("ERROR addMinsToEvt EVT not found!!!",e);return}let n=s.end,r=_(n,{minute:parseInt(t)}),a=parseInt(t)+s.duration,g=this.hasOverlappingEvent(e,s.start,r);return g.length>0?{overlaps:this.massageOneToMany(g),canContinue:!1}:l(s,a,r)}onPickEvent(e,t,o,l,s=null){const n=()=>{l&&(this.removeFromBalance(e==null?void 0:e.duration),console.log("onPickEvent...useBalance","force?"+o));let p=this.addToSchedule({...e,time:t.time},!1);return this.isViewingPast()||l?(s&&s(`onPickEvent::Added ${e==null?void 0:e.title}...Saving schedule`,"info"),this.saveDaySchedule()):this.toggleActionBtns(!0,"onPickEvt"),{overlaps:p,canContinue:!0}};let r=_(t,{minute:e.duration}),a=this.hasOverlappingEvent(e.id,t,r),g=a.length;if(g>0){console.log("onPickEvent::OVERLAPS!!"+g,"with force "+o,JSON.parse(JSON.stringify(a)));let p=this.massageOneToMany(a),d={overlaps:p,canContinue:!1};if(g>1||!o)return d;s&&s(`onPickEvent:: ${g} OVERLAPS! Forcing...`,"info"),this.toggleActionBtns(!0,"onPickEvt");for(let h=0;h<g;h++){let D=p[h][1],u=0;do this.recurChangeTime(D[u].inConflict,e,t,!0,s);while(++u<D.length)}return l&&this.removeFromBalance(e==null?void 0:e.duration),this.isViewingPast()||l?this.saveDaySchedule():this.toggleActionBtns(!0,"onPickEvt"),{overlaps:null,canContinue:!0}}else return n()}onAdHocEvent(e,t,o,l=null){const s=g=>(o?(this.removeFromBalance(g==null?void 0:g.duration),console.log("onAdHocEvent...using Balance",g==null?void 0:g.duration),this.saveDaySchedule(),l&&l("Saving Schedule with New adHoc...","positive")):l&&l("New adHoc Evt added!! ...doSave eh","info"),{overlaps:null,canContinue:!0});let n=this.getSubGoalByID(e);if(!n)return{overlaps:null,canContinue:!1};let r=this.addToSchedule(n,!0),a=Array.isArray(r);if(!r||a){let g={overlaps:r,canContinue:!1},p=r.length;if(a&&p>1)return g;if(a&&p==1){l&&l(`onAdHocEvent:: ${p} OVERLAPS! Forcing...`,"warning");for(let d=0;d<p;d++){let h=r[d][1],D=0;do this.recurChangeTime(h[D].inConflict,n,t,!0,l);while(++D<h.length)}return s(n)}return g}return s(n)}recurChangeTime(e,t,o,l=!1,s=null){var r,a,g,p,d;let n=this.findSchedEvent(e);if(n){let h=j(n.start.time)-j(o.time),D=`${h>0?"DOWN":"UP"}`,u=null;if(h>=0){u=_(o,{minute:parseInt(t.duration)+10});let f=_(o,{minute:parseInt(n.duration)+10});console.log(`recurChangeTime::START>>(${e}) '${n==null?void 0:n.title}' ${n==null?void 0:n.duration} mins going FORWARD ${D} for ${h} due to evt:(${t.id})${(r=t==null?void 0:t.title)==null?void 0:r.trim()} at ${o.time} 
          
 doAdd?:${l} >`,JSON.parse(JSON.stringify(u.time)),"alt:",f.time);let y=te(f,u);if(y>0){let c=Math.floor(y/1e3/60);c<=h?console.log(`recurChangeTime::(${e}) duration: ${n.duration} vs Target evtDura:${t.duration}...USING overlappedEvtNew ${u.time}!! ${c} <= dragInterval ${h} `,f.time):(console.log(`recurChangeTime::DIFFY = ${y} and ${c} >= dragInterval ${h}...
COULD USE ALTERNATIVE as duration:${n.duration} vs evtDura:${t.duration}`,u.time,f.time),h==0?u=f:console.log("recurChangeTime::NOT USING ALTERNATIVE",f.time))}}else{u=_(o,{minute:-(parseInt(n.duration)+10)});let f=_(o,{minute:-(parseInt(t.duration)+10)});console.log(`recurChangeTime::START>>(${e}) '${n==null?void 0:n.title}' going BACKWARD ${D} for ${h} due to evt:(${t.id})${(a=t==null?void 0:t.title)==null?void 0:a.trim()} at ${o.time}
          
 doAdd?:${l}`,u.time,"alt:"+f.time)}let C=this.hasOverlappingEvent(e,u,_(u,{minute:n.duration})),E=C.length;if(E>0){let f=0;s&&s(`${E} Cascading Overlaps handling (${e}) '${n==null?void 0:n.title}' going ${D} as ${l?"Adding":"Moving"} '${(g=t==null?void 0:t.title)==null?void 0:g.trim()}'`);do{if(console.log(`CASCADING OVERLAPPED timeChange >> ${f} (${e}) at: ${u.time} now at: ${n.start.time} till ${n.end.time}`,C[f]),C[f].inConflict==t.id){console.log(`EUUUH...ERROR::recurChangeTime::self overlap?!?OVERLAPPED:${e} ...break `+f,E,C[f].inConflict,t.id);break}this.recurChangeTime(C[f].inConflict,n,u,!1,s)}while(++f<E)}this.changeEvtTime(n,u);let v=o;if(!l){this.changeEvtTime(t,v);return}let R=this.addToSchedule({...t,time:v.time},this.isViewingToday());if(R.length>0){this.doLog(`recurChangeTime::TARGET extra OVERLAP ${l?"Adding":"Moving"} ${(p=t==null?void 0:t.title)==null?void 0:p.trim()}`,R),s&&s(`EXTRA OVERLAPS ${l?"Adding":"Moving"} TARGET ${(d=t==null?void 0:t.title)==null?void 0:d.trim()}`),R.find(S=>S[0]=="withID")&&(R=R.filter(S=>S[0]!="withID"),this.doLog("recurChangeTime::TARGET::WITHID!!!Now>>",R.length));let y=R.length,c=0;do{let S=R[c][1],b=S.length-1;for(;b>=0;b--){if(S[b].inConflict==t.id){console.log("EUUUH...::recurChangeTime::TARGET>>OVERLAP::self overlap?!?...breaking!",S[b].inConflict,t.id,S[b].targetStart);break}this.recurChangeTime(S[b].inConflict,t,v,l,s)}}while(++c<y)}}else console.log("recurChangeTime::ERROR ERROR >> overlapped event not found!","doAdd? "+l,e,t)}hasOverlappingEvent(e,t,o){const l=[];return this._dailyScheduled.forEach((s,n,r)=>{if(n!=e){let a=this.checkOverlapByTime(t,o,s.start,s.end,e);a&&l.push({target:e,targetStart:t,direction:a,inConflict:n})}}),l}checkOverlapByTime(e,t,o,l,s){let n=this.getTimeyNumber(e),r=this.getTimeyNumber(t),a=this.getTimeyNumber(o),g=this.getTimeyNumber(l);if(n===!1||a===!1||r===!1||g===!1)return console.log("ERROR... checkOverlapByTime error",n,r,a,g),!1;let p=!1;n>a&&n<g&&(p="bas"),r>a&&r<g&&(p="haut");let d=a>=n&&r>=g,h=n>=a&&r<=g;return(d||h)&&(p="surrounding",h&&console.log("::checkOverlapByTime::"+s,"surrounding:"+d,"surrounded:"+h)),p}canDropEvent(e,t){let o=_(e,{minute:t.duration}),l=this.hasOverlappingEvent(t.id,e,o);return l.length>0?(this.doLog("canDropEvent:Overlaps= "+l.length,l),{overlaps:this.massageOneToMany(l),canContinue:!1}):(this.toggleActionBtns(!0,"canDropEvent"),{overlaps:null,canContinue:!0})}toggleActionBtns(e,t){this.disableSaveSchedule=!e,this.showReloadBtn=this.hasEventsForDate()&&e,this.showClearBtn=!this.isViewingPast()&&e}resetChosen(){this.chosenScore=null,this.chosenPrio=null}enableActionBtns(){let e=this.isViewingPast();this.showOneEachBtn=!e,this.showLoadDefaults=!e,this.showScoreBtn=!e,this.showPrioBtn=!e}tooClose(e,t){let o=_(e,{minute:0}),l=this.getTimeNumber(o),s=_(e,{day:1}),n=new Date(s.date);n.setHours(24),n.setMinutes(0),n.setSeconds(0),n.setMilliseconds(0);let r=ae(n),a=Math.floor(te(o,r)/1e3/60);if(a<t)return console.log("tooClose to midnight eh...:(",a),!0;let g=!1;return this._dailyScheduled.forEach((p,d,h)=>{let u=this.getTimeNumber(p.start)-l,C=te(o,p.start);Math.floor(C/1e3/60)<=10&&u>0&&(g=d)}),g}changeEvtTime(e,t,o){return o=="ok"&&We(e.id,t.time,null),this.doUpdateSchedule(e,t),o}doUpdateSchedule(e,t){let o=this.findSchedEvent(e.id);if(!o){console.log("doUpdateSchedule-ERROR NOT found",e.id,o);return}let l=_(Y(o.date),{minute:j(t.time)}),s=_(l,{minute:o.duration});this._endTimesSet.delete(o.end.time)?this._endTimesSet.add(s.time):console.log("doUpdateSchedule-endTimesSet NOT FOUND?!?",o.id),this._startTimesSet.delete(o.start.time)?this._startTimesSet.add(l.time):console.log("doUpdateSchedule-startTimesSet NOT FOUND?!?",e.id,t),o.time=t.time,o.sortTime=l;let a=this.updateDetz({...o,time:t.time,start:l,end:s});this._dailyScheduled.set(e.id,a),this.enableNoteScoreEdit(e.id,l,s)}saveDaySchedule(){let e={};this._dailyScheduled.size<1?e=null:this._dailyScheduled.forEach((t,o,l)=>{e[o]={time:t.start.time,duration:t.duration,atScore:t==null?void 0:t.atScore},this.usingMoods[o]&&(e[o].byMood=this.usingMoods[o]),t.notes!==void 0&&(t==null?void 0:t.notes)!==""&&(e[o].notes=t==null?void 0:t.notes)}),console.log("saveDaySchedule",e?Object.keys(e).length:"CLEARED"),Qe(this.currentDate,e),this.disableSaveSchedule=!0,this.showReloadBtn=!1,this.showClearBtn=e!=null&&!this.isViewingPast()}updateMinEndNowBtn(e,t,o){for(let[l,s]of this._dailyScheduled)(t?s.end.time:s.start.time)==e&&(this.hasStarted[l]=!t,this.isDisabledScoreEdit[l]=!t,this.mobile&&(console.log(`updateMinEndNowBtn..MOBILE::good?>>${o}::${t}`,e),this.showMobileDialog[l]=!t))}reduceEvtDuration(e,t){let o=this.findSchedEvent(e);if(!o){console.log("ERROR:: reduceEvtDuration Evt not found!!!",e);return}const l=ae(new Date);let s=o.start,n=o.end,r=this.updateDetz({...o,duration:t,end:l});this._dailyScheduled.set(e,r),this._endTimesSet.delete(n.time)||console.log("ERROR endTimesSet item does not exist?!?",o,this._endTimesSet),this._endTimesSet.add(l.time),this.enableNoteScoreEdit(e,s,l),this.saveDaySchedule()}canEndNow(e){let t=this.findSchedEvent(e);if(!t)return console.log("ERROR canEndNow Evt not found!!!",e),!1;const o=ae(new Date);let l=t.start,s=t.end;if(!Be(o,l,s,!0))return console.log("umm aint in the middle of this event! Nothing to do...canEndNow::ERROR?",o.time,l.time,s.time),!1;let n=_(o,{minute:0}),r=te(l,n),a=Math.floor(r/1e3/60);return console.log(`canEndNow:: ${e} duration from ${t.duration} to: ${a}`),a<10?a:this.reduceEvtDuration(e,a)}updateNoteScore(e,t,o=""){let l=this.findSchedEvent(e);l?(l.score==t||(We(e,null,t),l.atScore=t),l.score=t,o!==""&&(l.notes=o),this.isViewingPast()?this.saveDaySchedule():this.toggleActionBtns(!0,"updateNoteScore")):console.log(`ERROR ERROR::updateNoteScore could not find event ${e}?!?`)}deleteEvtMood(e){if(this.usingMoods[e]){delete this.usingMoods[e],console.log("deleteEvtMood::>> "+e);return}}updateCurrentMoods(){for(let e in this.usingMoods)this._dailyScheduled.has(parseInt(e))||this.deleteEvtMood(e)}removeScheduledEvt(e){if(!e){console.log("ERROR removeScheduledEvt, NO evt to delete!",e);return}let t=null;if(this._dailyScheduled.has(e.id))t=this._dailyScheduled.get(e.id),this._dailyScheduled.delete(e.id);else{console.log("removeScheduledEvt:: ERROR NO evt?@? ERROR",e);return}if(t){let o=this._startTimesSet.delete(t.start.time),l=this._endTimesSet.delete(t.end.time);(!o||!l)&&console.log(`removeScheduledEvt ::> ERROR? scheduleSets has no such evt?@? start:${o}...end:${l}`,t,e.id+" "+(e==null?void 0:e.title.trim())+" "+(e==null?void 0:e.details)),this.deleteEvtMood(e.id)}}addToBalance(e){let o=this.getCurrentBalance()-parseInt(e==null?void 0:e.duration);Je(o)}removeFromBalance(e){let o=this.getCurrentBalance()+parseInt(e);Je(o)}disableEvtScoreEdit(e,t){this.isDisabledScoreEdit[e]=!t,this.mobileEnableScore[e]=t}enableNoteScoreEdit(e,t,o){const l=ae(new Date);let s=te(l,o),n=_(l,{minute:0});this.getTimeNumber(n),s>0?(this.isDisabledScoreEdit[e]=!0,this.mobileEnableScore[e]=!1):(this.hasStarted[e]=!1,this.mobile&&(this.showMobileDialog[e]=!1),this.mobileEnableScore[e]=!0,this.isDisabledScoreEdit[e]=!1),Be(l,t,o,!0)?this.hasStarted[e]=!0:this.hasStarted[e]=!1}getTimeyNumber(e){return e!==null?kt(e):!1}getTimeNumber(e){return e!==null?Le(e):!1}doLog(e,t){console.log(e,t?JSON.parse(JSON.stringify(t)):"")}}const Xt=()=>!0;function Zt(i){const e={};return i.forEach(t=>{e[t]=Xt}),e}function xe(){const{emit:i,proxy:e}=Ye(),t=k(null);function o(){t.value.show()}function l(){t.value.hide()}function s(r){i("ok",r),l()}function n(){i("hide")}return Object.assign(e,{show:o,hide:l}),{dialogRef:t,onDialogHide:n,onDialogOK:s,onDialogCancel:l}}const tt=["ok","hide"];xe.emits=tt;xe.emitsObject=Zt(tt);const ei=mt({name:"scheduleBy",props:{title:String,message:String,options:Array,selectedO:String},emits:["onCancel","onOk","ok","hide"],data(){return{mess:this.message,daOptions:this.options,skipOvCheck:k(!1),optGroup:this.selectedO}},setup(){const{dialogRef:i,onDialogHide:e,onDialogOK:t,onDialogCancel:o}=xe();return{dialogRef:i,onDialogHide:e,onDialogOK:t,onCancelClick:o}},computed:{oCheck:{get(){return this.skipOvCheck},set(i){this.skipOvCheck=i}},oChoice:{get(){return this.optGroup},set(i){this.optGroup=i}}},methods:{show(){this.$refs.dialogRef.show()},hide(){this.$refs.dialogRef.hide()},onDialogHidey(){this.$emit("hide"),this.onDialogHide()},onOKyClick(){this.$emit("ok",{choice:this.oChoice,skipOCheck:this.oCheck}),this.hide()},onCancelyClick(){this.$emit("onCancel"),this.hide(),this.showy=!1}}}),ti={class:"q-ma-md title"},ii={class:"q-ma-md title"},oi={class:"q-gutter-sm"};function li(i,e,t,o,l,s){return M(),Q(bt,{ref:"dialogRef","transition-show":"rotate","transition-hide":"rotate",onHide:i.onDialogHidey},{default:L(()=>[A(vt,{class:"my-dialog"},{default:L(()=>[x("div",ti,J(i.title),1),A(Oe,{dark:""}),x("div",ii,J(i.mess),1),A(St,{class:"q-gutter-md"},{default:L(()=>[x("div",oi,[A(pt,{modelValue:i.oChoice,"onUpdate:modelValue":e[0]||(e[0]=n=>i.oChoice=n),options:i.daOptions},null,8,["modelValue","options"])]),i.oChoice!="filter"?(M(),Q(Ze,{key:0,modelValue:i.oCheck,"onUpdate:modelValue":e[1]||(e[1]=n=>i.oCheck=n),label:"Skip Overlap Check?","left-label":""},null,8,["modelValue"])):H("",!0)]),_:1}),A(Oe,{dark:""}),A(yt,{align:"center",class:"q-mx-md"},{default:L(()=>[A(De,{label:"Cancel",flat:"",color:"primary",onClick:i.onCancelyClick},null,8,["onClick"]),A(Oe,{vertical:!0}),A(De,{label:"Ok",flat:"",color:"primary",onClick:i.onOKyClick},null,8,["onClick"])]),_:1})]),_:1})]),_:1},8,["onHide"])}var si=Xe(ei,[["render",li],["__scopeId","data-v-3623ea57"]]);function Ke(i){return i.button===0}const ni={name:"altDayCalendar",components:{NavigationBar:se(()=>ne(()=>import("./NavigationBar.966fb264.js"),["assets/NavigationBar.966fb264.js","assets/index.2c41191f.js","assets/index.4f70e4de.css"])),QCalendarDay:Lt,GoalyEnd:se(()=>ne(()=>import("./goalyEnd.28bd3119.js"),["assets/goalyEnd.28bd3119.js","assets/goalyEnd.bf51d2cd.css","assets/index.2c41191f.js","assets/index.4f70e4de.css","assets/goalStorage.b43d9204.js","assets/QSelect.13f9b917.js","assets/touch.70a9dd44.js","assets/QItem.49a304e8.js"])),daInstructions:se(()=>ne(()=>import("./instructions.a38358b0.js"),["assets/instructions.a38358b0.js","assets/index.2c41191f.js","assets/index.4f70e4de.css"])),schedBtn:se(()=>ne(()=>import("./schedBtn.1d918dff.js"),["assets/schedBtn.1d918dff.js","assets/schedBtn.e216f6f0.css","assets/goalStorage.b43d9204.js","assets/index.2c41191f.js","assets/index.4f70e4de.css"])),dropDwnBtn:se(()=>ne(()=>import("./dropDwnBtn.8ee6502c.js"),["assets/dropDwnBtn.8ee6502c.js","assets/dropDwnBtn.9d1a048a.css","assets/QItem.49a304e8.js","assets/index.2c41191f.js","assets/index.4f70e4de.css","assets/QList.e2dcbc93.js","assets/QSelect.13f9b917.js","assets/touch.70a9dd44.js","assets/goalStorage.b43d9204.js"])),schedDialog:se(()=>ne(()=>import("./schedDialog.a629a005.js"),["assets/schedDialog.a629a005.js","assets/schedDialog.0a5a881b.css","assets/index.2c41191f.js","assets/index.4f70e4de.css","assets/QSpace.73bd9570.js"])),mobileNoteScore:se(()=>ne(()=>import("./onScoreEditDialog.4edf39aa.js"),["assets/onScoreEditDialog.4edf39aa.js","assets/onScoreEditDialog.1a5ed29f.css","assets/index.2c41191f.js","assets/index.4f70e4de.css"]))},data(){return _t(),k(null),k(null),k(null),k(null),k(null),{splitterPage:k(35),splitterLegend:k(40),timeStartPos:k(0),showTree:k(!1),treeGoals:k([]),expanded:k([]),filter:k([]),filterRef:k(null),calendar:k(null),showEvtDialog:k(!1),currentDate:k(Ce()),scoreOptions:k([1,2,3,4,5,6,7,8]),anchorTimestamp:k(null),otherTimestamp:k(null),mouseDown:k(!1),mobile:k(!0),daSchedule:k(null),showInstru:k(!1)}},beforeMount(){this.mobile=Gt(),this.daSchedule=new Yt(this.currentDate,this.mobile),this.constructTree()},mounted(){this.adjustCurrentTime(),this.intervalId=setInterval(()=>{this.adjustCurrentTime()},6e4)},beforeUnmount(){clearInterval(this.intervalId)},computed:{chosenScoreLabel(){return this.daSchedule.chosenScoreLabel()},chosenPrioLabel(){return this.daSchedule.chosenPrioLabel()},style(){return{top:this.timeStartPos+"px"}},showSchedInstru(){return this.getDateEvents(this.currentDate).length<1},showRemInstru(){return this.getDateEvents(this.currentDate).length>0},defaultBtnLabel(){let i=this.daSchedule.unscheduledDefaultEvts();return i>0?i+" Defaults":"Defaults"},isDefaultBtnEnabled(){return!this.daSchedule.unscheduledDefaultEvts()>0||this.isViewingPast()},saveScheduleDisabled(){return this.daSchedule.saveBtnEnabled()},showTreeForm(){return this.showTree||this.constructTree(),this.showTree},filterString(){return this.filter.join()},currentBalance(){return this.daSchedule.getCurrentBalance()},canbeScheduled(){let i=this.daSchedule.unscheduled(),e=(t,o)=>{if(t.parentGoal>o.parentGoal)return 1;if(t.parentGoal==o.parentGoal)return 0;if(t.parentGoal<o.parentGoal)return-1};if(i.length==0){let t=this.daSchedule.getSubGoals();return t.sort(e),t}return i.sort(e),i},scheduleMoodsLabel(){let i=null,e=this.daSchedule.getCurrentMoods();if(!Object.keys(e).length>0)return i;let t=new Map;for(let l in e){let s=e[l].join();t.set(l,s)}let o={};for(let[l,s]of t){let n=this.daSchedule.findSchedEvent(parseInt(l));o[l]={m:s,color:n==null?void 0:n.color,bg:n==null?void 0:n.bgcolor}}return o},startEndTimes(){const i=[];return this.anchorDayTimeIdentifier!==!1&&this.otherDayTimeIdentifier!==!1&&(this.anchorDayTimeIdentifier<=this.otherDayTimeIdentifier?i.push(ce(this.anchorTimestamp),ce(this.otherTimestamp)):i.push(ce(this.otherTimestamp),ce(this.anchorTimestamp))),i},anchorDayTimeIdentifier(){return this.anchorTimestamp!==null?Le(this.anchorTimestamp):!1},otherDayTimeIdentifier(){return this.otherTimestamp!==null?Le(this.otherTimestamp):!1},eventsMap(){return this.daSchedule.scheduledEventsMap()}},methods:{showEvtMobile(i){return this.daSchedule.showEvtNoteScoreMobile(i)},selectedTimeInterval(){return this.targetDrop.timestamp.time},adjustCurrentTime(){var l,s;const i=ae(new Date);if(this.currentDate!==i.date){this.timeStartPos=-10,this.currentTime="";return}this.currentDate=i.date,this.currentTime=i.time,this.timeStartPos=(s=(l=this.$refs)==null?void 0:l.calendar)==null?void 0:s.timeStartPos(i.time,!1);let e=this.daSchedule.getCurrentSchedTimesSets(),t=e.endSet&&e.endSet.has(i.time),o=e.startSet&&e.startSet.has(i.time);(t||o)&&(this.daSchedule.updateMinEndNowBtn(this.currentTime,t,o),o&&(this.scrollToTime(i,"slow"),this.doNotify("Event Starting :)","positive","top")))},hasDate(i){return this.currentDate?i.find(e=>e.date===this.currentDate):!1},getDateEvents(i){let e=(o,l)=>{let s=te(o.sortTime,l.sortTime);if(s>0)return-1;if(s==0)return 0;if(s<0)return 1};const t=this.eventsMap[i]||[];return t.length===1?t[0].side="full":t.length,t.sort(e)},constructTree(){this.treeGoals=this.daSchedule.fetchGoalsTree()},resetGoalEvts(){return this.daSchedule.getSubGoals()},allMainGPrio(){return this.daSchedule.getAllPrio()},resetFilter(){var i;this.filter=[],(i=this.filterRef)==null||i.focus()},myFilterMethod(i,e){if(i.isChildren&&(i==null?void 0:i.moods.length)>0){const t=this.filter.map(l=>l.toLowerCase());let o=i==null?void 0:i.moods.some(l=>t.indexOf(l.toLowerCase())>-1);return i.label&&o}},labelGoals(i){let e=0;if(i=="s"){for(const o in this.treeGoals)e+=this.treeGoals[o].children.length;return`Scheduled => ${this.daSchedule.getAllEvts().size} out of ${e} 
`}return`Balance: ${this.daSchedule.getCurrentBalance()||0} 
`},badgeClasses(i,e){return Rt(i,e)},styleDragLine(i,e=void 0,t=void 0){let o=e(i.time),l=t(i.duration),s=o+l;this.timeStartPos+l;const n={};return e&&t&&(n.top=s+"px",n.height=l+"px"),n["align-items"]="flex-start",n},badgeStyles(i,e,t=void 0,o=void 0){return wt(i,e,t,o)},classyColor(i){return`row items-center ${i.isChildren?"text-":"text-white bg-"}${i.color} `},isViewingPast(){return this.daSchedule.isViewingPast()},onMoodAdd(){let i=[];const e=this.filter.map(t=>t.toLowerCase());if(this.treeGoals.filter(t=>{if(t.children.length>0)return t.children.filter(o=>{if((o==null?void 0:o.moods.length)>0&&(o==null?void 0:o.moods.some(l=>e.indexOf(l.toLowerCase())>-1))){let l=o==null?void 0:o.moods.filter(s=>{if(e.indexOf(s.toLowerCase())>-1)return s});return i.push({id:o.id,mood:l}),o}})}),i.length>0)if(i=i.filter(o=>!this.daSchedule.getAllEvts().has(o.id)),i.length>0){let o=this.daSchedule.scheduleByMood(i);if(o.canContinue)this.doNotify(`Added ${o==null?void 0:o.added} Evts by Mood...doSave eh`,"info");else{if(o.overlaps&&Object.keys(o.overlaps).length>0)return(o==null?void 0:o.added)>0&&this.doNotify(`${o==null?void 0:o.added} Evts added BUT some Overlaps to fix!`,"warning"),this.handleOverlaps(o.overlaps,"byMood");this.doNotify("Empty as no Mood Evts :(","warning")}}else this.doNotify(`Evts of Mood '${this.filterString}' already scheduled!`,"warning","top");else this.doNotify("Nothing to add :(","warning","top")},onScheduleOneEach(){let i=o=>{let l=this.daSchedule.scheduleOneEach(o.choice,o.skipOCheck,this.doNotify);if(l.canContinue)this.doNotify(`${l==null?void 0:l.added} Evts by Each ParentGoal...doSave eh`,"info");else{if(l.overlaps&&Object.keys(l.overlaps).length>0)return(l==null?void 0:l.added)>0&&this.doNotify(`${l==null?void 0:l.added} Evts added BUT some Overlaps to fix!`,"warning"),this.handleOverlaps(l.overlaps,"oneEach");this.doNotify("Empty None for OneEach :(","warning")}t>0||(l==null?void 0:l.added)>0?this.daSchedule.toggleActionBtns(!0,"oneEach"):console.log("onScheduleOneEach::no Evts and no toggling for flag>> ",o.choice,l==null?void 0:l.added)},e=()=>{console.log("onScheduleOneEach..Aborting"),this.reset()},t=this.daSchedule.getAllEvts().size;if(t>0){let o=[{label:"Add one Evt from Each parent Goals",value:"add"},{label:"Reset schedule and add one random Evt from Each parent Goals",value:"reset"}];this.scheduleByDialog("Reload Schedule",`Current: ${this.currentDate} already have scheduled Events...`,o,"",i,e)}else i({choice:"reset",skipOCheck:!this.daSchedule.isViewingToday()})},onReloadSaved(){let i=this.daSchedule.hasEventsForDate(),e=()=>{console.log("Aborting reload!",this.currentDate,i)},t=()=>{let o=this.daSchedule.loadEvtsForDay(!1);o.canContinue||(o.overlaps&&Object.keys(o.overlaps).length>0?(console.log("onReloadSaved::OVERLAPS",o.overlaps),this.handleOverlaps(o.overlaps,"view")):(this.doNotify(`Reloaded schedule for ${this.currentDate}`,"positive","bottom"),(this.isViewingPast()||this.currentDate!==Ce())&&this.adjustCurrentTime())),this.reset()};if(this.daSchedule.getAllEvts().size>0&&!this.isViewingPast()){let o=i?`Reload saved schedule of: ${this.currentDate} ?`:"Reset current Schedule?";this.confirmAction("",o,"OK",t,e)}else t()},onClearDay(){let i=this.daSchedule.hasEventsForDate();if(this.isViewingPast()){this.doNotify("Editing past is no no!");return}this.daSchedule.resetSchedule(!0);let e=i?"Cleared...Can still Reload saved":"Resetting...";this.doNotify(e,"warning","top"),this.reset(),this.daSchedule.toggleActionBtns(i,"view")},onLoadDefault(){let i=t=>{let o=this.daSchedule.scheduleDefaults(t.choice,t.skipOCheck);if(o.canContinue)this.doNotify(`Defaults added ${o==null?void 0:o.added} ...doSave eh`,"info");else{if(o.overlaps&&Object.keys(o.overlaps).length>0)return(o==null?void 0:o.added)>0&&this.doNotify(`${o==null?void 0:o.added} Default Evts added BUT some Overlaps to fix!`,"warning"),this.handleOverlaps(o.overlaps,"byDefaults");this.doNotify("Empty as No Defaults :(","warning")}e>0||(o==null?void 0:o.added)>0?this.daSchedule.toggleActionBtns(!0,"byDefaults"):console.log("onLoadDefault::no Evts and no toggling for flag>> ",t.choice,o==null?void 0:o.added)},e=this.daSchedule.getAllEvts().size;if(e>0){let t=this.daSchedule.unscheduledDefaults(),o=[{label:`Add ${t==null?void 0:t.length} Default Evts to current schedule`,value:"add"},{label:"Reset and schedule All Defaults",value:"reset"}];this.scheduleByDialog("Schedule Defaults",`Current: ${this.currentDate} already have scheduled Events...`,o,"",function(l){i(l)},function(){console.log("onLoadDefaults::Aborting")})}else i({choice:"reset",skipOCheck:!this.daSchedule.isViewingToday()})},onChoosenPrio(i){this.daSchedule.onChoosenPrio(i)},doReloadWithPrio(){var s,n,r,a,g,p;let i=this.daSchedule.chosenPrio;if(i==null){this.doNotify("Ayo select a priority!");return}let e=()=>{this.reset()},t=d=>{let h=this.daSchedule.scheduleSamePrio(d.choice,d.skipOCheck);if(h.canContinue)this.doNotify(`${h==null?void 0:h.added} Evts with Priority == ${i} ...doSave eh`,"info");else{if(h.overlaps&&Object.keys(h.overlaps).length>0)return(h==null?void 0:h.added)>0&&this.doNotify(`${h==null?void 0:h.added} Evts added BUT some Overlaps to fix!`,"warning"),this.handleOverlaps(h.overlaps,"byPrio");this.doNotify(`No Evts with Priority == ${i} :(`,"warning","top")}l>0||(h==null?void 0:h.added)>0?this.daSchedule.toggleActionBtns(!0,"byPrio"):console.log("doReloadWithPrio::no Evts and no toggling for flag>> ",d.choice,h==null?void 0:h.added)},o=this.daSchedule.byPrio,l=this.daSchedule.getAllEvts().size;if(l>0){let d=[];((s=o==null?void 0:o.filter)==null?void 0:s.length)>0&&((n=o==null?void 0:o.filter)==null?void 0:n.length)!=l&&d.push({label:`Filter out of ${l} scheduled to ${(r=o==null?void 0:o.filter)==null?void 0:r.length} Evts`,value:"filter"}),((a=o==null?void 0:o.toAdd)==null?void 0:a.length)>0&&d.push({label:`Add ${(g=o==null?void 0:o.toAdd)==null?void 0:g.length} Evts to current schedule`,value:"add"}),d.push({label:`Reset current and schedule ${(p=o==null?void 0:o.reset)==null?void 0:p.length} Evts.`,value:"reset"});let D=`Reload Schedule by Parent's Priority == ${i}`;this.scheduleByDialog("",D,d,"",t,e)}else t({choice:"reset",skipOCheck:!this.daSchedule.isViewingToday()});this.daSchedule.disablePrioBtn=!0},onChoosenScore(i){this.daSchedule.onChoosenScore(i)},onScheduleByScore(i,e=!1){let t=[],o=!1,l=null;const s=this.daSchedule;let n=()=>[{label:"Keep Evt with Highest Priority",value:"opt1",color:"secondary"},{label:"Manually Choose one event",value:"opt3"}];const r=d=>this.findhighestPrio(d),a=(d,h)=>this.betterEvtLabel(d,h,!1);let g=(d,h,D)=>{this.confirmChoiceDialog("","Choose which Event to keep",d.map(u=>a(u,"default")),"",function(u){let C=d.find(E=>E.id==u);if(!C){console.log("chooseOneEvt::ERROR NOT FOUND!!",u);return}if(h.id==C.id){d.forEach(v=>{v.id!=C.id&&s.removeScheduledEvt(v)});let E=s.addToSchedule(h,!e,!1);//!skipOvCheck
console.log("chooseOneEvt::ADDED",u,D,E)}else d.forEach(E=>{h.id==E.id?console.log("chooseOneEvt,not adding target",E.id,C.id):E.id!=C.id?s.removeScheduledEvt(E):console.log("chooseOneEvt,not adding scheduled",E.id,C.id)});return D=u,D},null,function(){console.log("onScheduleByScore::onDismiss >>chooseOne",D,l),l=D})};i.sort(function(d,h){return j(d.time)-j(h.time)}),i.forEach((d,h,D)=>{let u=s.addToSchedule(d,!e,!1);if(u&&Array.isArray(u))if(u.length>1){console.log("onScheduleByScore::OVERLAP >> oneToMany",d,u),o=!0;let C=null;if(u.find(E=>E[0]=="withID")){u=u.filter(E=>E[0]!="withID");for(let E=0;E<u.length;E++){u[E][0];let v=u[E][1];C=v[0].targetStart,this.scrollToTime(C,"slow");let R=[],f=[],y=!1;for(;v.length;){const b=v.pop();let O=this.daSchedule.findSchedEvent(b.inConflict);R.push(`(${O==null?void 0:O.id}) '${O==null?void 0:O.title.trim()}'`),d.id!=b.target&&console.log("onScheduleByScore::ERROR ERROR:: NOT same target ID?!?",d,b),f.push(O),b.direction=="surrounding"?y=!0:y=y}f.unshift(d);let c=`Adding (${d==null?void 0:d.id}) '${d==null?void 0:d.title.trim()}' at ${V(d==null?void 0:d.time)} Conflicts with scheduled ${R.join(" and ")}. `,S=n();y||S.push({label:`Force in > '${d==null?void 0:d.title.trim()}' ?`,value:"opt4"}),this.confirmChoiceDialog("OneToMany Conflicts",c,S,"",function(b){var O;switch(b){case"opt1":let w=r(f);if(console.log("onScheduleByScore::ByPriority >> AUTO ",w.e.id,(O=w==null?void 0:w.e)==null?void 0:O.title.trim()),d.id==w.e.id){f.forEach(X=>{X.id!=w.e.id&&s.removeScheduledEvt(X)});let U=s.addToSchedule(d,!e,!1);//!skipOvCheck
console.log("onScheduleByScore::ByPriority>>ADDED",l,U)}else f.forEach(U=>{U.id!=w.e.id?s.removeScheduledEvt(U):console.log("onScheduleByScore::ByPrio,not adding target?",U.id,w.e.id)});l=b;return;case"opt4":let W=f.find(U=>U.id!=d.id);s.recurChangeTime(W.id,d,C,!0),l=b;return;default:g(f,d,l);return}},null,function(){console.log("onScheduleByScore::onDismiss >> OneToMany",l)})}}else console.log("onScheduleByScore::OVERLAP! ERROR not oneToMany?!?",u)}else t.push(...u);else u===!0||console.log("onScheduleByScore::adding...FAILED?>>",d,u)});const p=()=>{this.doLog("onScheduleByScore::doContinue",t),t.length>0&&this.doNotify(`${t.length} EXTRA Overlaps to fix!`,"negative","top"),this.doNotify("Added byScore!..doSave eh","info","top")};if(o){let d=setInterval(()=>{l&&(setTimeout(()=>{clearInterval(d)},0),p())},3e3)}else p()},doReloadWithScore(){var s,n,r,a,g,p;let i=this.daSchedule.chosenScore;if(i==null){this.doNotify("Ayo select a score!");return}let e=()=>{this.reset()},t=d=>{let h=this.daSchedule.scheduleByScore(d.choice,d.skipOCheck);if(h.canContinue)this.doNotify(`${h==null?void 0:h.added} Evts with Interval Score <= ${i} ...doSave eh`,"info");else{if(h.overlaps&&Object.keys(h.overlaps).length>0)return(h==null?void 0:h.added)>0&&this.doNotify(`${h==null?void 0:h.added} Evts added BUT some Overlaps to fix!`,"warning"),this.handleOverlaps(h.overlaps,"byScore");this.doNotify(`No Evts with Interval Score <= ${i} :(`,"warning")}l>0||(h==null?void 0:h.added)>0?this.daSchedule.toggleActionBtns(!0,"byScore"):console.log("doReloadWithScore::no Evts and no toggling for flag>> ",d.choice,h==null?void 0:h.added)},o=this.daSchedule.byScore,l=this.daSchedule.getAllEvts().size;if(l>0){let d=[];((s=o==null?void 0:o.filter)==null?void 0:s.length)>0&&((n=o==null?void 0:o.filter)==null?void 0:n.length)!=l&&d.push({label:`Filter out of ${l} scheduled to ${(r=o==null?void 0:o.filter)==null?void 0:r.length} Evts`,value:"filter"}),((a=o==null?void 0:o.toAdd)==null?void 0:a.length)>0&&d.push({label:`Add ${(g=o==null?void 0:o.toAdd)==null?void 0:g.length} Evts to current schedule.`,value:"add"}),d.push({label:`Reset current and schedule ${(p=o==null?void 0:o.reset)==null?void 0:p.length} Evts.`,value:"reset"});let D=`Reload Schedule by Interval Score <= ${i}`;this.scheduleByDialog("",D,d,"",t,e)}else t({choice:"reset",skipOCheck:!this.daSchedule.isViewingToday()});this.daSchedule.disableScoreBtn=!0},doSaveSchedule(){this.daSchedule.saveDaySchedule(),this.doNotify(`Schedule saved for ${this.currentDate}`,"positive","top"),this.resetFilter()},doDroppy(i,e){if(i&&e){let t=this.daSchedule.tooClose(i,e.duration);if(t&&(console.log("doDroppy::tooClose to>>",t),t===!0)){this.doNotify("Dropping event TOO close to midnight!"),this.reset();return}let o=this.daSchedule.canDropEvent(i,e),l=this.daSchedule.getOriginalEvtTime(e.id);if(o.canContinue)if((e==null?void 0:e.inDefaults)||!(e!=null&&e.canMove)){let n=e!=null&&e.inDefaults?"Default at ":"Cannot Move from ",r=[`Evt "${e.title.trim()}" ${n} ${V(l)}.`,`
Also Save Evt default time to ${V(i.time)}?`,`
Cancel or Dismiss to undo!`,`
No selection to keep at ${V(e.time)}`].join(`
`);const a=this.daSchedule,g=this.doCleanup;this.confirmTimeChange("Changing Evt's time",r,"Change","Temp.Move",function(p){a.changeEvtTime(e,i,p),g()},function(){g()},function(){console.log(`doDroppy::onDismiss..keep as is>> ${e.id})'${e.title.trim()}'`),g()})}else this.daSchedule.changeEvtTime(e,i,!1),this.doCleanup();else this.handleOverlaps(o.overlaps,"onDrop")}else{console.log("doDroppy null ERROR?",i,this.targetDrop,e,this.selectedItem);return}},canAutoSchedule(i,e){let t=i.title.trim().toLowerCase().includes(e.title.trim().toLowerCase()),o=e.title.trim().toLowerCase().includes(i.title.trim().toLowerCase()),l=this.daSchedule.parentGoalById(i.parentGoal),s=this.daSchedule.parentGoalById(e.parentGoal),n=i.title.trim().toLowerCase().includes(s.title.trim().toLowerCase()),r=e.title.trim().toLowerCase().includes(l.title.trim().toLowerCase());return(n||r)&&console.log("canAutoSchedule:: WOAH PARENT AUTO schedule?--TODO***",n&&"toAdd: "+i.title,r&&"sched: "+e.title,`
Normal AUTO>>`,t,o),t||o?{addIncSched:t,schdIncToAdd:o}:!1},movedIntoConflict(i,e,t,o=0){console.log("movedIntoConflict >>",JSON.parse(JSON.stringify(i)),"from:"+t,o);const l=(f,y)=>{if(f!=null&&f.parentGoal){let c=this.daSchedule.parentGoalById(f.parentGoal);return y?`Of '${c==null?void 0:c.title.trim()}' (${c==null?void 0:c.priority})`:`Of '${c==null?void 0:c.title.trim()}'`}return console.log("prioLabel..ERROR no PARENT found?",f),""},s=(f,y)=>{switch(y){case"score":return`${l(f,!1)} > "${f.title.trim()}" with Score:: ${f.score} = ${re(f.score)}`;case"prio":return`"${f.title.trim()}" ${l(f,!0)}`;default:return`"${f.title.trim()}" ${l(f,!0)} && Score:: ${f.score} for ${f.duration} mins`}},n=(f,y=!1)=>{this.doNotify(f,y?"warning":"positive","top")},r=f=>{this.daSchedule.deleteEvtMood(f)},a=f=>{console.log(`movedIntoConflict::doRemove ${f.id}:${f.title}`),this.daSchedule.removeScheduledEvt(f)};let g=f=>{console.log("onDismissy::from "+t,f,v),this.doCleanup(),this.daSchedule.toggleActionBtns(!0,t)};const p=(f,y,c)=>{if(console.log(`movedIntoConflict::removeReplace >> replacing>> ${f.id}) '${f.title.trim()}' WITH ${y.id}) ${y.title.trim()}`,c,"from>"+t),e){if(console.log("movedIntoConflict::removeReplace...OVERRIDE from>>"+t),t=="onDrop"){a(f);return}console.log("movedIntoConflict::removeReplace....OVERRIDE updating..."+t),this.daSchedule.doUpdateSchedule(y,c.targetStart);return}if(a(f),t=="onDrop")console.log("movedIntoConflict::removeReplace for onDrop...just updating schedule",y.id,c.targetStart.time),this.daSchedule.doUpdateSchedule(y,c.targetStart);else{console.log("movedIntoConflict::removeReplace >>addGoalsToSchedule from "+t);let S=this.daSchedule.getStoredRawEvt(c.target);S&&(JSON.parse(JSON.stringify(y)),Object.assign(y,S,{time:c.targetStart.time}));let b=this.daSchedule.addGoalsToSchedule([{...y,time:c.targetStart.time}],!0),O=Object.keys(b).length;if(O>0)return console.log(`movedIntoConflict::removeReplace:: OVERLAPS again of size:${O} from >${t}>`+y.title,JSON.parse(JSON.stringify(b))),this.doNotify(`Extra Overlaps while removing to add '${y.title.trim()}' `,"warning","top"),this.movedIntoConflict(b,e,t+"nah")}},d=(f,y)=>{let c=this.daSchedule.findSchedEvent(y.target);if(!c){console.log("movedIntoConflict::forceAddMins>>NOT FOUND?!?",y.target);return}let S=this.daSchedule.getStoredRawEvt(y.target);if(S){let b=c.duration+parseInt(o);JSON.parse(JSON.stringify(c)),Object.assign(c,S,{duration:b})}else console.log("movedIntoConflict::forceAddMins >>NEWLY ADDED?!? Error?",c.id,c,S),Object.assign(c,{duration:newDura});this.daSchedule.recurChangeTime(f.id,c,y.targetStart,!1,this.doNotify),this.doSaveSchedule()},h=(f,y,c)=>{console.log(`movedIntoConflict::forceAdd:${t} >>${y.id})'${y.title}' at ${y.time} to ${c.targetStart.time}
          
Changing >>${f.id} from ${f.time}`);let S=this.daSchedule.getStoredRawEvt(c.target);S&&(JSON.parse(JSON.stringify(y)),Object.assign(y,S,{time:c.targetStart.time}));let b=this.daSchedule.recurChangeTime(f.id,y,c.targetStart,t!="onDrop",this.doNotify);if(b){let O=Object.keys(b).length;if(O>0)return console.log(`movedIntoConflict::forceAdd:: OVERLAPS again of size:${O} from >${t}>`+y.title,JSON.parse(JSON.stringify(b))),this.doNotify(`Extra Overlaps while adding '${y.title.trim()}'`,"negative","top"),this.movedIntoConflict(b,e,t+"nah")}g("ForceAdd")};let D=(f,y,c,S,b)=>{v.push(y),y==c.id?(p(S,c,b),n(`by ${f}, ${t=="onDrop"?"Moving":"Adding"} '${c.title.trim()}'`,!0)):(console.log(`onOkChoice::by ${f},chose scheduled ${y} ...with override?`,e,t),n(`by ${f}, Keeping '${S.title.trim()}'`),t.indexOf("byMood")>-1&&r(c.id),t=="onDrop"&&a(c))},u=(f,y)=>{if(e){if(console.log("movedIntoConflict::cancelChoice::OVERRIDE...coolios!!from:"+t,f.title.trim()),t=="onDrop"){n("Umm...not moving then...."),this.daSchedule.toggleActionBtns(!1,"view");return}a(f),n(`Keeping '${y.title.trim()}'`);return}t.indexOf("byMood")>-1&&r(f.id),this.daSchedule.toggleActionBtns(!0,"view"),n(`Keeping scheduled '${y.title.trim()}'`)};const C=(f,y,c,S)=>{if(f=="opt3"){let b="Pick one event...",O=[{label:s(y,"def"),value:y.id,color:"secondary"},{label:s(c,"def"),value:c.id}];this.confirmChoiceDialog("",b,O,"",function(w){D("Choice",w,y,c,S)},null,function(){g("resolveChoice::byEvent... dismissing")})}else if(f=="opt2"){let b="Pick event by Score",O=[{label:s(y,"score"),value:y.id,color:"secondary"},{label:s(c,"score"),value:c.id}];this.confirmChoiceDialog("",b,O,"",function(w){D("Score",w,y,c,S)},null,function(){g("resolveChoice::byScore... dismissing")})}else if(f=="opt1"){let b="Pick event by Priority",O=[{label:s(y,"prio"),value:y.id,color:"secondary"},{label:s(c,"prio"),value:c.id}];this.confirmChoiceDialog("",b,O,"",function(w){D("Priority",w,y,c,S)},null,function(){g("resolveChoice::byPriority... dismissing")})}else f=="opt0"?(console.log("resolveChoice::it's a drop?...keeping as is....",t),n("Umm...keeping as is then!"),this.doCleanup()):h(c,y,S)},E=(f,y,c,S,b)=>{S.direction!=="surrounding"&&!b&&(t.indexOf("nah")>-1?console.log("movedIntoConflict::manualSolve NOT adding Force as from "+t):f.push({label:`Force in '${y.title.trim()}'`,value:"opt4"}));let O=`${t=="onDrop"?"Moving":"Adding"} '${y.title.trim()}' at ${V(S.targetStart.time)} Overlaps with Scheduled '${c.title.trim()}' at ${V(c==null?void 0:c.time)}.
          
Cancel to keep '${c.title.trim()}' `,w=b?"Choose Auto Resolution":"Resolve Overlapping Events";this.confirmChoiceDialog(w,O,f,"opt1",function(W){C(W,y,c,S)},function(){console.log("movedIntoConflict>>manualSolve::cancelChoice? Notif?>> from: "+t,v[0]),n("Umm...keeping as is then!")})};let v=[],R=Object.keys(i).length;i.find(f=>f[0]=="withID");for(let f=0;f<R;f++){let y=i[f][0];if(y=="withID"){console.log("movedIntoConflict...skipping withID key",y,i.withID);continue}let c=i[f][1],S=[{label:"Choose one event",value:"opt3"}];t=="onDrop"?S.unshift({label:"Leave as is!",value:"opt0"},{label:"Choose by Priority",value:"opt1",color:"secondary"},{label:"Choose by Score",value:"opt2"}):S.unshift({label:"Choose by Priority",value:"opt1",color:"secondary"},{label:"Choose by Score",value:"opt2"});const b=c.pop();let O=this.daSchedule.getSubGoalByID(b.target),w=this.daSchedule.findSchedEvent(b.inConflict);if(!w||!O){console.log("movedIntoConflict...ERROR ERROR no evts found!!!",b);return}let W=this.canAutoSchedule(O,w);if(t=="onAddMins"){let U=w!=null&&w.inDefaults?"In Defaults":w!=null&&w.canMove?"":"Cannot move",X=`Adding ${o} mins to "${O.title.trim()}" Overlaps with Scheduled "${w.title.trim()}" at ${V(w.time)} as ${U}.
            
Force?
            
Cancel/Dismiss to Leave as is.`;this.confirmAction("",X,"Add",function(){d(w,b)},function(){n("Keeping as Is...")})}else if(W){console.log("movedIntoConflict:: can AUTO schedule",W.addIncSched,W.schdIncToAdd,"direction == surrounding? >>",b.direction=="surrounding"),this.scrollToTime(b==null?void 0:b.targetStart,"slow");let U=`"${O.title.trim()}" at ${V(O.time)} related to Scheduled "${w.title.trim()}" at ${V(w.time)}.
            
Auto resolve Overlap?
            
Cancel/Dismiss to manually choose.`;this.confirmAction("",U,"Auto",function(){var X;W.addIncSched?(console.log("Auto resolve::removeReplace..with TIMES>>",O.time,w.time,(X=b==null?void 0:b.targetStart)==null?void 0:X.time),p(w,O,b),n(`Removing Scheduled to Add '${O.title.trim()}'`,!0),v.push(O.id)):(console.log("Auto resolve::cancelChoice >> from: ",t),u(O,w),v.push(w.id))},function(){E(S,O,w,b,!0)},function(){g("Auto-dismiss")})}else E(S,O,w,b,!1)}},handleOverlaps(i,e=""){let t=i.length;i.reverse(),this.doLog("handleOverlaps::ORIGNL from: "+e+" >> "+t,i);let o=i.filter(s=>s[0]=="withID");o&&(i=i.filter(s=>s[0]!="withID"),t=i.length);const l=Nt(i);for(let s=0;s<t;s++){let n=i[s][0],r=i[s][1],a=null;s>0?a=l[s-1][1][0].targetStart:a=null,s==t-1&&(e.indexOf("nah")>-1?console.log("handleOverlaps...NO END SCROLL::FROM",e,n):this.scrollToTime(r[0].targetStart,"slow")),o&&o.find(g=>g[1]==n)?(console.log("handleOverlaps::WITHID >> oneToMany="+r.length,"Key: "+n,a==null?void 0:a.time,t),this.fixConflicts(r,e,!0,[t,s],a)):this.fixConflicts(r,e,!1,[t,s],a)}},fixConflicts(i,e,t,o,l=null){var Ge;const s=T=>this.daSchedule.findSchedEvent(T),n=T=>this.daSchedule.getSubGoalByID(T),r=(T,$)=>{if(!T){console.log("fixConflicts::scrollToConflict ERROR >>empty time withID="+t,$,T);return}setTimeout(()=>{this.scrollToTime(T,"slow")},1e3)},a=T=>{this.doNotifyTimeout(T,"negative","top",1e4)},g=(T,$=!1)=>{this.doNotify(T,$?"warning":"positive","top")},p=T=>this.findhighestPrio(T);let d=T=>this.getSmallestScoreInterval(T),h=T=>{console.log("onDismissy>> ",T,c.length),c.length>0&&setTimeout(()=>{t?D(c,O):u(c,O)},0)},D=(T,$)=>{console.log(`fixConflicts::removeWithID with toKeep=${T.length} `,l==null?void 0:l.time);let P=[],N=!1;for($.forEach((m,G,q)=>{if(T.find(I=>I.id==m.id))if(m.id==S.id){let I=y.has(m.id)?y.get(m.id):"",B=f.has(m.id)?f.get(m.id):f.get(S.id),ee=this.daSchedule.getStoredRawEvt(m.id);ee&&(JSON.parse(JSON.stringify(m)),Object.assign(m,ee,{time:B.time}));let le=e=="onDrop"?this.daSchedule.doUpdateSchedule(m,B)||{}:this.daSchedule.addGoalsToSchedule([{...m,time:B.time}],!1);if(Object.keys(le).length>0)console.log("fixConflicts::removeWithID::OVERLAP on add",le,m,B.time),P.push(le);else{let we=`${I} Adding '${m==null?void 0:m.title.trim()}' at ${V(B.time)}`;this.doNotify(we,"positive","top")}N=!0}else{console.log("fixConflicts::removeWithID....Keeping scheduled Evt!!",m.id,f.get(m.id));let I=`${y.has(m.id)?y.get(m.id):""} Keeping scheduled '${m==null?void 0:m.title.trim()}'`;this.doNotify(I,"positive","top"),this.daSchedule.reAddScheduled(m.id)}else if(m.id!=S.id){console.log("fixConflicts::removeWithID >>removing scheduled",m.id,m.title,m.time);let I=this.daSchedule.getCurrentMoods()[m.id];this.daSchedule.removeScheduledEvt(m);let B=`Removed scheduled '${m==null?void 0:m.title.trim()}'`;B=I?B+` With Moods: '${I}'`:B,this.doNotify(B,I?"negative":"warning"),N=!0}else e=="onDrop"?(console.log("fixConflicts::removeWithID >>Removing target onDrop!!",m.id,m.title,m.time),this.daSchedule.removeScheduledEvt(m)):console.log("fixConflicts::removeWithID >>NOT adding original target",S.id),this.daSchedule.deleteEvtMood(S.id),this.resetFilter()}),e=="onDrop"||N?(this.daSchedule.toggleActionBtns(!0,e),this.doCleanup()):console.log("fixConflicts::removeWithID...NO TOGGLING",e);P.length;){const m=P.pop();this.doLog(`${e}> fixConflicts::removeWithID:: OVERLAPS`,m),this.doNotify("EXTRA Overlaps to fix!","negative","top");let G=e.indexOf("view")>-1?e:e+"nah";return this.handleOverlaps(m,G)}l?r(l,"removeWithID"):console.log("fixConflicts::removeWithID >> NO SCROLLING after conflicts",e,l,N)},u=(T,$)=>{console.log(`fixConflicts::removeConflicts with toKeep=${T.length}`,l==null?void 0:l.time);let P=[],N=!1;for($.forEach((m,G,q)=>{if(T.find(I=>I.id==m.id)){let I=y.has(m.id)?y.get(m.id):"",B=f.has(m.id)?f.get(m.id):null;if(m.id!=b.id){let ee=this.daSchedule.getStoredRawEvt(m.id);ee&&(JSON.parse(JSON.stringify(m)),Object.assign(m,ee,{time:B.time}));let le=e=="onDrop"?this.daSchedule.doUpdateSchedule(m,B)||{}:this.daSchedule.addGoalsToSchedule([{...m,time:B.time}],this.daSchedule.isViewingToday());if(le&&Object.keys(le).length>0)P.push(le),this.doNotify(`Extra Overlaps while adding '${m==null?void 0:m.title.trim()}'`,"negative","top");else{let we=`${I} Adding '${m==null?void 0:m.title.trim()}' at ${V(B.time)}`;this.doNotify(we,"positive","top")}N=!0}else this.doNotify(`${I} Keeping scheduled '${m==null?void 0:m.title.trim()}' `,"positive","top"),this.daSchedule.reAddScheduled(m.id)}else if(m.id==b.id){let I=this.daSchedule.getCurrentMoods()[m.id];this.daSchedule.removeScheduledEvt(m);let B=`Removed scheduled '${m==null?void 0:m.title.trim()}'`;B=I?B+` With Moods: '${I}'`:B,this.doNotify(B,I?"negative":"warning"),N=!0}else console.log("fixConflicts::removeConflicts >> NOT adding target ",m.id,m.title),this.daSchedule.deleteEvtMood(m.id),this.resetFilter()}),e.indexOf("view")>-1||N?this.daSchedule.toggleActionBtns(!0,e):console.log("fixConflicts::removeConflicts...NO TOGGLING",e,N);P.length;){const m=P.pop();this.doLog(`fixConflicts::removeConflicts::EXTRA OVERLAPS from ${e} `,m),this.doNotify("EXTRA Overlaps to fix","negative","top");let G=e.indexOf("view")>-1?e:e+"nah";return this.handleOverlaps(m,G)}l?r(l,"removeConflicts"):console.log("removeConflicts::NO SCROLLING after conflicts",l,e,N)};const C=(T,$)=>{let P=[],N=$.filter(m=>!T.some(G=>G.id==m.id));for(console.log(`fixConflicts::forceAdd of ${T.length} withID=${t} `+e,"allConflicts= "+$.length,l==null?void 0:l.time),$.forEach(m=>{if(T.find(G=>G.id==m.id)){let G=f.has(m.id)?f.get(m.id):null,q=this.daSchedule.getStoredRawEvt(m.id);q&&Object.assign(m,q,{time:G.time});let I=N.length>0?N[0]:null;I||(console.log("fixConflicts::forceAdd::ERROR as no scheduled?!?",N),I=$.find(ee=>ee.id!=m.id)),console.log(`fixConflicts::forceAdd...NEW:${m.id} '${m.title.trim()}' dura= ${m.duration} 
 
              origAt: ${m.time} added at>>`,G==null?void 0:G.time,"from>>"+e,`
 >> USING for change `+I.id+" "+(I==null?void 0:I.title),"withID "+t);let B=this.daSchedule.recurChangeTime(I.id,m,G,e!="onDrop",a);if(B&&Object.keys(B).length>0)console.log("fixConflicts::forceAdd >>OVERLAP on add",B,m,G.time),P.push(B);else{let ee=`Force Added '${m==null?void 0:m.title.trim()}' at ${V(G.time)}`;this.doNotify(ee,"positive","top")}}else console.log("fixConflicts::forceAdd::scheduled Move withID: "+t,m.id),t?e=="onDrop"?this.daSchedule.recurChangeTime(m.id,T[0],f.get(T[0].id),e!="onDrop",a):console.log("fixConflicts::forceAdd >> WITHID but nothing to do?",t,m.id):console.log("fixConflicts::forceAdd >>not WITHID >> NOTHING for scheduled",m.id,"Not onDrop: "+e!="onDrop")}),this.daSchedule.toggleActionBtns(!0,e);P.length;){const m=P.pop();return this.doLog("fixConflicts::forceAdd:: EXTRA OVERLAPS "+e,m),this.doNotify("EXTRA Overlaps to fix!","negative","top"),this.handleOverlaps(m,e+"nah")}l&&r(l,"forceAdd")};let E=(T,$)=>{switch(T){case"score":this.confirmChoiceDialog("","Choose one event by Score",$.map(P=>this.betterEvtLabel(P,"score",!1)),"",function(P){let N=$.find(m=>m.id==P);if(N)c.push(N),y.set(N.id,`By Score Interval (${N.score}),`);else{console.log("chooseOneEvt::ERROR NOT FOUND!!",P);return}return N},null,function(){h("chooseOneEvt::>>byScore...")});return;case"prio":this.confirmChoiceDialog("","Choose one event by Priority",$.map(P=>this.betterEvtLabel(P,"prio",!1)),"",function(P){let N=$.find(m=>m.id==P);if(N)c.push(N),y.set(N.id,"By Priority,");else{console.log("chooseOneEvt::ERROR NOT FOUND!!",P);return}return N},null,function(){h("chooseOneEvt::>>byPriority...")});return;default:this.confirmChoiceDialog("","Choose which Event to keep",$.map(P=>this.betterEvtLabel(P,"default",!1)),"",function(P){let N=$.find(m=>m.id==P);if(N)c.push(N),y.set(N.id,"By pick,");else{console.log("chooseOneEvt::ERROR NOT FOUND!!",P);return}return N},null,function(){h("chooseOneEvt::>>byPick...")});return}},v=(T,$,P,N,m)=>{var G;if(T=="opt3")E("default",N);else if(T=="opt2")if(m)E("score",N);else{let q=d(N);q?(c.push(q),y.set(q.id,`By Shortest Score Interval (${q.score}),`)):(console.log("ERROR ERROR::fixConflicts >> smallestScoreInterval::No current set?",N),g("Umm...Score Error",!0),E("score",N))}else if(T=="opt1")if(m)E("prio",N);else{let q=p(N);console.log("fixConflicts::ByPriority >> AUTO "+e,q.e.id,(G=q==null?void 0:q.e)==null?void 0:G.title.trim()),c.push(q.e),y.set(q.e.id,`By Highest Priority (${q.prio}),`)}else T=="opt0"?(console.log("fixConflicts::AUTO:SOLVE >>",S,b,P,N),$.addIncSched?t?(c.push(S),y.set(S.id,"By Title Auto-Solve,")):(c.push(P[0]),y.set(P[0].id,"By Title Auto-Solve,")):t?(c.push(N[0]),y.set(N[0].id,"By Title Auto-Solve,")):(c.push(b),y.set(b.id,"By Title Auto-Solve,"))):C(P,N)},R=()=>{if(e=="onDrop"){g("Umm...not moving then...."),this.doCleanup();return}if(e.indexOf("byMood")>-1){console.log("fixConflicts::cancelChoice >>Mood update? canChooseOne:"+Z+" withID "+t,S.id),this.daSchedule.deleteEvtMood(S.id);return}if(t){console.log("fixConflicts::cancelChoice::WITHID from> ",e),g("Keeping Schedule as-is...");return}c.push(b)},f=new Map,y=new Map,c=[],S=null,b=null,O=[],w=[],W=!1,U=[];for(i.length;i.length;){const T=i.pop();let $=s(T.inConflict);if(!$){console.log("fixConflicts...ERROR ERROR no evts found!!!",T);return}let P=n(T.target);if(!P){console.log("fixConflicts...ERROR ERROR target evt not found!!!",T);return}f.set(T.target,T==null?void 0:T.targetStart),t?(U.push(`'${$==null?void 0:$.title.trim()}'`),S?S.id!==T.target&&console.log("fixConflicts::ERROR ERROR:: oneToManyConflict >>Not same target ID?!?",S,T,w,f):(S=P,w.push(P),O.unshift(P)),O.push($)):(U.push(`'${P==null?void 0:P.title.trim()}'`),b?b.id!==$.id&&console.log("fixConflicts::ERROR ERROR::manyToOneConflict Not same schedule?!?",b.id,$.id,T,w):(b=$,O.unshift($),f.set(T.inConflict,T==null?void 0:T.targetStart)),w.push(P),O.push(P)),T.direction=="surrounding"?W=!0:W=W}let X=U.join(" and "),Z=o[0]<3,ge=!1;U.length<2&&(ge=t?this.canAutoSchedule(S,O[0]):this.canAutoSchedule(w[0],b));let K=[],Se=Z?"Pick one event via ":"Auto-Resolve to keep Evt with ";if(ge?(this.doLog("fixConflicts::AUTO-RESOLVE!! "+b.id+"withID:"+t,ge),K.unshift({label:"By Title Auto-resolve?",value:"opt0"}),K.push({label:"Manually Choose one event",value:"opt3"})):Z?K.push({label:"Manually Choose one event",value:"opt3"}):(K.push({label:"Manually Choose one event",value:"opt3"}),e=="byScore"?K.unshift({label:Se+`${Z?"Priority":"Highest Priority"}`,value:"opt1",color:"secondary"}):e=="byPrio"?K.unshift({label:Se+`${Z?"Score Interval":"Shortest Score Interval"}`,value:"opt2"}):K.unshift({label:Se+`${Z?"Priority":"Highest Priority"}`,value:"opt1",color:"secondary"},{label:Se+`${Z?"Score Interval":"Shortest Score Interval"}`,value:"opt2"})),!W&&!e.indexOf("nah")>-1){let T=t?`Force in > '${S==null?void 0:S.title.trim()}' ?`:`Force in > ${U.join()}`;K.push({label:T,value:"opt4"})}else W&&Z&&(e.indexOf("onPickEvt")>-1||e.indexOf("adHocEvt")>-1)&&K.push({label:"Force add ?",value:"opt4"});let Te=e.indexOf("onDrop")>-1,it=e.indexOf("byMood")>-1,Re=`${Z&&K.length<=2||ge?"Cancel to keep scheduled":Te?"Cancel to keep as-is":it?"Cancel to keep scheduled":""}`,ot=t?`${Te?"Moving":"Adding"} (${S==null?void 0:S.id}) '${S==null?void 0:S.title.trim()}' at ${V((Ge=f.get(S.id))==null?void 0:Ge.time)} Conflicts with scheduled ${X}. 
 ${Re}`:`${Te?"Moving":"Adding"} ${X} Conflicts with scheduled (${b==null?void 0:b.id}) '${b==null?void 0:b.title.trim()}' at ${V(b==null?void 0:b.time)}. 
 ${Re}`,lt=t?`OneToMany Conflicts #${o[1]+1}`:`ManyToOne Conflicts #${o[1]+1}`;this.radioChoiceDialog(lt,ot,K,"",function(T){v(T,ge,w,O,Z)},Re!=""?R:null,function(){h("Main!")})},onPickEvent(i,e,t,o){if(this.closingDialog(),!i||!i.id){console.log("onPickEvent...ERROR nothing!",i,e,t,o),this.doNotify("No Goal selected..."),this.reset();return}let l=this.isViewingPast()?!0:e,s=o!=i.duration,n=this.daSchedule.tooClose(this.targetDrop.timestamp,s?o:i.duration);if(n){if(console.log("onPickEvent::tooClose check FAIL!",n),n===!0){this.doNotify("Picking event TOO close to midnight!"),this.reset();return}if(l)this.doNotify(`'${i.title.trim()}' TOO close Buuut..FORCING!`,"warning","top");else{this.doNotify(`'${i.title.trim()}' TOO close to a scheduled Evt--Check Force box!!`),this.reset();return}}s&&(i.duration=o);let r=this.daSchedule.onPickEvent(i,this.targetDrop.timestamp,l,t,this.doNotifyTimeout);r.canContinue?(t&&this.doNotify("What is Owed PAID! gg!","info","top"),this.reset()):r.overlaps&&Object.keys(r.overlaps).length>0?(t&&this.doNotify("Overlaps!-Balance Not Used!","negative","top"),this.handleOverlaps(r.overlaps,"onPickEvt")):this.doNotify("Error? onPickEvt :(","negative","bottom")},onAddHocEvent(i,e,t,o,l){if(this.possibleRange||(this.possibleRange=this.startEndTimes),i.trim()==""){this.doNotify("Empty Goal title..."),this.closingDialog(),this.reset();return}let s=Ue(this.possibleRange[0]),n=o>15?_(s,{minute:parseInt(o)}):_(Ue(this.possibleRange[1]),{minute:15}),r=Math.floor(te(s,n)/1e3/60),a=this.daSchedule.tooClose(s,r);if(a){if(console.log("onAddHocEvent::tooClose check FAIL!!",a),this.closingDialog(),a===!0){this.doNotify(`'${i}' Not added as over midnight!`);return}this.doNotify(`'${i}' too close to a scheduled Evt--Forcing!!`,"warning")}this.closingDialog();let g=this.daSchedule.saveNewGoal(s,i,e,t,r);if(g===0||g){let p=this.daSchedule.onAdHocEvent(g,s,l,this.doNotifyTimeout);if(p.canContinue)this.constructTree(),this.reset(),this.doNotify("New adHoc Evt added!","positive","top"),this.daSchedule.toggleActionBtns(!0,"adHocEvt"),this.mobile&&this.adjustCurrentTime();else if(console.log("onAdHocEvent::OVERLAPS?",JSON.parse(JSON.stringify(p))),p.overlaps==null){this.doNotify("Error Adding this event :(","negative"),console.log("onAdHocEvent::ERROR not found?");return}else l&&this.doNotify("Overlaps!-Balance Not Used!","warning","top"),this.handleOverlaps(p.overlaps,"adHocEvt")}else console.log("onAdHocEvent::BOO ERROR no subID :(",g),this.doNotify("Error adding :(  Add Evt by select!","negative")},onEndNow(i){const e=()=>{let n=this.daSchedule.findSchedEvent(i);this.daSchedule.removeScheduledEvt(n),this.doNotify(`Removing "${n==null?void 0:n.title.trim()}" and Saving...`,"info"),this.doSaveSchedule()},t=n=>{console.log("onEndNow::reducing!!!",i,Number.isInteger(n)),this.daSchedule.reduceEvtDuration(i,n),this.doNotify("Reducing and Saving...","info")},o=n=>{const r=ae(new Date);let a=n.start,g=n.end;if(!Be(r,a,g,!0))return console.log("onEndNow::ERROR >> not in the middle of event?!? Nothing to do...",r.time,a.time,g.time,n),!1;let p=_(r,{minute:0}),d=te(a,p);return Math.floor(d/1e3/60)};let l=this.daSchedule.findSchedEvent(i);if(!l){console.log("onEndNow::ERROR Evt not found!!!",i,l),this.doNotify("Error evt not in schedule?!","negative");return}let s=o(l);s?s<10?this.confirmAction("",`Less than 10mins remove?
 Cancel to just EndNow`,"OK",e,function(){t(s)}):t(s):console.log("onEndNow...END",i,s,Number.isInteger(s))},onSaveScore(i,e,t=""){let o=re(i);if(o<-1){o==-89?(console.log("onSaveScore parsing error",o,i),this.doNotify("Score Parsing Error... YOU FOO! ")):this.doNotify("Score Error: higher# on lower#");return}this.daSchedule.updateNoteScore(e,i,t),t!==""&&!this.isViewingPast()&&this.doNotify("Note added...do Save eh!","warning","bottom")},onAddMins(i,e){let t=this.daSchedule.addMinsToEvt(i,e,this.doNotify);if(!t.canContinue){if(t.overlaps&&Object.keys(t.overlaps).length>0)return this.doNotify("Bumped into some Evts","warning","top"),this.movedIntoConflict(t.overlaps,!0,"onAddMins",e);this.doNotify("Add ERROR:(","negative","bottom")}},removeEvtInSchedule(i,e=!0){let t=!1,o=()=>{if(this.daSchedule.removeScheduledEvt(i),t||e){e&&(this.daSchedule.addToBalance(i),this.doNotify(`Balance change after removing '${i.title}'`,"warning","top")),this.doSaveSchedule();return}this.daSchedule.toggleActionBtns(!0,"view")},l=()=>{console.log("Cancelled remove.."),this.reset(),this.closingDialog()};if(this.isViewingPast()){if(i.duration<30){this.doNotify("Removing from the past... Check BALANCE!"),this.daSchedule.addToBalance(i),t=!0,o();return}this.chooseAlternatives(i);return}if(!this.daSchedule.isViewingToday()&&!this.mobile){t=this.daSchedule.getCurrentMoods()[i.id],console.log("Removing future evt"),o();return}let s=`Remove "${i.title}" ?`,n=this.daSchedule.getStoredRawEvt(i.id),r=this.daSchedule.getCurrentMoods()[i.id];r&&(t=!!n,s=s+` With Moods: '${r}'`),n||(e=!1),s=e?s+" (Balance affected)":s,this.confirmAction("Schedule Change",s,"Remove",o,l)},betterEvtLabel(i,e,t=null){const o=(s,n)=>{if(s!=null&&s.parentGoal){let r=this.daSchedule.parentGoalById(s.parentGoal);return n?`Of '${r==null?void 0:r.title.trim()}' (${r==null?void 0:r.priority})`:`Of '${r==null?void 0:r.title.trim()}'`}return console.log("prioLabel..ERROR no PARENT found?",s),""};let l="";switch(e){case"score":return l=`${o(i,!1)} > "${i.title.trim()}" with Score:: ${i.score} = ${re(i.score)} `,l+=t?`@ ${V(i==null?void 0:i.time)} ++ ${i==null?void 0:i.duration} mins`:`for ${i==null?void 0:i.duration} mins`,{label:l,value:i.id};case"prio":return l=`"${i.title.trim()}" ${o(i,!1)} `,l+=t?`@ ${V(i==null?void 0:i.time)} ++ ${i==null?void 0:i.duration} mins`:`for ${i==null?void 0:i.duration} mins`,{label:l,value:i.id};default:return l=`"${i.title.trim()}" ${o(i,!0)} && Score:: ${i.score} = ${re(i.score)} ${t?` @ ${V(i==null?void 0:i.time)} ++ ${i==null?void 0:i.duration} mins`:`for ${i.duration} mins`}`,{label:l,value:i.id}}},getLargestScoreInterval(i){let e=0,t=null;for(let o of i){let l=re(o.score);l>-1&&l>=e&&(e=l,t=o)}return t},getSmallestScoreInterval(i){let e=9,t=null;for(let o of i){let l=re(o.score);l>-1&&l<=e&&(e=l,t=o)}return t},findhighestPrio(i){let e=0,t=null;for(let o of i)if(o.parentGoal){let l=this.daSchedule.parentGoalById(o.parentGoal);l?l.priority>e&&(e=l.priority,t=o):console.log("findhighestPrio::ERROR no PARENT found?",o)}else console.log("findhighestPrio::ERROR EVT not found?",o);return{e:t,prio:e}},chooseAlternatives(i){let e=(h,D)=>{if(h.parentGoal>D.parentGoal)return 1;if(h.parentGoal==D.parentGoal)return 0;if(h.parentGoal<D.parentGoal)return-1},t=this.daSchedule.getAltEvts().sort(e),o=ae(new Date),l=i.time,s=o.date,n=i.title;const r=h=>h.filter(D=>!this.daSchedule.getAllEvts().has(D.id)),a=h=>{let D=_(Y(s),{day:0}),u=_(Y(D.date),{day:1}),C=this.daSchedule.getEventsForDate(D.date),E={},v=null;C?E=C:console.log("chooseAlternatives::addInFutur EMPTY for >>...",D.date),h.forEach(R=>{if(v=this.daSchedule.getSubGoalByID(R),E[R]){console.log("addInFutur...ALREADY PRESENT",R,D.date,v==null?void 0:v.title.trim()),this.doNotify(`Alternative '${v==null?void 0:v.title.trim()}' already present on ${D.date}. Moving it to next day`,"warning");let f=this.daSchedule.getEventsForDate(u.date);if(f)if(!f[R])f[R]={duration:v==null?void 0:v.duration,time:l,notes:`Alt replace for '${n}'`};else{console.log("addInFutur...STILL PRESENT in next day:"+u.date,v.title.trim()),this.doNotify(`Booo! Alt '${v==null?void 0:v.title.trim()}' also present on ${u.date} :(( ...Check BALANCE!`),this.daSchedule.addToBalance(v);return}else f={},f[R]={duration:v.duration,time:l,notes:`Alt replace for '${n}'`};this.daSchedule.updateDaySchedule(u.date,f),this.doNotify(`Saving ${v.title} in ${u.date}`,"info","bottom")}else E[R]={duration:v.duration,time:l,notes:`Alt replace for '${n}'`}}),this.daSchedule.updateDaySchedule(D.date,E)},g=h=>{this.daSchedule.removeScheduledEvt(i);let D=t.find(E=>E.id==h);console.log("remReplace...Add at:",l,D.title,"usually at:"+D.time);let u=this.daSchedule.addGoalsToSchedule([{...D,time:l,notes:`Alt replace for '${n}'`}],!0),C=Object.keys(u).length;if(C>0)return console.log(`chooseAlternatives::removeReplace:: OVERLAPS again from ${D.length} overlaps =${C}`,D,u),this.doNotify(`Extra Overlaps while adding ${D[0].title.trim()}`,"negative"),this.handleOverlaps(u,"alts");this.daSchedule.saveDaySchedule(),this.doNotify(`Added Alt replacement '${D==null?void 0:D.title}' at ${l}`,"info")},p=h=>{this.doNotify(h)},d=()=>{this.daSchedule.removeScheduledEvt(i),this.daSchedule.addToBalance(i),this.doNotify(`Balance change after removing '${i.title}'`,"warning","top"),this.doSaveSchedule()};if(t=r(t),t.length==0){this.withActionNotify("...Alternatives already present!",d);return}this.checkBoxDialog("Gotta pick alternative!","Select the first Evt to replace Removed + an Extra evt for next day (today)!",t.map(h=>this.betterEvtLabel(h,"default",!1)),t[0].id,function(h){console.log("chooseAlternatives::opt",h),g(h.shift()),h.length>0?a(h):(console.log("chooseAlternatives::onOk...nothing to add?!?",t.length,h.length,t.length-h.length),p("No Alternative scheduled later :("))},function(){console.log("chooseAlternatives::onCancel")})},reset(){this.selectedItem=null,this.targetDrop=null,this.touchedItem=null,this.daSchedule.resetChosen(),this.possibleRange=null},doCleanup(){console.log("doCleanup",this.lastTarget),this.lastTarget&&(this.lastTarget.style.background="",this.lastTarget=null)},closeDialogWithReset(){this.showEvtDialog=!1,this.selectedItem=null,this.targetDrop=null,this.touchedItem=null,this.possibleRange=null},closingDialog(){this.showEvtDialog=!1},doLog(i,e){console.log(i,JSON.parse(JSON.stringify(e)))},onPrev(){let i=()=>{this.$refs.calendar.prev(),this.adjustCurrentTime()},e=()=>{setTimeout(i,1e3),this.doSaveSchedule()};this.saveScheduleDisabled?i():this.confirmAction("",`Save day: ${this.currentDate} changes?`,"Save",e,i)},onToday(){let i=()=>{this.$refs.calendar.moveToToday(),this.adjustCurrentTime()},e=()=>{setTimeout(i,1e3),this.doSaveSchedule()};this.saveScheduleDisabled?i():this.confirmAction("",`Save day: ${this.currentDate} changes?`,"Save",e,i)},onNext(){let i=()=>{this.$refs.calendar.next(),this.adjustCurrentTime()},e=()=>{setTimeout(i,1e3),this.doSaveSchedule()};this.saveScheduleDisabled?i():this.confirmAction("",`Save day: ${this.currentDate} changes?`,"Save",e,i)},onChange(){let i=this.daSchedule.onChangeViewDate(this.currentDate);if(!i.canContinue){if(i.overlaps&&i.overlaps.length>0)return this.handleOverlaps(i.overlaps,"view");this.doNotify(`Loaded schedule for ${this.currentDate}`,"positive","bottom"),this.adjustCurrentTime()}},onDragStart(i,e){if(this.isViewingPast()){this.doNotify("Editing past is no no!"),i.preventDefault();return}this.selectedItem=e},onDragEnter(i,e,t){if(e==="goal-item")i.preventDefault();else{if(this.targetDrop&&this.targetDrop.timestamp.time==t.timestamp.time)console.log("onDragEnter...calendar,SAME",this.targetDrop.timestamp.time);else{let o=i.target;o.style.background=this.selectedItem.bgcolor.includes("-")?"grey":this.selectedItem.bgcolor,this.lastTarget=o}this.targetDrop=t,i.preventDefault()}return!0},onDragOver(i,e,t){return i.preventDefault(),!0},onDragLeave(i,e,t){let o=i.target;return o.style.background="",!1},onDragEnd(i){},onDrop(i,e,t){let o=this.daSchedule.findSchedEvent(this.selectedItem.id);if(!o){console.log("onDrop ERROR",o,this.selectedItem);return}let l=null;if(e==="interval")l=t.timestamp;else if(e==="goal-item"&&this.targetDrop)l=this.targetDrop.timestamp;else{console.log("Cannot drop here YO!!",i,e,t,this.targetDrop);return}if(!l){console.log("ERROR...no timestamp YO!!",i,e,t,this.targetDrop);return}this.doDroppy(l,this.selectedItem)},onClickTime(i){this.targetDrop=i.scope,this.showEvtDialog=!0},onClickDate(i){console.log("onClickDate",i)},onClickInterval(i){console.log("onClickInterval",i)},onClickHeadIntervals(i){console.log("onClickHeadIntervals",i)},onClickHeadDay(i){console.log("onClickHeadDay",i)},onMouseDownTime({scope:i,event:e}){if(Ke(e)){if(this.mobile===!0&&this.anchorTimestamp!==null&&this.otherTimestamp!==null&&ce(this.anchorTimestamp)===ce(this.otherTimestamp)){this.otherTimestamp=i.timestamp,this.mouseDown=!1;return}this.mouseDown=!0,this.anchorTimestamp=i.timestamp,this.otherTimestamp=i.timestamp}},onMouseUpTime({scope:i,event:e}){if(this.mobile!==!0&&Ke(e)&&(this.otherTimestamp=i.timestamp,this.mouseDown=!1),!this.mousedown){let t=this.startEndTimes;if(t[1]==t[0])return;this.possibleRange=t,console.log("onMouseUpTime range change",this.possibleRange)}},onMouseMoveTime({scope:i,event:e}){this.mobile!==!0&&this.mouseDown===!0&&(this.otherTimestamp=i.timestamp)},onDblClickEvent(i,e){if(this.isViewingPast()){if(console.log("onDblClickEvent::ERROR?",e),e.duration<30){console.log("onDblClickEvent..baah too smoll smoll",e.title,e.duration),this.doNotify("umm Removing from the past..Soo Check BALANCE!"),this.daSchedule.addToBalance(e),this.daSchedule.removeScheduledEvt(e);return}this.chooseAlternatives(e),i.preventDefault();return}this.removeEvtInSchedule(e,!1),i.preventDefault()},onTouchStart(i,e){if(i.type=="touchstart"){this.selectedItem=e;let t=document.elementFromPoint(i.changedTouches[0].clientX,i.changedTouches[0].clientY);if(t.parentNode.classList.contains("my-event"))t.parentNode.classList.add("my-event-drag"),this.touchedItem=t;else if(t.closest(".my-event"),t=t.parentNode,t.parentNode.classList.contains("my-event"))t.parentNode.classList.add("my-event-drag"),this.touchedItem=t;else{this.touchedItem=!1;return}return i.preventDefault(),!0}console.log("onTouchStart::ERROR...UNKNOWN",i)},onTouchEvt(i,e){const t=l=>{let s=l.split(" "),n=s[s.length-2],r=_(Y(this.currentDate),{minute:j(n)});return s[s.length-1]=="PM"?r.hour==12?r:_(Y(this.currentDate),{hour:12,minute:j(n)}):r.hour==12?_(Y(this.currentDate),{hour:-12,minute:j(n)}):r};let o=l=>{let s=l.closest(".my-event");s.classList.contains("my-event-drag")&&s.classList.toggle("my-event-drag")};if(this.selectedItem||(console.log("onTouchEvt NULL Item >>ERROR?!? "+i.type,this.selectedItem,this.touchedItem),e=this.selectedItem),this.isViewingPast()){this.doNotify("Editing past is no no!"),o(this.touchedItem),i.preventDefault(),i.stopPropagation();return}if(i.type=="touchmove"){let l=document.elementFromPoint(i.changedTouches[0].clientX,i.changedTouches[0].clientY);if(l.ariaLabel){let s=t(l.ariaLabel);if(this.targetDrop){let n=te(this.targetDrop,s);if(JSON.stringify(this.targetDrop)===JSON.stringify(s)&&n==0)return;this.lastTarget?(this.lastTarget.style.background="",l.style.background=this.selectedItem.bgcolor.includes("-")?"grey":this.selectedItem.bgcolor,this.lastTarget=l):(this.lastTarget=l,l.style.background=this.selectedItem.bgcolor.includes("-")?"grey":this.selectedItem.bgcolor)}this.targetDrop=s,i.preventDefault();return}return}if(i.type=="touchend"){let l=document.elementFromPoint(i.changedTouches[0].clientX,i.changedTouches[0].clientY);if(!this.touchedItem)return;if(l.parentNode.classList.contains("my-event-drag"))console.log("onTouchEvt::END >>removing my-event-drag","isDisabledScoreEdit>> "+this.daSchedule.isDisabledScoreEdit[e.id],"mobileEnableScore>> "+this.daSchedule.mobileEnableScore[e.id]),l.parentNode.classList.remove("my-event-drag");else{let s=this.touchedItem.parentNode.classList.contains("my-event-drag");s?this.touchedItem.parentNode.classList.remove("my-event-drag"):console.log("onTouchEvt::END...target NO my-event-drag?",s,l,l.parentNode)}if(l.ariaLabel){let s=t(l.ariaLabel);this.targetDrop=s,this.doDroppy(this.targetDrop,this.selectedItem)}else(l.classList.contains("title")||l.classList.contains("my-event"))&&this.targetDrop&&this.doDroppy(this.targetDrop,this.selectedItem);i.preventDefault(),i.stopPropagation();return}console.log("onTouchEvt::UNKNOWN",i)},onTouchHold({evt:i,...e},t){if(!this.mobile)return console.log("onTouchHold>>NOT MOBILE",i.type,"mobileEnableScore>> "+this.daSchedule.mobileEnableScore[t.id]),!0;let o=document.elementFromPoint(i.changedTouches[0].clientX,i.changedTouches[0].clientY);this.daSchedule.toggleEvtNoteScoreMobile(t.id);let l=o.closest(".my-event");o.classList.contains("title")&&o.parentNode.classList.contains("my-event-drag")?(console.log("onTouchHold...REMOVING my-event-drag"),o.parentNode.classList.remove("my-event-drag")):l&&l.classList.contains("my-event-drag")?l.classList.toggle("my-event-drag"):this.touchedItem&&(l=this.touchedItem.closest(".my-event"),l&&l.classList.contains("my-event-drag")?l.classList.toggle("my-event-drag"):console.log("ERROR...onTouchHold--class not found on Target!!",o,this.touchedItem)),this.daSchedule.isDisabledScoreEdit[t.id]&&!this.daSchedule.mobileEnableScore[t.id]&&this.onDblClickEvent(i,t)},scrollToEvent(i){this.$refs.calendar.scrollToTime(i.time,350)},scrollToTime(i,e=null){var t;if(this.$refs.calendar){let o=_(i,{minute:-10});(t=this.$refs.calendar)==null||t.scrollToTime(o.time,e?e=="fast"?400:1e3:500)}else setTimeout(()=>{console.log("scrollToTime::NO SCROLLY at",i.time,"Trying again...."),this.scrollToTime(i,"slow")},1e3)},confirmTimeChange(i,e,t,o,l,s,n=null){this.$q.dialog({title:i,message:e,cancel:!1,ok:t,options:{type:"radio",model:"",items:[{label:t+" and "+o,value:"ok"},{label:o,value:"alt"}]},class:"overflow-wrap: break-word;",style:""}).onOk(r=>{if(r==""){console.log("confirmTimeChange onOk with no selection >>onDismiss"),this.doNotify("No selection made...Leaving as is","info"),n?n():console.log("confirmTimeChange:: No Dismiss func to execute!");return}return l(r)}).onCancel(()=>{s()})},radioChoiceDialog(i,e,t,o,l=null,s=null,n=null){this.$q.dialog({title:i,cancel:!!s,persistent:!0,message:e,seamless:!0,options:{type:"radio",model:o,items:t}}).onOk(r=>{l&&(r==""?this.radioChoiceDialog(i,e,t,o,l,s,n):l(r))}).onCancel(()=>{s&&s()}).onDismiss(()=>{n&&n()})},checkBoxDialog(i,e,t,o,l=null,s=null,n=null){let r=t.length,a=r>2?2:r;this.$q.dialog({title:i,message:e,options:{type:"checkbox",model:[],isValid:g=>g.length>0&&g.length>=a,items:t},cancel:!0,persistent:!0}).onOk(g=>{l(g)}).onCancel(()=>{s&&s()}).onDismiss(()=>{n&&n()})},confirmChoiceDialog(i,e,t,o,l=null,s=null,n=null){this.$q.dialog({title:i,cancel:!!s,persistent:!0,message:e,options:{type:"radio",model:o,items:t}}).onOk(r=>{l&&(r==""?this.confirmChoiceDialog(i,e,t,o,l,s,n):l(r))}).onCancel(()=>{s&&s()}).onDismiss(()=>{n&&n()})},scheduleByDialog(i,e,t,o,l=null,s=null,n=null){this.$q.dialog({component:si,componentProps:{title:i,message:e,options:t,selectedO:o}}).onOk(r=>{l&&(r.choice==""?this.scheduleByDialog(i,e,t,o,l,s,n):l(r))}).onCancel(()=>{s&&s()}).onDismiss(()=>{n&&n()})},confirmAction(i,e,t,o,l,s=null){this.$q.dialog({title:i,cancel:!0,ok:t,message:e}).onOk(()=>{o()}).onCancel(()=>{l()}).onDismiss(()=>{if(s){s();return}})},doNotifyTimeout(i,e=void 0,t="top",o=null){this.$q.notify({color:e!==void 0?e:"negative",position:t,message:i,icon:e==null?"report_problem":"thumb_up",timeout:o||5e3,multiLine:!0})},doNotify(i,e=void 0,t="top"){this.$q.notify({color:e!==void 0?e:"negative",position:t,message:i,multiLine:!0,icon:e==null?"report_problem":"thumb_up"})},withActionNotify(i,e=null,t=void 0,o="top",l=null){this.$q.notify({color:t!==void 0?t:"negative",position:o,message:i,icon:t==null?"report_problem":"thumb_up",onDismiss:l,actions:[{label:"Force?",color:"yellow",handler:()=>{e?e():console.log("withActionNotify::ActionHandler::NOTHING...")}}]})}}},Ee=i=>(Ct("data-v-dd68ea38"),i=i(),Et(),i),ri={class:"subcontent"},ai={class:"q-px-md boxy"},di={key:0},hi={key:1},ci={key:2},ui={key:3},fi={key:4},gi={key:5},mi={class:"row justify-center"},Si=Ee(()=>x("br",null,null,-1)),pi=Ee(()=>x("br",null,null,-1)),yi={key:0,class:"q-pa-sm bg-grey-12",style:{"max-width":"400px"}},vi={class:"q-pa-sm row justify-center"},bi={class:"row justify-center"},Oi=Ee(()=>x("br",null,null,-1)),Di={key:0,class:"q-gutter-md"},Ci={class:"q-mr-sm text-weight-bold",size:"28px"},Ei={key:0},Ti={class:"text-weight-bold"},Ri={key:1,class:"text-weight-light text-black"},wi={key:1,class:"q-pa-md q-gutter-sm bg-grey-12",style:{"max-width":"400px"}},Ni={class:"instru"},Pi={key:0,class:"row q-px-md"},Ai={class:"row justify-center"},$i={class:"q-gutter-md",style:{display:"flex","max-width":"800px",width:"100%",height:"600px"}},Mi={style:{display:"flex","justify-content":"center","flex-wrap":"wrap",padding:"2px"}},_i={class:"heady q-calendar__ellipsis"},ki=["onDblclick","onDragstart","onTouchstart","onTouchmove","onTouchend"],Ii=Ee(()=>x("br",null,null,-1));function Bi(i,e,t,o,l,s){const n=ie("sched-btn"),r=ie("drop-dwn-btn"),a=ie("da-instructions"),g=ie("navigation-bar"),p=ie("goaly-end"),d=ie("mobileNoteScore"),h=ie("q-calendar-day"),D=ie("sched-dialog");return M(),Q(It,{padding:""},{default:L(()=>[x("div",ri,[A(qe,{modelValue:l.splitterPage,"onUpdate:modelValue":e[10]||(e[10]=u=>l.splitterPage=u),limits:[30,70]},{before:L(()=>[A(qe,{modelValue:l.splitterLegend,"onUpdate:modelValue":e[3]||(e[3]=u=>l.splitterLegend=u),horizontal:"",limits:[20,80],style:{height:"100%"}},{before:L(()=>[x("div",ai,[l.daSchedule.getProps().showReloadBtn?(M(),F("div",di,[A(n,{"text-label":"Reload",class:"sched-btn","text-color":"green",onDoBtnAction:s.onReloadSaved},null,8,["onDoBtnAction"])])):H("",!0),l.daSchedule.getProps().showClearBtn?(M(),F("div",hi,[A(n,{"text-label":"Clear",class:"sched-btn","text-color":"lime-5",onDoBtnAction:s.onClearDay},null,8,["onDoBtnAction"])])):H("",!0),l.daSchedule.getProps().showLoadDefaults?(M(),F("div",ci,[A(n,{textLabel:s.defaultBtnLabel,isDisabled:s.isDefaultBtnEnabled,class:"sched-btn","text-color":"blue",onDoBtnAction:s.onLoadDefault},null,8,["textLabel","isDisabled","onDoBtnAction"])])):H("",!0),l.daSchedule.getProps().showScoreBtn?(M(),F("div",ui,[A(r,{class:"sched-drop-btn","text-color":"teal",disableBtn:l.daSchedule.disableScoreBtn,optionLabel:s.chosenScoreLabel,daOptions:l.scoreOptions,onDoReload:s.doReloadWithScore,onChooseOption:s.onChoosenScore},null,8,["disableBtn","optionLabel","daOptions","onDoReload","onChooseOption"])])):H("",!0),l.daSchedule.getProps().showPrioBtn?(M(),F("div",fi,[A(r,{class:"sched-drop-btn","text-color":"teal",disableBtn:l.daSchedule.getProps().disablePrioBtn,optionLabel:s.chosenPrioLabel,daOptions:s.allMainGPrio(),onDoReload:s.doReloadWithPrio,onChooseOption:s.onChoosenPrio},null,8,["disableBtn","optionLabel","daOptions","onDoReload","onChooseOption"])])):H("",!0),l.daSchedule.getProps().showOneEachBtn?(M(),F("div",gi,[A(n,{"text-label":"One Each",class:"sched-btn","text-color":"brown",onDoBtnAction:s.onScheduleOneEach},null,8,["onDoBtnAction"])])):H("",!0)]),x("div",mi,[A(De,{class:"q-mt-md","text-color":s.saveScheduleDisabled?"grey":"blue",elevated:"",push:"",align:"evenly",label:"SaveSchedule",disable:s.saveScheduleDisabled,onClick:s.doSaveSchedule,"no-caps":""},null,8,["text-color","disable","onClick"]),A(De,{class:"q-mt-md","text-color":"green",elevated:"",push:"",align:"evenly",label:l.showTree?"HideTree":"ShowTree",onClick:e[0]||(e[0]=u=>l.showTree=!l.showTree),"no-caps":""},null,8,["label"])]),Si]),after:L(()=>[pi,l.treeGoals.length>0?(M(),F("div",yi,[x("div",vi,J(s.labelGoals("s")),1),x("div",bi,[A(be,{color:"secondary","multi-line":""},{default:L(()=>[oe(J(s.labelGoals("b"))+" mins ",1)]),_:1})]),A(Oe),Oi,s.showTreeForm?(M(),F("div",Di,[A(At,{label:"'je-suis'",hint:"Keyword >> Enter","hide-hint":"",ref:"filterRef",modelValue:l.filter,"onUpdate:modelValue":e[1]||(e[1]=u=>l.filter=u),"use-input":"","use-chips":"",multiple:"",disable:s.isViewingPast(),"hide-dropdown-icon":"","input-debounce":"0","new-value-mode":"add-unique",class:"q-gutter-sm"},{"selected-item":L(u=>[A($t,{removable:"",dense:"",onRemove:C=>u.removeAtIndex(u.index),tabindex:u.tabindex,"text-color":"black",class:"q-ma-none",style:{width:"80px"}},{default:L(()=>[oe(J(u.opt),1)]),_:2},1032,["onRemove","tabindex"])]),append:L(()=>[l.filter.length>0?(M(),Q($e,{key:0,name:"clear",class:"cursor-pointer",onClick:s.resetFilter},null,8,["onClick"])):H("",!0)]),_:1},8,["modelValue","disable"]),A(Bt,{nodes:l.treeGoals,"node-key":"label",filter:s.filterString,"filter-method":s.myFilterMethod,expanded:l.expanded,"onUpdate:expanded":e[2]||(e[2]=u=>l.expanded=u),"no-connectors":"",dense:""},{"default-header":L(u=>[x("div",{class:ve(s.classyColor(u.node))},[u.node.isChildren?H("",!0):(M(),Q($e,{key:0,name:u.expanded?"expand_less":"expand_more",size:"28px",right:""},null,8,["name"])),x("div",Ci,J(u.node.label),1),A($e,{name:u.node.icon},null,8,["name"])],2)]),"default-body":L(u=>[u.node.isChildren?(M(),F("div",Ei,[x("span",Ti," >> "+J(u.node.details),1),u.node.moods.length>0?(M(),Q(Ie,{key:0},{default:L(()=>[oe(J("Moods::> "+u.node.moods.join(",")),1)]),_:2},1024)):H("",!0)])):(M(),F("span",Ri,J(u.node.details),1))]),_:1},8,["nodes","filter","filter-method","expanded"])])):H("",!0),l.filter.length>0?(M(),F("div",wi,[A(n,{"text-label":"Add Mood Evts",class:"q-mt-xl sched-btn","text-color":"red",onDoBtnAction:s.onMoodAdd},null,8,["onDoBtnAction"])])):H("",!0)])):H("",!0)]),_:1},8,["modelValue"]),x("div",Ni,[A(Ze,{modelValue:l.showInstru,"onUpdate:modelValue":e[4]||(e[4]=u=>l.showInstru=u),label:l.showInstru?"Hide Instructions":"Show Instructions",color:"teal",class:"q-pa-md q-mx-xl",align:"center"},null,8,["modelValue","label"]),l.showInstru?(M(),Q(a,{key:0,showRemInstru:s.showRemInstru,showSchedInstru:s.showSchedInstru},null,8,["showRemInstru","showSchedInstru"])):H("",!0)])]),separator:L(()=>[A(Ot,{color:"primary",class:"q-px-md","text-color":"white",size:"40px",icon:"drag_indicator",style:{position:"relative",top:"70%"}})]),after:L(()=>[A(g,{onToday:s.onToday,onPrev:s.onPrev,onNext:s.onNext},null,8,["onToday","onPrev","onNext"]),s.scheduleMoodsLabel?(M(),F("div",Pi,[oe(" By moods: "),(M(!0),F(he,null,Me(s.scheduleMoodsLabel,(u,C)=>(M(),Q(be,{key:C,color:u.color,"multi-line":"",rounded:""},{default:L(()=>[oe(J(u.m),1)]),_:2},1032,["color"]))),128))])):H("",!0),x("div",Ai,[x("div",$i,[A(h,{ref:"calendar",view:"day",modelValue:l.currentDate,"onUpdate:modelValue":e[9]||(e[9]=u=>l.currentDate=u),"drag-enter-func":s.onDragEnter,"drag-over-func":s.onDragOver,"drag-leave-func":s.onDragLeave,"drop-func":s.onDrop,animated:"",bordered:"",hoverable:"","no-active-date":"","transition-next":"slide-left","transition-prev":"slide-right","time-clicks-clamped":"","interval-minutes":15,"interval-count":96,"interval-height":28,"selected-start-end-dates":s.startEndTimes,onChange:s.onChange,onClickDate:s.onClickDate,onClickTime:s.onClickTime,onClickInterval:s.onClickInterval,onClickHeadIntervals:s.onClickHeadIntervals,onClickHeadDay:s.onClickHeadDay,onMousedownTime:s.onMouseDownTime,onMouseupTime:s.onMouseUpTime,onMousemoveTime:s.onMouseMoveTime},{"head-day-event":L(({scope:{timestamp:u}})=>[x("div",Mi,[(M(!0),F(he,null,Me(s.eventsMap[u.date],C=>(M(),F(he,{key:C.id},[C.time?(M(),Q(be,{key:1,class:ve(s.badgeClasses(C,"header")),style:me([s.badgeStyles(C,"header"),{margin:"1px",width:"10px","max-width":"10px",height:"10px","max-height":"10px",cursor:"pointer"}]),onClick:E=>s.scrollToEvent(C)},{default:L(()=>[A(Ie,null,{default:L(()=>[oe(J("("+C.id+") "+C.title+" - "+C.time+" ("+C.duration+"min) >> "+C.end.time),1)]),_:2},1024)]),_:2},1032,["class","style","onClick"])):(M(),Q(be,{key:0,class:ve(s.badgeClasses(C,"header")),style:me([s.badgeStyles(C,"header"),{width:"100%",cursor:"pointer",height:"12px","font-size":"10px",margin:"1px"}])},{default:L(()=>[x("div",_i,[oe(J(C.title)+" ",1),A(Ie,null,{default:L(()=>[oe(J(C.details),1)]),_:2},1024)])]),_:2},1032,["class","style"]))],64))),128))])]),"day-container":L(({scope:{days:u}})=>[s.hasDate(u)?(M(),F(he,{key:0},[x("div",{class:"day-view-current-time-indicator",style:me(s.style)},null,4),x("div",{class:"day-view-current-time-line",style:me(s.style)},null,4)],64)):H("",!0)]),"day-body":L(({scope:{timestamp:u,timeStartPos:C,timeDurationHeight:E}})=>[(M(!0),F(he,null,Me(s.getDateEvents(u.date),v=>(M(),F(he,{key:v.id},[v.time!==void 0?(M(),F("div",{key:0,class:ve(["my-event",s.badgeClasses(v,"body")]),style:me(s.badgeStyles(v,"body",C,E)),draggable:!0,onDblclick:_e(R=>s.onDblClickEvent(R,v),["prevent"]),onDragstart:_e(R=>s.onDragStart(R,v),["stop"]),onDragend:e[5]||(e[5]=_e((...R)=>s.onDragEnd&&s.onDragEnd(...R),["stop"])),onDrop:e[6]||(e[6]=R=>s.onDrop(R,"goal-item",i.scope)),onDragenter:e[7]||(e[7]=R=>s.onDragEnter(R,"goal-item",i.scope)),onDragover:e[8]||(e[8]=R=>s.onDragOver(R,"goal-item",i.scope)),onTouchstart:R=>s.onTouchStart(R,v),onTouchmove:R=>s.onTouchEvt(R,v),onTouchend:R=>s.onTouchEvt(R,v)},[Dt(A(p,{disabledScore:l.daSchedule.isDisabledScoreEdit[v.id],title:v.title,id:v.id,startTime:v.time,score:v.score,details:v.details,notes:v.notes,icon:v.icon,happeningNow:l.daSchedule.hasStarted[v.id]?l.daSchedule.hasStarted[v.id]:!1,onEndNow:s.onEndNow,onSaveScore:s.onSaveScore,onAddMins:s.onAddMins,onDeleteNow:R=>s.removeEvtInSchedule(v)},null,8,["disabledScore","title","id","startTime","score","details","notes","icon","happeningNow","onEndNow","onSaveScore","onAddMins","onDeleteNow"]),[[xt,R=>s.onTouchHold(R,v),"400:12:15"]]),s.showEvtMobile(v.id)?(M(),Q(d,{key:0,title:v.title,id:v.id,startTime:v.time,score:v.score,details:v.details,notes:v.notes,"show-dialog":s.showEvtMobile(v.id),onSaveScore:s.onSaveScore,onDeleteNow:R=>s.removeEvtInSchedule(v),onEuhHidin:R=>l.daSchedule.euhHidin(v.id)},null,8,["title","id","startTime","score","details","notes","show-dialog","onSaveScore","onDeleteNow","onEuhHidin"])):H("",!0)],46,ki)):H("",!0)],64))),128))]),_:1},8,["modelValue","drag-enter-func","drag-over-func","drag-leave-func","drop-func","selected-start-end-dates","onChange","onClickDate","onClickTime","onClickInterval","onClickHeadIntervals","onClickHeadDay","onMousedownTime","onMouseupTime","onMousemoveTime"])])]),Ii]),_:1},8,["modelValue"]),l.showEvtDialog?(M(),Q(D,{key:0,parentGoals:l.daSchedule.allPGoals(),canBeScheduled:s.canbeScheduled,balance:s.currentBalance,selectedTime:s.selectedTimeInterval(),onAdHocEvent:s.onAddHocEvent,onOnPickEvent:s.onPickEvent,onEuhHidin:s.closingDialog},null,8,["parentGoals","canBeScheduled","balance","selectedTime","onAdHocEvent","onOnPickEvent","onEuhHidin"])):H("",!0)])]),_:1})}var zi=Xe(ni,[["render",Bi],["__scopeId","data-v-dd68ea38"]]);export{zi as default};
