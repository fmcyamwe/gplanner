import{F as U,a1 as F,r as E,N as L,G as y,H as D,I as c,O as g,J as m,R as S,S as P,U as R,a2 as W,a3 as T,Q as B,K as G,M as N,a4 as J,L as _,a5 as k,_ as Y,a6 as I}from"./index.8d9f491f.js";import{u as X,a as Z,Q as ee,b as q,c as te}from"./goalStorage.7a0c2073.js";import{Q as H}from"./QBadge.70b7f409.js";import{i as se,Q as ae}from"./isMobile.1eb8eb3c.js";import{Q as ie}from"./index.f1f77578.js";import{t as oe,F as le,a as b,p as O,b as C,N as Q,O as V,P as z,S as ne}from"./QCalendarTask.f5cba6e2.js";import{a as re,b as de}from"./utiFunc.f569f737.js";import{N as w}from"./actions.b3f98fa8.js";const he={name:"weekCalendar",components:{NavigationBar:F(()=>Y(()=>import("./NavigationBar.c2070522.js"),["assets/NavigationBar.c2070522.js","assets/NavigationBar.bf3d18d0.css","assets/index.8d9f491f.js","assets/index.f80becc5.css"])),QCalendar:ie},data(){return X(),{store:Z(),calendar:E(null),currentDate:E(oe()),events:[],treeGoals:E([]),expanded:E([]),showTree:E(!1),moods:E({}),mobile:E(!1),todayEvts:E({}),mostEvts:E(5),intervalMins:E(15),intervals:E(48),earliestStart:E(0),testEarliest:E(null)}},beforeMount(){this.mobile=se(),this.loadEvts(),this.constructTree(),this.dayNotifData()},computed:{storedGoalsMap(){const s=new Map;let e=this.store.getSubGoals;return e?(e.forEach(t=>{s.set(t.id,t)}),s):(console.log("GoalsMap is empty or null",e),s)},label(){return this.showTree?"Hide Legend":"Show Legend"},allEvents(){return this.store.getAllDates},parentGoalsMap(){const s=new Map;let e=this.store.getMainGoals;return e?(e.forEach(t=>{s.set(t.id,t)}),s):(console.log("parentGoalsMap is empty or null",e),s)},eventsMap(){const s={};return this.events.forEach(e=>{if(s[e.date]||(s[e.date]=[]),s[e.date].push(e),e.days){console.log(`eventsMap multiple days? event for ${e.date}`,e.days);let t=le(e.date),n=e.days;do t=b(t,{day:1}),s[t.date]||(s[t.date]=[]),s[t.date].push(e);while(--n>0)}}),s}},methods:{reload(){this.loadEvts(!0)},loadEvts(s=!1){var i,a,h,u;let e=this.parentGoalsMap,t=this.storedGoalsMap,n=this.store.getAllDates;if(t&&e){if(n){s&&(this.events=[],this.moods={});for(let o in n){let l=n[o];o==this.currentDate&&(this.todayEvts=l);for(let r in l){let d=t.get(parseInt(r));if(d){let f=e.get(d.parentGoal),p=b(C(o),{minute:O(l[r].time)}),v=b(p,{minute:parseInt(l[r].duration)}),x="";l[r].notes!==void 0&&((i=l[r])==null?void 0:i.notes)!==""?x=[`${p.time} - ${v.time}`,`${(h=(a=l[r])==null?void 0:a.atScore)!=null?h:""} >> ${d.score}`,`${(u=l[r])==null?void 0:u.notes}`].join(`
\r`):x=`${p.time} - ${v.time}`,l[r].byMood!==void 0&&(this.moods[o]||(this.moods[o]=[]),this.moods[o].push(...l[r].byMood)),this.testEarliest||(console.log(`loadEvts::testEarliest>> ${d.id}: `+d.title,JSON.stringify(o),JSON.stringify(p.time)),this.testEarliest=p),this.events.push({id:d.id,title:d.title,details:x,time:l[r].time,duration:l[r].duration,date:o,bgcolor:f.bgcolor,sortTime:p})}}}}}else{console.log("ERROR--no parent or goals!!REVIEW**");return}},dayNotifData(){if(this.mobile){let s=this.storedGoalsMap;console.log("dayNotifData",JSON.stringify(this.todayEvts)),w.getSkippedNotifs({date:this.currentDate}).then(e=>{var n,i;let t=e.skipped;if(Array.isArray(t)&&t.length>0)if(Object.keys(this.todayEvts).length>0){console.log("WoooResults>> ",JSON.stringify(t));let a=[];for(let h of t)h in this.todayEvts?(delete this.todayEvts[h],a.push((i=(n=s.get(parseInt(h)))==null?void 0:n.title)!=null?i:""),console.log("dayNotifData::deleteSkipped>> "+h,JSON.stringify(a))):console.log("dayNotifData::Skipped NOT FOUND?!? "+h,JSON.stringify(a));this.store.saveDailySchedule(this.currentDate,this.todayEvts),a.forEach(h=>{this.$q.notify({color:"warning",position:"top",message:`'${h}' Was Skipped!`,caption:`${this.currentDate} Schedule updated with removal`,icon:"thumb_down",timeout:t.length>1?2e3:3e3})}),w.clearStoreKey({key:"skip"}).then(h=>{this.reload()})}else console.log("ERROR::storage::mismatch--SHOULD CLEAR!?!")}).catch(e=>{console.log("dayNotifData::getSkippedNotifs>>ERROR",e)}),w.getNotes().then(e=>{var t,n;if("notes"in e){let i=e.notes;const a=[];if(Array.isArray(i)){let h=[];for(let u of i)if(u.id in this.todayEvts){let o=Object.assign({},{...this.todayEvts[u.id],notes:u.note});this.todayEvts[u.id]=o,h.push(`'${(n=(t=s.get(parseInt(u.id)))==null?void 0:t.title)!=null?n:""}'`),a.push(u.id)}else console.log("getNotes>>ERROR note Evts not found "+u.id,JSON.stringify(u),JSON.stringify(this.todayEvts));this.store.saveDailySchedule(this.currentDate,this.todayEvts),this.$q.notify({color:"positive",position:"top",message:`${h.join()} Evts had notes added!!`,icon:"thumb_up",timeout:3e3})}else console.log("getNotes>>ERROR not array",JSON.stringify(i),Array.isArray(i));w.clearStoreKey({key:"notey",ids:a}).then(h=>{this.reload()})}}),w.getStartEndTimes().then(e=>{var t,n;if("started"in e&&"ended"in e){let i=e.started,a=e.ended;if(!(Array.isArray(i)&&Array.isArray(a))){console.log("getStartEndTimes>>ERROR::not arrays?!?",i,a);return}if(Object.keys(this.todayEvts).length<1&&(i.length>0||a.length>0)){console.log("ERROR::getStartEndTimes >>storage mismatch--CLEARING KEYS!!"),w.clearStoreKey({key:"start"}).then(u=>{console.log("dayNotifData::clearStoreKey>>Start",JSON.stringify(u))}).then(()=>{console.log("dayNotifData::clearStoreKey>>End"),w.clearStoreKey({key:"end"})});return}if(i.length>0||a.length>0){let u=[],o=[],l=[];console.log("getStartEndTimes::",JSON.stringify(i),"ended>> "+JSON.stringify(a));for(let r in this.todayEvts){let d=i.find(v=>v.id==r),f=a.find(v=>v.id==r),p=this.todayEvts[r];if(d&&f){console.log(`getStartEndTimes>> Key: ${r} in BOTH!!`,JSON.stringify(d),JSON.stringify(f));let v=Q(new Date(d.startedAt)),x=Q(new Date(f.endedAt)),A=b(C(this.currentDate),{minute:O(p.time)});console.log(`getStartEndTimes>> ${d.id} was saved at`,A.time,"for: "+p.duration);let $=Math.floor(V(A,v)/1e3/60),M=Math.floor((f.endedAt-d.startedAt)/1e3/60);if(console.log(d.id+" Actual startedAt and endedAt",v.time,x.time,$," with actualDura: "+M),$>=3||M>p.duration){let K=v.time,j=Object.assign({},{...p,time:K,duration:M});console.log("getStartEndTimes::Setting Started>> "+r,JSON.stringify(j)),this.todayEvts[r]=j,l.push([`'${(n=(t=s.get(parseInt(d.id)))==null?void 0:t.title)!=null?n:""}' was modified!`,`Start time: ${K} with duration: ${M}`])}u.push(d.id),o.push(f.id)}else if(d)console.log("dayNotifData::getStartEndTimes::Evt only IN START?!? "+r,JSON.stringify(d));else if(f){let v=b(C(this.currentDate),{minute:O(p.time)}),x=Q(new Date(f.endedAt)),A=Math.floor(V(v,x)/1e3/60);console.log("dayNotifData::getStartEndTimes::Evt only IN END?! "+r,"dura as "+p.duration,A,JSON.stringify(f),v.time,x.time),o.push(f.id)}else console.log("dayNotifData::getStartEndTimes>> Evt with no start or end!! "+r,JSON.stringify(this.todayEvts[r]))}this.store.saveDailySchedule(this.currentDate,this.todayEvts),l.forEach(r=>{var d,f;this.$q.notify({color:"warning",position:"top",message:(d=r[0])!=null?d:"",caption:(f=r[1])!=null?f:"",icon:"tag_faces",timeout:l.length>1?2e3:3e3})}),u.length>0&&w.clearStoreKey({key:"start",ids:u}),o.length>0&&w.clearStoreKey({key:"end",ids:o})}}}).then(()=>{this.reload()})}},constructTree(){this.treeGoals=this.store.fetchGoalsTree()},getEvents(s){let e=(n,i)=>{let a=V(n.sortTime,i.sortTime);if(a>0)return-1;if(a==0)return 0;if(a<0)return 1};const t=this.eventsMap[s]||[];if(t.length===1)t[0].side="full";else if(t.length===2){const n=b(C(t[0].date),{minute:O(t[0].time)}),i=b(n,{minute:t[0].duration}),a=b(C(t[1].date),{minute:O(t[1].time)}),h=b(a,{minute:t[1].duration});z(a,n,i,!0)||z(h,n,i,!0)?(t[0].side="left",t[1].side="right"):(t[0].side="full",t[1].side="full")}return t.length>this.mostEvts&&(console.log(`getEvents hiiigh ${s}`,t.length,this.mobile),this.mostEvts=this.mobile?t.length+5:t.length),t.sort(e),t},isEarlier(s){var n;let e=this.getTimeyNumber(s),t=this.getTimeyNumber(this.testEarliest);console.log(`isEarlier::testEarliest>> ${(n=s==null?void 0:s.time)!=null?n:"EMPTY"}: ${this.testEarliest.time}`,JSON.stringify(e),JSON.stringify(t))},getTimeyNumber(s){return s!==null?ne(s):!1},classyColor(s){return`row items-center ${s.isChildren?"text-":"text-white bg-"}${s.color} `},badgeClasses(s,e){return re(s,e)},badgeStyles(s,e,t=void 0,n=void 0){return de(s,e,t,n)},scrollToEvent(s){this.$refs.calendar.scrollToTime(s.time,350)},onToday(){this.$refs.calendar.moveToToday()},onPrev(){this.$refs.calendar.prev()},onNext(){this.$refs.calendar.next()},onClickHeadDay({scope:s,event:e}){var a,h;let t=s.timestamp.date,n=this.moods[t],i=(h=(a=this.eventsMap[t])==null?void 0:a.length)!=null?h:0;n?this.$q.notify({color:"positive",position:"top",message:`${i} Scheduled with Moods: ${n.join()}`,icon:"tag_faces",multiLine:!0,timeout:3e3}):this.$q.notify({color:"white",textColor:"black",position:"top",message:i>0?`${i} Scheduled without Any Mood!`:"Empty and NO mood!!",icon:i>0?"mood":"sentiment_neutral",iconColor:i>0?"positive":"red",multiLine:!0,timeout:3e3})},onChange(s){this.mostEvts=5}}},ue={class:"q-px-md"},me={class:"row justify-center"},ce={class:"q-px-md",style:{display:"flex","max-width":"800px",width:"100%",height:"500px"}},ye={style:{display:"flex","justify-content":"center","flex-wrap":"wrap",padding:"2px"}},fe={class:"title q-calendar__ellipsis"},ge={class:"title q-calendar__ellipsis"},pe={class:"lineyy"},ve={key:0,class:"q-pa-md"},Ee={key:0,class:"q-pa-md bg-grey-12",style:{"max-width":"400px"}},Se={class:"q-mr-sm text-weight-bold",size:"28px"},_e={key:0},Ne={class:"text-weight-bold liney"},be={key:1,class:"text-weight-light text-black liney"},we={key:1,class:"column justify-center items-center"};function xe(s,e,t,n,i,a){const h=L("navigation-bar"),u=L("q-calendar");return y(),D(ee,{padding:""},{default:c(()=>[g("div",ue,[m(h,{onToday:a.onToday,onPrev:a.onPrev,onNext:a.onNext},null,8,["onToday","onPrev","onNext"]),e[3]||(e[3]=g("i",{class:"row justify-center q-pa-sm"},"Click on Day header for that day's Moods ",-1)),g("div",me,[g("div",ce,[m(u,{ref:"calendar",modelValue:i.currentDate,"onUpdate:modelValue":e[0]||(e[0]=o=>i.currentDate=o),view:"week",dark:"",animated:"",hoverable:"",bordered:"","transition-prev":"slide-right","transition-next":"slide-left","no-active-date":"","interval-minutes":15,"interval-count":96,"interval-height":i.mostEvts*3,onChange:a.onChange,onClickHeadDay:a.onClickHeadDay},{"head-day-event":c(({scope:{timestamp:o}})=>[g("div",ye,[(y(!0),S(R,null,P(a.eventsMap[o.date],l=>(y(),S(R,{key:l.id},[l.time?(y(),D(H,{key:1,class:J(a.badgeClasses(l,"header")),style:I([a.badgeStyles(l,"header"),{margin:"1px",width:"10px","max-width":"10px",height:"10px","max-height":"10px",cursor:"pointer"}]),onClick:r=>a.scrollToEvent(l)},{default:c(()=>[m(q,null,{default:c(()=>[_(N(l.time+" - "+l.title),1)]),_:2},1024)]),_:2},1032,["class","style","onClick"])):(y(),D(H,{key:0,class:J(a.badgeClasses(l,"header")),style:I([a.badgeStyles(l,"header"),{width:"100%",cursor:"pointer",height:"12px","font-size":"10px",margin:"1px"}])},{default:c(()=>[g("div",fe,[_(N(l.title)+" ",1),m(q,null,{default:c(()=>[_(N(l.details),1)]),_:2},1024)])]),_:2},1032,["class","style"]))],64))),128))])]),"day-body":c(({scope:{timestamp:o,timeStartPos:l,timeDurationHeight:r}})=>[(y(!0),S(R,null,P(a.getEvents(o.date),d=>(y(),S(R,{key:d.id},[d.time!==void 0?(y(),S("div",{key:0,class:J(["my-event",a.badgeClasses(d,"body")]),style:I(a.badgeStyles(d,"body",l,r))},[g("span",ge,[_(N(d.title)+" ",1),m(q,null,{default:c(()=>[g("div",pe,N(d.details),1)]),_:2},1024)])],6)):G("",!0)],64))),128))]),_:1},8,["modelValue","interval-height","onChange","onClickHeadDay"])])])]),m(W,{modelValue:i.showTree,"onUpdate:modelValue":e[1]||(e[1]=o=>i.showTree=o),label:a.label,color:"teal",class:"q-pa-md"},null,8,["modelValue","label"]),m(te,null,{default:c(()=>[i.showTree?(y(),S("div",ve,[i.treeGoals.length>0?(y(),S("div",Ee,[e[4]||(e[4]=g("div",{class:"row justify-center"}," Goals & Goal Events ",-1)),m(T),e[5]||(e[5]=g("br",null,null,-1)),m(ae,{nodes:i.treeGoals,"node-key":"label",expanded:i.expanded,"onUpdate:expanded":e[2]||(e[2]=o=>i.expanded=o),"no-connectors":"",dense:"",accordion:""},{"default-header":c(o=>[g("div",{class:J(a.classyColor(o.node))},[o.node.isChildren?G("",!0):(y(),D(B,{key:0,name:o.expanded?"expand_less":"expand_more",size:"28px",class:"q-mr-sm"},null,8,["name"])),g("div",Se,N(o.node.label),1),m(B,{name:o.node.icon},null,8,["name"])],2)]),"default-body":c(o=>[o.node.isChildren?(y(),S("div",_e,[g("span",Ne," >> "+N(o.node.details),1),o.node.moods.length>0?(y(),D(q,{key:0},{default:c(()=>[_(N("Moods::> "+o.node.moods.join(",")),1)]),_:2},1024)):G("",!0)])):(y(),S("span",be,N(o.node.details),1))]),_:1},8,["nodes","expanded"])])):(y(),S("div",we,[e[11]||(e[11]=g("br",null,null,-1)),m(k,null,{default:c(()=>e[6]||(e[6]=[_(" 1. Add some Goals first. A schedulable goal is one with a parent Goal--can have multiple related goals with the same parent. ")])),_:1}),m(T),m(k,null,{default:c(()=>e[7]||(e[7]=[_(" 2. Go to Schedule to see a daily schedule. Drag scheduled events to new timeslots or click in calendar to add an event. ")])),_:1}),m(T),m(k,null,{default:c(()=>e[8]||(e[8]=[_(" 3. Reload a saved daily schedule or defaults or choose minimal score events to schedule. Fix any scheduling conflicts. ")])),_:1}),m(T),m(k,null,{default:c(()=>e[9]||(e[9]=[_(" 4. Save the daily schedule (dont forget to update their score as needed!) ")])),_:1}),m(T),m(k,null,{default:c(()=>e[10]||(e[10]=[_(" 5. Check out the summary of all goals here! ")])),_:1})]))])):G("",!0)]),_:1})]),_:1})}var Ge=U(he,[["render",xe],["__scopeId","data-v-3371b6d2"]]);export{Ge as default};
