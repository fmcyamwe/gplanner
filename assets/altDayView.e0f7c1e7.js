import{j as Xe,U as Ze,W as et,r as B,c as ne,w as Be,n as tt,h as ye,k as Te,ay as it,D as ot,g as st,az as lt,ad as Ee,v as nt,aA as rt,aa as ve,aC as Ie,ab as we,Z as at,_ as dt,$ as re,L as ie,E as _,F as X,G as $,M as V,H as P,O as I,I as x,N as xe,K as Q,J as j,a1 as oe,Q as Re,a2 as be,a3 as Z,bs as ht,R as ae,P as Ne,a5 as me,a4 as de,aS as Pe,f as ct,a6 as ut,a7 as ft}from"./index.762ba570.js";import{w as L,c as ue,p as gt,a as mt,b as St,Q as Oe}from"./utiFunc.aea2335a.js";import{T as pt,Q as yt,a as vt}from"./QSelect.237ecba7.js";import{c as Ae,a as bt,u as Ot,Q as _e}from"./goalStorage.694b4132.js";import{t as Ce,E as Le,b as K,a as M,p as z,d as ee,U as te,i as Ge,V as Ct,m as $e,l as he,c as Ve,Q as Dt,e as Tt}from"./QCalendarTask.a73fdf7a.js";import{a as Et}from"./QCalendar.13e1461a.js";/* empty css                             */import"./touch.70a9dd44.js";import"./QItem.a04202ae.js";var Fe=Xe({name:"QSplitter",props:{...Ze,modelValue:{type:Number,required:!0},reverse:Boolean,unit:{type:String,default:"%",validator:i=>["%","px"].includes(i)},limits:{type:Array,validator:i=>i.length!==2||typeof i[0]!="number"||typeof i[1]!="number"?!1:i[0]>=0&&i[0]<=i[1]},emitImmediately:Boolean,horizontal:Boolean,disable:Boolean,beforeClass:[Array,String,Object],afterClass:[Array,String,Object],separatorClass:[Array,String,Object],separatorStyle:[Array,String,Object]},emits:["update:modelValue"],setup(i,{slots:e,emit:t}){const{proxy:{$q:o}}=st(),s=et(i,o),l=B(null),n={before:B(null),after:B(null)},r=ne(()=>`q-splitter no-wrap ${i.horizontal===!0?"q-splitter--horizontal column":"q-splitter--vertical row"} q-splitter--${i.disable===!0?"disabled":"workable"}`+(s.value===!0?" q-splitter--dark":"")),h=ne(()=>i.horizontal===!0?"height":"width"),d=ne(()=>i.reverse!==!0?"before":"after"),v=ne(()=>i.limits!==void 0?i.limits:i.unit==="%"?[10,90]:[50,1/0]);function y(a){return(i.unit==="%"?a:Math.round(a))+i.unit}const b=ne(()=>({[d.value]:{[h.value]:y(i.modelValue)}}));let m,C,R,S,E;function N(a){if(a.isFirst===!0){const D=l.value.getBoundingClientRect()[h.value];m=i.horizontal===!0?"up":"left",C=i.unit==="%"?100:D,R=Math.min(C,v.value[1],Math.max(v.value[0],i.modelValue)),S=(i.reverse!==!0?1:-1)*(i.horizontal===!0?1:o.lang.rtl===!0?-1:1)*(i.unit==="%"?D===0?0:100/D:1),l.value.classList.add("q-splitter--active");return}if(a.isFinal===!0){E!==i.modelValue&&t("update:modelValue",E),l.value.classList.remove("q-splitter--active");return}const u=R+S*(a.direction===m?-1:1)*a.distance[i.horizontal===!0?"y":"x"];E=Math.min(C,v.value[1],Math.max(v.value[0],u)),n[d.value].value.style[h.value]=y(E),i.emitImmediately===!0&&i.modelValue!==E&&t("update:modelValue",E)}const g=ne(()=>[[pt,N,void 0,{[i.horizontal===!0?"vertical":"horizontal"]:!0,prevent:!0,stop:!0,mouse:!0,mouseAllDir:!0}]]);function f(a,u){a<u[0]?t("update:modelValue",u[0]):a>u[1]&&t("update:modelValue",u[1])}return Be(()=>i.modelValue,a=>{f(a,v.value)}),Be(()=>i.limits,()=>{tt(()=>{f(i.modelValue,v.value)})}),()=>{const a=[ye("div",{ref:n.before,class:["q-splitter__panel q-splitter__before"+(i.reverse===!0?" col":""),i.beforeClass],style:b.value.before},Te(e.before)),ye("div",{class:["q-splitter__separator",i.separatorClass],style:i.separatorStyle,"aria-disabled":i.disable===!0?"true":void 0},[it("div",{class:"q-splitter__separator-area absolute-full"},Te(e.separator),"sep",i.disable!==!0,()=>g.value)]),ye("div",{ref:n.after,class:["q-splitter__panel q-splitter__after"+(i.reverse===!0?"":" col"),i.afterClass],style:b.value.after},Te(e.after))];return ye("div",{class:r.value,ref:l},ot(e.default,a))}}}),wt=lt({name:"touch-hold",beforeMount(i,e){const{modifiers:t}=e;if(t.mouse!==!0&&Ee.has.touch!==!0)return;const o={handler:e.value,noop:nt,mouseStart(l){typeof o.handler=="function"&&rt(l)===!0&&(ve(o,"temp",[[document,"mousemove","move","passiveCapture"],[document,"click","end","notPassiveCapture"]]),o.start(l,!0))},touchStart(l){if(l.target!==void 0&&typeof o.handler=="function"){const n=l.target;ve(o,"temp",[[n,"touchmove","move","passiveCapture"],[n,"touchcancel","end","notPassiveCapture"],[n,"touchend","end","notPassiveCapture"]]),o.start(l)}},start(l,n){o.origin=Ie(l);const r=Date.now();Ee.is.mobile===!0&&(document.body.classList.add("non-selectable"),Ae(),o.styleCleanup=h=>{o.styleCleanup=void 0;const d=()=>{document.body.classList.remove("non-selectable")};h===!0?(Ae(),setTimeout(d,10)):d()}),o.triggered=!1,o.sensitivity=n===!0?o.mouseSensitivity:o.touchSensitivity,o.timer=setTimeout(()=>{o.timer=void 0,Ae(),o.triggered=!0,o.handler({evt:l,touch:n!==!0,mouse:n===!0,position:o.origin,duration:Date.now()-r})},o.duration)},move(l){const{top:n,left:r}=Ie(l);o.timer!==void 0&&(Math.abs(r-o.origin.left)>=o.sensitivity||Math.abs(n-o.origin.top)>=o.sensitivity)&&(clearTimeout(o.timer),o.timer=void 0)},end(l){we(o,"temp"),o.styleCleanup!==void 0&&o.styleCleanup(o.triggered),o.triggered===!0?l!==void 0&&at(l):o.timer!==void 0&&(clearTimeout(o.timer),o.timer=void 0)}},s=[600,5,7];if(typeof e.arg=="string"&&e.arg.length>0&&e.arg.split(":").forEach((l,n)=>{const r=parseInt(l,10);r&&(s[n]=r)}),[o.duration,o.touchSensitivity,o.mouseSensitivity]=s,i.__qtouchhold=o,t.mouse===!0){const l=t.mouseCapture===!0||t.mousecapture===!0?"Capture":"";ve(o,"main",[[i,"mousedown","mouseStart",`passive${l}`]])}Ee.has.touch===!0&&ve(o,"main",[[i,"touchstart","touchStart",`passive${t.capture===!0?"Capture":""}`],[i,"touchend","noop","notPassiveCapture"]])},updated(i,e){const t=i.__qtouchhold;t!==void 0&&e.oldValue!==e.value&&(typeof e.value!="function"&&t.end(),t.handler=e.value)},beforeUnmount(i){const e=i.__qtouchhold;e!==void 0&&(we(e,"main"),we(e,"temp"),e.timer!==void 0&&clearTimeout(e.timer),e.styleCleanup!==void 0&&e.styleCleanup(),delete i.__qtouchhold)}});const Rt=()=>!!/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);let fe,U;function Nt(){fe={},U=bt()}function Pt(){fe.pGoalsMap==null;const i=new Map;let e=We();return e?(e.forEach(t=>{i.set(t.id,t)}),fe.pGoalsMap=i,i):(console.log("Repo:: parentGoalsMap is empty or null",e),i)}function At(i){return U.hasEventsForDate(i)}function je(i){return U.getEventsForDate(i)}function We(){return U.getMainGoals}function _t(){return fe.subGoals==null&&(fe.subGoals=U.getSubGoals),fe.subGoals}function $t(){return U.fetchAlternativeEvts()}function Mt(){return U.currentBalance()}function kt(){return U.fetchGoalsTree()}function Bt(){let i=U.fetchAllPrio();return!i.size>0?(console.log("ERROR...no Priority goals?",i),[]):Array.from(i.values()).sort()}function Ue(i){return U.fetchGoalsUpToMaxScore(i)}function He(i,e=null,t=null){U.saveSubProp(i,e,t)}function It(){return U.getGoalByTitle("Misc")}function ze(i){U.setBalance(i)}function qe(i,e){U.saveDailySchedule(i,e)}function xt(i,e,t,o){return U.addMainGoal(i,e,t,o)}function ce(i,e,t,o,s,l,n,r,h){return U.addSubGoal(i,e,t,o,s,l,n,r,h)}function Lt(i,e,t=null){let o=i,s=e.id,l=e,n=t,r=i.duration,h=i.time,d=null,v=null;return{id:s,duration:r,time:h,date:()=>d,datey:y,score:b(),atScore:o.atScore,getGoal:()=>l,getPGoal:()=>n,data:()=>o,setData:a=>o=a,setMoods:a=>v=a,getMoods:S,setNotes:a=>a,hasNote:m,setDura:a=>r=a,setTime:a=>h=a,setDate:a=>d=a,durationChanged:C,timeChanged:R,parsedScore:E,withPropsEventsTo:g,addPropsEventsTo:f};function y(){return d}function b(){return o.atScore||e.score}function m(){return i.notes!==void 0}function C(){return i.duration!==e.duration}function R(){return i.time!==e.time}function S(){return"byMood"in o&&(v=o.byMood),v}function E(){const a=b().split(/on/);return a.length!=2?-89:a[1]-a[0]}function N(a){if(!a)return"";let u=a.split(":");return parseInt(u[0])>=12?a+"PM":a+"AM"}function g(a,u=null){let p=Object.assign({},{...this});return p.bgcolor=a.bgcolor,p.jeSuis?p.details=`Of '${a.title.trim()}' :: << ${p.jeSuis.join(",")} >>`:p.details=`Of '${a.title.trim()}' :: ${N(p==null?void 0:p.time)} -> ${p==null?void 0:p.duration}min -- ${p!=null&&p.inDefaults?"Dft:":":"}${p!=null&&p.canMove?":Mv:":":"}${p!=null&&p.isAlternative?":Alt":":"}`,console.log("withProps",JSON.parse(JSON.stringify(p)),p.datey(),p.date(),p.title,p.details),p}function f(a){if(!n){console.log("addProps:: ERROR no parentGoal",this.data);return}this.data,getGoal();let u=Object.assign({},{...sav});return u.bgcolor=t.bgcolor,u.jeSuis?u.details=`Of '${t.title.trim()}' :: << ${u.jeSuis.join(",")} >>`:u.details=`Of '${t.title.trim()}' :: ${N(u==null?void 0:u.time)} -> ${u==null?void 0:u.duration}min -- ${u!=null&&u.inDefaults?"Dft:":":"}${u!=null&&u.canMove?":Mv:":":"}${u!=null&&u.isAlternative?":Alt":":"}`,console.log("addProps",JSON.parse(JSON.stringify(u)),u.datey(),u.date(),u.title,u.details),u}}class Gt{constructor(e,t){this.showReloadBtn=!1,this.showClearBtn=!1,this.showLoadDefaults=!0,this.showScoreBtn=!0,this.showPrioBtn=!0,this.showOneEachBtn=!1,this.disablePrioBtn=!0,this.disableScoreBtn=!0,this.disableSaveSchedule=!0,this.chosenScore=null,this.chosenPrio=null,this._dailyScheduled=new Map,this._endTimesSet=new Set,this._startTimesSet=new Set,this.savedRawEvts=[],this.usingMoods={},this.isDisabledScoreEdit={},this.hasStarted={},this.mobileEnableScore={},this.showMobileDialog={},this.currentDate=e,this.mobile=t,Nt()}allPGoals(){return We()}getAllEvts(){return this._dailyScheduled}showEvtNoteScoreMobile(e){return this.mobileEnableScore[e]&&this.showMobileDialog[e]}toggleEvtNoteScoreMobile(e){(this.isViewingPast()||this.isViewingToday())&&(this.showMobileDialog[e]=!0)}euhHidin(e){this.showMobileDialog[e]=!1}getCurrentSchedTimesSets(){return{endSet:this._endTimesSet,startSet:this._startTimesSet}}isViewingPast(){let e=Ce();if(this.currentDate&&this.currentDate==e)return!1;let t=Le(K(e));return!(Le(K(this.currentDate))>=t)}isViewingToday(){return Ce()==this.currentDate}toggle(){this.showReloadBtn=!this.showReloadBtn}getProps(){return{showReloadBtn:this.showReloadBtn,showClearBtn:this.showClearBtn,showLoadDefaults:this.showLoadDefaults,showScoreBtn:this.showScoreBtn,showPrioBtn:this.showPrioBtn,showOneEachBtn:this.showOneEachBtn,disablePrioBtn:this.disablePrioBtn,disableScoreBtn:this.disableScoreBtn,chosenScore:this.chosenScore,chosenPrio:this.chosenPrio}}saveBtnEnabled(){return this.disableSaveSchedule}fetchGoalsTree(){return kt()}getCurrentBalance(){return Mt()}getAllPrio(){return Bt()}getSubGoals(){return _t()}getCurrentMoods(){return this.usingMoods}getSubGoalByID(e){let t=this.getSubGoals(),o=parseInt(e);for(let s=0;s<t.length;s++)if(t[s].id===o)return t[s];return null}getOriginalEvtTime(e){let t=this.getSubGoalByID(e);return t?t.time:""}getStoredRawEvt(e){return e in this.savedRawEvts?this.savedRawEvts[e]:null}getAltEvts(){return $t()}getEventsForDate(e){return je(e)}updateDaySchedule(e,t){qe(e,t)}parentGoalsMap(){return Pt()}parentGoalById(e){return this.parentGoalsMap().has(e)?this.parentGoalsMap().get(e):null}findSchedEvent(e){return this._dailyScheduled.has(e)?this._dailyScheduled.get(e):null}hasEventsForDate(){return At(this.currentDate)}scheduledEventsMap(){const e={};return this._dailyScheduled.forEach((t,o,s)=>{let l=t.date;e[l]||(e[l]=[]),e[l].push(t)}),e}schedEvtWithProps(e,t,o){if(!e.getPGoal()){console.log("schedEvtWithProps:: ERROR no parentGoal",e.data);return}let s=e.data(),l=e.getGoal(),n=e.getPGoal(),r={...l};(e.timeChanged()||e.durationChanged())&&(r.time=s.time,r.duration=s.duration),e.setDate(this.currentDate);let h=e.getMoods();if(h){//!==
this.usingMoods[r.id]=h}r.date=this.currentDate,r.bgcolor=n.bgcolor,r.icon=n.icon,r.start=t,r.end=o;let d=`Of '${n.title.trim()}' :: ${L(r==null?void 0:r.time)} -> ${r==null?void 0:r.duration}min -- ${r!=null&&r.inDefaults?"Dft:":":"}${r!=null&&r.canMove?":Mv:":":"}${r!=null&&r.isAlternative?":Alt":":"}`;return r.jeSuis&&r.jeSuis.length>0&&(d+=h?` <>Mood:'${h}' >>${r.jeSuis.join(",")}`:` << ${r.jeSuis.join(",")} >>`),r.details=d,e.hasNote()&&(r.notes=s.notes),r}doProppy(e,t){let o=this.parentGoalById(e.parentGoal);if(!o){console.log("doProppy:: ERROR no Pgoal found ?!?",e);return}let s=M(K(t),{minute:z(e.time)}),l=M(s,{minute:e.duration}),n=Object.assign({},{...e,date:t,bgcolor:o.bgcolor,start:s,end:l,icon:o.icon});return e.jeSuis&&e.jeSuis.length>0?n.details=`Of '${o.title.trim()}' :: << ${e.jeSuis.join(",")} >>`:n.details=`Of '${o.title.trim()}' :: ${L(e==null?void 0:e.time)} -> ${e==null?void 0:e.duration}min -- ${e!=null&&e.inDefaults?"Dft:":":"}${e!=null&&e.canMove?":Mv:":":"}${e!=null&&e.isAlternative?":Alt":":"}`,"byMood"in e&&(console.log("doProppy::BYMOOD found!! ERROR?!?",JSON.parse(JSON.stringify(e))),this.usingMoods[n.id]=e.byMood),n}updateDetz(e){var s,l;let o=`Of '${(l=(s=this.parentGoalById(e.parentGoal))==null?void 0:s.title)==null?void 0:l.trim()}' :: ${L(e==null?void 0:e.time)} -> ${e==null?void 0:e.duration}min -- ${e!=null&&e.inDefaults?"Dft:":":"}${e!=null&&e.canMove?":Mv:":":"}${e!=null&&e.isAlternative?":Alt":":"}`;return e.jeSuis&&e.jeSuis.length>0&&(o+=this.usingMoods[e.id]?` <> Mood:'${this.usingMoods[e.id]}' >>${e.jeSuis.join(",")}`:` << ${e.jeSuis.join(",")} >>`),e.details=o,e}addGoalsToSchedule(e,t){let o={};return e.sort(function(s,l){return z(s.time)-z(l.time)}),e.forEach(s=>{let l=this.addToSchedule(s,t,!1);l?Array.isArray(l)&&(o[s.id]=l):console.log("addGoalsToSchedule:: ERROR Evt NOT added",l,t,s.id,s.title,s.time)}),this.massageOverlapObj(o)}addToSchedule(e,t,o=!1){if(this._dailyScheduled.has(e.id))return!1;{let s=M(K(this.currentDate),{minute:z(e.time)}),l=M(s,{minute:e.duration});if(t){let h=this.hasOverlappingEvent(e.id,s,l);if(h.length>0)return h}let n=o?this.schedEvtWithProps(e,s,l):this.doProppy(e,this.currentDate);n.sortTime=s;let r={...n,for:n.duration,start:s,end:l};this._dailyScheduled.set(n.id,r),this._endTimesSet.add(l.time),this._startTimesSet.add(s.time),this.enableNoteScoreEdit(n.id,s,l)}return!0}doSortingByTime(e){let t=(s,l)=>{let n=z(s[1].time),r=z(l[1].time);return n<r?-1:r>n?1:0};const o=[];for(let s in e)o.push([s,e[s]]);return o.sort(t),this.doLog("doSortingByTime---After",o),Object.fromEntries(o)}anotherSorting(e){return Object.entries(e).sort(([,o],[,s])=>z(o.time)-z(s.time))}enrichAddToSchedule(){let e={},t=this.isViewingToday();console.log("enrichAddToSchedule",Object.keys(this.savedRawEvts).length,"overlapCheck:"+t);let o=this.anotherSorting(this.savedRawEvts);for(let s=0;s<o.length;s++){let l=o[s][0],n=o[s][1],r=this.getSubGoalByID(l);if(!r){console.log(`enrichAddToSchedule:: ERROR No goal found for key: ${l}...skipping!`);continue}let h=this.parentGoalById(r.parentGoal),d=Lt(n,r,h),v=this.addToSchedule(d,t,!0);v?Array.isArray(v)&&(e[r.id]=v):console.log("enrichAddToSchedule..ERROR?!? not added",v,r)}return this.massageOverlapObj(e)}loadEvtsForDay(e){return e||this.resetSchedule(!0),this.savedRawEvts=je(this.currentDate),this.savedRawEvts?{overlaps:this.enrichAddToSchedule(),canContinue:!1}:{overlaps:null,canContinue:!0}}onChangeViewDate(e){let t=e==this.currentDate;return this.currentDate=e,this.enableActionBtns(),this.loadEvtsForDay(t)}resetSchedule(e=!1){this.savedRawEvts=[],this._dailyScheduled=new Map,this._endTimesSet=new Set,this._startTimesSet=new Set,e&&(this.usingMoods={}),this.showReloadBtn=!1,this.showClearBtn=!1,this.disableSaveSchedule=!0}unscheduledDefaults(){return this.getSubGoals().filter(t=>(t==null?void 0:t.inDefaults)&&(t==null?void 0:t.time)!=""&&!this._dailyScheduled.has(t.id));//!this.actualEvts.find(x => x.id == evt.id))
}unscheduled(){return this.getSubGoals().filter(t=>!this._dailyScheduled.has(t.id));//!this.actualEvts.find(item => item.id == x.id)
}subGoalsOfParent(e){return this.getSubGoals().filter(o=>o.parentGoal==e)}chosenScoreLabel(){return this.chosenScore==null?"By Score":`Score <= ${this.chosenScore}`}chosenPrioLabel(){return this.chosenPrio==null?"By Priority":`Prio = ${this.chosenPrio}`}calculatePrioEvts(){let e=this.getSubGoals().filter(o=>{var s;return((s=this.parentGoalById(o.parentGoal))==null?void 0:s.priority)==this.chosenPrio}),t=e.filter(o=>!this._dailyScheduled.has(o.id));//!this.actualEvts.find(item => item.id == x.id)) //add those not scheduled
this.byPrio={prio:this.chosenPrio,toAdd:t,reset:e}}onChoosenPrio(e){let t=this.chosenPrio;t&&t==e?this.disablePrioBtn=!0:(this.chosenPrio=e,this.disablePrioBtn=!1,this.calculatePrioEvts())}scheduleSamePrio(e){const t=()=>{let r=[];return this._dailyScheduled.forEach((h,d,v)=>{var y;((y=this.parentGoalById(h.parentGoal))==null?void 0:y.priority)==this.chosenPrio&&r.push(h)}),r},o=r=>{console.log("scheduleSamePrio::RECALCULATE?!?",r,this.chosenPrio,JSON.parse(JSON.stringify(this.byPrio)));let h=this.getSubGoals().filter(d=>{var v;return((v=this.parentGoalById(d.parentGoal))==null?void 0:v.priority)==this.chosenPrio});return r=="reset"?h:h.filter(d=>!this._dailyScheduled.has(d.id));//!this.actualEvts.find(item => item.id == x.id)
};let s=[];if(e=="filter"?(s=t(),this.resetSchedule()):(this.byPrio?e=="add"?s=this.byPrio.toAdd:s=this.byPrio.reset:s=o(e),e!="add"?this.resetSchedule():console.log("scheduleSamePrio::No resetSchedule",e,s.length)),s.length<1)return this.toggleActionBtns(!1,"byPrio"),{overlaps:null,canContinue:!1};let l=this.addGoalsToSchedule(s,this.isViewingToday()),n=Object.keys(l).length;return this.updateCurrentMoods(),this.toggleActionBtns(s.length>0,"byPrio"),{overlaps:l,canContinue:!(n>0),added:s.length}}calculateScoreEvts(){let e=Ue(this.chosenScore),t=e.filter(o=>!this._dailyScheduled.has(o.id));//!this.actualEvts.find(item => item.id == x.id)
this.byScore={score:this.chosenScore,toAdd:t,reset:e}}onChoosenScore(e){let t=this.chosenScore;t&&t==e?this.disableScoreBtn=!0:(this.chosenScore=e,this.disableScoreBtn=!1,this.calculateScoreEvts())}scheduleByScore(e){const t=()=>{let r=[];return this._dailyScheduled.forEach((h,d,v)=>{let y=ue(h.score);y>-1&&y<=this.chosenScore&&r.push(h)}),r},o=r=>{console.log("scheduleByScore::RECALCULATE?!?",r,this.chosenScore,JSON.parse(JSON.stringify(this.byScore)));let h=Ue(this.chosenScore);return r=="reset"?h:h.filter(d=>!this._dailyScheduled.has(d.id))};let s=[];if(e=="filter"?(s=t(),this.resetSchedule()):(this.byScore?e=="add"?s=this.byScore.toAdd:s=this.byScore.reset:s=o(e),e!="add"?this.resetSchedule():console.log("scheduleByScore::No resetSchedule",e,s.length)),s.length<1)return this.toggleActionBtns(!1,"byScore"),{overlaps:null,canContinue:!1};let l=this.addGoalsToSchedule(s,this.isViewingToday()),n=Object.keys(l).length;return this.updateCurrentMoods(),this.toggleActionBtns(s.length>0,"byScore"),{overlaps:l,canContinue:!(n>0),added:s.length}}scheduleOneEach(e){const t=r=>{let h=[];return this.parentGoalsMap().forEach((d,v,y)=>{let b=this.subGoalsOfParent(d.id);if(b.length>0){let m=null,C=b.length;if(r)m=b[Math.floor(Math.random()*C)];else{let R=0;for(;this._dailyScheduled.has(b[C].id);)if(R++,C=Math.floor(Math.random()*b.length),console.log(`selectOneFromP::index ${C} scheduled...new random> At try> `+R,b.length),R>2){console.log("selectOneFromP::random...TOO MANY TRIES..ERROR?",R,C,b.length,b);break}m=b[C],console.log("selectOneFromP::NO Random at index: "+C,R,m)}h.push(m)}else console.log("scheduleOneEach::selectOneFromP...huh no subgoals for parentGoal",d)}),h},o=()=>{let r=this.unscheduled(),h=[];return this.parentGoalsMap().forEach((d,v,y)=>{let b=r.filter(C=>C.parentGoal==d.id),m=b.length;if(m>0){let C=b[Math.floor(Math.random()*m)];h.push(C)}else console.log("scheduleOneEach::NO SUBGOAL for",v,d==null?void 0:d.title)}),h};let s=[];if(e=="add"?(s=o(),console.log("scheduleOneEach...TOADD>> "+s.length)):(this.resetSchedule(),s=t(!0)),s.length<1)return console.log("Empty for OneEach :("),this.toggleActionBtns(!1,"oneEach"),{overlaps:null,canContinue:!1};let l=this.addGoalsToSchedule(s,this.isViewingToday()),n=Object.keys(l).length;return this.updateCurrentMoods(),this.toggleActionBtns(s.length>0,"oneEach"),{overlaps:l,canContinue:!(n>0),added:s.length}}scheduleByMood(e){var l;let t=[];for(let n=0;n<e.length;n++){let r=this.getSubGoalByID(e[n].id);r&&r.time!=""&&(t.push(r),this.usingMoods[e[n].id]=(l=e[n])==null?void 0:l.mood)}if(t.length<1)return console.log("Empty for Mood :("),this.toggleActionBtns(!1,"ByMood"),{overlaps:null,canContinue:!1};let o=this.addGoalsToSchedule(t,this.isViewingToday()),s=Object.keys(o).length;return s>0?console.log(`scheduleByMood overlaps!! Try reload= ${t.length} with overlaps =${s}`):this.toggleActionBtns(t.length>0,"ByMood"),{overlaps:o,canContinue:!(s>0),added:t.length}}scheduleDefaults(e){let t=null;e=="add"?t=this.unscheduledDefaults():(this.resetSchedule(),t=this.unscheduledDefaults()),this.showReloadBtn=this.hasEventsForDate(),this.showClearBtn=!this.isViewingPast()&&t.length>0;let o=this.addGoalsToSchedule(t,this.isViewingToday()),s=Object.keys(o).length;return this.updateCurrentMoods(),this.toggleActionBtns(t.length>0,"defaults"),{overlaps:o,canContinue:!(s>0)}}massageOverlapObj(e){let t={};for(let o in e){let s=e[o];if(s.length>0){let l=0;do{let n=s[l];t[n.inConflict]||(t[n.inConflict]=[]),t[n.inConflict].push(n),l>0&&(n.inConflict in t&&delete t[n.inConflict],s[l-1].inConflict in t&&delete t[s[l-1].inConflict],t[n.target]?(t[n.target].push(n),console.log("WOAH WOAH,massageOverlapObj::obj.id already present! ERROR?",n.target)):t[n.target]=[n],t[n.target].unshift(s[l-1]),t.withID||(t.withID=[]),t.withID.push(n.target))}while(++l<s.length)}}return t}massageSingleOverlapArr(e){let t={};for(let o=0;o<e.length;o++){let s=e[o];t[s==null?void 0:s.inConflict]?t[s==null?void 0:s.inConflict].push(s):t[s==null?void 0:s.inConflict]=[s],o>0&&(s.inConflict in t&&delete t[s.inConflict],e[o-1].inConflict in t&&delete t[e[o-1].inConflict],t[s.target]?(t[s.target].push(s),console.log("WOAH obj.id already present?",s.target)):t[s.target]=[s],t[s.target].unshift(e[o-1]),t.withID||(t.withID=[]),t.withID.push(s.target))}return t}saveNewGoal(e,t,o,s,l){if(s=="self"){let n=this.addParentGoal(t,t,"red-14",2);return n?ce(n,t,"1on5",e.time,l,!0,!1,l<30):(console.log("ERROR? no pID",n),n===0?ce(n,t,"1on5",e.time,l,!0,!1,l<30):null)}else if(o){return console.log("with parentGoal "+o.id,o==null?void 0:o.title),ce(o.id,t,"1on5",e.time,l,!1,!1,l<30);//!canMove and notInDefaults. isAlternative when duration<30
}else{let n=It();if(n)return ce(n.id,t,"1on5",e.time,l,!1,!1,l<30);{let r=this.addParentGoal("Misc","Miscellaneous","grey-10",2);return r?ce(r,t,"1on5",e.time,l,!0,!1,l<30):(console.log("ERROR? no pID",r),r===0?ce(r,t,"1on5",e.time,l,!0,!1,l<30):null)}}}addParentGoal(e,t,o,s=2){let l=[];this.parentGoalsMap().forEach((h,d,v)=>{let y=h.bgcolor;l.push(y)});let n=gt(),r=n.filter(h=>!l.find(d=>d==h));if(r.length>1){let h=Math.floor(Math.random()*r.length),d=r[h];console.log(`addParentGoal::bgcolor..index ${h} from ${o} to:`,d),o=d||o}else console.log("addParentGoal::NONE available",r,n);return xt(e,t,o,s)}onPickEvent(e,t,o,s,l=null){const n=()=>{s&&(this.removeFromBalance(e==null?void 0:e.duration),console.log("onPickEvent...useBalance","force?"+o));let v=this.addToSchedule({...e,time:t.time},!1);return this.isViewingPast()||s?this.saveDaySchedule():this.toggleActionBtns(!0,"onPickEvt"),{overlaps:v,canContinue:!0}};let r=M(t,{minute:e.duration}),h=this.hasOverlappingEvent(e.id,t,r),d=h.length;if(d>0){this.toggleActionBtns(!0,"onPickEvt");let v={overlaps:this.massageSingleOverlapArr(h),canContinue:!1};if(d>1||!o)return v;l&&l(`onPickEvent:: ${d} OVERLAPS! Forcing...`,"info");let y=0;do this.recurChangeTime(h[y].inConflict,e,t,!0,l);while(++y<d);return s&&this.removeFromBalance(e==null?void 0:e.duration),this.isViewingPast()||s?this.saveDaySchedule():this.toggleActionBtns(!0,"onPickEvt"),{overlaps:null,canContinue:!0}}else return n()}onAdHocEvent(e,t,o,s=null){const l=d=>(o&&(this.removeFromBalance(d==null?void 0:d.duration),console.log("onAdHocEvent...using Balance",d==null?void 0:d.duration)),this.saveDaySchedule(),s&&s("onAdHoc...Saving Schedule","info"),{overlaps:null,canContinue:!0});let n=this.getSubGoalByID(e);if(!n)return{overlaps:null,canContinue:!1};let r=this.addToSchedule(n,!0),h=Array.isArray(r);if(!r||h){console.log("onAdHocEvent::Overlaps!!",JSON.parse(JSON.stringify(r)));let d={overlaps:r?this.massageSingleOverlapArr(r):null,canContinue:!1},v=r.length;if(h&&v>1)return d;if(h&&v==1){s&&s(`onAdHocEvent:: ${v} OVERLAPS! Forcing...`,"info");let y=0;do this.recurChangeTime(r[y].inConflict,n,t,!0,s);while(++y<v);return l(n)}return d}return l(n)}recurChangeTime(e,t,o,s=!1,l=null){var r,h,d,v,y,b;let n=this.findSchedEvent(e);if(n){let m=z(n.start.time)-z(o.time),C=`${m>0?"DOWN":"UP"}`,R=null;if(m>=0){R=M(o,{minute:parseInt(t.duration)+10});let f=M(o,{minute:parseInt(n.for)+10});console.log(`recurChangeTime::START>>(${e}) '${n==null?void 0:n.title}' going FORWARD ${C} for ${m} due to evt:(${t.id})${(r=t==null?void 0:t.title)==null?void 0:r.trim()} at ${o.time} 
          
 doAdd?:${s} >`,JSON.parse(JSON.stringify(R.time)),"alt:",f.time);let a=ee(f,R);a>0&&(Math.floor(a/1e3/60)<=m?console.log(`recurChangeTime::(${e})....with duration:${n.for} vs evtDura:${t.duration}...NOT using alternative!!`):(console.log(`recurChangeTime::DIFFY>>${a}...gonna use Alternative`,f.time),R=f))}else{R=M(o,{minute:-(parseInt(n.for)+10)});let f=M(o,{minute:-(parseInt(t.duration)+10)});console.log(`recurChangeTime::START>>(${e}) '${n==null?void 0:n.title}' going BACKWARD ${C} for ${m} due to evt:(${t.id})${(h=t==null?void 0:t.title)==null?void 0:h.trim()} at ${o.time}
          
 doAdd?:${s}`,R.time,"alt:"+f.time)}let S=this.hasOverlappingEvent(e,R,M(R,{minute:n.for})),E=S.length;if(E>0){console.log(`WARNING WARNING::Extra Overlaps of ${E} for OVERLAPPED ${e} at ${R.time}`,S);let f=0;l&&l(`${E} Cascading Overlaps handling (${e}) '${n==null?void 0:n.title}' going ${C} as ${s?"Adding":"Moving"} '${(d=t==null?void 0:t.title)==null?void 0:d.trim()}'`);do{if(console.log(`CASCADING timeChange ${f} >> (${e}) at: ${R.time} now at: ${n.start.time} till ${n.end.time}`,n.for),S[f].inConflict==t.id){console.log(`EUUUH...ERROR::recurChangeTime::self overlap?!?OVERLAPPED:${e} ...break`,S[f].inConflict,t.id);break}this.recurChangeTime(S[f].inConflict,n,R,!1,l)}while(++f<E)}this.changeEvtTime(n,R);let N=o;if(console.log(`recurChangeTime::TARGET>>(${t.id})${(v=t==null?void 0:t.title)==null?void 0:v.trim()} ${s?"Adding at":"Moving to"} >> ${N.time}`),!s){this.changeEvtTime(t,N);return}let g=this.addGoalsToSchedule([{...t,time:N.time}],this.isViewingToday());if(Object.keys(g).length>0){console.log(`recurChangeTime::EXTRA OVERLAP ${s?"Adding":"Moving"} TARGET ${(y=t==null?void 0:t.title)==null?void 0:y.trim()} of size=${Object.keys(g).length}`,JSON.parse(JSON.stringify(g))),l&&l(`EXTRA OVERLAPS ${s?"Adding":"Moving"} TARGET ${(b=t==null?void 0:t.title)==null?void 0:b.trim()}`);for(let f in g){let a=g[f];if(!a[0]){console.log("recurChangeTime::TARGET EXTRA OVERLAP...SKIPPING key",f);continue}let u=a.length;if(u>0){let D=0;do{if(console.log(`recurChangeTime::TARGET CASCADING OVERLAP: ${t.id}-${t==null?void 0:t.title} at: ${N.time}`,a[D].targetStart,a[D].direction),a[D].inConflict==t.id){console.log("EUUUH...::recurChangeTime::TARGET>>OVERLAP::self overlap?!?...breaking!",a[D].inConflict,t.id,a[D].targetStart);break}this.recurChangeTime(a[D].inConflict,t,N,s,l)}while(++D<u)}}}}else console.log("recurChangeTime::ERROR >> overlapped event not found!","doAdd? "+s,e,t)}hasOverlappingEvent(e,t,o){const s=[];return this._dailyScheduled.forEach((l,n,r)=>{if(n!=e){let h=this.checkOverlapByTime(t,o,l.start,l.end);h&&(this._startTimesSet.has(t.time)&&console.log(`hasOverlappingEvent ${e} same start`,t.time),s.push({target:e,targetStart:t,direction:h,inConflict:n}))}}),s}checkOverlapByTime(e,t,o,s){let l=this.getTimeyNumber(e),n=this.getTimeyNumber(t),r=this.getTimeyNumber(o),h=this.getTimeyNumber(s);if(l===!1||r===!1||n===!1||h===!1)return console.log("ERROR... checkOverlapByTime error",l,n,r,h),!1;let d=!1;l>r&&l<h&&(d="bas"),n>r&&n<h&&(d="haut");let v=r>=l&&n>=h,y=l>=r&&n<=h;return(v||y)&&(d="surrounding"),d}canDropEvent(e,t){let o=M(e,{minute:t.duration}),s=this.hasOverlappingEvent(t.id,e,o);return s.length>0?{overlaps:this.massageSingleOverlapArr(s),canContinue:!1}:(this.toggleActionBtns(!0,"canDropEvent"),{overlaps:null,canContinue:!0})}toggleActionBtns(e,t){this.disableSaveSchedule=!e,this.showReloadBtn=this.hasEventsForDate()&&e,this.showClearBtn=!this.isViewingPast()&&e}resetChosen(){this.chosenScore=null,this.chosenPrio=null}enableActionBtns(){let e=this.isViewingPast();this.showOneEachBtn=!e,this.showLoadDefaults=!e,this.showScoreBtn=!e,this.showPrioBtn=!e}tooClose(e,t){let o=M(e,{minute:0}),s=this.getTimeNumber(o),l=M(e,{day:1}),n=new Date(l.date);n.setHours(24),n.setMinutes(0),n.setSeconds(0),n.setMilliseconds(0);let r=te(n),h=Math.floor(ee(o,r)/1e3/60);if(h<t)return console.log("tooClose to midnight eh...:(",h),!0;let d=!1;return this._dailyScheduled.forEach((v,y,b)=>{let C=this.getTimeNumber(v.start)-s,R=ee(o,v.start);Math.floor(R/1e3/60)<=10&&C>0&&(d=y)}),d}changeEvtTime(e,t,o){return o=="ok"&&He(e.id,t.time,null),this.doUpdateSchedule(e,t),o}doUpdateSchedule(e,t){let o=this.findSchedEvent(e.id);if(!o){console.log("doUpdateSchedule-ERROR NOT found",e.id,o);return}let s=M(K(o.date),{minute:z(t.time)}),l=M(s,{minute:o.duration});this._endTimesSet.delete(o.end.time)?this._endTimesSet.add(l.time):console.log("doUpdateSchedule-endTimesSet NOT FOUND?!?"),this._startTimesSet.delete(o.start.time)?this._startTimesSet.add(s.time):console.log("doUpdateSchedule-startTimesSet NOT FOUND?!?",e.id,t),o.time=t.time,o.sortTime=s;let h=this.updateDetz({...o,time:t.time,start:s,end:l});this._dailyScheduled.set(e.id,h),this.enableNoteScoreEdit(e.id,s,l)}saveDaySchedule(){let e={};this._dailyScheduled.size<1?e=null:this._dailyScheduled.forEach((t,o,s)=>{e[o]={time:t.start.time,duration:t.for,atScore:t==null?void 0:t.atScore},this.usingMoods[o]&&(e[o].byMood=this.usingMoods[o]),t.notes!==void 0&&(t==null?void 0:t.notes)!==""&&(e[o].notes=t==null?void 0:t.notes)}),console.log("saveDaySchedule",e?Object.keys(e).length:"CLEARED"),qe(this.currentDate,e),this.disableSaveSchedule=!0,this.showReloadBtn=!1,this.showClearBtn=e!=null&&!this.isViewingPast()}updateMinEndNowBtn(e,t,o){for(let[s,l]of this._dailyScheduled)(t?l.end.time:l.start.time)==e&&(this.hasStarted[s]=!t,this.isDisabledScoreEdit[s]=!t,this.mobile&&(console.log(`updateMinEndNowBtn..MOBILE::good?>>${o}::${t}`,e),this.showMobileDialog[s]=!t))}reduceEvtDuration(e,t){let o=this.findSchedEvent(e);if(!o){console.log("ERROR:: reduceEvtDuration Evt not found!!!",e);return}const s=te(new Date);let l=o.start,n=o.end,r=this.updateDetz({...o,for:t,duration:t,end:s});this._dailyScheduled.set(e,r),this._endTimesSet.delete(n.time)||console.log("ERROR endTimesSet item does not exist?!?",o,this._endTimesSet),this._endTimesSet.add(s.time),this.enableNoteScoreEdit(e,l,s),this.saveDaySchedule()}canEndNow(e){let t=this.findSchedEvent(e);if(!t)return console.log("ERROR canEndNow Evt not found!!!",e),!1;const o=te(new Date);let s=t.start,l=t.end;if(!Ge(o,s,l,!0))return console.log("umm aint in the middle of this event! Nothing to do...canEndNow::ERROR?",o.time,s.time,l.time),!1;let n=M(o,{minute:0}),r=ee(s,n),h=Math.floor(r/1e3/60);return console.log(`canEndNow:: ${e} duration from ${t.for} to: ${h}`),h<10?h:this.reduceEvtDuration(e,h)}updateNoteScore(e,t,o=""){let s=this.findSchedEvent(e);s?(s.score==t||(He(e,null,t),s.atScore=t),s.score=t,o!==""&&(s.notes=o),this.isViewingPast()?this.saveDaySchedule():this.toggleActionBtns(!0,"updateNoteScore")):console.log(`ERROR ERROR::updateNoteScore could not find event ${e}?!?`)}addMinsToEvt(e,t,o=null){const s=(y,b,m)=>{let C=y.end,R=this.updateDetz({...y,for:b,duration:b,end:m});return this._dailyScheduled.set(e,R),this._endTimesSet.delete(C.time)||console.log("ERROR endTimesSet item does not exist?!?"+C.time,y,this._endTimesSet),this._endTimesSet.add(m.time),this.saveDaySchedule(),{overlaps:null,canContinue:!0}};let l=this.findSchedEvent(e);if(!l){console.log("ERROR addMinsToEvt EVT not found!!!",e);return}let n=l.end,r=M(n,{minute:parseInt(t)}),h=parseInt(t)+l.for,d=this.hasOverlappingEvent(e,l.start,r),v=d.length;if(v>0){console.log("addMinsToEvt::OVERLAPS of size "+v,JSON.parse(JSON.stringify(d)));let y={overlaps:this.massageSingleOverlapArr(d),canContinue:!1};if(v>1)return y;let b=this.findSchedEvent(d[0].inConflict);if(!b)return console.log("addMinsToEvt::ERROR inConflict evt not found?!?"+v,d[0].inConflict),y;if((b==null?void 0:b.inDefaults)||!(b!=null&&b.canMove))return y;o&&o(`addMinsToEvt::${v} OVERLAPS..Forcing`),this.recurChangeTime(d[0].inConflict,{...l,duration:h},d[0].targetStart,!1,o)}return s(l,h,r)}deleteEvtMood(e){if(this.usingMoods[e]){delete this.usingMoods[e],console.log("deleteEvtMood::>> "+e);return}}updateCurrentMoods(){for(let e in this.usingMoods)this._dailyScheduled.has(parseInt(e))||this.deleteEvtMood(e)}removeScheduledEvt(e){if(!e){console.log("ERROR doRemove, NO evt to delete?!?",e);return}let t=null;if(this._dailyScheduled.has(e.id))t=this._dailyScheduled.get(e.id),this._dailyScheduled.delete(e.id);else{console.log("removeScheduledEvt ::> dailyScheduled has no such evt?@? ERROR",e);return}if(t){let o=this._startTimesSet.delete(t.start.time),s=this._endTimesSet.delete(t.end.time);(!o||!s)&&console.log(`removeScheduledEvt ::> ERROR? scheduleSets has no such evt?@? start:${o}...end:${s}`,t,e.id+" "+(e==null?void 0:e.title.trim())+" "+(e==null?void 0:e.details)),this.deleteEvtMood(e.id)}}addToBalance(e){let o=this.getCurrentBalance()-parseInt(e==null?void 0:e.duration);ze(o)}removeFromBalance(e){let o=this.getCurrentBalance()+parseInt(e);ze(o)}disableEvtScoreEdit(e,t){this.isDisabledScoreEdit[e]=!t,this.mobileEnableScore[e]=t}enableNoteScoreEdit(e,t,o){const s=te(new Date);let l=ee(s,o),n=M(s,{minute:0});this.getTimeNumber(n),l>0?(this.isDisabledScoreEdit[e]=!0,this.mobileEnableScore[e]=!1):(this.hasStarted[e]=!1,this.mobile&&(this.showMobileDialog[e]=!1),this.mobileEnableScore[e]=!0,this.isDisabledScoreEdit[e]=!1),Ge(s,t,o,!0)?this.hasStarted[e]=!0:this.hasStarted[e]=!1}getTimeyNumber(e){return e!==null?Ct(e):!1}getTimeNumber(e){return e!==null?$e(e):!1}doLog(e,t){console.log(e,JSON.parse(JSON.stringify(t)))}}function Je(i){return i.button===0}const Vt={name:"altDayCalendar",components:{NavigationBar:re(()=>de(()=>import("./NavigationBar.a8a8e17a.js"),["assets/NavigationBar.a8a8e17a.js","assets/index.762ba570.js","assets/index.4f70e4de.css"])),QCalendarDay:Et,GoalyEnd:re(()=>de(()=>import("./goalyEnd.27920f6f.js"),["assets/goalyEnd.27920f6f.js","assets/goalyEnd.bf51d2cd.css","assets/index.762ba570.js","assets/index.4f70e4de.css","assets/goalStorage.694b4132.js","assets/QSelect.237ecba7.js","assets/touch.70a9dd44.js","assets/QItem.a04202ae.js"])),schedBtn:re(()=>de(()=>import("./schedBtn.1290659a.js"),["assets/schedBtn.1290659a.js","assets/schedBtn.32a55c93.css","assets/index.762ba570.js","assets/index.4f70e4de.css"])),dropDwnBtn:re(()=>de(()=>import("./dropDwnBtn.19021a66.js"),["assets/dropDwnBtn.19021a66.js","assets/dropDwnBtn.35a7a0b5.css","assets/QItem.a04202ae.js","assets/index.762ba570.js","assets/index.4f70e4de.css","assets/QList.c54698c6.js","assets/QSelect.237ecba7.js","assets/touch.70a9dd44.js","assets/goalStorage.694b4132.js"])),schedDialog:re(()=>de(()=>import("./schedDialog.f563a5ed.js"),["assets/schedDialog.f563a5ed.js","assets/schedDialog.ada32e3f.css","assets/index.762ba570.js","assets/index.4f70e4de.css","assets/QSpace.d5ec7764.js"])),mobileNoteScore:re(()=>de(()=>import("./onScoreEditDialog.ea8f8d8d.js"),["assets/onScoreEditDialog.ea8f8d8d.js","assets/onScoreEditDialog.b00fdc3d.css","assets/index.762ba570.js","assets/index.4f70e4de.css"]))},data(){return Ot(),B(null),B(null),B(null),B(null),B(null),{splitterPage:B(35),splitterLegend:B(40),timeStartPos:B(0),showTree:B(!1),treeGoals:B([]),expanded:B([]),filter:B([]),filterRef:B(null),calendar:B(null),showEvtDialog:B(!1),currentDate:B(Ce()),scoreOptions:B([1,2,3,4,5,6,7,8]),anchorTimestamp:B(null),otherTimestamp:B(null),mouseDown:B(!1),mobile:B(!0),daSchedule:B(null)}},beforeMount(){this.mobile=Rt(),this.daSchedule=new Gt(this.currentDate,this.mobile),this.constructTree()},mounted(){this.adjustCurrentTime(),this.intervalId=setInterval(()=>{this.adjustCurrentTime()},6e4)},beforeUnmount(){clearInterval(this.intervalId)},computed:{chosenScoreLabel(){return this.daSchedule.chosenScoreLabel()},chosenPrioLabel(){return this.daSchedule.chosenPrioLabel()},style(){return{top:this.timeStartPos+"px"}},showSchedInstru(){return this.getDateEvents(this.currentDate).length<1},showRemInstru(){return this.getDateEvents(this.currentDate).length>0&&!this.isViewingPast()},defaultLabels(){let e=this.daSchedule.unscheduled().filter(t=>(t==null?void 0:t.inDefaults)&&(t==null?void 0:t.time)!="").length;return e>0?e+" Defaults":"Defaults"},showDefaultBtn(){return this.daSchedule.unscheduledDefaults().length>0&&!this.isViewingPast()},saveScheduleDisabled(){return this.daSchedule.saveBtnEnabled()},showTreeForm(){return this.showTree||this.constructTree(),this.showTree},filterString(){return this.filter.join()},currentBalance(){return this.daSchedule.getCurrentBalance()},canbeScheduled(){let i=this.daSchedule.unscheduled(),e=(t,o)=>{if(t.parentGoal>o.parentGoal)return 1;if(t.parentGoal==o.parentGoal)return 0;if(t.parentGoal<o.parentGoal)return-1};if(i.length==0){let t=this.daSchedule.getSubGoals();return t.sort(e),t}return i.sort(e),i},scheduleMoodsLabel(){let i=null,e=this.daSchedule.getCurrentMoods();if(!Object.keys(e).length>0)return i;let t=new Map;for(let s in e){let l=e[s].join();t.set(s,l)}let o={};for(let[s,l]of t){let n=this.daSchedule.findSchedEvent(parseInt(s));o[s]={m:l,color:n==null?void 0:n.color,bg:n==null?void 0:n.bgcolor}}return o},startEndTimes(){const i=[];return this.anchorDayTimeIdentifier!==!1&&this.otherDayTimeIdentifier!==!1&&(this.anchorDayTimeIdentifier<=this.otherDayTimeIdentifier?i.push(he(this.anchorTimestamp),he(this.otherTimestamp)):i.push(he(this.otherTimestamp),he(this.anchorTimestamp))),i},anchorDayTimeIdentifier(){return this.anchorTimestamp!==null?$e(this.anchorTimestamp):!1},otherDayTimeIdentifier(){return this.otherTimestamp!==null?$e(this.otherTimestamp):!1},eventsMap(){return this.daSchedule.scheduledEventsMap()}},methods:{showEvtMobile(i){return this.daSchedule.showEvtNoteScoreMobile(i)},klikaj(i){console.log("klikaj...",this.currentDate,i)},adjustCurrentTime(){var s,l;const i=te(new Date);if(this.currentDate!==i.date){this.timeStartPos=-10,this.currentTime="";return}this.currentDate=i.date,this.currentTime=i.time,this.timeStartPos=(l=(s=this.$refs)==null?void 0:s.calendar)==null?void 0:l.timeStartPos(i.time,!1);let e=this.daSchedule.getCurrentSchedTimesSets(),t=e.endSet&&e.endSet.has(i.time),o=e.startSet&&e.startSet.has(i.time);(t||o)&&(this.daSchedule.updateMinEndNowBtn(this.currentTime,t,o),o&&(this.scrollToTime(i,"slow"),this.doNotify("Event Starting :)","positive","top")))},hasDate(i){return this.currentDate?i.find(e=>e.date===this.currentDate):!1},getDateEvents(i){let e=(o,s)=>{let l=ee(o.sortTime,s.sortTime);if(l>0)return-1;if(l==0)return 0;if(l<0)return 1};const t=this.eventsMap[i]||[];return t.length===1?t[0].side="full":t.length,t.sort(e)},constructTree(){this.treeGoals=this.daSchedule.fetchGoalsTree()},resetGoalEvts(){return this.daSchedule.getSubGoals()},allMainGPrio(){return this.daSchedule.getAllPrio()},resetFilter(){var i;this.filter=[],(i=this.filterRef)==null||i.focus()},myFilterMethod(i,e){if(i.isChildren&&(i==null?void 0:i.moods.length)>0){const t=this.filter.map(s=>s.toLowerCase());let o=i==null?void 0:i.moods.some(s=>t.indexOf(s.toLowerCase())>-1);return i.label&&o}},labelGoals(i){let e=0;if(i=="s"){for(const o in this.treeGoals)e+=this.treeGoals[o].children.length;return`Scheduled => ${this.daSchedule.getAllEvts().size} out of ${e} 
`}return`Balance: ${this.daSchedule.getCurrentBalance()||0} 
`},badgeClasses(i,e){return mt(i,e)},styleDragLine(i,e=void 0,t=void 0){let o=e(i.time),s=t(i.duration),l=o+s;this.timeStartPos+s;const n={};return e&&t&&(n.top=l+"px",n.height=s+"px"),n["align-items"]="flex-start",n},badgeStyles(i,e,t=void 0,o=void 0){return St(i,e,t,o)},classyColor(i){return`row items-center ${i.isChildren?"text-":"text-white bg-"}${i.color} `},isViewingPast(){return this.daSchedule.isViewingPast()},onMoodAdd(){let i=[];const e=this.filter.map(t=>t.toLowerCase());if(this.treeGoals.filter(t=>{if(t.children.length>0)return t.children.filter(o=>{if((o==null?void 0:o.moods.length)>0&&(o==null?void 0:o.moods.some(s=>e.indexOf(s.toLowerCase())>-1))){let s=o==null?void 0:o.moods.filter(l=>{if(e.indexOf(l.toLowerCase())>-1)return l});return i.push({id:o.id,mood:s}),o}})}),i.length>0)if(i=i.filter(o=>!this.daSchedule.getAllEvts().has(o.id)),i.length>0){let o=this.daSchedule.scheduleByMood(i);if(o.canContinue)this.doNotify(`Added ${o==null?void 0:o.added} Evts by Mood...doSave eh`,"info");else{if(o.overlaps&&Object.keys(o.overlaps).length>0)return this.handleOverlaps(o.overlaps,"byMood");this.doNotify("Empty as no Mood Evts :(","warning")}}else this.doNotify(`Evts of Mood '${this.filterString}' already scheduled!`,"warning","top");else this.doNotify("Nothing to add :(","warning","top")},onScheduleOneEach(){let i=t=>{let o=this.daSchedule.scheduleOneEach(t);if(o.canContinue)this.doNotify(`By ${t} >> ${o==null?void 0:o.added} Evts by OneEach...doSave eh`,"info");else{if(o.overlaps&&Object.keys(o.overlaps).length>0)return this.handleOverlaps(o.overlaps,"oneEach");this.doNotify("Empty None for OneEach :(","warning")}},e=()=>{console.log("onScheduleOneEach..Aborting",this.daSchedule.getAllEvts()),this.reset()};if(this.daSchedule.getAllEvts().size>0){let t=[{label:"Add one Evt from Each parent Goals",value:"add"},{label:"Reset schedule and add one random Evt from Each parent Goals",value:"overwrite"}];this.radioChoiceDialog("Warning!!",`Date: ${this.currentDate} already have scheduled Events...`,t,"",i,e)}else i("overwrite")},onReloadSaved(){let i=this.daSchedule.hasEventsForDate(),e=()=>{console.log("Aborting",this.currentDate,this.scheduledEvents,i)},t=()=>{let o=this.daSchedule.loadEvtsForDay(!1);o.canContinue||(o.overlaps&&Object.keys(o.overlaps).length>0?(console.log("onReloadSaved::OVERLAPPS",o.overlaps),this.handleOverlaps(o.overlaps,"view")):(this.doNotify(`Reloaded schedule for ${this.currentDate}`,"positive","bottom"),(this.isViewingPast()||this.currentDate!==Ce())&&this.adjustCurrentTime())),this.reset()};if(this.daSchedule.getAllEvts().size>0&&!this.isViewingPast()){let o=i?"Reload? saved schedule of: "+this.currentDate:"Overwrite current Evts?";this.confirmAction("",o,"OK",t,e)}else t()},onClearDay(){let i=this.daSchedule.hasEventsForDate();if(this.isViewingPast()){this.doNotify("Editing past is no no!");return}this.daSchedule.resetSchedule(!0);let e=i?"Cleared...Can still Reload saved":"Resetting...";this.doNotify(e,"warning","top"),this.reset(),this.daSchedule.toggleActionBtns(i,"view")},onLoadDefault(){let i=e=>{let t=this.daSchedule.scheduleDefaults(e);if(t.canContinue)this.doNotify(`Defaults ${e} ...doSave eh`,"info");else{if(t.overlaps&&Object.keys(t.overlaps).length>0)return this.handleOverlaps(t.overlaps,"byDefaults");this.doNotify("Empty as No Defaults :(","warning")}};if(this.daSchedule.getAllEvts().size>0){let e=this.daSchedule.unscheduledDefaults(),t=[{label:`Add ${e==null?void 0:e.length} Default Evts to current schedule`,value:"add"},{label:"Reset and only schedule Defaults",value:"reset"}];this.radioChoiceDialog("",`Date: ${this.currentDate} already have scheduled Events...`,t,"",function(o){i(o)},function(){console.log("onLoadDefaults::Aborting")})}else i("reset")},onChoosenPrio(i){this.daSchedule.onChoosenPrio(i)},doReloadWithPrio(){var l,n,r;if(this.daSchedule.chosenPrio==null){this.doNotify("Ayo select a priority!");return}let i=()=>{this.reset()},e=h=>{let d=this.daSchedule.scheduleSamePrio(h);if(d.canContinue)this.doNotify(`By ${h} >> ${d==null?void 0:d.added} Evts with Priority == ${this.daSchedule.chosenPrio} ...doSave eh`,"info");else{if(d.overlaps&&Object.keys(d.overlaps).length>0)return this.handleOverlaps(d.overlaps,"byPrio");this.doNotify(`No Evts with Priority == ${this.daSchedule.chosenPrio} :(`,"warning","top")}},t=this.daSchedule.chosenPrio,o=this.daSchedule.byPrio,s=this.daSchedule.getAllEvts().size;if(s>0){let h=[{label:`Filter out ${s} scheduled for Evts with priority == ${t}`,value:"filter"}];((l=o==null?void 0:o.toAdd)==null?void 0:l.length)>0&&h.push({label:`Add ${(n=o==null?void 0:o.toAdd)==null?void 0:n.length} Evts with priority == ${t}`,value:"add"}),h.push({label:`Reset and schedule ${(r=o==null?void 0:o.reset)==null?void 0:r.length} Evts with priority == ${t}`,value:"reset"});let d=`Reload Schedule by Priority == ${t}`;this.radioChoiceDialog(d,"Parent priority == "+t,h,"",e,i)}else e("reset");this.daSchedule.disablePrioBtn=!0},onChoosenScore(i){this.daSchedule.onChoosenScore(i)},doReloadWithScore(){var l,n,r;if(this.daSchedule.chosenScore==null){this.doNotify("Ayo select a score!");return}let i=()=>{this.reset()},e=h=>{let d=this.daSchedule.scheduleByScore(h);if(d.canContinue)this.doNotify(`${d==null?void 0:d.added} Evts via ${h} with Interval Score <= ${this.daSchedule.chosenScore} ...doSave eh`,"info");else{if(d.overlaps&&Object.keys(d.overlaps).length>0)return this.handleOverlaps(d.overlaps,"byScore");this.doNotify(`Empty for Interval Score <= ${this.daSchedule.chosenScore} :(`,"warning")}},t=this.daSchedule.chosenScore,o=this.daSchedule.byScore,s=this.daSchedule.getAllEvts().size;if(s>0){let h=[{label:`Filter out ${s} scheduled for Evts with Interval Score <= ${t}`,value:"filter"}];((l=o==null?void 0:o.toAdd)==null?void 0:l.length)>0&&h.push({label:`Add ${(n=o==null?void 0:o.toAdd)==null?void 0:n.length} Evts with Interval Score <= ${t}`,value:"add"}),h.push({label:`Reset and schedule ${(r=o==null?void 0:o.reset)==null?void 0:r.length} Evts with Interval Score <= ${t}`,value:"reset"});let d=`Reload Schedule by Interval Score <= ${t}`;this.radioChoiceDialog("",d,h,"",e,i)}else e("reset");this.daSchedule.disableScoreBtn=!0},doSaveSchedule(){this.daSchedule.saveDaySchedule(),this.doNotify(`Schedule saved for ${this.currentDate}`,"positive","top")},doLog(i,e){console.log(i,JSON.parse(JSON.stringify(e)))},doDroppy(i,e){if(i&&e){let t=this.daSchedule.tooClose(i,e.duration);if(t&&(console.log("doDroppy::tooClose to>>",t),t===!0)){this.doNotify("Dropping event TOO close to midnight!"),this.reset();return}let o=this.daSchedule.canDropEvent(i,e),s=this.daSchedule.getOriginalEvtTime(e.id);if(o.canContinue)if((e==null?void 0:e.inDefaults)||!(e!=null&&e.canMove)){let n=e!=null&&e.inDefaults?"Default at ":"Cannot Move from ",r=[`Evt "${e.title.trim()}" ${n} ${L(s)}.`,`
Also Save Evt default time to ${L(i.time)}?`,`
Cancel or Dismiss to undo!`,`
No selection to keep at ${L(e.time)}`].join(`
`);const h=this.daSchedule,d=this.doCleanup;this.confirmTimeChange("Changing Evt's time",r,"Change","Temp.Move",function(v){h.changeEvtTime(e,i,v),d()},function(){d()},function(){console.log(`doDroppy::onDismiss..keep as is>> ${e.id})'${e.title.trim()}'`),d()})}else this.daSchedule.changeEvtTime(e,i,!1),this.doCleanup();else this.doLog("doDroppy::CANNOT Drop",o),this.handleOverlaps(o.overlaps,"onDrop")}else{console.log("doDroppy null ERROR?",i,this.targetDrop,e,this.selectedItem);return}},canAutoSchedule(i,e){let t=i.title.trim().toLowerCase().includes(e.title.trim().toLowerCase()),o=e.title.trim().toLowerCase().includes(i.title.trim().toLowerCase()),s=this.daSchedule.parentGoalById(i.parentGoal),l=this.daSchedule.parentGoalById(e.parentGoal),n=i.title.trim().toLowerCase().includes(l.title.trim().toLowerCase()),r=e.title.trim().toLowerCase().includes(s.title.trim().toLowerCase());return(n||r)&&console.log("canAutoSchedule:: WOAH PARENT AUTO schedule?--TODO***",n,r,"Normal AUTO>>",t,o),t||o?{addIncSched:t,schdIncToAdd:o}:!1},movedIntoConflict(i,e,t,o=0){console.log("movedIntoConflict >>",JSON.parse(JSON.stringify(i)),"from:"+t,o);const s=(g,f)=>{if(g!=null&&g.parentGoal){let a=this.daSchedule.parentGoalById(g.parentGoal);return f?`Of '${a==null?void 0:a.title.trim()}' (${a==null?void 0:a.priority})`:`Of '${a==null?void 0:a.title.trim()}'`}return console.log("prioLabel..ERROR no PARENT found?",g),""},l=(g,f)=>{switch(f){case"score":return`${s(g,!1)} > "${g.title.trim()}" with Score:: ${g.score} = ${ue(g.score)}`;case"prio":return`"${g.title.trim()}" ${s(g,!0)}`;default:return`"${g.title.trim()}" ${s(g,!0)} && Score:: ${g.score} for ${g.duration} mins`}},n=(g,f=!1)=>{this.doNotify(g,f?"warning":"positive","top")},r=g=>{this.daSchedule.deleteEvtMood(g)},h=g=>{console.log(`movedIntoConflict::doRemove ${g.id}:${g.title}`),this.daSchedule.removeScheduledEvt(g)};let d=g=>{console.log("onDismissy::from "+t,g,E),this.doCleanup(),this.daSchedule.toggleActionBtns(!0,t)};const v=(g,f,a)=>{if(console.log(`movedIntoConflict::removeReplace >> replacing>> ${g.id}) '${g.title.trim()}' WITH ${f.id}) ${f.title.trim()}`,a,"from>"+t),e){if(console.log("movedIntoConflict::removeReplace...OVERRIDE from>>"+t),t=="onDrop"){h(g);return}console.log("movedIntoConflict::removeReplace....OVERRIDE updating..."+t),this.daSchedule.doUpdateSchedule(f,a.targetStart);return}if(h(g),t=="onDrop")console.log("movedIntoConflict::removeReplace for onDrop...just updating schedule",f.id,a.targetStart.time),this.daSchedule.doUpdateSchedule(f,a.targetStart);else{console.log("movedIntoConflict::removeReplace >>addGoalsToSchedule from "+t);let u=this.daSchedule.getStoredRawEvt(a.target);u&&(JSON.parse(JSON.stringify(f)),Object.assign(f,u,{time:a.targetStart.time}));let D=this.daSchedule.addGoalsToSchedule([{...f,time:a.targetStart.time}],!0),p=Object.keys(D).length;if(p>0)return console.log(`movedIntoConflict::removeReplace:: OVERLAPS again of size:${p} from >${t}>`+f.title,JSON.parse(JSON.stringify(D))),this.doNotify(`Extra Overlaps while removing to add '${f.title.trim()}' `,"warning","top"),this.movedIntoConflict(D,e,t+"nah")}},y=(g,f)=>{let a=this.daSchedule.findSchedEvent(f.target);if(!a){console.log("movedIntoConflict::forceAddMins>>NOT FOUND?!?",f.target);return}let u=this.daSchedule.getStoredRawEvt(f.target);if(u){let D=a.duration+parseInt(o);JSON.parse(JSON.stringify(a)),Object.assign(a,u,{duration:D})}else console.log("movedIntoConflict::forceAddMins >>NEWLY ADDED?!? Error?",a.id,a,u),Object.assign(a,{duration:newDura});this.daSchedule.recurChangeTime(g.id,a,f.targetStart,!1,this.doNotify),this.doSaveSchedule()},b=(g,f,a)=>{console.log(`movedIntoConflict::forceAdd:${t} >>${f.id})'${f.title}' at ${f.time} to ${a.targetStart.time}
          
Changing >>${g.id} from ${g.time}`);let u=this.daSchedule.getStoredRawEvt(a.target);u&&(JSON.parse(JSON.stringify(f)),Object.assign(f,u,{time:a.targetStart.time}));let D=this.daSchedule.recurChangeTime(g.id,f,a.targetStart,t!="onDrop",this.doNotify);if(D){let p=Object.keys(D).length;if(p>0)return console.log(`movedIntoConflict::forceAdd:: OVERLAPS again of size:${p} from >${t}>`+f.title,JSON.parse(JSON.stringify(D))),this.doNotify(`Extra Overlaps while adding '${f.title.trim()}'`,"negative","top"),this.movedIntoConflict(D,e,t+"nah")}d("ForceAdd")};let m=(g,f,a,u,D)=>{E.push(f),f==a.id?(v(u,a,D),n(`by ${g}, ${t=="onDrop"?"Moving":"Adding"} '${a.title.trim()}'`,!0)):(console.log(`onOkChoice::by ${g},chose scheduled ${f} ...with override?`,e,t),n(`by ${g}, Keeping '${u.title.trim()}'`),t.indexOf("byMood")>-1&&r(a.id),t=="onDrop"&&h(a))},C=(g,f)=>{if(e){if(console.log("movedIntoConflict::cancelChoice::OVERRIDE...coolios!!from:"+t,g.title.trim()),t=="onDrop"){n("Umm...not moving then...."),this.daSchedule.toggleActionBtns(!1,"view");return}h(g),n(`Keeping '${f.title.trim()}'`);return}t.indexOf("byMood")>-1&&r(g.id),this.daSchedule.toggleActionBtns(!0,"view"),n(`Keeping scheduled '${f.title.trim()}'`)};const R=(g,f,a,u)=>{if(g=="opt3"){let D="Pick one event...",p=[{label:l(f,"def"),value:f.id,color:"secondary"},{label:l(a,"def"),value:a.id}];this.radioChoiceDialog("",D,p,"",function(G){m("Choice",G,f,a,u)},null,function(){d("resolveChoice::byEvent... dismissing")})}else if(g=="opt2"){let D="Pick event by Score",p=[{label:l(f,"score"),value:f.id,color:"secondary"},{label:l(a,"score"),value:a.id}];this.radioChoiceDialog("",D,p,"",function(G){m("Score",G,f,a,u)},null,function(){d("resolveChoice::byScore... dismissing")})}else if(g=="opt1"){let D="Pick event by Priority",p=[{label:l(f,"prio"),value:f.id,color:"secondary"},{label:l(a,"prio"),value:a.id}];this.radioChoiceDialog("",D,p,"",function(G){m("Priority",G,f,a,u)},null,function(){d("resolveChoice::byPriority... dismissing")})}else g=="opt0"?(console.log("resolveChoice::it's a drop?...keeping as is....",t),n("Umm...keeping as is then!"),this.doCleanup()):b(a,f,u)},S=(g,f,a,u,D)=>{u.direction!=="surrounding"&&!D&&(t.indexOf("nah")>-1?console.log("movedIntoConflict::manualSolve NOT adding Force as from "+t):g.push({label:`Force in '${f.title.trim()}'`,value:"opt4"}));let p=`${t=="onDrop"?"Moving":"Adding"} '${f.title.trim()}' at ${L(u.targetStart.time)} Overlaps with Scheduled '${a.title.trim()}' at ${L(a==null?void 0:a.time)}.
          
Cancel to keep '${a.title.trim()}' `,G=D?"Choose Auto Resolution":"Resolve Overlapping Events";this.radioChoiceDialog(G,p,g,"opt1",function(F){R(F,f,a,u)},function(){console.log("movedIntoConflict>>manualSolve::cancelChoice? Notif?>> from: "+t,E[0]),n("Umm...keeping as is then!")})};let E=[],N=Object.keys(i).length;for(let g in i){if(!i[g]||!i[g][0]){console.log("movedIntoConflict...ERROR::skipping unknown key",g);continue}if(g=="withID"){console.log("movedIntoConflict...skipping withID key",g,i.withID);continue}let f=i[g];if(f.length>1){if("withID"in i){i.withID.find(F=>F==g)?(console.log(`movedIntoConflict::WITHID>>using oneToManyConflict as ${f.length} of`+N,i.withID),this.fixConflicts(f,t,!0,N-1)):(console.log(`movedIntoConflict::WITHID>>using manyToOneConflictas ${f.length} of`+N,i.withID),this.fixConflicts(f,t,!1,N-1));continue}console.log(`movedIntoConflict::NORMAL>>using manyToOneConflictas ${f.length} of`+N,i.withID),this.fixConflicts(f,t,!1,N);continue}let a=[{label:"Choose one event",value:"opt3"}];t=="onDrop"?a.unshift({label:"Leave as is!",value:"opt0"},{label:"Choose by Priority",value:"opt1",color:"secondary"},{label:"Choose by Score",value:"opt2"}):a.unshift({label:"Choose by Priority",value:"opt1",color:"secondary"},{label:"Choose by Score",value:"opt2"});const u=f.pop();let D=this.daSchedule.getSubGoalByID(u.target),p=this.daSchedule.findSchedEvent(u.inConflict);if(!p||!D){console.log("movedIntoConflict...ERROR ERROR no evts found!!!",u);return}let G=this.canAutoSchedule(D,p);if(t=="onAddMins"){let F=p!=null&&p.inDefaults?"In Defaults":p!=null&&p.canMove?"":"Cannot move",se=`Adding ${o} mins to "${D.title.trim()}" Overlaps with Scheduled "${p.title.trim()}" at ${L(p.time)} as ${F}.
            
Force?
            
Cancel/Dismiss to Leave as is.`;this.confirmAction("",se,"Add",function(){y(p,u)},function(){n("Keeping as Is...")})}else if(G){console.log("movedIntoConflict:: can AUTO schedule",G.addIncSched,G.schdIncToAdd,"direction == surrounding? >>",u.direction=="surrounding"),this.scrollToTime(u==null?void 0:u.targetStart,"slow");let F=`"${D.title.trim()}" at ${L(D.time)} related to Scheduled "${p.title.trim()}" at ${L(p.time)}.
            
Auto resolve Overlap?
            
Cancel/Dismiss to manually choose.`;this.confirmAction("",F,"Auto",function(){var se;G.addIncSched?(console.log("Auto resolve::removeReplace..with TIMES>>",D.time,p.time,(se=u==null?void 0:u.targetStart)==null?void 0:se.time),v(p,D,u),n(`Removing Scheduled to Add '${D.title.trim()}'`,!0),E.push(D.id)):(console.log("Auto resolve::cancelChoice >> from: ",t),C(D,p),E.push(p.id))},function(){S(a,D,p,u,!0)},function(){d("Auto-dismiss")})}else S(a,D,p,u,!1)}},handleOverlaps(i,e=""){let t=Object.keys(i).length;this.doLog("handleOverlaps from: "+e+" >> "+t,i);const o=Object.keys(i).reverse();for(let s=0;s<o.length;s++){let l=o[s];if(l=="withID")continue;let n=i[l];if(s==t-1&&this.scrollToTime(n[0].targetStart,"slow"),"withID"in i){i.withID.find(r=>r==l)?this.fixConflicts(n,e,!0,t-1):this.fixConflicts(n,e,!1,t-1);continue}this.fixConflicts(n,e,!1,t)}},fixConflicts(i,e,t,o){var ke;const s=O=>this.daSchedule.findSchedEvent(O),l=O=>this.daSchedule.getSubGoalByID(O),n=(O,A)=>{if(!O){console.log("fixConflicts::scrollToConflict ERROR >>empty time withID="+t,A,O);return}this.scrollToTime(O,"slow")},r=O=>{this.doNotifyTimeout(O,"negative","top",1e4)},h=(O,A=!1)=>{this.doNotify(O,A?"warning":"positive","top")},d=O=>this.findhighestPrio(O);let v=O=>this.getSmallestScoreInterval(O),y=O=>{if(console.log("onDismissy>> "+e,O,f.length),f.length>0)setTimeout(()=>{t?b(f,D):m(f,D)},0);else{n(t?N.get(a.id):N.get(u.id),"onDismissy");return}},b=(O,A)=>{this.doLog(`fixConflicts::removeWithID with toKeep=${O.length} `,O);let w=[];for(A.forEach((c,T,Y)=>{if(O.find(k=>k.id==c.id))if(c.id==a.id){let k=g.has(c.id)?g.get(c.id):"",H=N.has(c.id)?N.get(c.id):N.get(a.id),q=this.daSchedule.getStoredRawEvt(c.id);q&&(JSON.parse(JSON.stringify(c)),Object.assign(c,q,{time:H.time}));let le=e=="onDrop"?this.daSchedule.doUpdateSchedule(c,H)||{}:this.daSchedule.addGoalsToSchedule([{...c,time:H.time}],!1);if(Object.keys(le).length>0)console.log("fixConflicts::removeWithID::OVERLAP on add",le,c,H.time),w.push(le);else{let ge=`${k} Adding '${c==null?void 0:c.title.trim()}' at ${L(H.time)}`;this.doNotify(ge,"positive","top")}}else{console.log("fixConflicts::removeWithID....Keeping scheduled Evt!!",c.id);let k=`${g.has(c.id)?g.get(c.id):""} Keeping scheduled '${c==null?void 0:c.title.trim()}'`;this.doNotify(k,"positive","top")}else c.id!=a.id?(console.log("fixConflicts::removeWithID >>removing scheduled",c.id,c.title,c.time),this.daSchedule.removeScheduledEvt(c),this.doNotify(`Removed scheduled '${c==null?void 0:c.title.trim()}'`,"warning")):(e=="onDrop"?(console.log("fixConflicts::removeWithID >>Removing target onDrop!!",c.id,c.title,c.time),this.daSchedule.removeScheduledEvt(c),this.doCleanup()):console.log("fixConflicts::removeWithID >>NOT adding original target",a.id),this.daSchedule.deleteEvtMood(a.id),this.resetFilter())});w.length;){const c=w.pop();this.doLog(`${e}> fixConflicts::removeWithID:: OVERLAPS`,c),this.doNotify("EXTRA Overlaps to fix!"+w.length,"negative","top");let T=c.direction=="surrounding"?e+"nah":e;return this.handleOverlaps(c,T)}},m=(O,A)=>{console.log(`fixConflicts::removeConflicts with toKeep=${O.length} `);let w=[],c=!1;for(A.forEach((T,Y,k)=>{if(O.find(H=>H.id==T.id)){let H=g.has(T.id)?g.get(T.id):"",q=N.has(T.id)?N.get(T.id):null;if(T.id!=u.id){let le=this.daSchedule.getStoredRawEvt(T.id);le&&(JSON.parse(JSON.stringify(T)),Object.assign(T,le,{time:q.time}));let ge=e=="onDrop"?this.daSchedule.doUpdateSchedule(T,q)||{}:this.daSchedule.addGoalsToSchedule([{...T,time:q.time}],O.length<2);if(ge&&Object.keys(ge).length>0)w.push(ge),this.doNotify(`Extra Overlaps while adding '${T==null?void 0:T.title.trim()}'`,"negative","top");else{let Ye=`${H} Adding '${T==null?void 0:T.title.trim()}' at ${L(q.time)}`;this.doNotify(Ye,"positive","top")}c=!0}else this.doNotify(`${H} Keeping scheduled '${T==null?void 0:T.title.trim()}' `,"positive","top")}else T.id==u.id?(this.daSchedule.removeScheduledEvt(T),this.doNotify(`Removed scheduled '${T==null?void 0:T.title.trim()}' `,"warning","top"),c=!0):(console.log("fixConflicts::removeConflicts >> NOT adding target ",T.id,T.title),this.daSchedule.deleteEvtMood(T.id),this.resetFilter(),e.indexOf("view")>-1?c=!0:c=c)});w.length;){const T=w.pop();this.doLog(`fixConflicts::removeConflicts::EXTRA OVERLAPS from ${e} `,T),this.doNotify("EXTRA Overlaps to fix","negative","top");let Y=T.direction=="surrounding"?e+"nah":e;return this.handleOverlaps(T,Y)}};const C=(O,A)=>{let w=[];for(this.doLog(`fixConflicts::forceAdd of ${O.length} withID=${t}`,"allConflicts= "+A.length),A.forEach(c=>{if(O.find(T=>T.id==c.id)){let T=N.has(c.id)?N.get(c.id):null;console.log(`fixConflicts::forceAdd...NEW:${c.id} '${c.title.trim()}' dura= ${c.duration} 
 
              origAt: ${c.time} added at>>`,T==null?void 0:T.time,"from>>"+e);let Y=this.daSchedule.getStoredRawEvt(c.id);if(Y){let q=JSON.parse(JSON.stringify(c));Object.assign(c,Y,{time:T.time}),console.log("fixConflicts::forceAdd >>HAD SAVED!"+c.id,q)}let k=A.find(q=>q.id!=c.id),H=this.daSchedule.recurChangeTime(k.id,c,T,e!="onDrop",r);if(H&&Object.keys(H).length>0)console.log("fixConflicts::forceAdd >>OVERLAP on add",H,c,T.time),w.push(H);else{let q=`Force Added '${c==null?void 0:c.title.trim()}' at ${L(T.time)}`;this.doNotify(q,"positive","top")}}else console.log("fixConflicts::forceAdd >>CONFLICT NOTHING TODO?",t,c.id,N.has(c.id),N.has(O[0].id),O[0].id,e!="onDrop"),t&&this.daSchedule.recurChangeTime(c.id,O[0],N.get(O[0].id),e!="onDrop",r)}),this.daSchedule.toggleActionBtns(!0,e);w.length;){const c=w.pop();this.doLog("fixConflicts::forceAdd:: EXTRA OVERLAPS "+e,c),this.doNotify("EXTRA Overlaps to fix "+w.length,"negative","top");let T=c.direction=="surrounding"?e+"nah":e;return this.handleOverlaps(c,T)}};let R=(O,A)=>{switch(O){case"score":this.radioChoiceDialog("","Choose one event by Score",A.map(w=>this.betterEvtLabel(w,"score",!1)),"",function(w){let c=A.find(T=>T.id==w);if(c)f.push(c),g.set(c.id,`By Score Interval (${c.score}),`);else{console.log("chooseOneEvt::ERROR NOT FOUND!!",w);return}return c},null,function(){y("chooseOneEvt::>>byScore...")});return;case"prio":this.radioChoiceDialog("","Choose one event by Priority",A.map(w=>this.betterEvtLabel(w,"prio",!1)),"",function(w){let c=A.find(T=>T.id==w);if(c)f.push(c),g.set(c.id,"By Priority,");else{console.log("chooseOneEvt::ERROR NOT FOUND!!",w);return}return c},null,function(){y("chooseOneEvt::>>byPriority...")});return;default:this.radioChoiceDialog("","Choose which Event to keep",A.map(w=>this.betterEvtLabel(w,"default",!1)),"",function(w){let c=A.find(T=>T.id==w);if(c)f.push(c),g.set(c.id,"By pick,");else{console.log("chooseOneEvt::ERROR NOT FOUND!!",w);return}return c},null,function(){y("chooseOneEvt::>>byPick...")});return}},S=(O,A,w,c,T)=>{var Y;if(n(t?N.get(a.id):N.get(u.id),"resolveChoice"),O=="opt3")R("default",c);else if(O=="opt2")if(T)R("score",c);else{let k=v(c);console.log("fixConflicts::ByScore >>AUTO "+e,k.id,k==null?void 0:k.title.trim(),k.score),f.push(k),g.set(k.id,`By Shortest Score Interval (${k.score}),`)}else if(O=="opt1")if(T)R("prio",c);else{let k=d(c);console.log("fixConflicts::ByPriority >> AUTO "+e,k.e.id,(Y=k==null?void 0:k.e)==null?void 0:Y.title.trim()),f.push(k.e),g.set(k.e.id,`By Highest Priority (${k.prio}),`)}else O=="opt0"?(console.log("constructOptions...YEEE--AUTO:SOLVE ",a,u,w,c[1],c[0]),A.addIncSched?t?(f.push(a),g.set(a.id,"By Auto-Solve,")):(f.push(c[0]),g.set(c[0].id,"By Auto-Solve,")):t?(f.push(c[0]),g.set(c[0].id,"By Auto-Solve,")):(f.push(c[1]),g.set(c[1].id,"By Auto-Solve,"))):C(w,c)},E=()=>{if(e=="onDrop"){h("Umm...not moving then...."),this.doCleanup();return}e.indexOf("byMood")>-1&&console.log("fixConflicts::cancelChoice >>Mood update "+e),f.push(u)},N=new Map,g=new Map,f=[],a=null,u=null,D=[],p=[],G=!1,F=[];for(;i.length;){const O=i.pop();let A=s(O.inConflict);if(!A){console.log("constructOptions...ERROR ERROR no evts found!!!",O);return}let w=l(O.target);if(!w){console.log("constructOptions...ERROR ERROR target evt not found!!!",O);return}N.set(O.target,O==null?void 0:O.targetStart),t?(F.push(`(${A==null?void 0:A.id}) '${A==null?void 0:A.title.trim()}'`),a?a.id!=O.target&&console.log("fixConflicts::ERROR?...Not same target ID?!?",a,O,p,N):(a=w,p.push(w),D.unshift(w)),D.push(A)):(F.push(`(${w==null?void 0:w.id}) '${w==null?void 0:w.title.trim()}'`),u?u.id!=A.id&&console.log("fixConflicts::ERROR::ERROR Not same inConflict",u.id,A.id,p):(u=A,D.unshift(A),N.set(O.inConflict,O==null?void 0:O.targetStart)),p.push(w),D.push(w)),O.direction=="surrounding"?G=!0:G=G}let se=F.join(" and "),J=F.length<2&&o<3,Se=!1;F.length<2&&(Se=t?this.canAutoSchedule(a,D[0]):this.canAutoSchedule(p[0],u)),console.log(`fixConflicts::${J?"ONE":"MULTIPLE"} CHOICE >> withID=${t} --handling>> `,F.length,o);let W=[],pe=J?"Pick one event via ":"Auto-Resolve keep one with ";if(Se?(this.doLog("fixConflicts::AUTO-RESOLVE!!",Se),W.unshift({label:"Auto resolve Overlap?",value:"opt0"}),W.push({label:"Manually Choose one event",value:"opt3"})):J?W.push({label:"Manually Choose one event",value:"opt3"}):(W.push({label:"Manually Choose one event",value:"opt3"}),e=="byScore"?W.unshift({label:pe+`${J?"Priority":"Highest Priority"}`,value:"opt1",color:"secondary"}):e=="byPrio"?W.unshift({label:pe+`${J?"Score Interval":"Shortest Score Interval"}`,value:"opt2"}):W.unshift({label:pe+`${J?"Priority":"Highest Priority"}`,value:"opt1",color:"secondary"},{label:pe+`${J?"Score Interval":"Shortest Score Interval"}`,value:"opt2"})),!G&&!e.indexOf("nah")>-1){let O=t?`Force in > '${a==null?void 0:a.title.trim()}' ?`:`Force in > ${F.join()}`;W.push({label:O,value:"opt4"})}else G&&J&&(e.indexOf("onPickEvt")>-1||e.indexOf("adHocEvt")>-1)&&W.push({label:"Force add ?",value:"opt4"});let Me=`${J&&W.length<=2?"Cancel to keep scheduled":""}`,Qe=t?`Adding (${a==null?void 0:a.id}) '${a==null?void 0:a.title.trim()}' at ${L((ke=N.get(a.id))==null?void 0:ke.time)} Conflicts with scheduled ${se}. 
 ${Me}`:`Adding ${F.join()} Conflicts with scheduled (${u==null?void 0:u.id}) '${u==null?void 0:u.title.trim()}' at ${L(u==null?void 0:u.time)}. 
 ${Me}`,Ke=t?"oneToMany Conflicts":"manyToOne Conflicts";this.radioChoiceDialog(Ke,Qe,W,"",function(O){S(O,Se,p,D,J)},J?E:null,function(){y("Main!")})},onPickEvent(i,e,t,o){if(this.closingDialog(),!i||!i.id){console.log("onPickEvent...ERROR nothing!",i,e,t,o),this.doNotify("No Goal selected..."),this.reset();return}let s=this.daSchedule.isViewingPast()?!0:e,l=o!=i.duration,n=this.daSchedule.tooClose(this.targetDrop.timestamp,l?o:i.duration);if(n){if(console.log("onPickEvent::tooClose check FAIL!",n),n===!0){this.doNotify("Picking event TOO close to midnight!"),this.reset();return}if(s)this.doNotify(`'${i.title.trim()}' TOO close Buuut..FORCING!`,"warning","top");else{this.doNotify(`'${i.title.trim()}' Not added as TOO close to a scheduled Evt`),this.reset();return}}l&&(i.duration=o);let r=this.daSchedule.onPickEvent(i,this.targetDrop.timestamp,s,t,this.doNotifyTimeout);r.canContinue?t&&this.doNotify("What is Owed PAID! gg!","info","top"):r.overlaps&&Object.keys(r.overlaps).length>0?(t&&this.doNotify("Overlaps!-Balance Not Used!","negative","top"),this.handleOverlaps(r.overlaps,"onPickEvt")):this.doNotify("Error? onPickEvt :(","negative","bottom")},onAddHocEvent(i,e,t,o,s){if(this.possibleRange||(this.possibleRange=this.startEndTimes),i.trim()==""){this.doNotify("Empty Goal title..."),this.closingDialog(),this.reset();return}let l=Ve(this.possibleRange[0]),n=o>15?M(l,{minute:parseInt(o)}):M(Ve(this.possibleRange[1]),{minute:15}),r=Math.floor(ee(l,n)/1e3/60),h=this.daSchedule.tooClose(l,r);if(h){if(console.log("onAddHocEvent::tooClose check FAIL!!",h),this.closingDialog(),h===!0){this.doNotify(`'${i}' Not added as over midnight!`);return}this.doNotify(`'${i}' too close to a scheduled Evt--Forcing!!`,"warning")}this.closingDialog();let d=this.daSchedule.saveNewGoal(l,i,e,t,r);if(d){let v=this.daSchedule.onAdHocEvent(d,l,s,this.doNotifyTimeout);if(v.canContinue)this.constructTree(),this.reset(),this.doNotify("New adHoc Evt added!","positive","top"),this.mobile&&this.adjustCurrentTime();else if(console.log("onAdHocEvent::OVERLAPS?",JSON.parse(JSON.stringify(v))),v.overlaps==null){this.doNotify("Error Adding this event :(","negative"),console.log("onAdHocEvent::ERROR not found?");return}else s&&this.doNotify("Overlaps!-Balance Not Used!","warning","top"),this.handleOverlaps(v.overlaps,"adHocEvt")}else console.log("onAdHocEvent::BOO ERROR no subID :(",d),this.doNotify("Error adding :(  Add Evt by select!","negative")},onEndNow(i){const e=()=>{let s=this.daSchedule.findSchedEvent(i);this.daSchedule.removeScheduledEvt(s),this.daSchedule.saveDaySchedule(),this.doNotify(`Removing "${s==null?void 0:s.title.trim()}" Saving Schedule...`,"positive","top")},t=s=>{console.log("onEndNow::reducing!!!",i,Number.isInteger(s)),this.daSchedule.reduceEvtDuration(i,s)};let o=this.daSchedule.canEndNow(i);o?this.confirmAction("",`Less than 10mins remove?
 Cancel to just EndNow`,"OK",e,function(){t(o)}):console.log("onEndNow...END",i,o,Number.isInteger(o))},onSaveScore(i,e,t=""){let o=ue(i);if(o<-1){o==-89?(console.log("onSaveScore parsing error",o,i),this.doNotify("Score Parsing Error... YOU FOO! ")):this.doNotify("Score Error: higher# on lower#");return}this.daSchedule.updateNoteScore(e,i,t)},onAddMins(i,e){let t=this.daSchedule.addMinsToEvt(i,e,this.doNotify);if(!t.canContinue){if(t.overlaps&&Object.keys(t.overlaps).length>0)return this.doNotify("Bumped into some Evts","warning","top"),this.movedIntoConflict(t.overlaps,!0,"onAddMins",e);this.doNotify("Add ERROR:(","negative","bottom")}},removeEvtInSchedule(i,e=!0){let t=!1,o=()=>{if(this.daSchedule.removeScheduledEvt(i),t||e){e&&(this.daSchedule.addToBalance(i),this.doNotify(`Balance change after removing '${i.title}'`,"warning","top")),this.doSaveSchedule();return}this.daSchedule.toggleActionBtns(!0,"view")},s=()=>{console.log("Cancelled remove"),this.reset()};if(this.daSchedule.isViewingPast()){if(i.duration<30){this.doNotify("Removing from the past... Check BALANCE!"),this.daSchedule.addToBalance(i),t=!0,o();return}this.chooseAlternatives(i);return}if(!this.daSchedule.isViewingToday()&&!this.mobile){t=this.daSchedule.getCurrentMoods()[i.id],console.log("Removing future evt"),o();return}let l=`Remove "${i.title}" ?`,n=this.daSchedule.getCurrentMoods()[i.id];n&&(t=!0,l=l+` With Moods: '${n}'`),l=e?l+" (Balance affected)":l,this.confirmAction("Schedule Change",l,"Remove",o,s)},betterEvtLabel(i,e,t=null){const o=(l,n)=>{if(l!=null&&l.parentGoal){let r=this.daSchedule.parentGoalById(l.parentGoal);return n?`Of '${r==null?void 0:r.title.trim()}' (${r==null?void 0:r.priority})`:`Of '${r==null?void 0:r.title.trim()}'`}return console.log("prioLabel..ERROR no PARENT found?",l),""};let s="";switch(e){case"score":return s=`${o(i,!1)} > "${i.title.trim()}" with Score:: ${i.score} = ${ue(i.score)} `,s+=t?`@ ${L(i==null?void 0:i.time)} ++ ${i==null?void 0:i.duration} mins`:`for ${i==null?void 0:i.duration} mins`,{label:s,value:i.id};case"prio":return s=`"${i.title.trim()}" ${o(i,!0)} `,s+=t?`@ ${L(i==null?void 0:i.time)} ++ ${i==null?void 0:i.duration} mins`:`for ${i==null?void 0:i.duration} mins`,{label:s,value:i.id};default:return s=`"${i.title.trim()}" ${o(i,!0)} && Score:: ${i.score} = ${ue(i.score)} ${t?` @ ${L(i==null?void 0:i.time)} ++ ${i==null?void 0:i.duration} mins`:`for ${i.duration} mins`}`,{label:s,value:i.id}}},getSmallestScoreInterval(i){let e=9,t=null;for(let o of i){let s=ue(o.score);s>-1&&s<=e&&(e=s,t=o)}if(t)return t;console.log("ERROR ERROR getSmallestScoreInterval::No current set?",e,t,i)},findhighestPrio(i){let e=0,t=null;for(let o of i)if(o.parentGoal){let s=this.daSchedule.parentGoalById(o.parentGoal);s?s.priority>e&&(e=s.priority,t=o):console.log("findhighestPrio::ERROR no PARENT found?",o)}else console.log("findhighestPrio::ERROR EVT not found?",o);return{e:t,prio:e}},chooseAlternatives(i){let e=(y,b)=>{if(y.parentGoal>b.parentGoal)return 1;if(y.parentGoal==b.parentGoal)return 0;if(y.parentGoal<b.parentGoal)return-1},t=this.daSchedule.getAltEvts().sort(e),o=te(new Date),s=i.time,l=o.date,n=i.title;const r=y=>y.filter(b=>!this.daSchedule.getAllEvts().has(b.id)),h=y=>{let b=M(K(l),{day:0}),m=M(K(b.date),{day:1}),C=this.daSchedule.getEventsForDate(b.date),R={},S=null;C?R=C:console.log("chooseAlternatives::addInFutur EMPTY for >>...",b.date),y.forEach(E=>{if(S=this.daSchedule.getSubGoalByID(E),R[E]){console.log("addInFutur...ALREADY PRESENT",E,b.date,S==null?void 0:S.title.trim()),this.doNotify(`Alternative '${S==null?void 0:S.title.trim()}' already present on ${b.date}. Moving it to next day`,"warning");let N=this.daSchedule.getEventsForDate(m.date);if(N)if(!N[E])N[E]={duration:S==null?void 0:S.duration,time:s,notes:`Alt replace for '${n}'`};else{console.log("addInFutur...STILL PRESENT in next day:"+m.date,S.title.trim()),this.doNotify(`Booo! Alt '${S==null?void 0:S.title.trim()}' also present on ${m.date} :(( ...Check BALANCE!`),this.daSchedule.addToBalance(S);return}else N={},N[E]={duration:S.duration,time:s,notes:`Alt replace for '${n}'`};this.daSchedule.updateDaySchedule(m.date,N),this.doNotify(`Saving ${S.title} in ${m.date}`,"info","bottom")}else R[E]={duration:S.duration,time:s,notes:`Alt replace for '${n}'`}}),this.daSchedule.updateDaySchedule(b.date,R)},d=y=>{this.daSchedule.removeScheduledEvt(i);let b=t.find(R=>R.id==y);console.log("remReplace...Add at:",s,b.title,"usually at:"+b.time);let m=this.daSchedule.addGoalsToSchedule([{...b,time:s,notes:`Alt replace for '${n}'`}],!0),C=Object.keys(m).length;if(C>0)return console.log(`chooseAlternatives::removeReplace:: OVERLAPS again from ${b.length} overlaps =${C}`,b,m),this.doNotify(`Extra Overlaps while adding ${b[0].title.trim()}`,"negative"),this.handleOverlaps(m,"alts");this.daSchedule.saveDaySchedule(),this.doNotify(`Added Alt replacement '${b==null?void 0:b.title}' at ${s}`,"info")},v=y=>{this.doNotify(y)};if(t=r(t),t.length==0){v("Removing not allowed! Alternatives already present!");return}this.checkBoxDialog("Gotta pick alternative!","Select the first Evt to replace Removed + an Extra evt for next day (today)!",t.map(y=>this.betterEvtLabel(y,"default",!1)),t[0].id,function(y){console.log("chooseAlternatives::opt",y),d(y.shift()),y.length>0?h(y):(console.log("chooseAlternatives::onOk...nothing to add?!?",t.length,y.length,t.length-y.length),v("No Alternative scheduled later :("))},function(){console.log("chooseAlternatives::onCancel")})},reset(){this.selectedItem=null,this.targetDrop=null,this.touchedItem=null,this.daSchedule.resetChosen(),this.possibleRange=null},closingDialog(){this.showEvtDialog=!1},onPrev(){let i=()=>{this.$refs.calendar.prev()},e=()=>{setTimeout(i,1e3),this.doSaveSchedule()};this.saveScheduleDisabled?i():this.confirmAction("",`Save day: ${this.currentDate} changes?`,"Save",e,i)},onToday(){let i=()=>{this.$refs.calendar.moveToToday()},e=()=>{setTimeout(i,1e3),this.doSaveSchedule()};this.saveScheduleDisabled?i():this.confirmAction("",`Save day: ${this.currentDate} changes?`,"Save",e,i)},onNext(){let i=()=>{this.$refs.calendar.next()},e=()=>{setTimeout(i,1e3),this.doSaveSchedule()};this.saveScheduleDisabled?i():this.confirmAction("",`Save day: ${this.currentDate} changes?`,"Save",e,i)},onChange(){const i=t=>{setTimeout(()=>{let o=te(new Date);this.scrollToTime(o,t?"slow":"fast")},t?0:1e3)};let e=this.daSchedule.onChangeViewDate(this.currentDate);if(!e.canContinue){if(e.overlaps&&Object.keys(e.overlaps).length>0)return this.handleOverlaps(e.overlaps,"view");this.doNotify(`Loaded schedule for ${this.currentDate}`,"positive","bottom"),this.adjustCurrentTime()}i(e.canContinue)},onDragStart(i,e){if(this.daSchedule.isViewingPast()){this.doNotify("Editing past is no no!"),i.preventDefault();return}this.selectedItem=e},onDragEnter(i,e,t){if(e==="goal-item")i.preventDefault();else{if(this.targetDrop&&this.targetDrop.timestamp.time==t.timestamp.time)console.log("onDragEnter...calendar,SAME",this.targetDrop.timestamp.time);else{let o=i.target;o.style.background=this.selectedItem.bgcolor.includes("-")?"grey":this.selectedItem.bgcolor,this.lastTarget=o}this.targetDrop=t,i.preventDefault()}return!0},onDragOver(i,e,t){return i.preventDefault(),!0},onDragLeave(i,e,t){let o=i.target;return o.style.background="",!1},onDragEnd(i){},doCleanup(){this.lastTarget&&(this.lastTarget.style.background="",this.lastTarget=null)},onDrop(i,e,t){let o=this.daSchedule.findSchedEvent(this.selectedItem.id);if(!o){console.log("onDrop ERROR",o,this.selectedItem);return}let s=null;if(e==="interval")s=t.timestamp;else if(e==="goal-item"&&this.targetDrop)s=this.targetDrop.timestamp;else{console.log("Cannot drop here YO!!",i,e,t,this.targetDrop);return}if(!s){console.log("ERROR...no timestamp YO!!",i,e,t,this.targetDrop);return}this.doDroppy(s,this.selectedItem)},onClickTime(i){this.showEvtDialog=!0,this.targetDrop=i.scope},onClickDate(i){console.log("onClickDate",i)},onClickInterval(i){console.log("onClickInterval",i)},onClickHeadIntervals(i){console.log("onClickHeadIntervals",i)},onClickHeadDay(i){console.log("onClickHeadDay",i)},onMouseDownTime({scope:i,event:e}){if(Je(e)){if(this.mobile===!0&&this.anchorTimestamp!==null&&this.otherTimestamp!==null&&he(this.anchorTimestamp)===he(this.otherTimestamp)){this.otherTimestamp=i.timestamp,this.mouseDown=!1;return}this.mouseDown=!0,this.anchorTimestamp=i.timestamp,this.otherTimestamp=i.timestamp}},onMouseUpTime({scope:i,event:e}){if(this.mobile!==!0&&Je(e)&&(this.otherTimestamp=i.timestamp,this.mouseDown=!1),!this.mousedown){let t=this.startEndTimes;if(t[1]==t[0])return;this.possibleRange=t,console.log("onMouseUpTime range change",this.possibleRange)}},onMouseMoveTime({scope:i,event:e}){this.mobile!==!0&&this.mouseDown===!0&&(this.otherTimestamp=i.timestamp)},onDblClickEvent(i,e){if(this.isViewingPast()){if(console.log("onDblClickEvent::ERROR?",e),e.duration<30){console.log("onDblClickEvent..baah too smoll smoll",e.title,e.duration),this.doNotify("umm Removing from the past..Soo Check BALANCE!"),this.daSchedule.addToBalance(e),this.daSchedule.removeScheduledEvt(e);return}this.chooseAlternatives(e),i.preventDefault();return}this.removeEvtInSchedule(e,!1),i.preventDefault()},onTouchStart(i,e){if(i.type=="touchstart"){this.selectedItem=e;let t=document.elementFromPoint(i.changedTouches[0].clientX,i.changedTouches[0].clientY);if(t.parentNode.classList.contains("my-event"))t.parentNode.classList.add("my-event-drag"),this.touchedItem=t;else if(t.closest(".my-event"),t=t.parentNode,t.parentNode.classList.contains("my-event"))t.parentNode.classList.add("my-event-drag"),this.touchedItem=t;else{this.touchedItem=!1;return}return i.preventDefault(),!0}console.log("onTouchStart::ERROR...UNKNOWN",i)},onTouchEvt(i,e){const t=s=>{let l=s.split(" "),n=l[l.length-2],r=M(K(this.currentDate),{minute:z(n)});return l[l.length-1]=="PM"?r.hour==12?r:M(K(this.currentDate),{hour:12,minute:z(n)}):r.hour==12?M(K(this.currentDate),{hour:-12,minute:z(n)}):r};let o=s=>{let l=s.closest(".my-event");l.classList.contains("my-event-drag")&&l.classList.toggle("my-event-drag")};if(this.selectedItem||(console.log("onTouchEvt NULL Item >>ERROR?!? "+i.type,this.selectedItem,this.touchedItem),e=this.selectedItem),this.isViewingPast()){this.doNotify("Editing past is no no!"),o(this.touchedItem),i.preventDefault(),i.stopPropagation();return}if(i.type=="touchmove"){let s=document.elementFromPoint(i.changedTouches[0].clientX,i.changedTouches[0].clientY);if(s.ariaLabel){let l=t(s.ariaLabel);if(this.targetDrop){let n=ee(this.targetDrop,l);if(JSON.stringify(this.targetDrop)===JSON.stringify(l)&&n==0)return;this.lastTarget?(this.lastTarget.style.background="",s.style.background=this.selectedItem.bgcolor.includes("-")?"grey":this.selectedItem.bgcolor,this.lastTarget=s):(this.lastTarget=s,s.style.background=this.selectedItem.bgcolor.includes("-")?"grey":this.selectedItem.bgcolor)}this.targetDrop=l,i.preventDefault();return}return}if(i.type=="touchend"){let s=document.elementFromPoint(i.changedTouches[0].clientX,i.changedTouches[0].clientY);if(!this.touchedItem)return;if(s.parentNode.classList.contains("my-event-drag"))console.log("onTouchEvt::END >>removing my-event-drag","isDisabledScoreEdit>> "+this.daSchedule.isDisabledScoreEdit[e.id],"mobileEnableScore>> "+this.daSchedule.mobileEnableScore[e.id]),s.parentNode.classList.remove("my-event-drag");else{let l=this.touchedItem.parentNode.classList.contains("my-event-drag");l?this.touchedItem.parentNode.classList.remove("my-event-drag"):console.log("onTouchEvt::END...target NO my-event-drag?",l,s,s.parentNode)}if(s.ariaLabel){let l=t(s.ariaLabel);this.targetDrop=l,this.doDroppy(this.targetDrop,this.selectedItem)}else(s.classList.contains("title")||s.classList.contains("my-event"))&&this.targetDrop&&this.doDroppy(this.targetDrop,this.selectedItem);i.preventDefault(),i.stopPropagation();return}console.log("onTouchEvt::UNKNOWN",i)},onTouchHold({evt:i,...e},t){if(!this.mobile)return console.log("onTouchHold>>NOT MOBILE",i.type,"mobileEnableScore>> "+this.daSchedule.mobileEnableScore[t.id]),!0;let o=document.elementFromPoint(i.changedTouches[0].clientX,i.changedTouches[0].clientY);this.daSchedule.toggleEvtNoteScoreMobile(t.id);let s=o.closest(".my-event");o.classList.contains("title")&&o.parentNode.classList.contains("my-event-drag")?(console.log("onTouchHold...REMOVING my-event-drag"),o.parentNode.classList.remove("my-event-drag")):s&&s.classList.contains("my-event-drag")?s.classList.toggle("my-event-drag"):this.touchedItem&&(s=this.touchedItem.closest(".my-event"),s&&s.classList.contains("my-event-drag")?s.classList.toggle("my-event-drag"):console.log("ERROR...onTouchHold--class not found on Target!!",o,this.touchedItem)),this.daSchedule.isDisabledScoreEdit[t.id]&&!this.daSchedule.mobileEnableScore[t.id]&&this.onDblClickEvent(i,t)},scrollToEvent(i){this.$refs.calendar.scrollToTime(i.time,350)},scrollToTime(i,e=null){var t;if(this.$refs.calendar){let o=M(i,{minute:-30});(t=this.$refs.calendar)==null||t.scrollToTime(o.time,e?e=="fast"?400:1e3:500)}else setTimeout(()=>{let o=te(new Date);console.log("scrollToTime::NO SCROLLY at",i.time,"Now going to: "+o.time),this.scrollToTime(o,"slow")},1e3)},confirmTimeChange(i,e,t,o,s,l,n=null){this.$q.dialog({title:i,message:e,cancel:!1,ok:t,options:{type:"radio",model:"",items:[{label:t+" and "+o,value:"ok"},{label:o,value:"alt"}]},class:"overflow-wrap: break-word;",style:""}).onOk(r=>{if(r==""){console.log("confirmTimeChange onOk with no selection >>onDismiss"),this.doNotify("No selection made...Leaving as is","info"),n?n():console.log("confirmTimeChange:: No Dismiss func to execute!");return}return s(r)}).onCancel(()=>{l()})},radioChoiceDialog(i,e,t,o,s=null,l=null,n=null){this.$q.dialog({title:i,cancel:!!l,persistent:!0,message:e,seamless:!0,options:{type:"radio",model:o,items:t}}).onOk(r=>{s&&(r==""?this.radioChoiceDialog(i,e,t,o,s,l,n):s(r))}).onCancel(()=>{l&&l()}).onDismiss(()=>{n&&n()})},checkBoxDialog(i,e,t,o,s=null,l=null,n=null){let r=t.length,h=r>2?2:r;this.$q.dialog({title:i,message:e,options:{type:"checkbox",model:[],isValid:d=>d.length>0&&d.length>=h,items:t},cancel:!0,persistent:!0}).onOk(d=>{s(d)}).onCancel(()=>{l&&l()}).onDismiss(()=>{n&&n()})},confirmAction(i,e,t,o,s,l=null){this.$q.dialog({title:i,cancel:!0,ok:t,message:e}).onOk(()=>{o()}).onCancel(()=>{s()}).onDismiss(()=>{if(l){l();return}})},doNotifyTimeout(i,e=void 0,t="top",o=null){this.$q.notify({color:e!==void 0?e:"negative",position:t,message:i,icon:e==null?"report_problem":"thumb_up",timeout:o||5e3,multiLine:!0})},doNotify(i,e=void 0,t="top"){this.$q.notify({color:e!==void 0?e:"negative",position:t,message:i,multiLine:!0,icon:e==null?"report_problem":"thumb_up"})},withDismissNotify(i,e=void 0,t="top",o=null,s=null){this.$q.notify({color:e!==void 0?e:"negative",position:t,message:i,icon:e==null?"report_problem":"thumb_up",timeout:o!=null?o:5e3,closeBtn:"Okey",onDismiss:s})}}},De=i=>(ut("data-v-340f0e76"),i=i(),ft(),i),Ft={class:"subcontent"},jt={class:"q-px-md boxy"},Ut={key:0},Ht={key:1},zt={key:2},qt={key:3},Jt={key:4},Wt={key:5},Qt={class:"row justify-center"},Kt=De(()=>V("br",null,null,-1)),Yt=De(()=>V("br",null,null,-1)),Xt={key:0,class:"q-pa-sm bg-grey-12",style:{"max-width":"400px"}},Zt={class:"q-pa-sm row justify-center"},ei={class:"row justify-center"},ti=De(()=>V("br",null,null,-1)),ii={key:0,class:"q-gutter-md"},oi={class:"q-mr-sm text-weight-bold",size:"28px"},si={key:0},li={class:"text-weight-bold"},ni={key:1,class:"text-weight-light text-black"},ri={key:1,class:"q-pa-md q-gutter-sm bg-grey-12",style:{"max-width":"400px"}},ai={key:0,class:"q-ma-xl column items-center instru"},di={key:1,class:"q-ma-xl column items-center instru"},hi={key:0,class:"row q-px-md"},ci={class:"row justify-center"},ui={class:"q-gutter-md",style:{display:"flex","max-width":"800px",width:"100%",height:"600px"}},fi={style:{display:"flex","justify-content":"center","flex-wrap":"wrap",padding:"2px"}},gi={class:"heady q-calendar__ellipsis"},mi=["onDblclick","onDragstart","onTouchstart","onTouchmove","onTouchend"],Si=De(()=>V("br",null,null,-1));function pi(i,e,t,o,s,l){const n=ie("sched-btn"),r=ie("drop-dwn-btn"),h=ie("navigation-bar"),d=ie("goaly-end"),v=ie("mobileNoteScore"),y=ie("q-calendar-day"),b=ie("sched-dialog");return _(),X(Dt,{padding:""},{default:$(()=>[V("div",Ft,[P(Fe,{modelValue:s.splitterPage,"onUpdate:modelValue":e[9]||(e[9]=m=>s.splitterPage=m),limits:[30,70]},{before:$(()=>[P(Fe,{modelValue:s.splitterLegend,"onUpdate:modelValue":e[3]||(e[3]=m=>s.splitterLegend=m),horizontal:"",limits:[20,80],style:{height:"100%"}},{before:$(()=>[V("div",jt,[s.daSchedule.getProps().showReloadBtn?(_(),I("div",Ut,[P(n,{"text-label":"Reload",class:"sched-btn","text-color":"green",onDoBtnAction:l.onReloadSaved},null,8,["onDoBtnAction"])])):x("",!0),s.daSchedule.getProps().showClearBtn?(_(),I("div",Ht,[P(n,{"text-label":"Clear",class:"sched-btn","text-color":"lime-5",onDoBtnAction:l.onClearDay},null,8,["onDoBtnAction"])])):x("",!0),l.showDefaultBtn?(_(),I("div",zt,[P(n,{textLabel:l.defaultLabels,class:"sched-btn","text-color":"blue",onDoBtnAction:l.onLoadDefault},null,8,["textLabel","onDoBtnAction"])])):x("",!0),s.daSchedule.getProps().showScoreBtn?(_(),I("div",qt,[P(r,{class:"sched-drop-btn","text-color":"teal",disableBtn:s.daSchedule.disableScoreBtn,optionLabel:l.chosenScoreLabel,daOptions:s.scoreOptions,onDoReload:l.doReloadWithScore,onChooseOption:l.onChoosenScore},null,8,["disableBtn","optionLabel","daOptions","onDoReload","onChooseOption"])])):x("",!0),s.daSchedule.getProps().showPrioBtn?(_(),I("div",Jt,[P(r,{class:"sched-drop-btn","text-color":"teal",disableBtn:s.daSchedule.getProps().disablePrioBtn,optionLabel:l.chosenPrioLabel,daOptions:l.allMainGPrio(),onDoReload:l.doReloadWithPrio,onChooseOption:l.onChoosenPrio},null,8,["disableBtn","optionLabel","daOptions","onDoReload","onChooseOption"])])):x("",!0),s.daSchedule.getProps().showOneEachBtn?(_(),I("div",Wt,[P(n,{"text-label":"One Each",class:"sched-btn","text-color":"brown",onDoBtnAction:l.onScheduleOneEach},null,8,["onDoBtnAction"])])):x("",!0)]),V("div",Qt,[P(xe,{class:"q-mt-md","text-color":l.saveScheduleDisabled?"grey":"blue",elevated:"",push:"",align:"evenly",label:"SaveSchedule",disable:l.saveScheduleDisabled,onClick:l.doSaveSchedule,"no-caps":""},null,8,["text-color","disable","onClick"]),P(xe,{class:"q-mt-md","text-color":"green",elevated:"",push:"",align:"evenly",label:s.showTree?"HideTree":"ShowTree",onClick:e[0]||(e[0]=m=>s.showTree=!s.showTree),"no-caps":""},null,8,["label"])]),Kt]),after:$(()=>[Yt,s.treeGoals.length>0?(_(),I("div",Xt,[V("div",Zt,Q(l.labelGoals("s")),1),V("div",ei,[P(Oe,{color:"secondary","multi-line":""},{default:$(()=>[j(Q(l.labelGoals("b"))+" mins ",1)]),_:1})]),P(oe),ti,l.showTreeForm?(_(),I("div",ii,[P(yt,{label:"'je-suis'",hint:"Keyword >> Enter","hide-hint":"",ref:"filterRef",modelValue:s.filter,"onUpdate:modelValue":e[1]||(e[1]=m=>s.filter=m),"use-input":"","use-chips":"",multiple:"",disable:l.isViewingPast(),"hide-dropdown-icon":"","input-debounce":"0","new-value-mode":"add-unique",class:"q-gutter-sm"},{"selected-item":$(m=>[P(vt,{removable:"",dense:"",onRemove:C=>m.removeAtIndex(m.index),tabindex:m.tabindex,"text-color":"black",class:"q-ma-none",style:{width:"80px"}},{default:$(()=>[j(Q(m.opt),1)]),_:2},1032,["onRemove","tabindex"])]),append:$(()=>[s.filter.length>0?(_(),X(Re,{key:0,name:"clear",class:"cursor-pointer",onClick:l.resetFilter},null,8,["onClick"])):x("",!0)]),_:1},8,["modelValue","disable"]),P(Tt,{nodes:s.treeGoals,"node-key":"label",filter:l.filterString,"filter-method":l.myFilterMethod,expanded:s.expanded,"onUpdate:expanded":e[2]||(e[2]=m=>s.expanded=m),"no-connectors":"",dense:""},{"default-header":$(m=>[V("div",{class:be(l.classyColor(m.node))},[m.node.isChildren?x("",!0):(_(),X(Re,{key:0,name:m.expanded?"expand_less":"expand_more",size:"28px",right:""},null,8,["name"])),V("div",oi,Q(m.node.label),1),P(Re,{name:m.node.icon},null,8,["name"])],2)]),"default-body":$(m=>[m.node.isChildren?(_(),I("div",si,[V("span",li," >> "+Q(m.node.details),1),m.node.moods.length>0?(_(),X(_e,{key:0},{default:$(()=>[j(Q("Moods::> "+m.node.moods.join(",")),1)]),_:2},1024)):x("",!0)])):(_(),I("span",ni,Q(m.node.details),1))]),_:1},8,["nodes","filter","filter-method","expanded"])])):x("",!0),s.filter.length>0?(_(),I("div",ri,[P(n,{"text-label":"Add Mood Evts",class:"q-mt-xl sched-btn","text-color":"red",onDoBtnAction:l.onMoodAdd},null,8,["onDoBtnAction"])])):x("",!0)])):x("",!0)]),_:1},8,["modelValue"]),l.showRemInstru?(_(),I("div",ai,[P(Z,null,{default:$(()=>[j(" Double click upcoming evt to remove it ")]),_:1}),P(oe),P(Z,null,{default:$(()=>[j(" For mobile, Long press hold to remove or start drag ")]),_:1}),P(oe),P(Z,null,{default:$(()=>[j(" Can also add note to a finished evt or remove it ")]),_:1}),P(oe),P(Z,null,{default:$(()=>[j(" Click on time intervals to add events to schedule ")]),_:1}),P(oe),P(Z,null,{default:$(()=>[j(" ShowTree to filter goals by mood keywords. ")]),_:1})])):x("",!0),l.showSchedInstru?(_(),I("div",di,[P(Z,null,{default:$(()=>[j(" Use above Scheduling buttons to add events to schedule ")]),_:1}),P(oe),P(Z,null,{default:$(()=>[j(" Can also use mood keyworks to filter/add associated goals. ")]),_:1}),P(oe),P(Z,null,{default:$(()=>[j(" Click on time intervals to add events to schedule ")]),_:1})])):x("",!0)]),separator:$(()=>[P(ht,{color:"primary",class:"q-px-md","text-color":"white",size:"40px",icon:"drag_indicator",style:{position:"relative",top:"70%"}})]),after:$(()=>[P(h,{onToday:l.onToday,onPrev:l.onPrev,onNext:l.onNext},null,8,["onToday","onPrev","onNext"]),l.scheduleMoodsLabel?(_(),I("div",hi,[j(" By moods: "),(_(!0),I(ae,null,Ne(l.scheduleMoodsLabel,(m,C)=>(_(),X(Oe,{key:C,color:m.color,"multi-line":"",rounded:""},{default:$(()=>[j(Q(m.m),1)]),_:2},1032,["color"]))),128))])):x("",!0),V("div",ci,[V("div",ui,[P(y,{ref:"calendar",view:"day",modelValue:s.currentDate,"onUpdate:modelValue":e[8]||(e[8]=m=>s.currentDate=m),"drag-enter-func":l.onDragEnter,"drag-over-func":l.onDragOver,"drag-leave-func":l.onDragLeave,"drop-func":l.onDrop,animated:"",bordered:"",hoverable:"","no-active-date":"","transition-next":"slide-left","transition-prev":"slide-right","time-clicks-clamped":"","interval-minutes":15,"interval-count":96,"interval-height":28,"selected-start-end-dates":l.startEndTimes,onChange:l.onChange,onClickDate:l.onClickDate,onClickTime:l.onClickTime,onClickInterval:l.onClickInterval,onClickHeadIntervals:l.onClickHeadIntervals,onClickHeadDay:l.onClickHeadDay,onMousedownTime:l.onMouseDownTime,onMouseupTime:l.onMouseUpTime,onMousemoveTime:l.onMouseMoveTime},{"head-day-event":$(({scope:{timestamp:m}})=>[V("div",fi,[(_(!0),I(ae,null,Ne(l.eventsMap[m.date],C=>(_(),I(ae,{key:C.id},[C.time?(_(),X(Oe,{key:1,class:be(l.badgeClasses(C,"header")),style:me([l.badgeStyles(C,"header"),{margin:"1px",width:"10px","max-width":"10px",height:"10px","max-height":"10px",cursor:"pointer"}]),onClick:R=>l.scrollToEvent(C)},{default:$(()=>[P(_e,null,{default:$(()=>[j(Q("("+C.id+") "+C.title+" - "+C.time+" ("+C.duration+"min) >> "+C.end.time),1)]),_:2},1024)]),_:2},1032,["class","style","onClick"])):(_(),X(Oe,{key:0,class:be(l.badgeClasses(C,"header")),style:me([l.badgeStyles(C,"header"),{width:"100%",cursor:"pointer",height:"12px","font-size":"10px",margin:"1px"}])},{default:$(()=>[V("div",gi,[j(Q(C.title)+" ",1),P(_e,null,{default:$(()=>[j(Q(C.details),1)]),_:2},1024)])]),_:2},1032,["class","style"]))],64))),128))])]),"day-container":$(({scope:{days:m}})=>[l.hasDate(m)?(_(),I(ae,{key:0},[V("div",{class:"day-view-current-time-indicator",style:me(l.style)},null,4),V("div",{class:"day-view-current-time-line",style:me(l.style)},null,4)],64)):x("",!0)]),"day-body":$(({scope:{timestamp:m,timeStartPos:C,timeDurationHeight:R}})=>[(_(!0),I(ae,null,Ne(l.getDateEvents(m.date),S=>(_(),I(ae,{key:S.id},[S.time!==void 0?(_(),I("div",{key:0,class:be(["my-event",l.badgeClasses(S,"body")]),style:me(l.badgeStyles(S,"body",C,R)),draggable:!0,onDblclick:Pe(E=>l.onDblClickEvent(E,S),["prevent"]),onDragstart:Pe(E=>l.onDragStart(E,S),["stop"]),onDragend:e[4]||(e[4]=Pe((...E)=>l.onDragEnd&&l.onDragEnd(...E),["stop"])),onDrop:e[5]||(e[5]=E=>l.onDrop(E,"goal-item",i.scope)),onDragenter:e[6]||(e[6]=E=>l.onDragEnter(E,"goal-item",i.scope)),onDragover:e[7]||(e[7]=E=>l.onDragOver(E,"goal-item",i.scope)),onTouchstart:E=>l.onTouchStart(E,S),onTouchmove:E=>l.onTouchEvt(E,S),onTouchend:E=>l.onTouchEvt(E,S)},[ct(P(d,{disabledScore:s.daSchedule.isDisabledScoreEdit[S.id],title:S.title,id:S.id,startTime:S.time,score:S.score,details:S.details,notes:S.notes,icon:S.icon,happeningNow:s.daSchedule.hasStarted[S.id]?s.daSchedule.hasStarted[S.id]:!1,onEndNow:l.onEndNow,onSaveScore:l.onSaveScore,onAddMins:l.onAddMins,onDeleteNow:E=>l.removeEvtInSchedule(S)},null,8,["disabledScore","title","id","startTime","score","details","notes","icon","happeningNow","onEndNow","onSaveScore","onAddMins","onDeleteNow"]),[[wt,E=>l.onTouchHold(E,S),"400:12:15"]]),l.showEvtMobile(S.id)?(_(),X(v,{key:0,title:S.title,id:S.id,startTime:S.time,score:S.score,details:S.details,notes:S.notes,"show-dialog":l.showEvtMobile(S.id),onSaveScore:l.onSaveScore,onDeleteNow:E=>l.removeEvtInSchedule(S),onEuhHidin:E=>s.daSchedule.euhHidin(S.id)},null,8,["title","id","startTime","score","details","notes","show-dialog","onSaveScore","onDeleteNow","onEuhHidin"])):x("",!0)],46,mi)):x("",!0)],64))),128))]),_:1},8,["modelValue","drag-enter-func","drag-over-func","drag-leave-func","drop-func","selected-start-end-dates","onChange","onClickDate","onClickTime","onClickInterval","onClickHeadIntervals","onClickHeadDay","onMousedownTime","onMouseupTime","onMousemoveTime"])])]),Si]),_:1},8,["modelValue"]),s.showEvtDialog?(_(),X(b,{key:0,parentGoals:s.daSchedule.allPGoals(),canBeScheduled:l.canbeScheduled,balance:l.currentBalance,onAdHocEvent:l.onAddHocEvent,onOnPickEvent:l.onPickEvent,onEuhHidin:l.closingDialog},null,8,["parentGoals","canBeScheduled","balance","onAdHocEvent","onOnPickEvent","onEuhHidin"])):x("",!0)])]),_:1})}var Ri=dt(Vt,[["render",pi],["__scopeId","data-v-340f0e76"]]);export{Ri as default};
