import{a as z,b as F,Q as D,c as E}from"./utiFunc.b06fb4df.js";import{j as R,q,s as v,c as H,h as j,k as K,g as U,u as W,x as L,_ as O,d as A,r as C,E as V,F as r,G as _,H as d,I as c,K as i,M as p,N,O as b,Q as $,P as J,R as w,S as X,U as G,V as m,W as I,J as x,X as Y,Y as Z}from"./index.ed91736f.js";import{N as ee,t as te,p as ae,a as f,b as S,c as M,i as P,Q as se}from"./NavigationBar.7dbb5d42.js";import{u as oe,Q as le}from"./goalStorage.fc25f56a.js";import{Q as ne}from"./QCalendar.d4adcec0.js";import"./use-quasar.7a505cb4.js";var ie=R({name:"QPage",props:{padding:Boolean,styleFn:Function},setup(e,{slots:t}){const{proxy:{$q:s}}=U(),o=q(W,v);if(o===v)return console.error("QPage needs to be a deep child of QLayout"),v;if(q(L,v)===v)return console.error("QPage needs to be child of QPageContainer"),v;const g=H(()=>{const n=(o.header.space===!0?o.header.size:0)+(o.footer.space===!0?o.footer.size:0);if(typeof e.styleFn=="function"){const a=o.isContainer.value===!0?o.containerHeight.value:s.screen.height;return e.styleFn(n,a)}return{minHeight:o.isContainer.value===!0?o.containerHeight.value-n+"px":s.screen.height===0?n!==0?`calc(100vh - ${n}px)`:"100vh":s.screen.height-n+"px"}}),y=H(()=>`q-page${e.padding===!0?" q-layout-padding":""}`);return()=>j("main",{class:y.value,style:g.value},K(t.default))}});const re=A({name:"weekCalendar",components:{NavigationBar:ee,QCalendar:ne},data(){return{store:oe(),calendar:C(null),currentDate:C(te()),events:[],mostEvts:5,treeGoals:C([]),expanded:C([]),splitterModel:C(70)}},beforeMount(){this.loadEvts(),this.constructTree()},mounted(){console.log("mounted")},computed:{storedGoalsMap(){const e=new Map;let t=this.store.getSubGoals;return t?(t.forEach(s=>{e.set(s.id,s)}),e):(console.log("GoalsMap is empty or null",t),e)},allEvents(){return this.store.getAllDates},parentGoalsMap(){const e=new Map;let t=this.store.getMainGoals;return t?(t.forEach(s=>{e.set(s.id,s)}),e):(console.log("parentGoalsMap is empty or null",t),e)},storedEvents(){return this.store.getSubGoals},eventsMap(){const e={};return this.events.forEach(t=>{if(e[t.date]||(e[t.date]=[]),e[t.date].push(t),t.days){console.log(`eventsMap multiple days? event for ${t.date}`,t.days);let s=ae(t.date),o=t.days;do s=f(s,{day:1}),e[s.date]||(e[s.date]=[]),e[s.date].push(t);while(--o>0)}}),e}},methods:{classyColor(e){return`row items-center ${e.isChildren?"text-":"text-white bg-"}${e.color} `},loadEvts(){var o,h,g;let e=this.parentGoalsMap,t=this.storedGoalsMap,s=this.allEvents;if(t&&e){if(s)for(let y in s){let n=s[y];for(let a in n){let l=t.get(parseInt(a));if(l){let k=e.get(l.parentGoal),u=f(M(y),{minute:S(n[a].time)}),Q=f(u,{minute:parseInt(n[a].duration)}),T="";n[a].notes!==void 0&&((o=n[a])==null?void 0:o.notes)!==""?T=[`${u.time} - ${Q.time}`,`${(h=n[a])==null?void 0:h.atScore} >> ${l.score}`,`${(g=n[a])==null?void 0:g.notes}`].join(`
\r`):T=`${u.time} - ${Q.time}`,this.events.push({id:l.id,title:l.title,details:T,time:n[a].time,duration:n[a].duration,date:y,bgcolor:k.bgcolor})}}}}else{console.log("ERROR--no parent or goals!!REVIEW**");return}},constructTree(){this.treeGoals=this.store.fetchGoalsTree()},getEvents(e){const t=this.eventsMap[e]||[];if(t.length===1)t[0].side="full";else if(t.length===2){const s=f(M(t[0].date),{minute:S(t[0].time)}),o=f(s,{minute:t[0].duration}),h=f(M(t[1].date),{minute:S(t[1].time)}),g=f(h,{minute:t[1].duration});P(h,s,o,!0)||P(g,s,o,!0)?(t[0].side="left",t[1].side="right"):(t[0].side="full",t[1].side="full")}return t.length>this.mostEvts&&(this.mostEvts=t.length),t},badgeClasses(e,t){return z(e,t)},badgeStyles(e,t,s=void 0,o=void 0){return F(e,t,s,o)},scrollToEvent(e){this.$refs.calendar.scrollToTime(e.time,350)},onToday(){this.$refs.calendar.moveToToday()},onPrev(){this.doReset=!0,this.$refs.calendar.prev()},onNext(){this.$refs.calendar.next()},onClickDate(e){console.log("onClickDate",e)},onClickTime(e){console.log("onClickTime",e)},onClickInterval(e){console.log("onClickInterval",e)},onClickHeadIntervals(e){console.log("onClickHeadIntervals",e)},onClickHeadDay(e){console.log("onClickHeadDay",e)},onChange(e){this.mostEvts=5,console.log("onChange",e)}}}),B=e=>(Y("data-v-51a924d0"),e=e(),Z(),e),de={class:"q-pa-md"},ce={class:"row justify-center"},ue={style:{display:"flex","max-width":"800px",width:"100%",height:"400px",overflow:"auto"}},pe={style:{display:"flex","justify-content":"center","flex-wrap":"wrap",padding:"2px"}},me={class:"title q-calendar__ellipsis"},he={class:"title q-calendar__ellipsis"},ge={class:"lineyy"},ye={class:"row justify-center items-center"},fe={class:"q-pa-md"},ve={key:0,class:"q-pa-md bg-grey-12",style:{"max-width":"400px"}},Ce=B(()=>i("div",{class:"row justify-center"}," Goals & Goal Events ",-1)),ke=B(()=>i("br",null,null,-1)),_e={class:"q-mr-sm text-weight-bold",size:"28px"},be={key:0},we={class:"text-weight-bold liney"},xe={key:1,class:"text-weight-light text-black liney"};function Te(e,t,s,o,h,g){const y=V("navigation-bar"),n=V("q-calendar");return r(),_(ie,null,{default:d(()=>[c(le,{modelValue:e.splitterModel,"onUpdate:modelValue":t[2]||(t[2]=a=>e.splitterModel=a),limits:[50,100],style:{height:"600px"}},{before:d(()=>[i("div",de,[c(y,{onToday:e.onToday,onPrev:e.onPrev,onNext:e.onNext},null,8,["onToday","onPrev","onNext"]),i("div",ce,[i("div",ue,[c(n,{ref:"calendar",modelValue:e.currentDate,"onUpdate:modelValue":t[0]||(t[0]=a=>e.currentDate=a),view:"week",dark:"",animated:"",hoverable:"",bordered:"","transition-prev":"slide-right","transition-next":"slide-left","no-active-date":"","interval-minutes":30,"interval-count":48,"interval-height":e.mostEvts*3,onChange:e.onChange,onClickDate:e.onClickDate,onClickTime:e.onClickTime,onClickInterval:e.onClickInterval,onClickHeadIntervals:e.onClickHeadIntervals,onClickHeadDay:e.onClickHeadDay},{"head-day-event":d(({scope:{timestamp:a}})=>[i("div",pe,[(r(!0),p(b,null,N(e.eventsMap[a.date],l=>(r(),p(b,{key:l.id},[l.time?(r(),_(D,{key:1,class:w(e.badgeClasses(l,"header")),style:I([e.badgeStyles(l,"header"),{margin:"1px",width:"10px","max-width":"10px",height:"10px","max-height":"10px",cursor:"pointer"}]),onClick:k=>e.scrollToEvent(l)},{default:d(()=>[c(E,null,{default:d(()=>[x(m(l.time+" - "+l.title),1)]),_:2},1024)]),_:2},1032,["class","style","onClick"])):(r(),_(D,{key:0,class:w(e.badgeClasses(l,"header")),style:I([e.badgeStyles(l,"header"),{width:"100%",cursor:"pointer",height:"12px","font-size":"10px",margin:"1px"}])},{default:d(()=>[i("div",me,[x(m(l.title)+" ",1),c(E,null,{default:d(()=>[x(m(l.details),1)]),_:2},1024)])]),_:2},1032,["class","style"]))],64))),128))])]),"day-body":d(({scope:{timestamp:a,timeStartPos:l,timeDurationHeight:k}})=>[(r(!0),p(b,null,N(e.getEvents(a.date),u=>(r(),p(b,{key:u.id},[u.time!==void 0?(r(),p("div",{key:0,class:w(["my-event",e.badgeClasses(u,"body")]),style:I(e.badgeStyles(u,"body",l,k))},[i("span",he,[x(m(u.title)+" ",1),c(E,null,{default:d(()=>[i("div",ge,m(u.details),1)]),_:2},1024)])],6)):G("",!0)],64))),128))]),_:1},8,["modelValue","interval-height","onChange","onClickDate","onClickTime","onClickInterval","onClickHeadIntervals","onClickHeadDay"])])]),i("div",ye,[c($,{class:"q-ma-xl",color:"white","text-color":"blue",unelevated:"",to:"/summary",label:"Summary","no-caps":""}),c($,{class:"q-ma-xl",color:"white","text-color":"blue",unelevated:"",to:"/dayCalendar",label:"Daily Calendar","no-caps":""}),c($,{class:"q-ma-xl",color:"white","text-color":"blue",unelevated:"",to:"/viewGoals",label:"Goals","no-caps":""})])])]),after:d(()=>[i("div",fe,[e.treeGoals.length>0?(r(),p("div",ve,[Ce,c(J),ke,c(se,{nodes:e.treeGoals,"node-key":"label",expanded:e.expanded,"onUpdate:expanded":t[1]||(t[1]=a=>e.expanded=a),"no-connectors":"",dense:"",accordion:""},{"default-header":d(a=>[i("div",{class:w(e.classyColor(a.node))},[a.node.isChildren?G("",!0):(r(),_(X,{key:0,name:a.node.icon||a.expanded?"expand_less":"expand_more",size:"28px",class:"q-mr-sm"},null,8,["name"])),i("div",_e,m(a.node.label),1)],2)]),"default-body":d(a=>[a.node.isChildren?(r(),p("div",be,[i("span",we," >> "+m(a.node.details),1)])):(r(),p("span",xe,m(a.node.details),1))]),_:1},8,["nodes","expanded"])])):G("",!0)])]),_:1},8,["modelValue"])]),_:1})}var Qe=O(re,[["render",Te],["__scopeId","data-v-51a924d0"]]);export{Qe as default};
