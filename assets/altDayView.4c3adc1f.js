import{j as ni,U as si,W as ri,r as _,c as Me,w as Rt,n as ai,h as Xe,k as ft,ay as di,D as hi,g as Ut,bs as ci,az as jt,ad as gt,v as ui,aA as fi,aa as Ze,aC as Nt,ab as mt,Z as gi,d as mi,_ as Jt,E as V,F as Y,G as x,H as B,M as W,K as le,a1 as lt,bt as Qt,bu as pi,a0 as Kt,I as Z,bv as nt,N as De,a3 as Ct,bq as yi,$ as ve,L as fe,bw as Si,bx as vi,O as ie,J as ae,Q as pt,a2 as et,aS as Ve,f as tt,R as Pe,P as yt,a5 as it,a4 as be,a6 as bi,a7 as Ti}from"./index.9748ecce.js";import{a as Ci}from"./QItem.403aef8d.js";import{T as Oi,Q as wi,a as Di}from"./QSelect.8047b427.js";import{d as St,a as Ei,u as Ri,Q as Ni,b as vt}from"./goalStorage.ac2b6df5.js";import{t as st,D as $t,b as ne,a as G,p as Q,d as se,T as Ee,i as Ot,U as $i,l as wt,k as Ae,c as Mt,Q as Mi}from"./QCalendarTask.8236f647.js";import{w as z,c as we,p as Pi,a as Ai,b as Bi,d as ki,Q as bt}from"./utiFunc.24f4e6b4.js";import{a as xi}from"./QCalendar.ee853910.js";import{i as Ii}from"./isMobile.6dd3b995.js";import"./touch.70a9dd44.js";var Pt=ni({name:"QSplitter",props:{...si,modelValue:{type:Number,required:!0},reverse:Boolean,unit:{type:String,default:"%",validator:i=>["%","px"].includes(i)},limits:{type:Array,validator:i=>i.length!==2||typeof i[0]!="number"||typeof i[1]!="number"?!1:i[0]>=0&&i[0]<=i[1]},emitImmediately:Boolean,horizontal:Boolean,disable:Boolean,beforeClass:[Array,String,Object],afterClass:[Array,String,Object],separatorClass:[Array,String,Object],separatorStyle:[Array,String,Object]},emits:["update:modelValue"],setup(i,{slots:e,emit:t}){const{proxy:{$q:l}}=Ut(),n=ri(i,l),o=_(null),s={before:_(null),after:_(null)},r=Me(()=>`q-splitter no-wrap ${i.horizontal===!0?"q-splitter--horizontal column":"q-splitter--vertical row"} q-splitter--${i.disable===!0?"disabled":"workable"}`+(n.value===!0?" q-splitter--dark":"")),a=Me(()=>i.horizontal===!0?"height":"width"),c=Me(()=>i.reverse!==!0?"before":"after"),m=Me(()=>i.limits!==void 0?i.limits:i.unit==="%"?[10,90]:[50,1/0]);function u(h){return(i.unit==="%"?h:Math.round(h))+i.unit}const D=Me(()=>({[c.value]:{[a.value]:u(i.modelValue)}}));let S,O,T,v,g;function b(h){if(h.isFirst===!0){const w=o.value.getBoundingClientRect()[a.value];S=i.horizontal===!0?"up":"left",O=i.unit==="%"?100:w,T=Math.min(O,m.value[1],Math.max(m.value[0],i.modelValue)),v=(i.reverse!==!0?1:-1)*(i.horizontal===!0?1:l.lang.rtl===!0?-1:1)*(i.unit==="%"?w===0?0:100/w:1),o.value.classList.add("q-splitter--active");return}if(h.isFinal===!0){g!==i.modelValue&&t("update:modelValue",g),o.value.classList.remove("q-splitter--active");return}const p=T+v*(h.direction===S?-1:1)*h.distance[i.horizontal===!0?"y":"x"];g=Math.min(O,m.value[1],Math.max(m.value[0],p)),s[c.value].value.style[a.value]=u(g),i.emitImmediately===!0&&i.modelValue!==g&&t("update:modelValue",g)}const d=Me(()=>[[Oi,b,void 0,{[i.horizontal===!0?"vertical":"horizontal"]:!0,prevent:!0,stop:!0,mouse:!0,mouseAllDir:!0}]]);function y(h,p){h<p[0]?t("update:modelValue",p[0]):h>p[1]&&t("update:modelValue",p[1])}return Rt(()=>i.modelValue,h=>{y(h,m.value)}),Rt(()=>i.limits,()=>{ai(()=>{y(i.modelValue,m.value)})}),()=>{const h=[Xe("div",{ref:s.before,class:["q-splitter__panel q-splitter__before"+(i.reverse===!0?" col":""),i.beforeClass],style:D.value.before},ft(e.before)),Xe("div",{class:["q-splitter__separator",i.separatorClass],style:i.separatorStyle,"aria-disabled":i.disable===!0?"true":void 0},[di("div",{class:"q-splitter__separator-area absolute-full"},ft(e.separator),"sep",i.disable!==!0,()=>d.value)]),Xe("div",{ref:s.after,class:["q-splitter__panel q-splitter__after"+(i.reverse===!0?"":" col"),i.afterClass],style:D.value.after},ft(e.after))];return Xe("div",{class:r.value,ref:o},hi(e.default,h))}}});let Li=0,qe;function At(i,e){qe===void 0&&(qe=document.createElement("div"),qe.style.cssText="position: absolute; left: 0; top: 0",document.body.appendChild(qe));const t=i.getBoundingClientRect(),l=qe.getBoundingClientRect(),{marginLeft:n,marginRight:o,marginTop:s,marginBottom:r}=window.getComputedStyle(i),a=parseInt(n,10)+parseInt(o,10),c=parseInt(s,10)+parseInt(r,10);return{left:t.left-l.left,top:t.top-l.top,width:t.right-t.left,height:t.bottom-t.top,widthM:t.right-t.left+(e===!0?0:a),heightM:t.bottom-t.top+(e===!0?0:c),marginH:e===!0?a:0,marginV:e===!0?c:0}}function ot(i){return{width:i.scrollWidth,height:i.scrollHeight}}const Bt=["Top","Right","Bottom","Left"],kt=["borderTopLeftRadius","borderTopRightRadius","borderBottomRightRadius","borderBottomLeftRadius"],_i=/-block|-inline|block-|inline-/,Fi=/(-block|-inline|block-|inline-).*:/;function xt(i,e){const t=window.getComputedStyle(i),l={};for(let n=0;n<e.length;n++){const o=e[n];if(t[o]==="")if(o==="cssText"){const s=t.length;let r="";for(let a=0;a<s;a++)_i.test(t[a])!==!0&&(r+=t[a]+": "+t[t[a]]+"; ");l[o]=r}else if(["borderWidth","borderStyle","borderColor"].indexOf(o)>-1){const s=o.replace("border","");let r="";for(let a=0;a<Bt.length;a++){const c="border"+Bt[a]+s;r+=t[c]+" "}l[o]=r}else if(o==="borderRadius"){let s="",r="";for(let a=0;a<kt.length;a++){const c=t[kt[a]].split(" ");s+=c[0]+" ",r+=(c[1]===void 0?c[0]:c[1])+" "}l[o]=s+"/ "+r}else l[o]=t[o];else o==="cssText"?l[o]=t[o].split(";").filter(s=>Fi.test(s)!==!0).join(";"):l[o]=t[o]}return l}const Gi=["absolute","fixed","relative","sticky"];function It(i){let e=i,t=0;for(;e!==null&&e!==document;){const{position:l,zIndex:n}=window.getComputedStyle(e),o=Number(n);o>t&&(e===i||Gi.includes(l)===!0)&&(t=o),e=e.parentNode}return t}function Vi(i){return{from:i.from,to:i.to!==void 0?i.to:i.from}}function qi(i){return typeof i=="number"?i={duration:i}:typeof i=="function"&&(i={onEnd:i}),{...i,waitFor:i.waitFor===void 0?0:i.waitFor,duration:isNaN(i.duration)===!0?300:parseInt(i.duration,10),easing:typeof i.easing=="string"&&i.easing.length>0?i.easing:"ease-in-out",delay:isNaN(i.delay)===!0?0:parseInt(i.delay,10),fill:typeof i.fill=="string"&&i.fill.length>0?i.fill:"none",resize:i.resize===!0,useCSS:i.useCSS===!0||i.usecss===!0,hideFromClone:i.hideFromClone===!0||i.hidefromclone===!0,keepToClone:i.keepToClone===!0||i.keeptoclone===!0,tween:i.tween===!0,tweenFromOpacity:isNaN(i.tweenFromOpacity)===!0?.6:parseFloat(i.tweenFromOpacity),tweenToOpacity:isNaN(i.tweenToOpacity)===!0?.5:parseFloat(i.tweenToOpacity)}}function Lt(i){const e=typeof i;return e==="function"?i():e==="string"?document.querySelector(i):i}function _t(i){return i&&i.ownerDocument===document&&i.parentNode!==null}function Hi(i){let e=()=>!1,t=!1,l=!0;const n=Vi(i),o=qi(i),s=Lt(n.from);if(_t(s)!==!0)return e;typeof s.qMorphCancel=="function"&&s.qMorphCancel();let r,a,c,m;const u=s.parentNode,D=s.nextElementSibling,S=At(s,o.resize),{width:O,height:T}=ot(u),{borderWidth:v,borderStyle:g,borderColor:b,borderRadius:d,backgroundColor:y,transform:h,position:p,cssText:w}=xt(s,["borderWidth","borderStyle","borderColor","borderRadius","backgroundColor","transform","position","cssText"]),E=s.classList.toString(),A=s.style.cssText,M=s.cloneNode(!0),N=o.tween===!0?s.cloneNode(!0):void 0;N!==void 0&&(N.className=N.classList.toString().split(" ").filter(C=>/^bg-/.test(C)===!1).join(" ")),o.hideFromClone===!0&&M.classList.add("q-morph--internal"),M.setAttribute("aria-hidden","true"),M.style.transition="none",M.style.animation="none",M.style.pointerEvents="none",u.insertBefore(M,D),s.qMorphCancel=()=>{t=!0,M.remove(),N!==void 0&&N.remove(),o.hideFromClone===!0&&M.classList.remove("q-morph--internal"),s.qMorphCancel=void 0};const ee=()=>{const C=Lt(n.to);if(t===!0||_t(C)!==!0){typeof s.qMorphCancel=="function"&&s.qMorphCancel();return}s!==C&&typeof C.qMorphCancel=="function"&&C.qMorphCancel(),o.keepToClone!==!0&&C.classList.add("q-morph--internal"),M.classList.add("q-morph--internal");const{width:Te,height:X}=ot(u),{width:Re,height:ge}=ot(C.parentNode);o.hideFromClone!==!0&&M.classList.remove("q-morph--internal"),C.qMorphCancel=()=>{t=!0,M.remove(),N!==void 0&&N.remove(),o.hideFromClone===!0&&M.classList.remove("q-morph--internal"),o.keepToClone!==!0&&C.classList.remove("q-morph--internal"),s.qMorphCancel=void 0,C.qMorphCancel=void 0};const He=()=>{if(t===!0){typeof C.qMorphCancel=="function"&&C.qMorphCancel();return}o.hideFromClone!==!0&&(M.classList.add("q-morph--internal"),M.innerHTML="",M.style.left=0,M.style.right="unset",M.style.top=0,M.style.bottom="unset",M.style.transform="none"),o.keepToClone!==!0&&C.classList.remove("q-morph--internal");const oe=C.parentNode,{width:Ce,height:de}=ot(oe),F=C.cloneNode(o.keepToClone);F.setAttribute("aria-hidden","true"),o.keepToClone!==!0&&(F.style.left=0,F.style.right="unset",F.style.top=0,F.style.bottom="unset",F.style.transform="none",F.style.pointerEvents="none"),F.classList.add("q-morph--internal");const R=C===s&&u===oe?M:C.nextElementSibling;oe.insertBefore(F,R);const{borderWidth:k,borderStyle:$,borderColor:P,borderRadius:f,backgroundColor:q,transform:H,position:I,cssText:L}=xt(C,["borderWidth","borderStyle","borderColor","borderRadius","backgroundColor","transform","position","cssText"]),J=C.classList.toString(),te=C.style.cssText;C.style.cssText=L,C.style.transform="none",C.style.animation="none",C.style.transition="none",C.className=J.split(" ").filter(j=>/^bg-/.test(j)===!1).join(" ");const U=At(C,o.resize),me=S.left-U.left,pe=S.top-U.top,ze=S.width/(U.width>0?U.width:10),We=S.height/(U.height>0?U.height:100),he=O-Te,ce=T-X,Ie=Ce-Re,Le=de-ge,ye=Math.max(S.widthM,he),Se=Math.max(S.heightM,ce),Ne=Math.max(U.widthM,Ie),$e=Math.max(U.heightM,Le),Ue=s===C&&["absolute","fixed"].includes(I)===!1&&["absolute","fixed"].includes(p)===!1;let je=I==="fixed",Je=oe;for(;je!==!0&&Je!==document;)je=window.getComputedStyle(Je).position==="fixed",Je=Je.parentNode;if(o.hideFromClone!==!0&&(M.style.display="block",M.style.flex="0 0 auto",M.style.opacity=0,M.style.minWidth="unset",M.style.maxWidth="unset",M.style.minHeight="unset",M.style.maxHeight="unset",M.classList.remove("q-morph--internal")),o.keepToClone!==!0&&(F.style.display="block",F.style.flex="0 0 auto",F.style.opacity=0,F.style.minWidth="unset",F.style.maxWidth="unset",F.style.minHeight="unset",F.style.maxHeight="unset"),F.classList.remove("q-morph--internal"),typeof o.classes=="string"&&(C.className+=" "+o.classes),typeof o.style=="string")C.style.cssText+=" "+o.style;else if(ci(o.style)===!0)for(const j in o.style)C.style[j]=o.style[j];const Qe=It(M),Ke=It(C),Ye=je===!0?document.documentElement:{scrollLeft:0,scrollTop:0};C.style.position=je===!0?"fixed":"absolute",C.style.left=`${U.left-Ye.scrollLeft}px`,C.style.right="unset",C.style.top=`${U.top-Ye.scrollTop}px`,C.style.margin=0,o.resize===!0&&(C.style.minWidth="unset",C.style.maxWidth="unset",C.style.minHeight="unset",C.style.maxHeight="unset",C.style.overflow="hidden",C.style.overflowX="hidden",C.style.overflowY="hidden"),document.body.appendChild(C),N!==void 0&&(N.style.cssText=w,N.style.transform="none",N.style.animation="none",N.style.transition="none",N.style.position=C.style.position,N.style.left=`${S.left-Ye.scrollLeft}px`,N.style.right="unset",N.style.top=`${S.top-Ye.scrollTop}px`,N.style.margin=0,N.style.pointerEvents="none",o.resize===!0&&(N.style.minWidth="unset",N.style.maxWidth="unset",N.style.minHeight="unset",N.style.maxHeight="unset",N.style.overflow="hidden",N.style.overflowX="hidden",N.style.overflowY="hidden"),document.body.appendChild(N));const Et=j=>{s===C&&l!==!0?(C.style.cssText=A,C.className=E):(C.style.cssText=te,C.className=J),F.parentNode===oe&&oe.insertBefore(C,F),M.remove(),F.remove(),N!==void 0&&N.remove(),e=()=>!1,s.qMorphCancel=void 0,C.qMorphCancel=void 0,typeof o.onEnd=="function"&&o.onEnd(l===!0?"to":"from",j===!0)};if(o.useCSS!==!0&&typeof C.animate=="function"){const j=o.resize===!0?{transform:`translate(${me}px, ${pe}px)`,width:`${ye}px`,height:`${Se}px`}:{transform:`translate(${me}px, ${pe}px) scale(${ze}, ${We})`},_e=o.resize===!0?{width:`${Ne}px`,height:`${$e}px`}:{},dt=o.resize===!0?{width:`${ye}px`,height:`${Se}px`}:{},ht=o.resize===!0?{transform:`translate(${-1*me}px, ${-1*pe}px)`,width:`${Ne}px`,height:`${$e}px`}:{transform:`translate(${-1*me}px, ${-1*pe}px) scale(${1/ze}, ${1/We})`},ct=N!==void 0?{opacity:o.tweenToOpacity}:{backgroundColor:y},ut=N!==void 0?{opacity:1}:{backgroundColor:q};m=C.animate([{margin:0,borderWidth:v,borderStyle:g,borderColor:b,borderRadius:d,zIndex:Qe,transformOrigin:"0 0",...j,...ct},{margin:0,borderWidth:k,borderStyle:$,borderColor:P,borderRadius:f,zIndex:Ke,transformOrigin:"0 0",transform:H,..._e,...ut}],{duration:o.duration,easing:o.easing,fill:o.fill,delay:o.delay}),a=N===void 0?void 0:N.animate([{opacity:o.tweenFromOpacity,margin:0,borderWidth:v,borderStyle:g,borderColor:b,borderRadius:d,zIndex:Qe,transformOrigin:"0 0",transform:h,...dt},{opacity:0,margin:0,borderWidth:k,borderStyle:$,borderColor:P,borderRadius:f,zIndex:Ke,transformOrigin:"0 0",...ht}],{duration:o.duration,easing:o.easing,fill:o.fill,delay:o.delay}),r=o.hideFromClone===!0||Ue===!0?void 0:M.animate([{margin:`${ce<0?ce/2:0}px ${he<0?he/2:0}px`,width:`${ye+S.marginH}px`,height:`${Se+S.marginV}px`},{margin:0,width:0,height:0}],{duration:o.duration,easing:o.easing,fill:o.fill,delay:o.delay}),c=o.keepToClone===!0?void 0:F.animate([Ue===!0?{margin:`${ce<0?ce/2:0}px ${he<0?he/2:0}px`,width:`${ye+S.marginH}px`,height:`${Se+S.marginV}px`}:{margin:0,width:0,height:0},{margin:`${Le<0?Le/2:0}px ${Ie<0?Ie/2:0}px`,width:`${Ne+U.marginH}px`,height:`${$e+U.marginV}px`}],{duration:o.duration,easing:o.easing,fill:o.fill,delay:o.delay});const ue=Fe=>{r!==void 0&&r.cancel(),a!==void 0&&a.cancel(),c!==void 0&&c.cancel(),m.cancel(),m.removeEventListener("finish",ue),m.removeEventListener("cancel",ue),Et(Fe),r=void 0,a=void 0,c=void 0,m=void 0};s.qMorphCancel=()=>{s.qMorphCancel=void 0,t=!0,ue()},C.qMorphCancel=()=>{C.qMorphCancel=void 0,t=!0,ue()},m.addEventListener("finish",ue),m.addEventListener("cancel",ue),e=Fe=>t===!0||m===void 0?!1:Fe===!0?(ue(!0),!0):(l=l!==!0,r!==void 0&&r.reverse(),a!==void 0&&a.reverse(),c!==void 0&&c.reverse(),m.reverse(),!0)}else{const j=`q-morph-anim-${++Li}`,_e=document.createElement("style"),dt=o.resize===!0?`
            transform: translate(${me}px, ${pe}px);
            width: ${ye}px;
            height: ${Se}px;
          `:`transform: translate(${me}px, ${pe}px) scale(${ze}, ${We});`,ht=o.resize===!0?`
            width: ${Ne}px;
            height: ${$e}px;
          `:"",ct=o.resize===!0?`
            width: ${ye}px;
            height: ${Se}px;
          `:"",ut=o.resize===!0?`
            transform: translate(${-1*me}px, ${-1*pe}px);
            width: ${Ne}px;
            height: ${$e}px;
          `:`transform: translate(${-1*me}px, ${-1*pe}px) scale(${1/ze}, ${1/We});`,ue=N!==void 0?`opacity: ${o.tweenToOpacity};`:`background-color: ${y};`,Fe=N!==void 0?"opacity: 1;":`background-color: ${q};`,ti=N===void 0?"":`
            @keyframes ${j}-from-tween {
              0% {
                opacity: ${o.tweenFromOpacity};
                margin: 0;
                border-width: ${v};
                border-style: ${g};
                border-color: ${b};
                border-radius: ${d};
                z-index: ${Qe};
                transform-origin: 0 0;
                transform: ${h};
                ${ct}
              }

              100% {
                opacity: 0;
                margin: 0;
                border-width: ${k};
                border-style: ${$};
                border-color: ${P};
                border-radius: ${f};
                z-index: ${Ke};
                transform-origin: 0 0;
                ${ut}
              }
            }
          `,ii=o.hideFromClone===!0||Ue===!0?"":`
            @keyframes ${j}-from {
              0% {
                margin: ${ce<0?ce/2:0}px ${he<0?he/2:0}px;
                width: ${ye+S.marginH}px;
                height: ${Se+S.marginV}px;
              }

              100% {
                margin: 0;
                width: 0;
                height: 0;
              }
            }
          `,oi=Ue===!0?`
            margin: ${ce<0?ce/2:0}px ${he<0?he/2:0}px;
            width: ${ye+S.marginH}px;
            height: ${Se+S.marginV}px;
          `:`
            margin: 0;
            width: 0;
            height: 0;
          `,li=o.keepToClone===!0?"":`
            @keyframes ${j}-to {
              0% {
                ${oi}
              }

              100% {
                margin: ${Le<0?Le/2:0}px ${Ie<0?Ie/2:0}px;
                width: ${Ne+U.marginH}px;
                height: ${$e+U.marginV}px;
              }
            }
          `;_e.innerHTML=`
          @keyframes ${j} {
            0% {
              margin: 0;
              border-width: ${v};
              border-style: ${g};
              border-color: ${b};
              border-radius: ${d};
              background-color: ${y};
              z-index: ${Qe};
              transform-origin: 0 0;
              ${dt}
              ${ue}
            }

            100% {
              margin: 0;
              border-width: ${k};
              border-style: ${$};
              border-color: ${P};
              border-radius: ${f};
              background-color: ${q};
              z-index: ${Ke};
              transform-origin: 0 0;
              transform: ${H};
              ${ht}
              ${Fe}
            }
          }

          ${ii}

          ${ti}

          ${li}
        `,document.head.appendChild(_e);let re="normal";M.style.animation=`${o.duration}ms ${o.easing} ${o.delay}ms ${re} ${o.fill} ${j}-from`,N!==void 0&&(N.style.animation=`${o.duration}ms ${o.easing} ${o.delay}ms ${re} ${o.fill} ${j}-from-tween`),F.style.animation=`${o.duration}ms ${o.easing} ${o.delay}ms ${re} ${o.fill} ${j}-to`,C.style.animation=`${o.duration}ms ${o.easing} ${o.delay}ms ${re} ${o.fill} ${j}`;const Oe=Ge=>{Ge===Object(Ge)&&Ge.animationName!==j||(C.removeEventListener("animationend",Oe),C.removeEventListener("animationcancel",Oe),Et(),_e.remove())};s.qMorphCancel=()=>{s.qMorphCancel=void 0,t=!0,Oe()},C.qMorphCancel=()=>{C.qMorphCancel=void 0,t=!0,Oe()},C.addEventListener("animationend",Oe),C.addEventListener("animationcancel",Oe),e=Ge=>t===!0||!C||!M||!F?!1:Ge===!0?(Oe(),!0):(l=l!==!0,re=re==="normal"?"reverse":"normal",M.style.animationDirection=re,N.style.animationDirection=re,F.style.animationDirection=re,C.style.animationDirection=re,!0)}};o.waitFor>0||o.waitFor==="transitionend"||o.waitFor===Object(o.waitFor)&&typeof o.waitFor.then=="function"?(o.waitFor>0?new Promise(Ce=>setTimeout(Ce,o.waitFor)):o.waitFor==="transitionend"?new Promise(Ce=>{const de=()=>{F!==null&&(clearTimeout(F),F=null),C&&(C.removeEventListener("transitionend",de),C.removeEventListener("transitioncancel",de)),Ce()};let F=setTimeout(de,400);C.addEventListener("transitionend",de),C.addEventListener("transitioncancel",de)}):o.waitFor).then(He).catch(()=>{typeof C.qMorphCancel=="function"&&C.qMorphCancel()}):He()};return typeof i.onToggle=="function"&&i.onToggle(),requestAnimationFrame(ee),C=>e(C)}const rt={},zi=["duration","delay","easing","fill","classes","style","duration","resize","useCSS","hideFromClone","keepToClone","tween","tweenFromOpacity","tweenToOpacity","waitFor","onEnd"],Wi=["resize","useCSS","hideFromClone","keepToClone","tween"];function ke(i,e){i.clsAction!==e&&(i.clsAction=e,i.el.classList[e]("q-morph--invisible"))}function Yt(i){if(i.animating===!0||i.queue.length<2)return;const[e,t]=i.queue;i.animating=!0,e.animating=!0,t.animating=!0,ke(e,"remove"),ke(t,"remove");const l=Hi({from:e.el,to:t.el,onToggle(){ke(e,"add"),ke(t,"remove")},...t.opts,onEnd(n,o){t.opts.onEnd!==void 0&&t.opts.onEnd(n,o),o!==!0&&(e.animating=!1,t.animating=!1,i.animating=!1,i.cancel=void 0,i.queue.shift(),Yt(i))}});i.cancel=()=>{l(!0),i.cancel=void 0}}function Xt(i,e){const t=e.opts;Wi.forEach(l=>{t[l]=i[l]===!0})}function Ui(i,e){const t=typeof i=="string"&&i.length>0?i.split(":"):[];e.name=t[0],e.group=t[1],Object.assign(e.opts,{duration:isNaN(t[2])===!0?300:parseFloat(t[2]),waitFor:t[3]})}function ji(i,e){i.group!==void 0&&(e.group=i.group),i.name!==void 0&&(e.name=i.name);const t=e.opts;zi.forEach(l=>{i[l]!==void 0&&(t[l]=i[l])})}function Ji(i,e){if(e.name===i){const t=rt[e.group];t===void 0?(rt[e.group]={name:e.group,model:i,queue:[e],animating:!1},ke(e,"remove")):t.model!==i&&(t.model=i,t.queue.push(e),t.animating===!1&&t.queue.length===2&&Yt(t));return}e.animating===!1&&ke(e,"add")}function Ft(i,e){let t;Object(e)===e?(t=""+e.model,ji(e,i),Xt(e,i)):t=""+e,t!==i.model?(i.model=t,Ji(t,i)):i.animating===!1&&i.clsAction!==void 0&&i.el.classList[i.clsAction]("q-morph--invisible")}var Tt=jt({name:"morph",mounted(i,e){const t={el:i,animating:!1,opts:{}};Xt(e.modifiers,t),Ui(e.arg,t),Ft(t,e.value),i.__qmorph=t},updated(i,e){Ft(i.__qmorph,e.value)},beforeUnmount(i){const e=i.__qmorph,t=rt[e.group];t!==void 0&&t.queue.indexOf(e)!==-1&&(t.queue=t.queue.filter(n=>n!==e),t.queue.length===0&&(t.cancel!==void 0&&t.cancel(),delete rt[e.group])),e.clsAction==="add"&&i.classList.remove("q-morph--invisible"),delete i.__qmorph}}),Qi=jt({name:"touch-hold",beforeMount(i,e){const{modifiers:t}=e;if(t.mouse!==!0&&gt.has.touch!==!0)return;const l={handler:e.value,noop:ui,mouseStart(o){typeof l.handler=="function"&&fi(o)===!0&&(Ze(l,"temp",[[document,"mousemove","move","passiveCapture"],[document,"click","end","notPassiveCapture"]]),l.start(o,!0))},touchStart(o){if(o.target!==void 0&&typeof l.handler=="function"){const s=o.target;Ze(l,"temp",[[s,"touchmove","move","passiveCapture"],[s,"touchcancel","end","notPassiveCapture"],[s,"touchend","end","notPassiveCapture"]]),l.start(o)}},start(o,s){l.origin=Nt(o);const r=Date.now();gt.is.mobile===!0&&(document.body.classList.add("non-selectable"),St(),l.styleCleanup=a=>{l.styleCleanup=void 0;const c=()=>{document.body.classList.remove("non-selectable")};a===!0?(St(),setTimeout(c,10)):c()}),l.triggered=!1,l.sensitivity=s===!0?l.mouseSensitivity:l.touchSensitivity,l.timer=setTimeout(()=>{l.timer=void 0,St(),l.triggered=!0,l.handler({evt:o,touch:s!==!0,mouse:s===!0,position:l.origin,duration:Date.now()-r})},l.duration)},move(o){const{top:s,left:r}=Nt(o);l.timer!==void 0&&(Math.abs(r-l.origin.left)>=l.sensitivity||Math.abs(s-l.origin.top)>=l.sensitivity)&&(clearTimeout(l.timer),l.timer=void 0)},end(o){mt(l,"temp"),l.styleCleanup!==void 0&&l.styleCleanup(l.triggered),l.triggered===!0?o!==void 0&&gi(o):l.timer!==void 0&&(clearTimeout(l.timer),l.timer=void 0)}},n=[600,5,7];if(typeof e.arg=="string"&&e.arg.length>0&&e.arg.split(":").forEach((o,s)=>{const r=parseInt(o,10);r&&(n[s]=r)}),[l.duration,l.touchSensitivity,l.mouseSensitivity]=n,i.__qtouchhold=l,t.mouse===!0){const o=t.mouseCapture===!0||t.mousecapture===!0?"Capture":"";Ze(l,"main",[[i,"mousedown","mouseStart",`passive${o}`]])}gt.has.touch===!0&&Ze(l,"main",[[i,"touchstart","touchStart",`passive${t.capture===!0?"Capture":""}`],[i,"touchend","noop","notPassiveCapture"]])},updated(i,e){const t=i.__qtouchhold;t!==void 0&&e.oldValue!==e.value&&(typeof e.value!="function"&&t.end(),t.handler=e.value)},beforeUnmount(i){const e=i.__qtouchhold;e!==void 0&&(mt(e,"main"),mt(e,"temp"),e.timer!==void 0&&clearTimeout(e.timer),e.styleCleanup!==void 0&&e.styleCleanup(),delete i.__qtouchhold)}});let xe,K;function Ki(){xe={},K=Ei()}function Yi(){xe.pGoalsMap==null;const i=new Map;let e=Zt();return e?(e.forEach(t=>{i.set(t.id,t)}),xe.pGoalsMap=i,i):(console.log("Repo:: parentGoalsMap is empty or null",e),i)}function Xi(i){return K.hasEventsForDate(i)}function Gt(i){return K.getEventsForDate(i)}function Zt(){return K.getMainGoals}function Zi(){return xe.subGoals==null&&(xe.subGoals=K.getSubGoals),xe.subGoals}function eo(){return K.fetchAlternativeEvts()}function to(){return K.currentBalance()}function io(){return K.fetchGoalsTree()}function oo(){let i=K.fetchAllPrio();return!i.size>0?(console.log("ERROR...no Priority goals?",i),[]):Array.from(i.values()).sort()}function Vt(i){return K.fetchGoalsUpToMaxScore(i)}function qt(i,e=null,t=null){K.saveSubProp(i,e,t)}function lo(){return K.getGoalByTitle("Misc")}function Ht(i){K.setBalance(i)}function zt(i,e){K.saveDailySchedule(i,e)}function no(i,e,t,l){return K.addMainGoal(i,e,t,l)}function Be(i,e,t,l,n,o,s,r,a){return K.addSubGoal(i,e,t,l,n,o,s,r,a)}function so(i,e,t=null){let l=i,n=e.id,o=e,s=t,r=i.duration,a=i.time,c=null,m=null;return{id:n,duration:r,time:a,date:()=>c,datey:u,score:D(),atScore:l.atScore,getGoal:()=>o,getPGoal:()=>s,data:()=>l,setData:h=>l=h,setMoods:h=>m=h,getMoods:v,setNotes:h=>h,hasNote:S,setDura:h=>r=h,setTime:h=>a=h,setDate:h=>c=h,durationChanged:O,timeChanged:T,parsedScore:g,withPropsEventsTo:d,addPropsEventsTo:y};function u(){return c}function D(){return l.atScore||e.score}function S(){return i.notes!==void 0}function O(){return i.duration!==e.duration}function T(){return i.time!==e.time}function v(){return"byMood"in l&&(m=l.byMood),m}function g(){const h=D().split(/on/);return h.length!=2?-89:h[1]-h[0]}function b(h){if(!h)return"";let p=h.split(":");return parseInt(p[0])>=12?h+"PM":h+"AM"}function d(h,p=null){let E=Object.assign({},{...this});return E.bgcolor=h.bgcolor,E.jeSuis?E.details=`Of '${h.title.trim()}' :: << ${E.jeSuis.join(",")} >>`:E.details=`Of '${h.title.trim()}' :: ${b(E==null?void 0:E.time)} -> ${E==null?void 0:E.duration}min -- ${E!=null&&E.inDefaults?"Dft:":":"}${E!=null&&E.canMove?":Mv:":":"}${E!=null&&E.isAlternative?":Alt":":"}`,console.log("withProps",JSON.parse(JSON.stringify(E)),E.datey(),E.date(),E.title,E.details),E}function y(h){if(!s){console.log("addProps:: ERROR no parentGoal",this.data);return}this.data,getGoal();let p=Object.assign({},{...sav});return p.bgcolor=t.bgcolor,p.jeSuis?p.details=`Of '${t.title.trim()}' :: << ${p.jeSuis.join(",")} >>`:p.details=`Of '${t.title.trim()}' :: ${b(p==null?void 0:p.time)} -> ${p==null?void 0:p.duration}min -- ${p!=null&&p.inDefaults?"Dft:":":"}${p!=null&&p.canMove?":Mv:":":"}${p!=null&&p.isAlternative?":Alt":":"}`,console.log("addProps",JSON.parse(JSON.stringify(p)),p.datey(),p.date(),p.title,p.details),p}}class ro{constructor(e,t){this.showReloadBtn=!1,this.showClearBtn=!1,this.showActionBtns=!0,this.disablePrioBtn=!0,this.disableScoreBtn=!0,this.disableSaveSchedule=!0,this.chosenScore=null,this.chosenPrio=null,this._dailyScheduled=new Map,this._endTimesSet=new Set,this._startTimesSet=new Set,this.savedRawEvts=[],this.usingMoods={},this.isDisabledScoreEdit={},this.hasStarted={},this.mobileEnableScore={},this.showMobileDialog={},this.currentDate=e,this.mobile=t,Ki()}allPGoals(){return Zt()}getAllEvts(){return this._dailyScheduled}getScheduledEvts(){let e=new Map;for(let[t,l]of this._dailyScheduled)l.start.time.indexOf("NaN")>-1||e.set(t,l);return e}labelScheduled(){let e=this.getSubGoals().length,t=this.getScheduledEvts(),l=this.getAllEvts().size-t.size;return{sched:`Scheduled => ${t.size} out of ${e} Evts
`,noTime:l>0?l:null}}showEvtNoteScoreMobile(e){return this.mobileEnableScore[e]&&this.showMobileDialog[e]}toggleEvtNoteScoreMobile(e){(this.isViewingPast()||this.isViewingToday())&&(this.showMobileDialog[e]=!0)}euhHidin(e){this.showMobileDialog[e]=!1}getCurrentSchedTimesSets(){return{endSet:this._endTimesSet,startSet:this._startTimesSet}}isViewingPast(){let e=st();if(this.currentDate&&this.currentDate==e)return!1;let t=$t(ne(e));return!($t(ne(this.currentDate))>=t)}isViewingToday(){return st()==this.currentDate}toggle(){this.showReloadBtn=!this.showReloadBtn}actionBtnsEnabled(){return this.showActionBtns}getProps(){return{showReloadBtn:this.showReloadBtn,showClearBtn:this.showClearBtn,disablePrioBtn:this.disablePrioBtn,disableScoreBtn:this.disableScoreBtn,chosenScore:this.chosenScore,chosenPrio:this.chosenPrio}}saveBtnEnabled(){return this.disableSaveSchedule}fetchGoalsTree(){return io()}getCurrentBalance(){return to()}getAllPrio(){return oo()}getSubGoals(){return Zi()}getCurrentMoods(){return this.usingMoods}getSubGoalByID(e){let t=this.getSubGoals(),l=parseInt(e);for(let n=0;n<t.length;n++)if(t[n].id===l)return t[n];return null}unscheduledDefaults(){return this.getSubGoals().filter(t=>(t==null?void 0:t.inDefaults)&&!this._dailyScheduled.has(t.id))}unscheduledDefaultEvts(){return this.unscheduledDefaults().length}unscheduled(){return this.getSubGoals().filter(t=>!this._dailyScheduled.has(t.id));//!this.actualEvts.find(item => item.id == x.id)
}subGoalsOfParent(e){return this.getSubGoals().filter(l=>l.parentGoal==e)}getOriginalEvtTime(e){let t=this.getSubGoalByID(e);return t?t.time:""}getStoredRawEvt(e){return this.savedRawEvts&&e in this.savedRawEvts?this.savedRawEvts[e]:null}availableEvtsToSchedule(){let e=(l,n)=>{if(l.parentGoal>n.parentGoal)return 1;if(l.parentGoal==n.parentGoal)return 0;if(l.parentGoal<n.parentGoal)return-1},t=this.unscheduled();return t.length<1?(console.log("availableEvtsToSchedule >NO available on",this.currentDate,t),this.getSubGoals().sort(e)):t.sort(e)}getAlternatives(){let e=(t,l)=>{if(t.parentGoal>l.parentGoal)return 1;if(t.parentGoal==l.parentGoal)return 0;if(t.parentGoal<l.parentGoal)return-1};return eo().sort(e)}getEventsForDate(e){return Gt(e)}updateDaySchedule(e,t){zt(e,t)}parentGoalsMap(){return Yi()}parentGoalById(e){return this.parentGoalsMap().has(e)?this.parentGoalsMap().get(e):null}findSchedEvent(e){return this._dailyScheduled.has(e)?this._dailyScheduled.get(e):null}hasEventsForDate(){return Xi(this.currentDate)}scheduledEventsMap(){const e={};return this._dailyScheduled.forEach((t,l,n)=>{let o=t.date;e[o]||(e[o]=[]),e[o].push(t)}),e}schedEvtWithProps(e,t,l){if(!e.getPGoal()){console.log("schedEvtWithProps:: ERROR no parentGoal",e.data);return}let n=e.data(),o=e.getGoal(),s=e.getPGoal(),r={...o};(e.timeChanged()||e.durationChanged())&&(r.time=n.time,r.duration=n.duration),e.setDate(this.currentDate);let a=e.getMoods();if(a){//!==
this.usingMoods[r.id]=a}r.date=this.currentDate,r.bgcolor=s.bgcolor,r.icon=s.icon,r.start=t,r.end=l;let c=`Of '${s.title.trim()}' :: ${z(r==null?void 0:r.time)} -> ${r==null?void 0:r.duration}min -- ${r!=null&&r.inDefaults?"Dft:":":"}${r!=null&&r.canMove?":Mv:":":"}${r!=null&&r.isAlternative?":Alt":":"}`;return r.jeSuis&&r.jeSuis.length>0&&(c+=a?` <>Mood:'${a}' >>${r.jeSuis.join(",")}`:` << ${r.jeSuis.join(",")} >>`),r.details=c,e.hasNote()&&(r.notes=n.notes),r}doProppy(e,t){let l=this.parentGoalById(e.parentGoal);if(!l){console.log("doProppy:: ERROR no Pgoal found ?!?",e);return}let n=G(ne(t),{minute:Q(e.time)}),o=G(n,{minute:e.duration}),s=Object.assign({},{...e,date:t,bgcolor:l.bgcolor,start:n,end:o,icon:l.icon});return e.jeSuis&&e.jeSuis.length>0?s.details=`Of '${l.title.trim()}' :: << ${e.jeSuis.join(",")} >>`:s.details=`Of '${l.title.trim()}' :: ${z(e==null?void 0:e.time)} -> ${e==null?void 0:e.duration}min -- ${e!=null&&e.inDefaults?"Dft:":":"}${e!=null&&e.canMove?":Mv:":":"}${e!=null&&e.isAlternative?":Alt":":"}`,"byMood"in e&&(console.log("doProppy::BYMOOD found!! "+s.id,JSON.parse(JSON.stringify(e))),this.usingMoods[s.id]=e.byMood),s}updateDetz(e){var n,o;let l=`Of '${(o=(n=this.parentGoalById(e.parentGoal))==null?void 0:n.title)==null?void 0:o.trim()}' :: ${z(e==null?void 0:e.time)} -> ${e==null?void 0:e.duration}min -- ${e!=null&&e.inDefaults?"Dft:":":"}${e!=null&&e.canMove?":Mv:":":"}${e!=null&&e.isAlternative?":Alt":":"}`;return e.jeSuis&&e.jeSuis.length>0&&(l+=this.usingMoods[e.id]?` <> Mood:'${this.usingMoods[e.id]}' >>${e.jeSuis.join(",")}`:` << ${e.jeSuis.join(",")} >>`),e.details=l,e}massageManyToOneOverlaps(e){let t=[],l=()=>{let r=[];return e.filter(a=>{a[0]=="oneToMany"&&r.push(a[1])}),r},n=e.filter(r=>r[0]!="oneToMany"),o=l(),s=[];for(let r=0;r<n.length;r++){let a=n[r][0];if(o.some(m=>m==a))s.push(...n[r][1]);else if(t.find(u=>u[0]==a)){let u=t.findIndex(D=>D[0]==a);t[u]=[a,[...t[u][1],...n[r][1]]]}else t.push([a,[...n[r][1]]])}if(t.length<1&&s.length>0)return this.doLog("massageManyToOneOverlaps::ONETOMANY!! returning original >> "+t.length+" vs "+s.length,e),e;if(s.length>0){this.doLog("massageManyToOneOverlaps::ADD SAMEY",s);let r=null,a=[];for(let m=0;m<s.length;m++){let u=s[m];t.find(S=>S[0]==u.inConflict)||(u.target!=r?(t.push([u.inConflict,[u]]),a.push(u.target)):console.log("massageManyToOneOverlaps::INCONF same current target? ERROR?",r,u))}let c=o.filter(m=>!a.some(u=>u==m));if(c.length>0){let m=0;do{let u=c[m],D=s.filter(S=>S.target==u);console.log("massageManyToOneOverlaps::ADDING",u,D),t.push([u,[...D]]),t.find(S=>S[0]=="oneToMany")?console.log("WOAH WOAH massageManyToOneOverlaps::oneToMany already present?!!ERROR ",t):t.push(["oneToMany",u])}while(++m<c.length)}}return this.doLog("massageManyToOneOverlaps::RETURNING",t),t}massageOneToMany(e){let t=[],l={};for(let n=0;n<e.length;n++){let o=e[n],s=t.find(r=>r[0]==o.inConflict);if(s){let r=t.findIndex(a=>a[0]==o.inConflict);t[r]=[o.inConflict,[...s[1],o]]}else if(!l[o.target])l[o.target]=[],l[o.target].push(o),t.push([o.inConflict,[o]]);else{let r=t.find(a=>a[0]=="oneToMany");if(r){let a=t.findIndex(m=>m[0]=="oneToMany"),c=t.findIndex(m=>m[0]==o.target);t[c]=[o.target,[...t[c][1],o]],o.target==r[1]||(t[a]=["oneToMany",[t[a][1],o.target]])}else{let a=t.pop();t.push([o.target,[...a[1],o]]),t.push(["oneToMany",o.target])}}}return t}addGoalsToSchedule(e,t){let l=[];return e.sort(function(n,o){return Q(n.time)-Q(o.time)}),e.forEach(n=>{let o=this.addToSchedule(n,t,!1);if(!o)console.log("addGoalsToSchedule:: ERROR Evt NOT added",o,t,n.id,n.title,n.time);else if(Array.isArray(o)){let s=o.length>1&&o.find(a=>a[0]=="oneToMany"),r={e:n,ov:o[0],oneToMany:s};l.push(r)}}),this.recheckOverlaps(l)}addToSchedule(e,t,l=!1){if(this._dailyScheduled.has(e.id))return console.log("addToSchedule--NOT added! present?!!?",t,e.title),!1;{let n=G(ne(this.currentDate),{minute:Q(e.time)}),o=G(n,{minute:e.duration});if(t){let a=this.hasOverlappingEvent(e.id,n,o);if(a.length>0)return this.massageOneToMany(a)}let s=l?this.schedEvtWithProps(e,n,o):this.doProppy(e,this.currentDate);s.sortTime=n;let r={...s,start:n,end:o};return this._dailyScheduled.set(s.id,r),this._endTimesSet.add(o.time),this._startTimesSet.add(n.time),this.enableNoteScoreEdit(s.id,n,o),!0}}stillInSchedule(e){let t=this.findSchedEvent(e),l=this.getStoredRawEvt(e);return{inSched:t,inStore:l}}doSortingByTime(e){let t=(n,o)=>{let s=Q(n[1].time),r=Q(o[1].time);return s<r?-1:r>s?1:0};const l=[];for(let n in e)l.push([n,e[n]]);return l.sort(t),this.doLog("doSortingByTime---After",l),Object.fromEntries(l)}anotherSorting(e){return Object.entries(e).sort(([,l],[,n])=>Q(l.time)-Q(n.time))}enrichAddToSchedule(){let e=[],t=this.isViewingToday();console.log("enrichAddToSchedule",Object.keys(this.savedRawEvts).length,"overlapCheck:"+t);let l=this.anotherSorting(this.savedRawEvts);for(let n=0;n<l.length;n++){let o=l[n][0],s=l[n][1],r=this.getSubGoalByID(o);if(!r){console.log(`enrichAddToSchedule:: ERROR No goal found for key: ${o}...skipping!`);continue}let a=this.parentGoalById(r.parentGoal),c=so(s,r,a),m=this.addToSchedule(c,t,!0);if(!m)console.log("enrichAddToSchedule..ERROR?!? not added",m,r);else if(Array.isArray(m)){let u=m.length>1&&m.find(S=>S[0]=="oneToMany"),D={e:c,ov:m[0],oneToMany:u};e.push(D)}}return this.recheckOverlaps(e)}recheckOverlaps(e){let t=[];const l=o=>{let s=t.find(r=>r[0]==o[0]);if(s){let r=t.findIndex(a=>a[0]==o[0]);t[r]=[o[0],[...s[1],...o[1]]]}else t.push(o)};let n=null;for(let o=0;o<e.length;o++){let s=e[o].e,r=e[o].ov;if(r[1].length>1){this.doLog("recheckOverlaps::MULTI Overlaps!!...skipping"+s.id,r),e[o].oneToMany?(t.push(r),t.push(e[o].oneToMany)):this.doLog("recheckOverlaps::MULTI Overlaps!!...umm NOT oneToMany?!?ERROR?",e[o]);continue}let a=e.filter(D=>D.ov[0]==r[0]);if(a.length>1){if(e[o].oneToMany&&this.doLog("recheckOverlaps::filter >>Multiple oneToMany?!?ERROR?"+s.id+" "+r[0],a),r[0]==n)continue;let D=0;do l(a[D].ov);while(++D<a.length);n=r[0];continue}let c=G(ne(this.currentDate),{minute:Q(s.time)}),m=G(c,{minute:s.duration}),u=this.hasOverlappingEvent(s.id,c,m);u.length>0?u.length>r[1].length?t.push(...this.massageOneToMany(u)):l(r):console.log("recheckOverlaps::ERROR>>hasOverlappingEvent no overlap?!?",s.id,u)}return t}loadEvtsForDay(e){return e||this.resetSchedule(!0),this.savedRawEvts=Gt(this.currentDate),this.savedRawEvts?{overlaps:this.enrichAddToSchedule(),canContinue:!1}:{overlaps:null,canContinue:!0}}onChangeViewDate(e){let t=e==this.currentDate;return this.currentDate=e,this.enableActionBtns(),this.loadEvtsForDay(t)}resetSchedule(e=!1){this.savedRawEvts=[],this._dailyScheduled=new Map,this._endTimesSet=new Set,this._startTimesSet=new Set,e&&(this.usingMoods={}),this.showReloadBtn=!1,this.showClearBtn=!1,this.disableSaveSchedule=!0}chosenScoreLabel(){return this.chosenScore==null?"By Score":`Score <= ${this.chosenScore}`}chosenPrioLabel(){return this.chosenPrio==null?"By Priority":`Prio == ${this.chosenPrio}`}filterSchedToCurrentPrio(){let e=[];return this._dailyScheduled.forEach((t,l,n)=>{var o;((o=this.parentGoalById(t.parentGoal))==null?void 0:o.priority)==this.chosenPrio&&e.push(t)}),e}calculatePrioEvts(){let e=this.getSubGoals().filter(l=>{var n;return((n=this.parentGoalById(l.parentGoal))==null?void 0:n.priority)==this.chosenPrio}),t=e.filter(l=>!this._dailyScheduled.has(l.id));//!this.actualEvts.find(item => item.id == x.id)) //add those not scheduled
this.byPrio={prio:this.chosenPrio,toAdd:t,reset:e,filter:this.filterSchedToCurrentPrio()}}onChoosenPrio(e){let t=this.chosenPrio;t&&t==e?this.disablePrioBtn=!0:(this.chosenPrio=e,this.disablePrioBtn=!1,this.calculatePrioEvts())}scheduleSamePrio(e,t=!1){const l=c=>{console.log("scheduleSamePrio::RECALCULATE?!?",c,this.chosenPrio,this.byPrio);let m=this.getSubGoals().filter(u=>{var D;return((D=this.parentGoalById(u.parentGoal))==null?void 0:D.priority)==this.chosenPrio});return c=="reset"?m:m.filter(u=>!this._dailyScheduled.has(u.id));//!this.actualEvts.find(item => item.id == x.id)
};let n=[];if(e=="filter"?(n=this.filterSchedToCurrentPrio(),this.resetSchedule()):(this.byPrio?e=="add"?n=this.byPrio.toAdd:n=this.byPrio.reset:n=l(e),e!="add"&&this.resetSchedule()),n.length<1)return{overlaps:null,canContinue:!1};let o=n.filter(c=>c.time==""),s=this.addGoalsToSchedule(n,!t),r=s.length;this.updateCurrentMoods();let a=n.length-r-o.length;return this.toggleActionBtns(a>0,"byPrio"),{overlaps:s,canContinue:!(r>0),added:a,noTime:o.length>0?o.length:null}}filterSchedToCurrentScore(){let e=[];return this._dailyScheduled.forEach((t,l,n)=>{let o=we(t.score);o>-1&&o<=this.chosenScore&&e.push(t)}),e}calculateScoreEvts(){let e=Vt(this.chosenScore),t=e.filter(l=>!this._dailyScheduled.has(l.id));//!this.actualEvts.find(item => item.id == x.id)
this.byScore={score:this.chosenScore,toAdd:t,reset:e,filter:this.filterSchedToCurrentScore()}}onChoosenScore(e){let t=this.chosenScore;t&&t==e?this.disableScoreBtn=!0:(this.chosenScore=e,this.disableScoreBtn=!1,this.calculateScoreEvts())}scheduleByScore(e,t=!1){const l=c=>{console.log("scheduleByScore::RECALCULATE?!?",c,this.chosenScore,this.byScore);let m=Vt(this.chosenScore);return c=="reset"?m:m.filter(u=>!this._dailyScheduled.has(u.id))};let n=[];if(e=="filter"?(n=this.filterSchedToCurrentScore(),this.resetSchedule()):(this.byScore?e=="add"?n=this.byScore.toAdd:n=this.byScore.reset:n=l(e),e!="add"&&this.resetSchedule()),n.length<1)return{overlaps:null,canContinue:!1};let o=n.filter(c=>c.time==""),s=this.addGoalsToSchedule(n,!t),r=s.length;this.updateCurrentMoods();let a=n.length-r-o.length;return this.toggleActionBtns(a>0,"byScore"),{overlaps:s,canContinue:!(r>0),added:a,noTime:o.length>0?o.length:null}}scheduleOneEach(e,t=!1,l=null){const n=u=>{let D=[];return this.parentGoalsMap().forEach((S,O,T)=>{let v=this.subGoalsOfParent(S.id);if(v.length>0){let g=null,b=v.length;if(u)g=v[Math.floor(Math.random()*b)];else{let d=0;for(;this._dailyScheduled.has(v[b].id);)if(d++,b=Math.floor(Math.random()*v.length),console.log(`selectOneFromP::index ${b} scheduled...new random> At try> `+d,v.length),d>2){console.log("selectOneFromP::random...TOO MANY TRIES..ERROR?",d,b,v.length,v);break}g=v[b],console.log("selectOneFromP::NO Random at index: "+b,d,g)}D.push(g)}else l&&l(`No Evt goal for Parent: '${S==null?void 0:S.title}'`,"warning")}),D},o=()=>{let u=this.unscheduled(),D=[];return this.parentGoalsMap().forEach((S,O,T)=>{let v=u.filter(b=>b.parentGoal==S.id),g=v.length;if(g>0){let b=v[Math.floor(Math.random()*g)];D.push(b)}else{let b=this.subGoalsOfParent(S.id).length>0,d=b?`All goals for Parent: '${S==null?void 0:S.title}' already scheduled`:`Parent: '${S==null?void 0:S.title}' has No Goals :(`;l&&l(d,b?"info":"warning")}}),D};let s=[];if(e=="add"?(s=o(),console.log("scheduleOneEach...TOADD>> "+s.length)):(this.resetSchedule(),s=n(!0)),s.length<1)return console.log("Empty for OneEach :("),{overlaps:null,canContinue:!1};let r=s.filter(u=>u.time==""),a=this.addGoalsToSchedule(s,!t),c=a.length;this.updateCurrentMoods();let m=s.length-c-r.length;return this.toggleActionBtns(m>0,"oneEach"),{overlaps:a,canContinue:!(c>0),added:m,noTime:r.length>0?r.length:null}}scheduleByMood(e){var s;let t=[];for(let r=0;r<e.length;r++){let a=this.getSubGoalByID(e[r].id);a&&(t.push(a),this.usingMoods[e[r].id]=(s=e[r])==null?void 0:s.mood)}if(t.length<1)return this.doLog("scheduleByMood::Error? as Empty Moods with toAdd ",e),{overlaps:null,canContinue:!1};let l=t.filter(r=>r.time==""),n=this.addGoalsToSchedule(t,this.isViewingToday()),o=n.length;return o>0||this.toggleActionBtns(t.length-o>0,"ByMood"),{overlaps:n,canContinue:!(o>0),added:t.length,noTime:l.length>0?l.length:null}}scheduleDefaults(e,t=!1){let l=[];e=="add"?l=this.unscheduledDefaults():(this.resetSchedule(),l=this.unscheduledDefaults()),this.showReloadBtn=this.hasEventsForDate(),this.showClearBtn=!this.isViewingPast()&&l.length>0;let n=l.filter(a=>a.time==""),o=this.addGoalsToSchedule(l,!t),s=o.length,r=l.length-s-n.length;return this.updateCurrentMoods(),this.toggleActionBtns(r>0,"defaults"),{overlaps:o,canContinue:!(s>0),added:r,noTime:n.length>0?n.length:null}}onPickEvent(e,t,l,n,o=null){const s=()=>{n&&(this.removeFromBalance(e==null?void 0:e.duration),console.log("onPickEvent...useBalance","force?"+l));let m=this.addToSchedule({...e,time:t.time},!1);return this.isViewingPast()||n?(o&&o(`onPickEvent::Added ${e==null?void 0:e.title}...Saving schedule`,"info"),this.saveDaySchedule()):this.toggleActionBtns(!0,"onPickEvt"),{overlaps:m,canContinue:!0}};let r=G(t,{minute:e.duration}),a=this.hasOverlappingEvent(e.id,t,r),c=a.length;if(c>0){console.log("onPickEvent::OVERLAPS!!"+c,"with force "+l,JSON.parse(JSON.stringify(a)));let m=this.massageOneToMany(a),u={overlaps:m,canContinue:!1};if(c>1||!l)return u;o&&o(`onPickEvent:: ${c} OVERLAPS! Forcing...`,"info"),this.toggleActionBtns(!0,"onPickEvt");for(let D=0;D<c;D++){let S=m[D][1],O=0;do this.recurChangeTime(S[O].inConflict,e,t,!0,o);while(++O<S.length)}return n&&this.removeFromBalance(e==null?void 0:e.duration),this.isViewingPast()||n?this.saveDaySchedule():this.toggleActionBtns(!0,"onPickEvt"),{overlaps:null,canContinue:!0}}else return s()}onAdHocEvent(e,t,l,n=null){const o=c=>(l?(this.removeFromBalance(c==null?void 0:c.duration),console.log("onAdHocEvent...using Balance",c==null?void 0:c.duration),this.saveDaySchedule(),n&&n("New adHoc Evt!! Saving Schedule with new balance....","positive")):n&&(n("New adHoc Evt added!! ...doSave eh","info"),this.toggleActionBtns(!0,"onAdHoc")),{overlaps:null,canContinue:!0});let s=this.getSubGoalByID(e);if(!s)return{overlaps:null,canContinue:!1};let r=this.addToSchedule(s,!0),a=Array.isArray(r);if(!r||a){let c={overlaps:r,canContinue:!1},m=r.length;if(a&&m>1)return c;if(a&&m==1){n&&n(`onAdHocEvent:: ${m} OVERLAPS! Forcing...`,"warning");for(let u=0;u<m;u++){let D=r[u][1],S=0;do this.recurChangeTime(D[S].inConflict,s,t,!0,n);while(++S<D.length)}return o(s)}return c}return o(s)}addMinsToEvt(e,t,l=null){const n=(u,D,S)=>{let O=u.end,T=this.updateDetz({...u,duration:D,end:S});return this._dailyScheduled.set(e,T),this._endTimesSet.delete(O.time)||console.log("ERROR endTimesSet item does not exist?!?"+O.time,u,this._endTimesSet),this._endTimesSet.add(S.time),l&&l(`${t} mins added to '${u==null?void 0:u.title}' Saving...`,"info"),this.saveDaySchedule(),{overlaps:null,canContinue:!0}};let o=this.findSchedEvent(e);if(!o){console.log("ERROR addMinsToEvt EVT not found!!!",e);return}let s=o.end,r=G(s,{minute:parseInt(t)}),a=parseInt(t)+o.duration,c=this.hasOverlappingEvent(e,o.start,r);return c.length>0?{overlaps:this.massageOneToMany(c),canContinue:!1}:n(o,a,r)}saveNewGoal(e,t,l,n,o){if(n=="self"){let s=this.addParentGoal(t,t,"red-14",2);return s?Be(s,t,"1on5",e.time,o,!0,!1,o<30):(console.log("ERROR? no pID",s),s===0?Be(s,t,"1on5",e.time,o,!0,!1,o<30):null)}else if(l){return console.log("with parentGoal "+l.id,l==null?void 0:l.title),Be(l.id,t,"1on5",e.time,o,!1,!1,o<30);//!canMove and notInDefaults. isAlternative when duration<30
}else{let s=lo();if(s)return Be(s.id,t,"1on5",e.time,o,!1,!1,o<30);{let r=this.addParentGoal("Misc","Miscellaneous","grey-10",2);return r?Be(r,t,"1on5",e.time,o,!0,!1,o<30):(console.log("ERROR? no pID",r),r===0?Be(r,t,"1on5",e.time,o,!0,!1,o<30):null)}}}addParentGoal(e,t,l,n=2){let o=[];this.parentGoalsMap().forEach((r,a,c)=>{let m=r.bgcolor;o.push(m)});let s=Pi().filter(r=>!o.some(a=>a==r));if(s.length>1){let r=Math.floor(Math.random()*s.length),a=s[r];console.log(`addParentGoal::bgcolor..index ${r} from ${l} to:`,a),l=a}else console.log("addParentGoal::NONE available",s,AllColors);return no(e,t,l,n)}recurChangeTime(e,t,l,n=!1,o=null){var r,a,c,m,u;let s=this.findSchedEvent(e);if(s){let D=Q(s.start.time)-Q(l.time),S=`${D>0?"DOWN":"UP"}`,O=null;if(D>=0){O=G(l,{minute:parseInt(t.duration)+10});let d=G(l,{minute:parseInt(s.duration)+10});console.log(`recurChangeTime::START>>(${e}) '${s==null?void 0:s.title}' ${s==null?void 0:s.duration} mins going FORWARD ${S} for ${D} due to evt:(${t.id})${(r=t==null?void 0:t.title)==null?void 0:r.trim()} at ${l.time} 
          
 doAdd?:${n} >`,JSON.parse(JSON.stringify(O.time)),"alt:",d.time);let y=se(d,O);if(y>0){let h=Math.floor(y/1e3/60);h<=D?console.log(`recurChangeTime::(${e}) duration: ${s.duration} vs Target evtDura:${t.duration}...USING overlappedEvtNew ${O.time}!! ${h} <= dragInterval ${D} `,d.time):(console.log(`recurChangeTime::DIFFY = ${y} and ${h} >= dragInterval ${D}...
COULD USE ALTERNATIVE as duration:${s.duration} vs evtDura:${t.duration}`,O.time,d.time),D==0?O=d:console.log("recurChangeTime::NOT USING ALTERNATIVE",d.time))}}else{O=G(l,{minute:-(parseInt(s.duration)+10)});let d=G(l,{minute:-(parseInt(t.duration)+10)});console.log(`recurChangeTime::START>>(${e}) '${s==null?void 0:s.title}' going BACKWARD ${S} for ${D} due to evt:(${t.id})${(a=t==null?void 0:t.title)==null?void 0:a.trim()} at ${l.time}
          
 doAdd?:${n}`,O.time,"alt:"+d.time);let y=se(d,O),h=y>0?Math.floor(y/1e3/60):0;console.log(`recurChangeTime::BACKWARD ${S} for ${D}`,h)}let T=this.hasOverlappingEvent(e,O,G(O,{minute:s.duration})),v=T.length;if(v>0){let d=0;o&&o(`${v} Cascading Overlaps handling (${e}) '${s==null?void 0:s.title}' going ${S} as ${n?"Adding":"Moving"} '${(c=t==null?void 0:t.title)==null?void 0:c.trim()}'`);do{if(console.log(`CASCADING OVERLAPPED >> ${d} (${e}) at: ${O.time} now at: ${s.start.time} till ${s.end.time}`,T[d]),T[d].inConflict==t.id){console.log(`EUUUH...ERROR::recurChangeTime::self overlap?!?OVERLAPPED:${e} ...break `+d,v,T[d].inConflict,t.id);break}this.recurChangeTime(T[d].inConflict,s,O,!1,o)}while(++d<v)}this.changeEvtTime(s,O);let g=l;if(!n){this.changeEvtTime(t,g);return}let b=this.addToSchedule({...t,time:g.time},this.isViewingToday());if(b.length>0){this.doLog(`recurChangeTime::TARGET extra OVERLAP ${n?"Adding":"Moving"} ${(m=t==null?void 0:t.title)==null?void 0:m.trim()}`,b),o&&o(`EXTRA OVERLAPS ${n?"Adding":"Moving"} TARGET ${(u=t==null?void 0:t.title)==null?void 0:u.trim()}`),b.find(p=>p[0]=="oneToMany")&&(b=b.filter(p=>p[0]!="oneToMany"),this.doLog("recurChangeTime::TARGET::WITHID!!!Now>>",b.length));let y=b.length,h=0;do{let p=b[h][1],w=p.length-1;for(;w>=0;w--){if(p[w].inConflict==t.id){console.log("EUUUH...::recurChangeTime::TARGET>>OVERLAP::self overlap?!?...breaking!",p[w].inConflict,t.id,p[w].targetStart);break}this.recurChangeTime(p[w].inConflict,t,g,n,o)}}while(++h<y)}}else console.log("recurChangeTime::ERROR ERROR >> overlapped event not found!","doAdd? "+n,e,t)}hasOverlappingEvent(e,t,l){const n=[];return this._dailyScheduled.forEach((o,s,r)=>{if(s!=e){let a=this.checkOverlapByTime(t,l,o.start,o.end,e);a&&n.push({target:e,targetStart:t,direction:a,inConflict:s})}}),n}checkOverlapByTime(e,t,l,n,o){let s=this.getTimeyNumber(e),r=this.getTimeyNumber(t),a=this.getTimeyNumber(l),c=this.getTimeyNumber(n);if(s===!1||a===!1||r===!1||c===!1)return console.log("ERROR... checkOverlapByTime error",s,r,a,c),!1;let m=!1;s>a&&s<c&&(m="bas"),r>a&&r<c&&(m="haut");let u=a>=s&&r>=c,D=s>=a&&r<=c;return(u||D)&&(m="surrounding"),m}canDropEvent(e,t){let l=G(e,{minute:t.duration}),n=this.hasOverlappingEvent(t.id,e,l);return n.length>0?{overlaps:this.massageOneToMany(n),canContinue:!1}:{overlaps:null,canContinue:!0}}toggleActionBtns(e,t){this.disableSaveSchedule=!e,this.showReloadBtn=this.hasEventsForDate()&&e,this.showClearBtn=!this.isViewingPast()&&e}resetChosen(){this.chosenScore=null,this.chosenPrio=null}enableActionBtns(){let e=this.isViewingPast();this.showActionBtns=!e}tooClose(e,t){let l=G(e,{minute:0}),n=this.getTimeNumber(l),o=G(e,{day:1}),s=new Date(o.date);s.setHours(24),s.setMinutes(0),s.setSeconds(0),s.setMilliseconds(0);let r=Ee(s),a=Math.floor(se(l,r)/1e3/60);if(a<t)return console.log("tooClose to midnight eh...:(",a),!0;let c=!1;return this._dailyScheduled.forEach((m,u,D)=>{let O=this.getTimeNumber(m.start)-n,T=se(l,m.start);Math.floor(T/1e3/60)<=10&&O>0&&(c=u)}),c}changeEvtTime(e,t,l=""){return l=="ok"&&qt(e.id,t.time,null),this.doUpdateSchedule(e,t),l}doUpdateSchedule(e,t){let l=this.findSchedEvent(e.id);if(!l){console.log("doUpdateSchedule-ERROR NOT found",e.id,l);return}let n=G(ne(l.date),{minute:Q(t.time)}),o=G(n,{minute:l.duration}),s=this._endTimesSet.delete(l.end.time);this._endTimesSet.add(o.time),s||console.log("doUpdateSchedule-endTimesSet NOT FOUND?!?",l.id,o.time),this._startTimesSet.delete(l.start.time),this._startTimesSet.add(n.time),l.time=t.time,l.sortTime=n;let r=this.updateDetz({...l,time:t.time,start:n,end:o});this._dailyScheduled.set(e.id,r),this.enableNoteScoreEdit(e.id,n,o)}saveDaySchedule(){let e={};this._dailyScheduled.size<1?e=null:this._dailyScheduled.forEach((t,l,n)=>{t.start.time.indexOf("NaN")>-1||(e[l]={time:t.start.time,duration:t.duration,atScore:t==null?void 0:t.atScore},this.usingMoods[l]&&(e[l].byMood=this.usingMoods[l]),t.notes!==void 0&&(t==null?void 0:t.notes)!==""&&(e[l].notes=t==null?void 0:t.notes))}),console.log("saveDaySchedule",e?Object.keys(e).length:"CLEARED"),zt(this.currentDate,e),this.disableSaveSchedule=!0,this.showReloadBtn=!1,this.showClearBtn=e!=null&&!this.isViewingPast()}updateMinEndNowBtn(e,t,l){for(let[n,o]of this._dailyScheduled)(t?o.end.time:o.start.time)==e&&(this.hasStarted[n]=!t,this.isDisabledScoreEdit[n]=!t,this.mobile&&(console.log(`updateMinEndNowBtn..MOBILE::good?>>${l}::${t}`,e),this.showMobileDialog[n]=!t))}reduceEvtDuration(e,t){let l=this.findSchedEvent(e);if(!l){console.log("ERROR:: reduceEvtDuration Evt not found!!!",e);return}const n=Ee(new Date);let o=l.start,s=l.end,r=this.updateDetz({...l,duration:t,end:n});this._dailyScheduled.set(e,r),this._endTimesSet.delete(s.time)||console.log("ERROR endTimesSet item does not exist?!?",l,this._endTimesSet),this._endTimesSet.add(n.time),this.enableNoteScoreEdit(e,o,n),this.saveDaySchedule()}canEndNow(e){let t=this.findSchedEvent(e);if(!t)return console.log("ERROR canEndNow Evt not found!!!",e),!1;const l=Ee(new Date);let n=t.start,o=t.end;if(!Ot(l,n,o,!0))return console.log("umm aint in the middle of this event! Nothing to do...canEndNow::ERROR?",l.time,n.time,o.time),!1;let s=G(l,{minute:0}),r=se(n,s),a=Math.floor(r/1e3/60);return console.log(`canEndNow:: ${e} duration from ${t.duration} to: ${a}`),a<10?a:this.reduceEvtDuration(e,a)}updateNoteScore(e,t,l=""){let n=this.findSchedEvent(e);n?(n.score==t||(qt(e,null,t),n.atScore=t),n.score=t,l!==""&&(n.notes=l),this.isViewingPast()?this.saveDaySchedule():this.toggleActionBtns(!0,"updateNoteScore")):console.log(`ERROR ERROR::updateNoteScore could not find event ${e}?!?`)}deleteEvtMood(e){if(this.usingMoods[e]){delete this.usingMoods[e],console.log("deleteEvtMood::>> "+e);return}}updateCurrentMoods(){for(let e in this.usingMoods)this._dailyScheduled.has(parseInt(e))||this.deleteEvtMood(e)}removeScheduledEvt(e){if(!e){console.log("ERROR removeScheduledEvt, NO evt to delete!",e);return}let t=null;if(this._dailyScheduled.has(e.id))t=this._dailyScheduled.get(e.id),this._dailyScheduled.delete(e.id);else{console.log("removeScheduledEvt:: ERROR NO evt?@? ERROR",e);return}if(t){let l=this._startTimesSet.delete(t.start.time),n=this._endTimesSet.delete(t.end.time);(!l||!n)&&console.log(`removeScheduledEvt ::> ERROR? scheduleSets has no such evt?@? start:${l}...end:${n}`,t,e.id+" "+(e==null?void 0:e.title.trim())+" "+(e==null?void 0:e.details)),this.deleteEvtMood(e.id)}}addToBalance(e){let l=this.getCurrentBalance()-parseInt(e==null?void 0:e.duration);Ht(l)}removeFromBalance(e){let l=this.getCurrentBalance()+parseInt(e);Ht(l)}disableEvtScoreEdit(e,t){this.isDisabledScoreEdit[e]=!t,this.mobileEnableScore[e]=t}enableNoteScoreEdit(e,t,l){const n=Ee(new Date);let o=se(n,l),s=G(n,{minute:0});this.getTimeNumber(s),o>0?(this.isDisabledScoreEdit[e]=!0,this.mobileEnableScore[e]=!1):(this.hasStarted[e]=!1,this.mobile&&(this.showMobileDialog[e]=!1),this.mobileEnableScore[e]=!0,this.isDisabledScoreEdit[e]=!1),Ot(n,t,l,!0)?this.hasStarted[e]=!0:this.hasStarted[e]=!1}getTimeyNumber(e){return e!==null?$i(e):!1}getTimeNumber(e){return e!==null?wt(e):!1}doLog(e,t){console.log(e,t?JSON.parse(JSON.stringify(t)):"")}}const ao=()=>!0;function ho(i){const e={};return i.forEach(t=>{e[t]=ao}),e}function Dt(){const{emit:i,proxy:e}=Ut(),t=_(null);function l(){t.value.show()}function n(){t.value.hide()}function o(r){i("ok",r),n()}function s(){i("hide")}return Object.assign(e,{show:l,hide:n}),{dialogRef:t,onDialogHide:s,onDialogOK:o,onDialogCancel:n}}const ei=["ok","hide"];Dt.emits=ei;Dt.emitsObject=ho(ei);const co=mi({name:"scheduleBy",props:{title:String,message:String,options:Array,selectedO:String},emits:["onCancel","onOk","ok","hide"],data(){return{mess:this.message,daOptions:this.options,skipOvCheck:_(!1),optGroup:this.selectedO}},setup(){const{dialogRef:i,onDialogHide:e,onDialogOK:t,onDialogCancel:l}=Dt();return{dialogRef:i,onDialogHide:e,onDialogOK:t,onCancelClick:l}},computed:{oCheck:{get(){return this.skipOvCheck},set(i){this.skipOvCheck=i}},oChoice:{get(){return this.optGroup},set(i){this.optGroup=i}}},methods:{show(){this.$refs.dialogRef.show()},hide(){this.$refs.dialogRef.hide()},onDialogHidey(){this.$emit("hide"),this.onDialogHide()},onOKyClick(){this.$emit("ok",{choice:this.oChoice,skipOCheck:this.oCheck}),this.hide()},onCancelyClick(){this.$emit("onCancel"),this.hide(),this.showy=!1}}}),uo={class:"q-ma-md title"},fo={class:"q-ma-md message"};function go(i,e,t,l,n,o){return V(),Y(yi,{ref:"dialogRef","transition-show":"rotate","transition-hide":"rotate",onHide:i.onDialogHidey},{default:x(()=>[B(Ct,{class:"my-dialog"},{default:x(()=>[W("div",uo,le(i.title),1),W("div",fo,le(i.mess),1),B(lt,{dark:""}),B(Qt,{class:"q-gutter-md"},{default:x(()=>[W("div",null,[B(pi,{modelValue:i.oChoice,"onUpdate:modelValue":e[0]||(e[0]=s=>i.oChoice=s),options:i.daOptions},null,8,["modelValue","options"])]),i.oChoice!="filter"?(V(),Y(Kt,{key:0,modelValue:i.oCheck,"onUpdate:modelValue":e[1]||(e[1]=s=>i.oCheck=s),label:"Skip Overlap Check?","left-label":""},null,8,["modelValue"])):Z("",!0)]),_:1}),B(lt,{dark:""}),B(nt,{align:"center",class:"q-mx-md"},{default:x(()=>[B(De,{label:"Cancel",flat:"",color:"primary",onClick:i.onCancelyClick},null,8,["onClick"]),B(lt,{vertical:!0}),B(De,{label:"Ok",flat:"",color:"primary",onClick:i.onOKyClick},null,8,["onClick"])]),_:1})]),_:1})]),_:1},8,["onHide"])}var mo=Jt(co,[["render",go],["__scopeId","data-v-5e3dbdf4"]]);function Wt(i){return i.button===0}const po={name:"altDayCalendar",components:{NavigationBar:ve(()=>be(()=>import("./NavigationBar.6000c43c.js"),["assets/NavigationBar.6000c43c.js","assets/NavigationBar.bf3d18d0.css","assets/index.9748ecce.js","assets/index.4f70e4de.css"])),QCalendarDay:xi,GoalyEnd:ve(()=>be(()=>import("./goalyEnd.e871dc01.js"),["assets/goalyEnd.e871dc01.js","assets/goalyEnd.bf51d2cd.css","assets/index.9748ecce.js","assets/index.4f70e4de.css","assets/goalStorage.ac2b6df5.js","assets/QSelect.8047b427.js","assets/touch.70a9dd44.js","assets/QItem.403aef8d.js"])),daInstructions:ve(()=>be(()=>import("./instructions.4513680d.js"),["assets/instructions.4513680d.js","assets/index.9748ecce.js","assets/index.4f70e4de.css"])),schedBtn:ve(()=>be(()=>import("./schedBtn.6066f2cd.js"),["assets/schedBtn.6066f2cd.js","assets/schedBtn.02258f8f.css","assets/goalStorage.ac2b6df5.js","assets/index.9748ecce.js","assets/index.4f70e4de.css"])),schedDialog:ve(()=>be(()=>import("./schedDialog.98b04295.js"),["assets/schedDialog.98b04295.js","assets/schedDialog.269d7ab5.css","assets/index.9748ecce.js","assets/index.4f70e4de.css","assets/QSpace.6765119d.js"])),mobileNoteScore:ve(()=>be(()=>import("./onScoreEditDialog.5468e35b.js"),["assets/onScoreEditDialog.5468e35b.js","assets/onScoreEditDialog.1a5ed29f.css","assets/index.9748ecce.js","assets/index.4f70e4de.css"])),actionBtns:ve(()=>be(()=>import("./actionBtns.63a35bf2.js"),["assets/actionBtns.63a35bf2.js","assets/actionBtns.40e84724.css","assets/index.9748ecce.js","assets/index.4f70e4de.css"])),scheduleDayLabel:ve(()=>be(()=>import("./dayLabels.d682aaf4.js"),["assets/dayLabels.d682aaf4.js","assets/dayLabels.99307dc6.css","assets/utiFunc.24f4e6b4.js","assets/index.9748ecce.js","assets/index.4f70e4de.css"]))},data(){return Ri(),_(null),_(null),_(null),_(null),_(null),{splitterPage:_(35),splitterLegend:_(40),timeStartPos:_(0),showTree:_(!1),treeGoals:_([]),expanded:_([]),filter:_([]),filterRef:_(null),nextMorphStep:_({btn:"card1",card1:"card2",card2:"btn"}),morphGroupModel:_("btn"),draggingFab:_(!1),fabPos:_([18,18]),calendar:_(null),showEvtDialog:_(!1),currentDate:_(st()),scoreOptions:_([1,2,3,4,5,6,7,8]),anchorTimestamp:_(null),otherTimestamp:_(null),mouseDown:_(!1),mobile:_(!0),daSchedule:_(null),showInstru:_(!1)}},beforeMount(){this.mobile=Ii(),this.mobile&&(this.splitterPage=0),this.daSchedule=new ro(this.currentDate,this.mobile),this.constructTree()},mounted(){this.adjustCurrentTime(),this.intervalId=setInterval(()=>{this.adjustCurrentTime()},6e4)},beforeUnmount(){clearInterval(this.intervalId)},computed:{chosenScoreLabel(){return this.daSchedule.chosenScoreLabel()},chosenPrioLabel(){return this.daSchedule.chosenPrioLabel()},style(){return{top:this.timeStartPos+"px"}},splitterLimits(){return this.mobile?[0,100]:[30,70]},showSchedInstru(){return this.getDateEvents(this.currentDate).length<1},showRemInstru(){return this.getDateEvents(this.currentDate).length>0},defaultBtnLabel(){let i=this.daSchedule.unscheduledDefaultEvts();return i>0?i+" Defaults":"Defaults"},isDefaultBtnEnabled(){return!this.daSchedule.unscheduledDefaultEvts()>0||this.isViewingPast()},doShowActionBtns(){return this.daSchedule.actionBtnsEnabled()},scheduleProps(){return this.daSchedule.getProps()},saveScheduleDisabled(){return this.daSchedule.saveBtnEnabled()},showTreeForm(){return this.showTree||this.constructTree(),this.showTree},filterString(){return this.filter.join()},currentBalance(){return this.daSchedule.getCurrentBalance()},canbeScheduled(){return this.daSchedule.availableEvtsToSchedule()},scheduleMoodsLabel(){let i=this.daSchedule.getCurrentMoods();if(!Object.keys(i).length>0)return null;let e=new Map;for(let l in i){let n=i[l].join();e.set(l,n)}let t={};for(let[l,n]of e){let o=this.daSchedule.findSchedEvent(parseInt(l));t[l]={m:n,bg:o==null?void 0:o.bgcolor}}return t},startEndTimes(){const i=[];return this.anchorDayTimeIdentifier!==!1&&this.otherDayTimeIdentifier!==!1&&(this.anchorDayTimeIdentifier<=this.otherDayTimeIdentifier?i.push(Ae(this.anchorTimestamp),Ae(this.otherTimestamp)):i.push(Ae(this.otherTimestamp),Ae(this.anchorTimestamp))),i},anchorDayTimeIdentifier(){return this.anchorTimestamp!==null?wt(this.anchorTimestamp):!1},otherDayTimeIdentifier(){return this.otherTimestamp!==null?wt(this.otherTimestamp):!1},eventsMap(){return this.daSchedule.scheduledEventsMap()}},methods:{moveFab(i){console.log("moveFab...",i,this.draggingFab,this.fabPos),this.draggingFab=i.isFirst!==!0&&i.isFinal!==!0,this.fabPos=[this.fabPos[0]-i.delta.x,this.fabPos[1]-i.delta.y]},prevMorph(){this.morphGroupModel=this.nextMorphStep.btn},nextMorph(){this.morphGroupModel=this.nextMorphStep[this.morphGroupModel]},morphClose(){this.morphGroupModel=this.nextMorphStep.card2},showEvtMobile(i){return this.daSchedule.showEvtNoteScoreMobile(i)},selectedTimeInterval(){return this.targetDrop.timestamp.time},adjustCurrentTime(){var n,o;const i=Ee(new Date);if(this.currentDate!==i.date){this.timeStartPos=-10,this.currentTime="";return}this.currentDate=i.date,this.currentTime=i.time,this.timeStartPos=(o=(n=this.$refs)==null?void 0:n.calendar)==null?void 0:o.timeStartPos(i.time,!1);let e=this.daSchedule.getCurrentSchedTimesSets(),t=e.endSet&&e.endSet.has(i.time),l=e.startSet&&e.startSet.has(i.time);(t||l)&&(this.daSchedule.updateMinEndNowBtn(this.currentTime,t,l),l&&(this.scrollToTime(i,"slow"),this.doNotify("Event Starting :)","positive","top")))},hasDate(i){return this.currentDate?i.find(e=>e.date===this.currentDate):!1},getDateEvents(i){let e=(l,n)=>{let o=se(l.sortTime,n.sortTime);if(o>0)return-1;if(o==0)return 0;if(o<0)return 1};const t=this.eventsMap[i]||[];return t.length===1?t[0].side="full":t.length,t.sort(e)},constructTree(){this.treeGoals=this.daSchedule.fetchGoalsTree()},resetGoalEvts(){return this.daSchedule.getSubGoals()},allMainGPrio(){return this.daSchedule.getAllPrio()},resetFilter(){var i;this.filter=[],(i=this.filterRef)==null||i.focus()},myFilterMethod(i,e){const t=this.filter.map(l=>l.toLowerCase());if(i.isChildren&&(i==null?void 0:i.moods.length)>0){let l=i==null?void 0:i.moods.some(n=>t.indexOf(n.toLowerCase())>-1);return i.label&&l}},labelScheduled(){return this.daSchedule.labelScheduled()},labelBalance(){return`Balance: ${this.daSchedule.getCurrentBalance()||0} 
`},badgeClasses(i,e){return Ai(i,e)},badgeStyles(i,e,t=void 0,l=void 0){return Bi(i,e,t,l)},classyColor(i){return`row items-center ${i.isChildren?"text-":"text-white bg-"}${i.color} `},isViewingPast(){return this.daSchedule.isViewingPast()},isViewingToday(){return this.daSchedule.isViewingToday()},onMoodAdd(){let i=[];const e=this.filter.map(t=>t.toLowerCase());if(this.treeGoals.filter(t=>{if(t.children.length>0)return t.children.filter(l=>{if((l==null?void 0:l.moods.length)>0&&(l==null?void 0:l.moods.some(n=>e.indexOf(n.toLowerCase())>-1))){let n=l==null?void 0:l.moods.filter(o=>{if(e.indexOf(o.toLowerCase())>-1)return o});return i.push({id:l.id,mood:n}),l}})}),i.length>0)if(i=i.filter(l=>!this.daSchedule.getScheduledEvts().has(l.id)),i.length>0){let l=this.daSchedule.scheduleByMood(i);if(l.canContinue)this.doNotify(`Added ${l==null?void 0:l.added} Evts by Mood...doSave eh`,"info");else{if(l.overlaps&&Object.keys(l.overlaps).length>0)return(l==null?void 0:l.added)>0&&this.doNotify(`${l==null?void 0:l.added} Evts added ${l!=null&&l.noTime?"Plus "+(l==null?void 0:l.noTime)+" Without time":""} BUT some Overlaps to fix!`,"warning"),this.handleOverlaps(l.overlaps,"byMood");this.doNotify("Empty as no Mood Evts :(","warning")}}else this.doNotify(`Evts of Mood '${this.filterString}' already scheduled!`,"warning","top");else this.doNotify("Nothing to add :(","warning","top")},onScheduleOneEach(){let i=l=>{let n=this.daSchedule.scheduleOneEach(l.choice,l.skipOCheck,this.doNotify);if(n.canContinue)this.doNotify(`${n==null?void 0:n.added} Evts by Each ParentGoal...doSave eh`,"info");else{if(n.overlaps&&Object.keys(n.overlaps).length>0)return(n==null?void 0:n.added)>0&&this.doNotify(`${n==null?void 0:n.added} Evts added ${n!=null&&n.noTime?"Plus "+(n==null?void 0:n.noTime)+" Without time":""} BUT some Overlaps to fix!`,"warning"),this.handleOverlaps(n.overlaps,"oneEach");this.doNotify("Empty None for OneEach :(","warning")}t>0||(n==null?void 0:n.added)>0?this.daSchedule.toggleActionBtns(!0,"oneEach"):console.log("onScheduleOneEach::no Evts and no toggling for flag>> ",l.choice,n==null?void 0:n.added)},e=()=>{console.log("onScheduleOneEach..Aborting"),this.reset()},t=this.daSchedule.getScheduledEvts().size;if(t>0){let l=[{label:"Add one Evt from Each parent Goals",value:"add"},{label:"Reset schedule and add one random Evt from Each parent Goals",value:"reset"}];this.scheduleByDialog("Schedule One of Each","One Random Evt per Parent Goal",l,"",i,e)}else i({choice:"reset",skipOCheck:!this.isViewingToday()})},onReloadSaved(){let i=this.daSchedule.hasEventsForDate(),e=()=>{console.log("Aborting reload!",this.currentDate,i)},t=()=>{let l=this.daSchedule.loadEvtsForDay(!1);l.canContinue||(l.overlaps&&Object.keys(l.overlaps).length>0?(console.log("onReloadSaved::OVERLAPS",l.overlaps),this.handleOverlaps(l.overlaps,"view")):(this.doNotify(`Reloaded schedule for ${this.currentDate}`,"positive","bottom"),(this.isViewingPast()||this.currentDate!==st())&&this.adjustCurrentTime())),this.reset()};if(this.daSchedule.getScheduledEvts().size>0&&!this.isViewingPast()){let l=i?`Reload saved schedule of: ${this.currentDate} ?`:"Reset current Schedule?";this.confirmAction("",l,"OK",t,e)}else t()},onClearDay(){let i=this.daSchedule.hasEventsForDate();if(this.isViewingPast()){this.doNotify("Editing past is no no!");return}this.daSchedule.resetSchedule(!0);let e=i?"Cleared...Can still Reload saved":"Resetting...";this.doNotify(e,"warning","top"),this.reset(),this.daSchedule.toggleActionBtns(i,"view")},onLoadDefault(){let i=l=>{let n=this.daSchedule.scheduleDefaults(l.choice,l.skipOCheck);if(n.canContinue)this.doNotify(`Defaults added ${n==null?void 0:n.added} ...doSave eh`,"info");else{if(n.overlaps&&Object.keys(n.overlaps).length>0)return(n==null?void 0:n.added)>0&&this.doNotify(`${n==null?void 0:n.added} Default Evts added ${n!=null&&n.noTime?"Plus "+(n==null?void 0:n.noTime)+" Without time":""} BUT some Overlaps to fix!`,"warning"),this.handleOverlaps(n.overlaps,"byDefaults");this.doNotify("Empty as No Defaults :(","warning")}e>0||(n==null?void 0:n.added)>0?this.daSchedule.toggleActionBtns(!0,"byDefaults"):console.log("onLoadDefault::no Evts and no toggling for flag>> ",l.choice,n==null?void 0:n.added)},e=this.daSchedule.getScheduledEvts().size,t=this.daSchedule.unscheduledDefaults();if(e>0||(t==null?void 0:t.length)>7){let l=[{label:`Add ${t==null?void 0:t.length} Default Evts to current schedule`,value:"add"}];e>0&&l.push({label:"Reset and schedule All Defaults",value:"reset"}),this.scheduleByDialog("Schedule Default Evts","",l,"",function(n){i(n)},function(){console.log("onLoadDefaults::Aborting")})}else i({choice:"reset",skipOCheck:!this.isViewingToday()})},onChoosenPrio(i){this.daSchedule.onChoosenPrio(i)},doReloadWithPrio(){var a,c,m,u,D,S,O,T;let i=this.daSchedule.chosenPrio;if(i==null){this.doNotify("Ayo select a priority!");return}let e=()=>{this.reset()},t=v=>{let g=this.daSchedule.scheduleSamePrio(v.choice,v.skipOCheck);if(g.canContinue)this.doNotify(`${g==null?void 0:g.added} Evts with Priority == ${i} ...doSave eh`,"info");else{if(g.overlaps&&Object.keys(g.overlaps).length>0)return(g==null?void 0:g.added)>0&&this.doNotify(`${g==null?void 0:g.added} Evts added ${g!=null&&g.noTime?"Plus "+(g==null?void 0:g.noTime)+" Without time":""} BUT some Overlaps to fix!`,"warning"),this.handleOverlaps(g.overlaps,"byPrio");this.doNotify(`No Evts with Priority == ${i} :(`,"warning","top")}n>0||(g==null?void 0:g.added)>0?this.daSchedule.toggleActionBtns(!0,"byPrio"):console.log("doReloadWithPrio::no Evts and no toggling for flag>> ",v.choice,g==null?void 0:g.added)},l=this.daSchedule.byPrio,n=this.daSchedule.getScheduledEvts().size,o=`By Goal's Parent Priority == ${i}`,s=[];if(!l){console.log("doReloadWithPrio::ERROR? >> no options",l),s=this.defaultScheduleByOpts(),this.scheduleByDialog("Schedule by Priority",o,s,"",t,e);return}if(((a=l==null?void 0:l.filter)==null?void 0:a.length)>0&&((c=l==null?void 0:l.filter)==null?void 0:c.length)!=n&&s.push({label:`Filter out of ${n} scheduled to ${(m=l==null?void 0:l.filter)==null?void 0:m.length} Evts`,value:"filter"}),((u=l==null?void 0:l.toAdd)==null?void 0:u.length)>0&&s.push({label:`Add ${(D=l==null?void 0:l.toAdd)==null?void 0:D.length} Evts to current schedule`,value:"add"}),((S=l==null?void 0:l.reset)==null?void 0:S.length)>0&&s.push({label:`Reset current and schedule ${(O=l==null?void 0:l.reset)==null?void 0:O.length} Evts.`,value:"reset"}),!s.length>0){this.doNotify(`No Evts with Priority == ${i} :(`,"warning","top");return}n>0?this.scheduleByDialog("Reload by Priority",o,s,"",t,e):((T=l==null?void 0:l.toAdd)==null?void 0:T.length)>7?this.scheduleByDialog("Schedule by Priority",o,s,"",t,e):t({choice:"reset",skipOCheck:!this.isViewingToday()}),this.daSchedule.disablePrioBtn=!0},onChoosenScore(i){this.daSchedule.onChoosenScore(i)},onScheduleByScore(i,e=!1){let t=[],l=!1,n=null;const o=this.daSchedule;let s=()=>[{label:"Keep Evt with Highest Priority",value:"opt1",color:"secondary"},{label:"Manually Choose one event",value:"opt3"}];const r=u=>this.findhighestPrio(u),a=(u,D)=>this.betterEvtLabel(u,D,!1);let c=(u,D,S)=>{this.confirmChoiceDialog("","Choose which Event to keep",u.map(O=>a(O,"default")),"",function(O){let T=u.find(v=>v.id==O);if(!T){console.log("chooseOneEvt::ERROR NOT FOUND!!",O);return}if(D.id==T.id){u.forEach(g=>{g.id!=T.id&&o.removeScheduledEvt(g)});let v=o.addToSchedule(D,!e,!1);//!skipOvCheck
console.log("chooseOneEvt::ADDED",O,S,v)}else u.forEach(v=>{D.id==v.id?console.log("chooseOneEvt,not adding target",v.id,T.id):v.id!=T.id?o.removeScheduledEvt(v):console.log("chooseOneEvt,not adding scheduled",v.id,T.id)});return S=O,S},null,function(){console.log("onScheduleByScore::onDismiss >>chooseOne",S,n),n=S})};i.sort(function(u,D){return Q(u.time)-Q(D.time)}),i.forEach((u,D,S)=>{let O=o.addToSchedule(u,!e,!1);if(O&&Array.isArray(O))if(O.length>1){console.log("onScheduleByScore::OVERLAP >> oneToMany",u,O),l=!0;let T=null;if(O.find(v=>v[0]=="oneToMany")){O=O.filter(v=>v[0]!="oneToMany");for(let v=0;v<O.length;v++){O[v][0];let g=O[v][1];T=g[0].targetStart,this.scrollToTime(T,"slow");let b=[],d=[],y=!1;for(;g.length;){const w=g.pop();let E=this.daSchedule.findSchedEvent(w.inConflict);b.push(`(${E==null?void 0:E.id}) '${E==null?void 0:E.title.trim()}'`),u.id!=w.target&&console.log("onScheduleByScore::ERROR ERROR:: NOT same target ID?!?",u,w),d.push(E),w.direction=="surrounding"?y=!0:y=y}d.unshift(u);let h=`Adding (${u==null?void 0:u.id}) '${u==null?void 0:u.title.trim()}' at ${z(u==null?void 0:u.time)} Conflicts with scheduled ${b.join(" and ")}. `,p=s();y||p.push({label:`Force in > '${u==null?void 0:u.title.trim()}' ?`,value:"opt4"}),this.confirmChoiceDialog("OneToMany Conflicts",h,p,"",function(w){var E;switch(w){case"opt1":let A=r(d);if(console.log("onScheduleByScore::ByPriority >> AUTO ",A.e.id,(E=A==null?void 0:A.e)==null?void 0:E.title.trim()),u.id==A.e.id){d.forEach(ee=>{ee.id!=A.e.id&&o.removeScheduledEvt(ee)});let N=o.addToSchedule(u,!e,!1);//!skipOvCheck
console.log("onScheduleByScore::ByPriority>>ADDED",n,N)}else d.forEach(N=>{N.id!=A.e.id?o.removeScheduledEvt(N):console.log("onScheduleByScore::ByPrio,not adding target?",N.id,A.e.id)});n=w;return;case"opt4":let M=d.find(N=>N.id!=u.id);o.recurChangeTime(M.id,u,T,!0),n=w;return;default:c(d,u,n);return}},null,function(){console.log("onScheduleByScore::onDismiss >> OneToMany",n)})}}else console.log("onScheduleByScore::OVERLAP! ERROR not oneToMany?!?",O)}else t.push(...O);else O===!0||console.log("onScheduleByScore::adding...FAILED?>>",u,O)});const m=()=>{this.doLog("onScheduleByScore::doContinue",t),t.length>0&&this.doNotify(`${t.length} EXTRA Overlaps to fix!`,"negative","top"),this.doNotify("Added byScore!..doSave eh","info","top")};if(l){let u=setInterval(()=>{n&&(setTimeout(()=>{clearInterval(u)},0),m())},3e3)}else m()},doReloadWithScore(){var a,c,m,u,D,S,O,T;let i=this.daSchedule.chosenScore;if(i==null){this.doNotify("Ayo select a score!");return}let e=()=>{this.reset()},t=v=>{let g=this.daSchedule.scheduleByScore(v.choice,v.skipOCheck);if(g.canContinue)this.doNotify(`${g==null?void 0:g.added} Evts with Interval Score <= ${i} ...doSave eh`,"info");else{if(g.overlaps&&Object.keys(g.overlaps).length>0)return(g==null?void 0:g.added)>0&&this.doNotify(`${g==null?void 0:g.added} Evts added ${g!=null&&g.noTime?"Plus "+(g==null?void 0:g.noTime)+" Without time":""} BUT some Overlaps to fix!`,"warning"),this.handleOverlaps(g.overlaps,"byScore");this.doNotify(`No Evts with Interval Score <= ${i} :(`,"warning")}n>0||(g==null?void 0:g.added)>0?this.daSchedule.toggleActionBtns(!0,"byScore"):console.log("doReloadWithScore::no Evts and no toggling for flag>> ",v.choice,g==null?void 0:g.added)},l=this.daSchedule.byScore,n=this.daSchedule.getScheduledEvts().size,o=`Goals with Interval Score <= ${i}`,s=[];if(!l){console.log("doReloadWithScore::ERROR? >> no options",l),s=this.defaultScheduleByOpts(),this.scheduleByDialog("Schedule by Score",o,s,"",t,e);return}if(((a=l==null?void 0:l.filter)==null?void 0:a.length)>0&&((c=l==null?void 0:l.filter)==null?void 0:c.length)!=n&&s.push({label:`Filter out of ${n} scheduled to ${(m=l==null?void 0:l.filter)==null?void 0:m.length} Evts`,value:"filter"}),((u=l==null?void 0:l.toAdd)==null?void 0:u.length)>0&&s.push({label:`Add ${(D=l==null?void 0:l.toAdd)==null?void 0:D.length} Evts to current schedule.`,value:"add"}),((S=l==null?void 0:l.reset)==null?void 0:S.length)>0&&s.push({label:`Reset current and schedule ${(O=l==null?void 0:l.reset)==null?void 0:O.length} Evts.`,value:"reset"}),!s.length>0){this.doNotify(`No Evts with Interval Score <= ${i} :(`,"warning");return}n>0?this.scheduleByDialog("Reload by Score",o,s,"",t,e):((T=l==null?void 0:l.toAdd)==null?void 0:T.length)>10?this.scheduleByDialog("Schedule by Score",o,s,"",t,e):t({choice:"reset",skipOCheck:!this.isViewingToday()}),this.daSchedule.disableScoreBtn=!0},doSaveSchedule(){var t;let i=(t=this.labelScheduled())==null?void 0:t.noTime;this.daSchedule.saveDaySchedule();let e=`Schedule saved for ${this.currentDate}`;i&&(e+=` 
Except for ${i} without time!`),this.doNotify(e,i?"info":"positive"),this.resetFilter()},addNewToSchedule(i,e){console.log("addNewToSchedule: ",i,e);let t=this.daSchedule.findSchedEvent(e.id);if(t){this.doNotify(`${t==null?void 0:t.title} is already scheduled`),this.doCleanup(),this.reset();return}let l=this.daSchedule.addGoalsToSchedule([{...e,time:i.time}],this.isViewingToday());if(l.length>0)return this.handleOverlaps(l,"addNew");this.doNotify(`${e==null?void 0:e.title} Added!..doSave eh`,"positive"),this.daSchedule.toggleActionBtns(!0,"onDrop"),this.doCleanup()},doDroppy(i,e){if(i&&e){let t=e.evt,l=this.daSchedule.tooClose(i,t.duration);if(l&&(console.log("doDroppy::tooClose to>>",l),l===!0)){this.doNotify("Dropping event TOO close to midnight!"),this.reset();return}if(e.type=="tree-item")return this.addNewToSchedule(i,t);let n=this.daSchedule.canDropEvent(i,t);if(n.canContinue){let o=(t==null?void 0:t.inDefaults)||!(t!=null&&t.canMove),s=this.daSchedule.getOriginalEvtTime(t.id),r=!s||(t==null?void 0:t.time)=="";if(o&&!r){let a=t!=null&&t.inDefaults?"Default at ":"Cannot Move from ",c=[`Evt "${t.title.trim()}" ${a} ${z(s)}.`,`
Also Save Evt default time to ${z(i.time)}?`,`
Cancel or No selection to keep at ${z(t.time)}`].join(`
`);const m=this.daSchedule,u=this.doCleanup;this.confirmTimeChange(`${t!=null&&t.inDefaults?"Changing Default Evt's time":"Evt's Cannot move"}`,c,"Change","Temp.Move",function(D){m.changeEvtTime(t,i,D),m.toggleActionBtns(!0,"doDroppy"),u()},function(){u()},function(){console.log(`doDroppy::onDismiss..keep as is>> ${t.id})'${t.title.trim()}'`),u()})}else this.daSchedule.changeEvtTime(t,i,!1),this.daSchedule.toggleActionBtns(!0,"doDroppy"),this.doCleanup()}else this.handleOverlaps(n.overlaps,"onDrop")}else{console.log("doDroppy null ERROR?",i,this.targetDrop,e,this.selectedItem);return}},titleIncludes(i,e){return{includer:i.trim().toLowerCase().includes(e.trim().toLowerCase()),included:e.trim().toLowerCase().includes(i.trim().toLowerCase())}},canAutoSchedule(i,e){let t=this.titleIncludes(i.title,e.title),l=t.includer,n=t.included,o=this.daSchedule.parentGoalById(i.parentGoal),s=this.daSchedule.parentGoalById(e.parentGoal),r=this.titleIncludes(i.title,s.title),a=this.titleIncludes(e.title,o.title);return(r||a)&&console.log("canAutoSchedule:: WOAH PARENT AUTO schedule?--TODO***",r,a),l||n?{addIncSched:l,schdIncToAdd:n}:!1},movedIntoConflict(i,e,t,l=0){console.log("movedIntoConflict >>",JSON.parse(JSON.stringify(i)),"from:"+t,l);const n=(d,y)=>{if(d!=null&&d.parentGoal){let h=this.daSchedule.parentGoalById(d.parentGoal);return y?`Of '${h==null?void 0:h.title.trim()}' (${h==null?void 0:h.priority})`:`Of '${h==null?void 0:h.title.trim()}'`}return console.log("prioLabel..ERROR no PARENT found?",d),""},o=(d,y)=>{switch(y){case"score":return`${n(d,!1)} > "${d.title.trim()}" with Score:: ${d.score} = ${we(d.score)}`;case"prio":return`"${d.title.trim()}" ${n(d,!0)}`;default:return`"${d.title.trim()}" ${n(d,!0)} && Score:: ${d.score} for ${d.duration} mins`}},s=(d,y=!1)=>{this.doNotify(d,y?"warning":"positive","top")},r=d=>{this.daSchedule.deleteEvtMood(d)},a=d=>{console.log(`movedIntoConflict::doRemove ${d.id}:${d.title}`),this.daSchedule.removeScheduledEvt(d)};let c=d=>{console.log("onDismissy::from "+t,d,g),this.doCleanup(),this.daSchedule.toggleActionBtns(!0,t)};const m=(d,y,h)=>{if(console.log(`movedIntoConflict::removeReplace >> replacing>> ${d.id}) '${d.title.trim()}' WITH ${y.id}) ${y.title.trim()}`,h,"from>"+t),e){if(console.log("movedIntoConflict::removeReplace...OVERRIDE from>>"+t),t=="onDrop"){a(d);return}console.log("movedIntoConflict::removeReplace....OVERRIDE updating..."+t),this.daSchedule.doUpdateSchedule(y,h.targetStart);return}if(a(d),t=="onDrop")console.log("movedIntoConflict::removeReplace for onDrop...just updating schedule",y.id,h.targetStart.time),this.daSchedule.doUpdateSchedule(y,h.targetStart);else{console.log("movedIntoConflict::removeReplace >>addGoalsToSchedule from "+t);let p=this.daSchedule.getStoredRawEvt(h.target);p&&(JSON.parse(JSON.stringify(y)),Object.assign(y,p,{time:h.targetStart.time}));let w=this.daSchedule.addGoalsToSchedule([{...y,time:h.targetStart.time}],!0),E=Object.keys(w).length;if(E>0)return console.log(`movedIntoConflict::removeReplace:: OVERLAPS again of size:${E} from >${t}>`+y.title,JSON.parse(JSON.stringify(w))),this.doNotify(`Extra Overlaps while removing to add '${y.title.trim()}' `,"warning","top"),this.movedIntoConflict(w,e,t+"nah")}},u=(d,y)=>{let h=this.daSchedule.findSchedEvent(y.target);if(!h){console.log("movedIntoConflict::forceAddMins>>NOT FOUND?!?",y.target);return}let p=this.daSchedule.getStoredRawEvt(y.target);if(p){let w=h.duration+parseInt(l);JSON.parse(JSON.stringify(h)),Object.assign(h,p,{duration:w})}else console.log("movedIntoConflict::forceAddMins >>NEWLY ADDED?!? Error?",h.id,h,p),Object.assign(h,{duration:newDura});this.daSchedule.recurChangeTime(d.id,h,y.targetStart,!1,this.doNotify),this.doSaveSchedule()},D=(d,y,h)=>{console.log(`movedIntoConflict::forceAdd:${t} >>${y.id})'${y.title}' at ${y.time} to ${h.targetStart.time}
          
Changing >>${d.id} from ${d.time}`);let p=this.daSchedule.getStoredRawEvt(h.target);p&&(JSON.parse(JSON.stringify(y)),Object.assign(y,p,{time:h.targetStart.time}));let w=this.daSchedule.recurChangeTime(d.id,y,h.targetStart,t!="onDrop",this.doNotify);if(w){let E=Object.keys(w).length;if(E>0)return console.log(`movedIntoConflict::forceAdd:: OVERLAPS again of size:${E} from >${t}>`+y.title,JSON.parse(JSON.stringify(w))),this.doNotify(`Extra Overlaps while adding '${y.title.trim()}'`,"negative","top"),this.movedIntoConflict(w,e,t+"nah")}c("ForceAdd")};let S=(d,y,h,p,w)=>{g.push(y),y==h.id?(m(p,h,w),s(`by ${d}, ${t=="onDrop"?"Moving":"Adding"} '${h.title.trim()}'`,!0)):(console.log(`onOkChoice::by ${d},chose scheduled ${y} ...with override?`,e,t),s(`by ${d}, Keeping '${p.title.trim()}'`),t.indexOf("byMood")>-1&&r(h.id),t=="onDrop"&&a(h))},O=(d,y)=>{if(e){if(console.log("movedIntoConflict::cancelChoice::OVERRIDE...coolios!!from:"+t,d.title.trim()),t=="onDrop"){s("Umm...not moving then...."),this.daSchedule.toggleActionBtns(!1,"view");return}a(d),s(`Keeping '${y.title.trim()}'`);return}t.indexOf("byMood")>-1&&r(d.id),this.daSchedule.toggleActionBtns(!0,"view"),s(`Keeping scheduled '${y.title.trim()}'`)};const T=(d,y,h,p)=>{if(d=="opt3"){let w="Pick one event...",E=[{label:o(y,"def"),value:y.id,color:"secondary"},{label:o(h,"def"),value:h.id}];this.confirmChoiceDialog("",w,E,"",function(A){S("Choice",A,y,h,p)},null,function(){c("resolveChoice::byEvent... dismissing")})}else if(d=="opt2"){let w="Pick event by Score",E=[{label:o(y,"score"),value:y.id,color:"secondary"},{label:o(h,"score"),value:h.id}];this.confirmChoiceDialog("",w,E,"",function(A){S("Score",A,y,h,p)},null,function(){c("resolveChoice::byScore... dismissing")})}else if(d=="opt1"){let w="Pick event by Priority",E=[{label:o(y,"prio"),value:y.id,color:"secondary"},{label:o(h,"prio"),value:h.id}];this.confirmChoiceDialog("",w,E,"",function(A){S("Priority",A,y,h,p)},null,function(){c("resolveChoice::byPriority... dismissing")})}else d=="opt0"?(console.log("resolveChoice::it's a drop?...keeping as is....",t),s("Umm...keeping as is then!"),this.doCleanup()):D(h,y,p)},v=(d,y,h,p,w)=>{p.direction!=="surrounding"&&!w&&(t.indexOf("nah")>-1?console.log("movedIntoConflict::manualSolve NOT adding Force as from "+t):d.push({label:`Force in '${y.title.trim()}'`,value:"opt4"}));let E=`${t=="onDrop"?"Moving":"Adding"} '${y.title.trim()}' at ${z(p.targetStart.time)} Overlaps with Scheduled '${h.title.trim()}' at ${z(h==null?void 0:h.time)}.
          
Cancel to keep '${h.title.trim()}' `,A=w?"Choose Auto Resolution":"Resolve Overlapping Events";this.confirmChoiceDialog(A,E,d,"opt1",function(M){T(M,y,h,p)},function(){console.log("movedIntoConflict>>manualSolve::cancelChoice? Notif?>> from: "+t,g[0]),s("Umm...keeping as is then!")})};let g=[],b=Object.keys(i).length;i.find(d=>d[0]=="oneToMany");for(let d=0;d<b;d++){let y=i[d][0];if(y=="oneToMany"){console.log("movedIntoConflict...skipping oneToMany key",y,i.oneToMany);continue}let h=i[d][1],p=[{label:"Choose one event",value:"opt3"}];t=="onDrop"?p.unshift({label:"Leave as is!",value:"opt0"},{label:"Choose by Priority",value:"opt1",color:"secondary"},{label:"Choose by Score",value:"opt2"}):p.unshift({label:"Choose by Priority",value:"opt1",color:"secondary"},{label:"Choose by Score",value:"opt2"});const w=h.pop();let E=this.daSchedule.getSubGoalByID(w.target),A=this.daSchedule.findSchedEvent(w.inConflict);if(!A||!E){console.log("movedIntoConflict...ERROR ERROR no evts found!!!",w);return}let M=this.canAutoSchedule(E,A);if(t=="onAddMins"){let N=A!=null&&A.inDefaults?"In Defaults":A!=null&&A.canMove?"":"Cannot move",ee=`Adding ${l} mins to "${E.title.trim()}" Overlaps with Scheduled "${A.title.trim()}" at ${z(A.time)} as ${N}.
            
Force?
            
Cancel/Dismiss to Leave as is.`;this.confirmAction("",ee,"Add",function(){u(A,w)},function(){s("Keeping as Is...")})}else if(M){console.log("movedIntoConflict:: can AUTO schedule",M.addIncSched,M.schdIncToAdd,"direction == surrounding? >>",w.direction=="surrounding"),this.scrollToTime(w==null?void 0:w.targetStart,"slow");let N=`"${E.title.trim()}" at ${z(E.time)} related to Scheduled "${A.title.trim()}" at ${z(A.time)}.
            
Auto resolve Overlap?
            
Cancel/Dismiss to manually choose.`;this.confirmAction("",N,"Auto",function(){var ee;M.addIncSched?(console.log("Auto resolve::removeReplace..with TIMES>>",E.time,A.time,(ee=w==null?void 0:w.targetStart)==null?void 0:ee.time),m(A,E,w),s(`Removing Scheduled to Add '${E.title.trim()}'`,!0),g.push(E.id)):(console.log("Auto resolve::cancelChoice >> from: ",t),O(E,A),g.push(A.id))},function(){v(p,E,A,w,!0)},function(){c("Auto-dismiss")})}else v(p,E,A,w,!1)}},handleOverlaps(i,e=""){let t=i.length;i.reverse(),this.doLog("handleOverlaps::ORIGNL from: "+e+" >> "+t,i);let l=i.filter(o=>o[0]=="oneToMany");l&&(i=i.filter(o=>o[0]!="oneToMany"),t=i.length);const n=ki(i);for(let o=0;o<t;o++){let s=i[o][0],r=i[o][1],a=null;o>0?a=n[o-1][1][0].targetStart:a=null,o==t-1&&(e.indexOf("nah")>-1?console.log("handleOverlaps...NO END SCROLL::FROM",e,s):this.scrollToTime(r[0].targetStart,"slow")),l&&l.find(c=>c[1]==s)?this.fixConflicts(r,e,!0,[t,o],a):this.fixConflicts(r,e,!1,[t,o],a)}},fixConflicts(i,e,t,l,n=null){var F;const o=R=>this.daSchedule.findSchedEvent(R),s=R=>this.daSchedule.getSubGoalByID(R),r=(R,k)=>{if(!R){console.log("fixConflicts::scrollToConflict ERROR >>empty time hasOneToMany="+t,k,R);return}setTimeout(()=>{this.scrollToTime(R,"slow")},1e3)},a=R=>{this.doNotifyTimeout(R,"negative","top",1e4)},c=(R,k=!1)=>{this.doNotify(R,k?"warning":"positive","top")},m=R=>this.findhighestPrio(R);let u=R=>this.getSmallestScoreInterval(R),D=R=>{console.log("onDismissy>> ",R,h.length),h.length>0&&setTimeout(()=>{t?S(h,E):O(h,E)},0),this.doCleanup()},S=(R,k)=>{console.log(`fixConflicts::removeWithID with toKeep=${R.length} `,n==null?void 0:n.time);let $=[],P=!1;for(k.forEach((f,q,H)=>{if(R.find(I=>I.id==f.id))if(f.id==p.id){let I=y.has(f.id)?y.get(f.id):"",L=d.has(f.id)?d.get(f.id):d.get(p.id),J=this.daSchedule.getStoredRawEvt(f.id);J&&(JSON.parse(JSON.stringify(f)),Object.assign(f,J,{time:L.time}));let te=e=="onDrop"?this.daSchedule.doUpdateSchedule(f,L)||{}:this.daSchedule.addGoalsToSchedule([{...f,time:L.time}],!1);if(Object.keys(te).length>0)console.log("fixConflicts::removeWithID::OVERLAP on add",te,f,L.time),$.push(te);else{let U=`${I} ${ge?"Moving":"Adding"} '${f==null?void 0:f.title.trim()}' at ${z(L.time)}`;this.doNotify(U,"positive","top")}P=!0}else{console.log("fixConflicts::removeWithID....Keeping scheduled Evt!!",f.id,f.title,f.time,d.get(f.id));let I=this.daSchedule.stillInSchedule(f.id);if(I.inSched){let L=`${y.has(f.id)?y.get(f.id):""} Keeping scheduled '${f==null?void 0:f.title.trim()}'`;this.doNotify(L,"positive","top")}else{this.doLog("fixConflicts::removeWithID>>ERROR::scheduled was removed: "+f.id+" "+f.title,I),this.doNotify(`Re-adding ${f.title}`,"warning"),I.inStore?Object.assign(f,I.inStore):console.log("fixConflicts::removeWithID>>scheduled was removed >>NOT STORED!!TODO**");let L=this.daSchedule.addGoalsToSchedule([f],!0);L.length>0?$.push(L):console.log("fixConflicts::removeWithID>>scheduled was removed >>NO Overlaps!!")}}else if(f.id!=p.id){console.log("fixConflicts::removeWithID >>removing scheduled",f.id,f.title,f.time);let I=this.daSchedule.getCurrentMoods()[f.id];this.daSchedule.removeScheduledEvt(f);let L=`Removed scheduled '${f==null?void 0:f.title.trim()}'`;L=I?L+` With Moods: '${I}'`:L,this.doNotify(L,I?"negative":"warning"),P=!0}else e=="onDrop"?(console.log("fixConflicts::removeWithID >>Removing target onDrop!!",f.id,f.title,f.time),this.daSchedule.removeScheduledEvt(f)):console.log("fixConflicts::removeWithID >>NOT adding original target",p.id),this.daSchedule.deleteEvtMood(p.id),this.resetFilter()}),e=="onDrop"||P?(this.daSchedule.toggleActionBtns(!0,e),this.doCleanup()):console.log("fixConflicts::removeWithID...NO TOGGLING",e);$.length;){const f=$.pop();this.doLog(`${e}> fixConflicts::removeWithID:: OVERLAPS`,f),this.doNotify("EXTRA Overlaps to fix!","negative","top");let q=e.indexOf("view")>-1?e:e+"nah";return this.handleOverlaps(f,q)}return n?r(n,"removeWithID"):console.log("fixConflicts::removeWithID >> NO SCROLLING after conflicts",e,n,P),"removeWithID"},O=(R,k)=>{console.log(`fixConflicts::removeConflicts with toKeep=${R.length}`,n==null?void 0:n.time);let $=[],P=!1;for(k.forEach((f,q,H)=>{if(R.find(I=>I.id==f.id)){let I=y.has(f.id)?y.get(f.id):"",L=d.has(f.id)?d.get(f.id):null;if(f.id!=w.id){let J=this.daSchedule.getStoredRawEvt(f.id);J&&(JSON.parse(JSON.stringify(f)),Object.assign(f,J,{time:L.time}));let te=e=="onDrop"?this.daSchedule.doUpdateSchedule(f,L)||{}:this.daSchedule.addGoalsToSchedule([{...f,time:L.time}],this.isViewingToday());if(te&&Object.keys(te).length>0)$.push(te),this.doNotify(`Extra Overlaps while adding '${f==null?void 0:f.title.trim()}'`,"negative","top");else{let U=`${I} ${ge?"Moving":"Adding"} '${f==null?void 0:f.title.trim()}' at ${z(L.time)}`;this.doNotify(U,"positive","top")}P=!0}else{let J=this.daSchedule.stillInSchedule(f.id);if(J.inSched)this.doNotify(`${I} Keeping scheduled '${f==null?void 0:f.title.trim()}' `,"positive","top");else{this.doLog("fixConflicts::removeConflicts>>ERROR::scheduled was removed: "+f.id+" "+f.title,J),this.doNotify(`Re-adding ${f.title}`,"warning"),J.inStore?Object.assign(f,J.inStore):console.log("fixConflicts::removeConflicts>>scheduled was removed >>NOT STORED!!TODO**");let te=this.daSchedule.addGoalsToSchedule([f],!0);te.length>0?$.push(te):console.log("fixConflicts::removeConflicts>>scheduled was removed >>NO Overlaps!!")}}}else if(f.id==w.id){let I=this.daSchedule.getCurrentMoods()[f.id];this.daSchedule.removeScheduledEvt(f);let L=`Removed scheduled '${f==null?void 0:f.title.trim()}'`;L=I?L+` With Moods: '${I}'`:L,this.doNotify(L,I?"negative":"warning"),P=!0}else console.log("fixConflicts::removeConflicts >> NOT adding target ",f.id,f.title),this.daSchedule.deleteEvtMood(f.id),this.resetFilter()}),e.indexOf("view")>-1||P?this.daSchedule.toggleActionBtns(!0,e):console.log("fixConflicts::removeConflicts...NO TOGGLING",e,P);$.length;){const f=$.pop();this.doLog(`fixConflicts::removeConflicts::EXTRA OVERLAPS from ${e} `,f),this.doNotify("EXTRA Overlaps to fix","negative","top");let q=e.indexOf("view")>-1?e:e+"nah";return this.handleOverlaps(f,q)}return n?r(n,"removeConflicts"):console.log("removeConflicts::NO SCROLLING after conflicts",n,e,P),"removeConflicts"};const T=(R,k)=>{let $=[],P=k.filter(f=>!R.some(q=>q.id==f.id));for(console.log(`fixConflicts::forceAdd of ${R.length} hasOneToMany=${t} `+e,"allConflicts= "+k.length,n==null?void 0:n.time),k.forEach(f=>{if(R.find(q=>q.id==f.id)){let q=d.has(f.id)?d.get(f.id):null,H=this.daSchedule.getStoredRawEvt(f.id);H&&Object.assign(f,H,{time:q.time});let I=P.length>0?P[0]:null;I||(console.log("fixConflicts::forceAdd::ERROR as no scheduled?!?",P),I=k.find(J=>J.id!=f.id)),console.log(`fixConflicts::forceAdd...NEW:${f.id} '${f.title.trim()}' dura= ${f.duration} 
 
              origAt: ${f.time} added at>>`,q==null?void 0:q.time,"from>>"+e,`
 >> USING for change `+I.id+" "+(I==null?void 0:I.title),"hasOneToMany "+t);let L=this.daSchedule.recurChangeTime(I.id,f,q,e!="onDrop",a);if(L&&Object.keys(L).length>0)console.log("fixConflicts::forceAdd >>OVERLAP on add",L,f,q.time),$.push(L);else{let J=`Force ${ge?"Moved":"Added"}  '${f==null?void 0:f.title.trim()}' at ${z(q.time)}`;this.doNotify(J,"positive","top")}}else t?e=="onDrop"?this.daSchedule.recurChangeTime(f.id,R[0],d.get(R[0].id),e!="onDrop",a):console.log("fixConflicts::forceAdd >> WITHID but nothing to do?",t,f.id):console.log("fixConflicts::forceAdd >>not WITHID >> NOTHING for scheduled",f.id,"Not onDrop: "+e!="onDrop")}),this.daSchedule.toggleActionBtns(!0,e);$.length;){const f=$.pop();return this.doLog("fixConflicts::forceAdd:: EXTRA OVERLAPS "+e,f),this.doNotify("EXTRA Overlaps to fix!","negative","top"),this.handleOverlaps(f,e+"nah")}return n&&r(n,"forceAdd"),"forceAdd"};let v=(R,k)=>{switch(R){case"score":this.confirmChoiceDialog("","Choose one event by Score",k.map($=>this.betterEvtLabel($,"score",!1)),"",function($){let P=k.find(f=>f.id==$);if(P)h.push(P),y.set(P.id,`By Score Interval (${P.score}),`);else{console.log("chooseOneEvt::ERROR NOT FOUND!!",$);return}return P},null,function(){D("chooseOneEvt::>>byScore...")});return;case"prio":this.confirmChoiceDialog("","Choose one event by Priority",k.map($=>this.betterEvtLabel($,"prio",!1)),"",function($){let P=k.find(f=>f.id==$);if(P)h.push(P),y.set(P.id,"By Priority,");else{console.log("chooseOneEvt::ERROR NOT FOUND!!",$);return}return P},null,function(){D("chooseOneEvt::>>byPriority...")});return;default:this.confirmChoiceDialog("","Choose which Event to keep",k.map($=>this.betterEvtLabel($,"default",!1)),"",function($){let P=k.find(f=>f.id==$);if(P)h.push(P),y.set(P.id,"By pick,");else{console.log("chooseOneEvt::ERROR NOT FOUND!!",$);return}return P},null,function(){D("chooseOneEvt::>>byPick...")});return}},g=(R,k,$,P,f)=>{var q;if(R=="opt3")v("default",P);else if(R=="opt2")if(f)v("score",P);else{let H=u(P);H?(h.push(H),y.set(H.id,`By Shortest Score Interval (${H.score}),`)):(console.log("ERROR ERROR::fixConflicts >> smallestScoreInterval::No current set?",P),c("Umm...Score Error",!0),v("score",P))}else if(R=="opt1")if(f)v("prio",P);else{let H=m(P);console.log("fixConflicts::ByPriority >> AUTO "+e,H.e.id,(q=H==null?void 0:H.e)==null?void 0:q.title.trim()),h.push(H.e),y.set(H.e.id,`By Highest Priority (${H.prio}),`)}else R=="opt0"?(console.log("fixConflicts::AUTO:SOLVE >>",p,w,$,P),k.addIncSched?t?(h.push(p),y.set(p.id,"By Title Auto-Solve,")):(h.push($[0]),y.set($[0].id,"By Title Auto-Solve,")):t?(h.push(P[0]),y.set(P[0].id,"By Title Auto-Solve,")):(h.push(w),y.set(w.id,"By Title Auto-Solve,"))):T($,P)},b=()=>{if(e=="onDrop"){c("Umm...not moving then...."),this.doCleanup();return}if(e.indexOf("byMood")>-1){console.log("fixConflicts::cancelChoice >>Mood update? canChooseOne:"+C+" hasOneToMany "+t,p.id),this.daSchedule.deleteEvtMood(p.id);return}if(t){console.log("fixConflicts::cancelChoice::hasOneToMany from> ",e),c("Keeping Schedule as-is...");return}h.push(w)},d=new Map,y=new Map,h=[],p=null,w=null,E=[],A=[],M=!1,N=[];for(i.length;i.length;){const R=i.pop();let k=o(R.inConflict);if(!k){console.log("fixConflicts...ERROR ERROR no evts found!!!",R);return}let $=s(R.target);if(!$){console.log("fixConflicts...ERROR ERROR target evt not found!!!",R);return}d.set(R.target,R==null?void 0:R.targetStart),t?(p?p.id!==R.target&&console.log("fixConflicts::ERROR ERROR:: oneToManyConflict >>Not same target ID?!?",p,R,A,d):(p=$,A.push($),E.unshift($)),N.push(`'${k==null?void 0:k.title.trim()}'`),E.push(k),this.titleIncludes(p.title,k==null?void 0:k.title)):(w?w.id!==k.id&&console.log("fixConflicts::ERROR ERROR::manyToOneConflict Not same schedule?!?",w.id,k.id,R,A):(w=k,E.unshift(k),d.set(R.inConflict,R==null?void 0:R.targetStart)),N.push(`'${$==null?void 0:$.title.trim()}'`),this.titleIncludes($==null?void 0:$.title,w==null?void 0:w.title),A.push($),E.push($)),R.direction=="surrounding"?M=!0:M=M}let ee=N.join(" and "),C=l[0]<3,Te=!1;N.length<2&&(Te=t?this.canAutoSchedule(p,E[0]):this.canAutoSchedule(A[0],w));let X=[],Re=C?"Pick one event via ":"Auto-Resolve to keep Evt with ";if(Te?(this.doLog("fixConflicts::AUTO-RESOLVE!! "+w.id+"hasOneToMany:"+t,Te),X.unshift({label:"By Title Auto-resolve?",value:"opt0"}),X.push({label:"Manually Choose one event",value:"opt3"})):C?X.push({label:"Manually Choose one event",value:"opt3"}):(X.push({label:"Manually Choose one event",value:"opt3"}),e=="byScore"?X.unshift({label:Re+`${C?"Priority":"Highest Priority"}`,value:"opt1",color:"secondary"}):e=="byPrio"?X.unshift({label:Re+`${C?"Score Interval":"Shortest Score Interval"}`,value:"opt2"}):X.unshift({label:Re+`${C?"Priority":"Highest Priority"}`,value:"opt1",color:"secondary"},{label:Re+`${C?"Score Interval":"Shortest Score Interval"}`,value:"opt2"})),!M&&!e.indexOf("nah")>-1){let R=t?`Force in > '${p==null?void 0:p.title.trim()}' ?`:`Force in > ${N.join()}`;X.push({label:R,value:"opt4"})}else{let R=e.indexOf("view")>-1&&C;M&&C&&(e.indexOf("onPickEvt")>-1||e.indexOf("adHocEvt")>-1||R)&&X.push({label:"Force in ?",value:"opt4"})}let ge=e.indexOf("onDrop")>-1,He=e.indexOf("byMood")>-1,oe=`${ge?"Cancel to keep as-is":C&&X.length<=2||Te||He?"Cancel to keep scheduled":""}`,Ce=t?`${ge?"Moving":"Adding"} (${p==null?void 0:p.id}) '${p==null?void 0:p.title.trim()}' at ${z((F=d.get(p.id))==null?void 0:F.time)} Conflicts with scheduled ${ee}. 
 ${oe}`:`${ge?"Moving":"Adding"} ${ee} Conflicts with scheduled (${w==null?void 0:w.id}) '${w==null?void 0:w.title.trim()}' at ${z(w==null?void 0:w.time)}. 
 ${oe}`,de=t?`OneToMany Conflicts #${l[1]+1}`:`ManyToOne Conflicts #${l[1]+1}`;this.radioChoiceDialog(de,Ce,X,"",function(R){g(R,Te,A,E,C)},oe!=""?b:null,function(){D("Main!")})},onPickEvent(i,e,t,l){if(this.closingDialog(),!i||!i.id){console.log("onPickEvent...ERROR nothing!",i,e,t,l),this.doNotify("No Goal selected..."),this.reset();return}const n=()=>{s&&(i.duration=l);let a=this.daSchedule.onPickEvent(i,this.targetDrop.timestamp,o,t,this.doNotifyTimeout);a.canContinue?t&&this.doNotify("What is Owed PAID! gg!","info","top"):a.overlaps&&Object.keys(a.overlaps).length>0?(t&&this.doNotify("Overlaps!-Balance Not Used!","negative","top"),this.handleOverlaps(a.overlaps,"onPickEvt")):this.doNotify("Error? onPickEvt :(","negative","bottom"),this.reset()};let o=this.isViewingPast()?!0:e,s=l!=i.duration,r=this.daSchedule.tooClose(this.targetDrop.timestamp,s?l:i.duration);if(r){if(console.log("onPickEvent::tooClose check FAIL!",r),r===!0){this.doNotify("Picking event TOO close to midnight!"),this.reset();return}if(o)this.doNotify(`'${i.title.trim()}' TOO close Buuut..FORCING!`,"warning","top");else{this.withActionNotify(`'${i.title.trim()}' TOO close to an Evt!!`,function(){console.log("onPickEvent::Force eh"),n()});return}}n()},onAddHocEvent(i,e,t,l,n){if(this.possibleRange||(this.possibleRange=this.startEndTimes),i.trim()==""){this.doNotify("Empty Goal title..."),this.closingDialog(),this.reset();return}let o=Mt(this.possibleRange[0]),s=l>15?G(o,{minute:parseInt(l)}):G(Mt(this.possibleRange[1]),{minute:15}),r=Math.floor(se(o,s)/1e3/60),a=this.daSchedule.tooClose(o,r);if(a){if(console.log("onAddHocEvent::tooClose check FAIL!!",a),this.closingDialog(),a===!0){this.doNotify(`'${i}' Not added as over midnight!`);return}this.doNotify(`'${i}' too close to a scheduled Evt--Forcing!!`,"warning")}this.closingDialog();let c=this.daSchedule.saveNewGoal(o,i,e,t,r);if(c===0||c){let m=this.daSchedule.onAdHocEvent(c,o,n,this.doNotifyTimeout);if(m.canContinue)this.constructTree(),this.reset(),this.mobile&&this.adjustCurrentTime();else if(console.log("onAdHocEvent::OVERLAPS?",JSON.parse(JSON.stringify(m))),m.overlaps==null){this.doNotify("Error Adding this event :(","negative"),console.log("onAdHocEvent::ERROR not found?");return}else n&&this.doNotify("Overlaps!-Balance Not Used!","warning","top"),this.handleOverlaps(m.overlaps,"adHocEvt")}else console.log("onAdHocEvent::BOO ERROR no subID :(",c),this.doNotify("Error adding :(  Add Evt by select!","negative")},onEndNow(i){const e=()=>{let s=this.daSchedule.findSchedEvent(i);this.daSchedule.removeScheduledEvt(s),this.doNotify(`Removing "${s==null?void 0:s.title.trim()}" and Saving...`,"info"),this.doSaveSchedule()},t=s=>{this.daSchedule.reduceEvtDuration(i,s),this.doNotify("Reducing and Saving...","info")},l=s=>{const r=Ee(new Date);let a=s.start,c=s.end;if(!Ot(r,a,c,!0))return console.log("onEndNow::ERROR >> not in the middle of event?!? Nothing to do...",r.time,a.time,c.time,s),!1;let m=G(r,{minute:0}),u=se(a,m);return Math.floor(u/1e3/60)};let n=this.daSchedule.findSchedEvent(i);if(!n){console.log("onEndNow::ERROR Evt not found!!!",i,n),this.doNotify("Error evt not in schedule?!","negative");return}let o=l(n);o?o<10?this.confirmAction("",`Less than 10mins remove?
 Cancel to just EndNow`,"Remove",e,function(){t(o)}):t(o):console.log("onEndNow...END",i,o,Number.isInteger(o))},onSaveScore(i,e,t=""){let l=we(i);if(l<-1){l==-89?(console.log("onSaveScore parsing error",l,i),this.doNotify("Score Parsing Error... YOU FOO! ")):this.doNotify("Score Error: higher# on lower#");return}this.daSchedule.updateNoteScore(e,i,t),t!==""&&!this.isViewingPast()&&this.doNotify("Note added...do Save eh!","warning","bottom")},onAddMins(i,e){let t=this.daSchedule.addMinsToEvt(i,e,this.doNotify);if(!t.canContinue){if(t.overlaps&&Object.keys(t.overlaps).length>0)return this.doNotify("Bumped into some Evts","warning","top"),this.movedIntoConflict(t.overlaps,!0,"onAddMins",e);this.doNotify("Add ERROR:(","negative","bottom")}},removeEvtInSchedule(i,e=!0){let t=!1,l=()=>{if(this.daSchedule.removeScheduledEvt(i),t||e){e&&(this.daSchedule.addToBalance(i),this.doNotify(`Balance change after removing '${i.title}'`,"warning","top")),this.doSaveSchedule();return}this.daSchedule.toggleActionBtns(!0,"view")},n=()=>{console.log("Cancelled remove.."),this.reset(),this.closingDialog()},o=()=>this.chooseAlternatives(i);if(this.isViewingPast()){if(i.duration<30){this.doNotify("Removing from the past... Check BALANCE!"),this.daSchedule.addToBalance(i),t=!0,l();return}this.chooseAlternatives(i);return}if(!this.isViewingToday()&&!this.mobile){t=this.daSchedule.getCurrentMoods()[i.id],console.log("Removing future evt"),l();return}let s=`Remove "${i.title}" ?`,r=this.daSchedule.getStoredRawEvt(i.id),a=this.daSchedule.getCurrentMoods()[i.id];a&&(t=!!r,s=s+` With Moods: '${a}'`),r||(e=!1);let c=e?"Remove (Balance affected)":"Schedule Change";i.duration>=30&&e?this.confirmCancelAction(c,s+` 
 Or choose an alternative?`,"Remove","Choose",l,o):this.confirmAction(c,s,"Remove",l,n)},defaultScheduleByOpts(){return[{label:"Filter out of current scheduled Evts",value:"filter"},{label:"Add Evts to current schedule",value:"add"},{label:"Reset current schedule",value:"reset"}]},betterEvtLabel(i,e,t=null){const l=(o,s)=>{if(o!=null&&o.parentGoal){let r=this.daSchedule.parentGoalById(o.parentGoal);return s?`Of '${r==null?void 0:r.title.trim()}' (${r==null?void 0:r.priority})`:`Of '${r==null?void 0:r.title.trim()}'`}return console.log("prioLabel..ERROR no PARENT found?",o),""};let n="";switch(e){case"score":return n=`${l(i,!1)} > "${i.title.trim()}" with Score:: ${i.score} = ${we(i.score)} `,n+=t?`@ ${z(i==null?void 0:i.time)} ++ ${i==null?void 0:i.duration} mins`:`for ${i==null?void 0:i.duration} mins`,{label:n,value:i.id};case"prio":return n=`"${i.title.trim()}" ${l(i,!1)} `,n+=t?`@ ${z(i==null?void 0:i.time)} ++ ${i==null?void 0:i.duration} mins`:`for ${i==null?void 0:i.duration} mins`,{label:n,value:i.id};default:return n=`"${i.title.trim()}" ${l(i,!0)} && Score:: ${i.score} = ${we(i.score)} ${t?` @ ${z(i==null?void 0:i.time)} ++ ${i==null?void 0:i.duration} mins`:`for ${i.duration} mins`}`,{label:n,value:i.id}}},getLargestScoreInterval(i){let e=0,t=null;for(let l of i){let n=we(l.score);n>-1&&n>=e&&(e=n,t=l)}return t},expandAll(){for(let i of this.treeGoals)this.expanded[i.label]=!0},getSmallestScoreInterval(i){let e=9,t=null;for(let l of i){let n=we(l.score);n>-1&&n<=e&&(e=n,t=l)}return t},findhighestPrio(i){let e=0,t=null;for(let l of i)if(l.parentGoal){let n=this.daSchedule.parentGoalById(l.parentGoal);n?n.priority>e&&(e=n.priority,t=l):console.log("findhighestPrio::ERROR no PARENT found?",l)}else console.log("findhighestPrio::ERROR EVT not found?",l);return{e:t,prio:e}},chooseAlternatives(i){let e=this.daSchedule.getAlternatives(),t=Ee(new Date),l=i.time,n=t.date,o=i.title,s=this.isViewingToday();const r=S=>S.filter(O=>!this.daSchedule.getScheduledEvts().has(O.id)),a=S=>{let O=G(ne(n),{day:s?1:0}),T=G(ne(O.date),{day:1}),v=this.daSchedule.getEventsForDate(O.date),g={},b=null;v?g=v:console.log("chooseAlternatives::addInFutur EMPTY for >>...",O.date),S.forEach(d=>{if(b=this.daSchedule.getSubGoalByID(d),g[d]){console.log("addInFutur...ALREADY PRESENT",d,O.date,b==null?void 0:b.title.trim()),this.doNotify(`Alternative '${b==null?void 0:b.title.trim()}' already present on ${O.date}. Moving it to next day`,"warning");let y=this.daSchedule.getEventsForDate(T.date);if(y)if(!y[d])y[d]={duration:b==null?void 0:b.duration,time:l,notes:`Alt replace for '${o}'`};else{console.log("addInFutur...STILL PRESENT in next day:"+T.date,b.title.trim()),this.doNotify(`Booo! Alt '${b==null?void 0:b.title.trim()}' also present on ${T.date} :(( ...Check BALANCE!`),this.daSchedule.addToBalance(b);return}else y={},y[d]={duration:b.duration,time:l,notes:`Alt replace for '${o}'`};this.daSchedule.updateDaySchedule(T.date,y),this.doNotify(`Saving ${b.title} in ${T.date}`,"info","bottom")}else g[d]={duration:b.duration,time:l,notes:`Alt replace for '${o}'`}}),this.daSchedule.updateDaySchedule(O.date,g)},c=S=>{this.daSchedule.removeScheduledEvt(i);let O=e.find(g=>g.id==S);console.log("remReplace...Add at:",l,O.title,"usually at:"+O.time);let T=this.daSchedule.addGoalsToSchedule([{...O,time:l,notes:`Alt replace for '${o}'`}],!0),v=Object.keys(T).length;if(v>0)return console.log(`chooseAlternatives::removeReplace:: OVERLAPS again from ${O.length} overlaps =${v}`,O,T),this.doNotify(`Extra Overlaps while adding ${O.title.trim()}`,"negative"),this.handleOverlaps(T,"alts");this.daSchedule.saveDaySchedule(),this.doNotify(`Added Alt replacement '${O==null?void 0:O.title}' at ${l}`,"info")},m=S=>{this.doNotify(S)},u=()=>{this.daSchedule.removeScheduledEvt(i),this.daSchedule.addToBalance(i),this.doNotify(`Balance change after removing '${i.title}'`,"warning","top"),this.doSaveSchedule()};if(e=r(e),e.length==0){this.withActionNotify("...Alternatives already present!",u);return}let D=`First Evt to replace Removed ${s?"(today)":""} + an Extra evt for next day! ${s?"":"(today)"}`;this.checkBoxDialog(`Alternative for '${o}'`,D,e.map(S=>this.betterEvtLabel(S,"default",!1)),function(S){console.log("chooseAlternatives::opt",S),c(S.shift()),S.length>0?a(S):(console.log("chooseAlternatives::onOk...nothing to add?!?",e.length,S.length,e.length-S.length),m("No Alternative scheduled later :("))},function(){console.log("chooseAlternatives::onCancel")})},reset(){this.selectedItem=null,this.targetDrop=null,this.touchedItem=null,this.daSchedule.resetChosen(),this.possibleRange=null},doCleanup(){this.lastTarget&&(this.lastTarget.style.background="",this.lastTarget=null)},closeDialogWithReset(){this.showEvtDialog=!1,this.selectedItem=null,this.targetDrop=null,this.touchedItem=null,this.possibleRange=null},closingDialog(){this.showEvtDialog=!1},doLog(i,e){console.log(i,JSON.parse(JSON.stringify(e)))},onPrev(){let i=()=>{this.$refs.calendar.prev(),this.adjustCurrentTime()},e=()=>{setTimeout(i,1e3),this.doSaveSchedule()};this.saveScheduleDisabled?i():this.confirmAction("",`Save day: ${this.currentDate} changes?`,"Save",e,i)},onToday(){let i=()=>{this.$refs.calendar.moveToToday(),this.adjustCurrentTime()},e=()=>{setTimeout(i,1e3),this.doSaveSchedule()};this.saveScheduleDisabled?i():this.confirmAction("",`Save day: ${this.currentDate} changes?`,"Save",e,i)},onNext(){let i=()=>{this.$refs.calendar.next(),this.adjustCurrentTime()},e=()=>{setTimeout(i,1e3),this.doSaveSchedule()};this.saveScheduleDisabled?i():this.confirmAction("",`Save day: ${this.currentDate} changes?`,"Save",e,i)},onChange(){let i=this.daSchedule.onChangeViewDate(this.currentDate);if(!i.canContinue){if(i.overlaps&&i.overlaps.length>0)return this.handleOverlaps(i.overlaps,"view");this.doNotify(`Loaded schedule for ${this.currentDate}`,"positive","bottom"),this.adjustCurrentTime()}},onDragStart(i,e,t){if(this.isViewingPast()){this.doNotify("Editing past is no no!"),i.preventDefault();return}if(e=="tree-item"){let l=this.daSchedule.getSubGoalByID(t.id);console.log("onDragyStart::TreeItem "+e,JSON.parse(JSON.stringify(t)),JSON.parse(JSON.stringify(l))),this.selectedItem={evt:{...l,color:t.color},type:e};return}this.selectedItem={evt:t,type:e}},onDragEnter(i,e,t){var l;if(e==="goal-item")i.preventDefault();else{if(this.targetDrop&&this.targetDrop.timestamp.time==t.timestamp.time)console.log("onDragEnter...calendar,SAME",this.targetDrop.timestamp.time);else{let n=i.target,o=(l=this.selectedItem.evt.bgcolor)!=null?l:this.selectedItem.evt.color;n.style.background=o.includes("-")?"grey":o,this.lastTarget=n}this.targetDrop=t,i.preventDefault()}return!0},onDragOver(i,e,t){return i.preventDefault(),!0},onDragLeave(i,e,t){let l=i.target;return l.style.background="",!1},onDragEnd(i){},onDrop(i,e,t){let l=null;if(e==="interval")l=t.timestamp;else if(e==="goal-item"&&this.targetDrop)l=this.targetDrop.timestamp;else{console.log("Cannot drop here YO!!",i,e,t,this.targetDrop);return}if(!l){console.log("ERROR...no timestamp YO!!",i,e,t,this.targetDrop);return}this.doDroppy(l,this.selectedItem)},onClickTime(i){this.targetDrop=i.scope,this.showEvtDialog=!0},onClickDate(i){console.log("onClickDate",i)},onClickInterval(i){console.log("onClickInterval",i)},onClickHeadIntervals(i){console.log("onClickHeadIntervals",i)},onClickHeadDay(i){console.log("onClickHeadDay",i)},onMouseDownTime({scope:i,event:e}){if(Wt(e)){if(this.mobile===!0&&this.anchorTimestamp!==null&&this.otherTimestamp!==null&&Ae(this.anchorTimestamp)===Ae(this.otherTimestamp)){this.otherTimestamp=i.timestamp,this.mouseDown=!1;return}this.mouseDown=!0,this.anchorTimestamp=i.timestamp,this.otherTimestamp=i.timestamp}},onMouseUpTime({scope:i,event:e}){if(this.mobile!==!0&&Wt(e)&&(this.otherTimestamp=i.timestamp,this.mouseDown=!1),!this.mousedown){let t=this.startEndTimes;if(t[1]==t[0])return;this.possibleRange=t,console.log("onMouseUpTime range change",this.possibleRange)}},onMouseMoveTime({scope:i,event:e}){this.mobile!==!0&&this.mouseDown===!0&&(this.otherTimestamp=i.timestamp)},onDblClickEvent(i,e){if(this.isViewingPast()){if(console.log("onDblClickEvent::ERROR?",e),e.duration<30){console.log("onDblClickEvent..baah too smoll smoll",e.title,e.duration),this.doNotify("umm Removing from the past..Soo Check BALANCE!"),this.daSchedule.addToBalance(e),this.daSchedule.removeScheduledEvt(e);return}this.chooseAlternatives(e),i.preventDefault();return}this.removeEvtInSchedule(e,!1),i.preventDefault()},onTouchHStart(i,e,t){if(e=="tree-item"){let l=this.daSchedule.getSubGoalByID(t.id);return console.log("onTouchHStart::TreeItem "+e,JSON.parse(JSON.stringify(t)),JSON.parse(JSON.stringify(l))),this.selectedItem={evt:{...l,color:t.color},type:e},i.preventDefault(),!0}return this.selectedItem={evt:t,type:e},i.target.classList.add("my-header-drag"),i.preventDefault(),!0},onTouchStart(i,e,t){if(i.type=="touchstart"){this.selectedItem={evt:t,type:e};let l=document.elementFromPoint(i.changedTouches[0].clientX,i.changedTouches[0].clientY);if(l.parentNode.classList.contains("my-event"))l.parentNode.classList.add("my-event-drag"),this.touchedItem=l;else if(l=l.parentNode,l.parentNode.classList.contains("my-event"))l.parentNode.classList.add("my-event-drag"),this.touchedItem=l;else{this.touchedItem=!1;return}return i.preventDefault(),!0}console.log("onTouchStart::ERROR...UNKNOWN",i)},onTouchHEvt(i,e){var t;if(i.type=="touchmove"){let l=document.elementFromPoint(i.changedTouches[0].clientX,i.changedTouches[0].clientY);if(l.ariaLabel){let n=this.getLabelTime(l.ariaLabel);if(this.targetDrop){let o=se(this.targetDrop,n);if(JSON.stringify(this.targetDrop)===JSON.stringify(n)&&o==0)return;let r=(t=this.selectedItem.evt.bgcolor)!=null?t:this.selectedItem.evt.color;this.lastTarget?(this.lastTarget.style.background="",l.style.background=r.includes("-")?"grey":r,this.lastTarget=l):(this.lastTarget=l,l.style.background=r.includes("-")?"grey":r)}this.targetDrop=n}return i.preventDefault(),!0}if(i.type=="touchend"){let l=document.elementFromPoint(i.changedTouches[0].clientX,i.changedTouches[0].clientY);if(l.ariaLabel){let n=this.getLabelTime(l.ariaLabel);this.targetDrop=n,this.doDroppy(this.targetDrop,this.selectedItem)}else this.targetDrop&&this.doDroppy(this.targetDrop,this.selectedItem);i.preventDefault(),i.stopPropagation();return}console.log("onTouchHEvt::UNKNOWN",i)},onTouchEvt(i,e){var l;let t=n=>{let o=n.closest(".my-event");o.classList.contains("my-event-drag")&&o.classList.toggle("my-event-drag")};if(!this.selectedItem){console.log("onTouchEvt NULL Item >>ERROR?!? "+i.type,this.selectedItem,this.touchedItem);return}if(this.isViewingPast()){this.doNotify("Editing past is no no!"),t(this.touchedItem),i.preventDefault(),i.stopPropagation();return}if(i.type=="touchmove"){let n=document.elementFromPoint(i.changedTouches[0].clientX,i.changedTouches[0].clientY);if(n.ariaLabel){let o=this.getLabelTime(n.ariaLabel);if(this.targetDrop){let s=se(this.targetDrop,o);if(JSON.stringify(this.targetDrop)===JSON.stringify(o)&&s==0)return;let a=(l=this.selectedItem.evt.bgcolor)!=null?l:this.selectedItem.evt.color;this.lastTarget?(this.lastTarget.style.background="",n.style.background=a.includes("-")?"grey":a,this.lastTarget=n):(this.lastTarget=n,n.style.background=a.includes("-")?"grey":a)}this.targetDrop=o,i.preventDefault();return}return}if(i.type=="touchend"){let n=document.elementFromPoint(i.changedTouches[0].clientX,i.changedTouches[0].clientY);if(!this.touchedItem)return;if(n.parentNode.classList.contains("my-event-drag"))console.log("onTouchEvt::END >>removing my-event-drag","isDisabledScoreEdit>> "+this.daSchedule.isDisabledScoreEdit[e.id],"mobileEnableScore>> "+this.daSchedule.mobileEnableScore[e.id]),n.parentNode.classList.remove("my-event-drag");else{let o=this.touchedItem.parentNode.classList.contains("my-event-drag");o?this.touchedItem.parentNode.classList.remove("my-event-drag"):console.log("onTouchEvt::END...target NO my-event-drag?",o,n,n.parentNode)}if(n.ariaLabel){let o=this.getLabelTime(n.ariaLabel);this.targetDrop=o,this.doDroppy(this.targetDrop,this.selectedItem)}else(n.classList.contains("title")||n.classList.contains("my-event"))&&this.targetDrop&&this.doDroppy(this.targetDrop,this.selectedItem);i.preventDefault(),i.stopPropagation();return}console.log("onTouchEvt::UNKNOWN",i)},getLabelTime(i){let e=i.split(" "),t=e[e.length-2],l=G(ne(this.currentDate),{minute:Q(t)});return e[e.length-1]=="PM"?l.hour==12?l:G(ne(this.currentDate),{hour:12,minute:Q(t)}):l.hour==12?G(ne(this.currentDate),{hour:-12,minute:Q(t)}):l},onTouchHold({evt:i,...e},t){if(!this.mobile)return console.log("onTouchHold>>NOT MOBILE",i.type,"mobileEnableScore>> "+this.daSchedule.mobileEnableScore[t.id]),!0;let l=document.elementFromPoint(i.changedTouches[0].clientX,i.changedTouches[0].clientY);this.daSchedule.toggleEvtNoteScoreMobile(t.id);let n=l.closest(".my-event");l.classList.contains("title")&&l.parentNode.classList.contains("my-event-drag")?(console.log("onTouchHold...REMOVING my-event-drag"),l.parentNode.classList.remove("my-event-drag")):n&&n.classList.contains("my-event-drag")?n.classList.toggle("my-event-drag"):this.touchedItem&&(n=this.touchedItem.closest(".my-event"),n&&n.classList.contains("my-event-drag")?n.classList.toggle("my-event-drag"):console.log("ERROR...onTouchHold--class not found on Target!!",l,this.touchedItem)),this.daSchedule.isDisabledScoreEdit[t.id]&&!this.daSchedule.mobileEnableScore[t.id]&&this.onDblClickEvent(i,t)},scrollToEvent(i){this.$refs.calendar.scrollToTime(i.time,350)},scrollToTime(i,e=null){var t;if(this.$refs.calendar){let l=G(i,{minute:-10});(t=this.$refs.calendar)==null||t.scrollToTime(l.time,e?e=="fast"?400:1e3:500)}else setTimeout(()=>{console.log("scrollToTime::NO SCROLLY at",i.time,"Trying again...."),this.scrollToTime(i,"slow")},1e3)},confirmTimeChange(i,e,t,l,n,o,s=null){this.$q.dialog({title:i,message:e,cancel:"Cancel",ok:t,options:{type:"radio",model:"",items:[{label:t+" and "+l,value:"ok"},{label:l,value:"alt"}]},class:"overflow-wrap: break-word;",style:""}).onOk(r=>{if(r==""){console.log("confirmTimeChange onOk with no selection >>onDismiss"),this.doNotify("No selection made...Leaving as is","info"),s?s():console.log("confirmTimeChange:: No Dismiss func to execute!");return}return n(r)}).onCancel(()=>{o()})},radioChoiceDialog(i,e,t,l,n=null,o=null,s=null){this.$q.dialog({title:i,cancel:!!o,persistent:!0,message:e,seamless:!0,options:{type:"radio",model:l,items:t}}).onOk(r=>{n&&(r===""?this.radioChoiceDialog(i,e,t,l,n,o,s):n(r))}).onCancel(()=>{o&&o()}).onDismiss(()=>{s&&s()})},checkBoxDialog(i,e,t,l=null,n=null,o=null){let s=t.length,r=s>2?2:s;this.$q.dialog({title:i,message:e,options:{type:"checkbox",model:[],isValid:a=>a.length>0&&a.length>=r,items:t},cancel:!0,persistent:!0,class:"overflow-wrap: break-word;",style:""}).onOk(a=>{l(a)}).onCancel(()=>{n&&n()}).onDismiss(()=>{o&&o()})},confirmChoiceDialog(i,e,t,l,n=null,o=null,s=null){this.$q.dialog({title:i,cancel:!!o,persistent:!0,message:e,options:{type:"radio",model:l,items:t}}).onOk(r=>{n&&(r===""?this.confirmChoiceDialog(i,e,t,l,n,o,s):n(r))}).onCancel(()=>{o&&o()}).onDismiss(()=>{s&&s()})},scheduleByDialog(i,e,t,l,n=null,o=null,s=null){this.$q.dialog({component:mo,componentProps:{title:i,message:e,options:t,selectedO:l}}).onOk(r=>{n&&(r.choice==""?this.scheduleByDialog(i,e,t,l,n,o,s):n(r))}).onCancel(()=>{o&&o()}).onDismiss(()=>{s&&s()})},confirmAction(i,e,t,l,n,o=null){this.$q.dialog({title:i,cancel:!0,ok:t,message:e,multiLine:!0}).onOk(()=>{l()}).onCancel(()=>{n()}).onDismiss(()=>{if(o){o();return}})},confirmCancelAction(i,e,t,l,n,o,s=null){this.$q.dialog({title:i,cancel:l,ok:t,message:e}).onOk(()=>{n()}).onCancel(()=>{o()}).onDismiss(()=>{if(s){s();return}})},doNotifyTimeout(i,e=void 0,t="top",l=null){this.$q.notify({color:e!==void 0?e:"negative",position:t,message:i,icon:e==null?"report_problem":"thumb_up",timeout:l||5e3,multiLine:!0})},doNotify(i,e=void 0,t="top"){this.$q.notify({color:e!==void 0?e:"negative",position:t,message:i,multiLine:!0,icon:e==null?"report_problem":"thumb_up"})},withActionNotify(i,e=null,t=void 0,l="top",n=null){this.$q.notify({color:t!==void 0?t:"negative",position:l,message:i,icon:t==null?"report_problem":"thumb_up",onDismiss:n,actions:[{label:"Force?",color:"yellow",handler:()=>{e?e():console.log("withActionNotify::ActionHandler::NOTHING...")}}]})}}},at=i=>(bi("data-v-18f4afc4"),i=i(),Ti(),i),yo={class:"subcontent"},So={class:"row justify-center"},vo=at(()=>W("br",null,null,-1)),bo={key:0,class:"q-gutter-md q-pa-sm bg-grey-12"},To={class:"q-mr-sm text-weight-bold",size:"28px"},Co=["onDragstart"],Oo={class:"text-weight-bold"},wo={key:1,class:"text-weight-light text-black"},Do=at(()=>W("br",null,null,-1)),Eo={class:"instru"},Ro={class:"q-pa-md relative-position forMobile"},No=at(()=>W("div",{class:"text-center text-subtitle2 q-mt-sm"}," Reload By ",-1)),$o={key:0,class:"row q-px-md"},Mo={class:"row justify-center"},Po={class:"q-gutter-md",style:{display:"flex","max-width":"800px",width:"100%",height:"600px"}},Ao={style:{display:"flex","justify-content":"center","flex-wrap":"wrap",padding:"2px"}},Bo=["onDragstart","onTouchstart","onTouchmove","onTouchend"],ko=["onDblclick","onDragstart","onTouchstart","onTouchmove","onTouchend"],xo=at(()=>W("br",null,null,-1));function Io(i,e,t,l,n,o){const s=fe("scheduleDayLabel"),r=fe("actionBtns"),a=fe("sched-btn"),c=fe("da-instructions"),m=fe("navigation-bar"),u=fe("goaly-end"),D=fe("mobileNoteScore"),S=fe("q-calendar-day"),O=fe("sched-dialog");return V(),Y(Ni,{padding:""},{default:x(()=>[W("div",yo,[B(Pt,{modelValue:n.splitterPage,"onUpdate:modelValue":e[19]||(e[19]=T=>n.splitterPage=T),limits:o.splitterLimits},Si({before:x(()=>[B(Pt,{modelValue:n.splitterLegend,"onUpdate:modelValue":e[4]||(e[4]=T=>n.splitterLegend=T),horizontal:"",limits:[20,80],style:{height:"100%"}},{before:x(()=>[B(s,{doShow:n.treeGoals.length>0,balanceLabel:o.labelBalance(),scheduleLabel:o.labelScheduled()},null,8,["doShow","balanceLabel","scheduleLabel"]),B(r,{scoreOptions:n.scoreOptions,allMainGPrio:o.allMainGPrio(),defaultBtnLabel:o.defaultBtnLabel,onScoreBtnLabel:o.chosenScoreLabel,onPrioBtnLabel:o.chosenPrioLabel,showReloadBtn:o.scheduleProps.showReloadBtn,showClearBtn:o.scheduleProps.showClearBtn,showActionBtns:o.doShowActionBtns,showTree:n.showTree,inMobile:n.mobile,isDefaultBtnEnabled:o.isDefaultBtnEnabled,isScoreBtnDisabled:o.scheduleProps.disableScoreBtn,isPrioBtnDisabled:o.scheduleProps.disablePrioBtn,onOnReloadSaved:o.onReloadSaved,onOnClearDay:o.onClearDay,onOnLoadDefaults:o.onLoadDefault,onDoReloadWithScore:o.doReloadWithScore,onDoReloadWithPrio:o.doReloadWithPrio,onOnChoosenScore:o.onChoosenScore,onOnChoosenPrio:o.onChoosenPrio,onOnScheduleOneEach:o.onScheduleOneEach,onDoHideTree:e[0]||(e[0]=()=>n.showTree=!n.showTree)},null,8,["scoreOptions","allMainGPrio","defaultBtnLabel","onScoreBtnLabel","onPrioBtnLabel","showReloadBtn","showClearBtn","showActionBtns","showTree","inMobile","isDefaultBtnEnabled","isScoreBtnDisabled","isPrioBtnDisabled","onOnReloadSaved","onOnClearDay","onOnLoadDefaults","onDoReloadWithScore","onDoReloadWithPrio","onOnChoosenScore","onOnChoosenPrio","onOnScheduleOneEach"]),W("div",So,[B(a,{"text-label":"SaveSchedule",class:"q-mt-md","text-color":o.saveScheduleDisabled?"grey":"blue",disable:o.saveScheduleDisabled,onDoBtnAction:o.doSaveSchedule,push:"",dense:!1},null,8,["text-color","disable","onDoBtnAction"]),n.showTree||o.isViewingPast()?(V(),Y(a,{key:0,"text-label":n.showTree?"HideTree":"ShowTree",class:"q-mt-md","text-color":"green",onDoBtnAction:e[1]||(e[1]=()=>{n.showTree&&o.resetFilter(),n.showTree=!n.showTree}),push:"",dense:!1},null,8,["text-label"])):Z("",!0)]),vo]),after:x(()=>[o.showTreeForm?(V(),ie("div",bo,[B(Ci,{overline:"",header:"",lines:"3"},{default:x(()=>[ae(" Filter by Mood / Expand & Hover for Moods ")]),_:1}),B(wi,{label:o.isViewingPast()?"Disabled In Past :(":"je-suis",hint:"Keyword >> Enter","hide-hint":"",ref:"filterRef",modelValue:n.filter,"onUpdate:modelValue":e[2]||(e[2]=T=>n.filter=T),"use-input":"","use-chips":"",multiple:"",disable:o.isViewingPast(),"hide-dropdown-icon":"","input-debounce":"0","new-value-mode":"add-unique",class:"q-gutter-sm"},{"selected-item":x(T=>[B(Di,{removable:"",dense:"",onRemove:v=>T.removeAtIndex(T.index),tabindex:T.tabindex,"text-color":"black",class:"q-ma-none",style:{width:"80px"}},{default:x(()=>[ae(le(T.opt),1)]),_:2},1032,["onRemove","tabindex"])]),append:x(()=>[n.filter.length>0?(V(),Y(pt,{key:0,name:"clear",class:"cursor-pointer",onClick:o.resetFilter},null,8,["onClick"])):Z("",!0)]),_:1},8,["label","modelValue","disable"]),B(Mi,{nodes:n.treeGoals,"node-key":"label",filter:o.filterString,"filter-method":o.myFilterMethod,expanded:n.expanded,"onUpdate:expanded":e[3]||(e[3]=T=>n.expanded=T),"no-connectors":"",dense:""},{"default-header":x(T=>[W("div",{class:et(o.classyColor(T.node))},[T.node.isChildren?Z("",!0):(V(),Y(pt,{key:0,name:T.expanded?"expand_less":"expand_more",size:"28px",right:""},null,8,["name"])),W("div",To,le(T.node.label),1),B(pt,{name:T.node.icon},null,8,["name"])],2)]),"default-body":x(T=>[T.node.isChildren?(V(),ie("div",{key:0,draggable:!0,style:{cursor:"grab"},onDragstart:Ve(v=>o.onDragStart(v,"tree-item",T.node),["stop"])},[W("span",Oo," >> "+le(T.node.details),1),T.node.moods.length>0?(V(),Y(vt,{key:0},{default:x(()=>[ae(le("Moods::> "+T.node.moods.join(",")),1)]),_:2},1024)):Z("",!0)],40,Co)):(V(),ie("span",wo,le(T.node.details),1))]),_:1},8,["nodes","filter","filter-method","expanded"]),Do,n.filter.length>0?(V(),Y(a,{key:0,"text-label":"Add Mood Evts",class:"q-mt-xl sched-btn","text-color":"red",onDoBtnAction:o.onMoodAdd},null,8,["onDoBtnAction"])):Z("",!0)])):Z("",!0)]),_:1},8,["modelValue"]),W("div",Eo,[B(Kt,{modelValue:n.showInstru,"onUpdate:modelValue":e[5]||(e[5]=T=>n.showInstru=T),label:n.showInstru?"Hide Instructions":"Show Instructions",color:"teal",class:"q-pa-md q-mx-xl",align:"center"},null,8,["modelValue","label"]),n.showInstru?(V(),Y(c,{key:0,showRemInstru:o.showRemInstru,showSchedInstru:o.showSchedInstru},null,8,["showRemInstru","showSchedInstru"])):Z("",!0)])]),after:x(()=>[W("div",Ro,[tt(B(De,{class:"absolute-top-left q-mx-md",fab:"",color:"primary",size:"md",icon:"legend_toggle",align:"evenly",onClick:o.nextMorph},null,8,["onClick"]),[[Tt,n.morphGroupModel,"btn:mygroup:300",{resize:!0}]]),tt((V(),Y(Ct,{class:"absolute-top-left q-ma-md bg-grey",style:{width:"50%","border-top-left-radius":"2em"}},{default:x(()=>[B(s,{doShow:n.treeGoals.length>0,balanceLabel:o.labelBalance(),scheduleLabel:o.labelScheduled()},null,8,["doShow","balanceLabel","scheduleLabel"]),B(nt,{align:"center"},{default:x(()=>[B(a,{"text-label":"SaveSchedule",class:"q-mt-md","text-color":"white",onDoBtnAction:e[6]||(e[6]=()=>{o.doSaveSchedule(),o.morphClose()}),push:"",dense:!1})]),_:1}),B(nt,{align:"right"},{default:x(()=>[B(De,{flat:"","no-caps":"","no-wrap":"",onClick:o.morphClose,icon:"thumb_up",color:"red"},null,8,["onClick"]),B(De,{flat:"",onClick:o.nextMorph,"no-caps":"","no-wrap":""},{default:x(()=>[ae("Actions >")]),_:1},8,["onClick"])]),_:1})]),_:1})),[[Tt,n.morphGroupModel,"card1:mygroup:500",{resize:!0}]]),tt((V(),Y(Ct,{class:"absolute-top-left q-ma-md",style:{width:"70%","border-top-left-radius":"2em"}},{default:x(()=>[No,B(lt,{color:"red",inset:""}),B(Qt,null,{default:x(()=>[B(r,{scoreOptions:n.scoreOptions,allMainGPrio:o.allMainGPrio(),defaultBtnLabel:o.defaultBtnLabel,onScoreBtnLabel:o.chosenScoreLabel,onPrioBtnLabel:o.chosenPrioLabel,showReloadBtn:o.scheduleProps.showReloadBtn,showClearBtn:o.scheduleProps.showClearBtn,showActionBtns:o.doShowActionBtns,showTree:n.showTree,inMobile:n.mobile,isDefaultBtnEnabled:o.isDefaultBtnEnabled,isScoreBtnDisabled:o.scheduleProps.disableScoreBtn,isPrioBtnDisabled:o.scheduleProps.disablePrioBtn,onOnReloadSaved:e[7]||(e[7]=()=>{o.onReloadSaved(),o.morphClose()}),onOnClearDay:e[8]||(e[8]=()=>{o.onClearDay(),o.morphClose()}),onOnLoadDefaults:e[9]||(e[9]=()=>{o.onLoadDefault(),o.morphClose()}),onDoReloadWithScore:e[10]||(e[10]=()=>{o.doReloadWithScore(),o.morphClose()}),onDoReloadWithPrio:e[11]||(e[11]=()=>{o.doReloadWithPrio(),o.morphClose()}),onOnChoosenScore:o.onChoosenScore,onOnChoosenPrio:o.onChoosenPrio,onOnScheduleOneEach:e[12]||(e[12]=()=>{o.onScheduleOneEach(),o.morphClose()}),onDoHideTree:e[13]||(e[13]=()=>n.showTree=!n.showTree)},null,8,["scoreOptions","allMainGPrio","defaultBtnLabel","onScoreBtnLabel","onPrioBtnLabel","showReloadBtn","showClearBtn","showActionBtns","showTree","inMobile","isDefaultBtnEnabled","isScoreBtnDisabled","isPrioBtnDisabled","onOnChoosenScore","onOnChoosenPrio"])]),_:1}),B(nt,{align:"right"},{default:x(()=>[B(De,{flat:"","no-caps":"","no-wrap":"",onClick:o.prevMorph},{default:x(()=>[ae(" < Prev ")]),_:1},8,["onClick"]),B(De,{flat:"",label:"Close","no-caps":"","no-wrap":"",onClick:o.nextMorph},null,8,["onClick"])]),_:1})]),_:1})),[[Tt,n.morphGroupModel,"card2:mygroup:500",{tween:!0}]])]),B(m,{onToday:o.onToday,onPrev:o.onPrev,onNext:o.onNext},null,8,["onToday","onPrev","onNext"]),o.scheduleMoodsLabel?(V(),ie("div",$o,[ae(" By moods: "),(V(!0),ie(Pe,null,yt(o.scheduleMoodsLabel,(T,v)=>(V(),Y(bt,{key:v,color:T.bg,"multi-line":"",rounded:""},{default:x(()=>[ae(le(T.m),1)]),_:2},1032,["color"]))),128))])):Z("",!0),W("div",Mo,[W("div",Po,[B(S,{ref:"calendar",view:"day",modelValue:n.currentDate,"onUpdate:modelValue":e[18]||(e[18]=T=>n.currentDate=T),"drag-enter-func":o.onDragEnter,"drag-over-func":o.onDragOver,"drag-leave-func":o.onDragLeave,"drop-func":o.onDrop,animated:"",bordered:"",hoverable:"","no-active-date":"","transition-next":"slide-left","transition-prev":"slide-right","time-clicks-clamped":"","interval-minutes":15,"interval-count":96,"interval-height":28,"selected-start-end-dates":o.startEndTimes,onChange:o.onChange,onClickDate:o.onClickDate,onClickTime:o.onClickTime,onClickInterval:o.onClickInterval,onClickHeadIntervals:o.onClickHeadIntervals,onClickHeadDay:o.onClickHeadDay,onMousedownTime:o.onMouseDownTime,onMouseupTime:o.onMouseUpTime,onMousemoveTime:o.onMouseMoveTime},{"head-day-event":x(({scope:{timestamp:T}})=>[W("div",Ao,[(V(!0),ie(Pe,null,yt(o.eventsMap[T.date],v=>(V(),ie(Pe,{key:v.id},[v.time?(V(),Y(bt,{key:1,class:et(o.badgeClasses(v,"header")),style:it([o.badgeStyles(v,"header"),{margin:"1px",width:"10px","max-width":"10px",height:"10px","max-height":"10px",cursor:"pointer"}]),onClick:g=>o.scrollToEvent(v)},{default:x(()=>[B(vt,null,{default:x(()=>[ae(le("("+v.id+") "+v.title+" - "+v.time+" ("+v.duration+"min) >> "+v.end.time),1)]),_:2},1024)]),_:2},1032,["class","style","onClick"])):(V(),ie("div",{key:0,draggable:!0,style:{width:"100%",cursor:"grab",height:"12px","font-size":"10px",margin:"5px"},class:"heady",onDragstart:Ve(g=>o.onDragStart(g,"header-item",v),["stop"]),onTouchstart:g=>o.onTouchHStart(g,"header-item",v),onTouchmove:g=>o.onTouchHEvt(g,v),onTouchend:g=>o.onTouchHEvt(g,v)},[B(bt,{class:et(o.badgeClasses(v,"header-item"))},{default:x(()=>[ae(le(v.title)+" ",1),B(vt,null,{default:x(()=>[ae("Drag to schedule >> "+le(v.duration)+"min ",1)]),_:2},1024)]),_:2},1032,["class"])],40,Bo))],64))),128))])]),"day-container":x(({scope:{days:T}})=>[o.hasDate(T)?(V(),ie(Pe,{key:0},[W("div",{class:"day-view-current-time-indicator",style:it(o.style)},null,4),W("div",{class:"day-view-current-time-line",style:it(o.style)},null,4)],64)):Z("",!0)]),"day-body":x(({scope:{timestamp:T,timeStartPos:v,timeDurationHeight:g}})=>[(V(!0),ie(Pe,null,yt(o.getDateEvents(T.date),b=>(V(),ie(Pe,{key:b.id},[b.time?(V(),ie("div",{key:0,class:et(["my-event",o.badgeClasses(b,"body")]),style:it(o.badgeStyles(b,"body",v,g)),draggable:!0,onDblclick:Ve(d=>o.onDblClickEvent(d,b),["prevent"]),onDragstart:Ve(d=>o.onDragStart(d,"goal-item",b),["stop"]),onDragend:e[14]||(e[14]=Ve((...d)=>o.onDragEnd&&o.onDragEnd(...d),["stop"])),onDrop:e[15]||(e[15]=d=>o.onDrop(d,"goal-item",i.scope)),onDragenter:e[16]||(e[16]=d=>o.onDragEnter(d,"goal-item",i.scope)),onDragover:e[17]||(e[17]=d=>o.onDragOver(d,"goal-item",i.scope)),onTouchstart:d=>o.onTouchStart(d,"goal-item",b),onTouchmove:d=>o.onTouchEvt(d,b),onTouchend:d=>o.onTouchEvt(d,b)},[tt(B(u,{disabledScore:n.daSchedule.isDisabledScoreEdit[b.id],title:b.title,id:b.id,startTime:b.time,score:b.score,details:b.details,notes:b.notes,icon:b.icon,happeningNow:n.daSchedule.hasStarted[b.id]?n.daSchedule.hasStarted[b.id]:!1,onEndNow:o.onEndNow,onSaveScore:o.onSaveScore,onAddMins:o.onAddMins,onDeleteNow:d=>o.removeEvtInSchedule(b)},null,8,["disabledScore","title","id","startTime","score","details","notes","icon","happeningNow","onEndNow","onSaveScore","onAddMins","onDeleteNow"]),[[Qi,d=>o.onTouchHold(d,b),"400:12:15"]]),o.showEvtMobile(b.id)?(V(),Y(D,{key:0,title:b.title,id:b.id,startTime:b.time,score:b.score,details:b.details,notes:b.notes,"show-dialog":o.showEvtMobile(b.id),onSaveScore:o.onSaveScore,onDeleteNow:d=>o.removeEvtInSchedule(b),onEuhHidin:d=>n.daSchedule.euhHidin(b.id)},null,8,["title","id","startTime","score","details","notes","show-dialog","onSaveScore","onDeleteNow","onEuhHidin"])):Z("",!0)],46,ko)):Z("",!0)],64))),128))]),_:1},8,["modelValue","drag-enter-func","drag-over-func","drag-leave-func","drop-func","selected-start-end-dates","onChange","onClickDate","onClickTime","onClickInterval","onClickHeadIntervals","onClickHeadDay","onMousedownTime","onMouseupTime","onMousemoveTime"])])]),xo]),_:2},[n.mobile?void 0:{name:"separator",fn:x(()=>[B(vi,{color:"primary",class:"q-px-md","text-color":"white",size:"40px",icon:"drag_indicator",style:{position:"relative",top:"70%"}})]),key:"0"}]),1032,["modelValue","limits"]),n.showEvtDialog?(V(),Y(O,{key:0,parentGoals:n.daSchedule.allPGoals(),canBeScheduled:o.canbeScheduled,balance:o.currentBalance,selectedTime:o.selectedTimeInterval(),onAdHocEvent:o.onAddHocEvent,onOnPickEvent:o.onPickEvent,onEuhHidin:o.closingDialog},null,8,["parentGoals","canBeScheduled","balance","selectedTime","onAdHocEvent","onOnPickEvent","onEuhHidin"])):Z("",!0)])]),_:1})}var Uo=Jt(po,[["render",Io],["__scopeId","data-v-18f4afc4"]]);export{Uo as default};
