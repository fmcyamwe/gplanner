import{F as P,a1 as L,r as _,N as q,G as h,H as b,I as c,O as y,J as u,R as p,S as Q,U as S,a2 as B,a3 as k,Q as V,K as w,M as v,a4 as T,L as g,a5 as E,_ as K,a6 as A}from"./index.57b3fa58.js";import{u as z,a as H,Q as U,b as C,c as W}from"./goalStorage.8d4da39c.js";import{Q as j}from"./QBadge.fe273677.js";import{i as F,Q as $}from"./isMobile.d1a668d7.js";import{r as X,W as Y,Q as Z}from"./index.6b3e9238.js";import{t as ee,a as x,p as D,b as M,F as te,N as I,O as se}from"./QCalendarTask.712d05e8.js";import{a as oe,b as ae}from"./utiFunc.f569f737.js";class ie extends Y{constructor(){super({name:"MyNotifActions",platforms:["android"]})}async getSkippedNotifs(e=null){return{}}async getNotes(){return{}}async clearStorage(){return{value:""}}async clearStoreKey(e){return{value:""}}async echo(){return{identifier:""}}async doPrint(){return console.log("MyNotifActions>>",JSON.stringify("PRINT")),{value:""}}}const N=X("MyNotifActions",new ie);const le={name:"weekCalendar",components:{NavigationBar:L(()=>K(()=>import("./NavigationBar.a4a30bf3.js"),["assets/NavigationBar.a4a30bf3.js","assets/NavigationBar.bf3d18d0.css","assets/index.57b3fa58.js","assets/index.f80becc5.css"])),QCalendar:Z},data(){return z(),{store:H(),calendar:_(null),currentDate:_(ee()),events:[],mostEvts:5,treeGoals:_([]),expanded:_([]),showTree:_(!1),moods:_({}),mobile:_(!1),todayEvts:_({})}},beforeMount(){this.mobile=F(),this.loadEvts(),this.constructTree(),this.dayNotifData()},beforeUnmount(){},computed:{storedGoalsMap(){const s=new Map;let e=this.store.getSubGoals;return e?(e.forEach(t=>{s.set(t.id,t)}),s):(console.log("GoalsMap is empty or null",e),s)},label(){return this.showTree?"Hide Legend":"Show Legend"},allEvents(){return this.store.getAllDates},parentGoalsMap(){const s=new Map;let e=this.store.getMainGoals;return e?(e.forEach(t=>{s.set(t.id,t)}),s):(console.log("parentGoalsMap is empty or null",e),s)},eventsMap(){const s={};return this.events.forEach(e=>{if(s[e.date]||(s[e.date]=[]),e.sortTime=x(M(e.date),{minute:D(e.time)}),s[e.date].push(e),e.days){console.log(`eventsMap multiple days? event for ${e.date}`,e.days);let t=te(e.date),n=e.days;do t=x(t,{day:1}),s[t.date]||(s[t.date]=[]),s[t.date].push(e);while(--n>0)}}),s}},methods:{reload(){this.loadEvts(!0)},loadEvts(s=!1){var i,o,d,r;let e=this.parentGoalsMap,t=this.storedGoalsMap,n=this.store.getAllDates;if(t&&e){if(n){s&&(this.events=[],this.moods={});for(let a in n){let l=n[a];a==this.currentDate&&(this.todayEvts=l);for(let m in l){let f=t.get(parseInt(m));if(f){let J=e.get(f.parentGoal),G=x(M(a),{minute:D(l[m].time)}),R=x(G,{minute:parseInt(l[m].duration)}),O="";l[m].notes!==void 0&&((i=l[m])==null?void 0:i.notes)!==""?O=[`${G.time} - ${R.time}`,`${(d=(o=l[m])==null?void 0:o.atScore)!=null?d:""} >> ${f.score}`,`${(r=l[m])==null?void 0:r.notes}`].join(`
\r`):O=`${G.time} - ${R.time}`,l[m].byMood!==void 0&&(this.moods[a]||(this.moods[a]=[]),this.moods[a].push(...l[m].byMood)),this.events.push({id:f.id,title:f.title,details:O,time:l[m].time,duration:l[m].duration,date:a,bgcolor:J.bgcolor})}}}}}else{console.log("ERROR--no parent or goals!!REVIEW**");return}},dayNotifData(){if(this.mobile){let s=this.storedGoalsMap;N.getSkippedNotifs({date:this.currentDate}).then(e=>{var n,i;let t=e.skipped;if(t&&Object.keys(t).length>0){const o=[];for(let d of t)o.push([d.id,d.evt]);if(Object.keys(this.todayEvts).length>0){let d=[];for(let r in this.todayEvts)o.find(a=>a[0]==r)&&(delete this.todayEvts[r],d.push((i=(n=s.get(parseInt(r)))==null?void 0:n.title)!=null?i:""),console.log("dayNotifData::deleteSkipped>> "+r,JSON.stringify(d)));this.store.saveDailySchedule(this.currentDate,this.todayEvts),this.$q.notify({color:"warning",position:"top",message:`${d.join()} Skipped!!`,caption:`${this.currentDate} Schedule updated with Skipped ${t.length} removal`,icon:"thumb_down",timeout:3e3}),N.clearStoreKey({key:"skip"}).then(r=>{console.log("dayNotifData::clearSkipKey",JSON.stringify(r)),this.reload()})}else console.log("GONCLEAR storage::mismatch!!"),N.clearStorage().then(d=>{console.log("dayNotifData::clearStorage",JSON.stringify(d))})}}).catch(e=>{console.log("dayNotifData::getSkippedNotifs>>ERROR",e),console.log(e)}),N.getNotes().then(e=>{var t,n;if("notes"in e){let i=e.notes;const o=[];if(Array.isArray(i)){let d=[];for(let r of i)if(r.id in this.todayEvts){let a=Object.assign({},{...this.todayEvts[r.id],notes:r.note});console.log("dayNotifData::Setting Note>>",JSON.stringify(a),JSON.stringify(this.todayEvts[r.id])),this.todayEvts[r.id]=a,d.push((n=(t=s.get(parseInt(r.id)))==null?void 0:t.title)!=null?n:""),o.push(r.id)}else console.log("getNotes>>ERROR note Evts not found "+r.id,JSON.stringify(r),JSON.stringify(this.todayEvts));this.store.saveDailySchedule(this.currentDate,this.todayEvts),this.$q.notify({color:"positive",position:"top",message:`${d.join()} Evts had notes added!!`,icon:"thumb_up",timeout:3e3})}else console.log("getNotes>>ERROR not array",JSON.stringify(i),Array.isArray(i));N.clearStoreKey({key:"notey",ids:o}).then(d=>{console.log("dayNotifData::clearNoteKey",JSON.stringify(d)),this.reload()})}})}},constructTree(){this.treeGoals=this.store.fetchGoalsTree()},getEvents(s){let e=(n,i)=>{let o=se(n.sortTime,i.sortTime);if(o>0)return-1;if(o==0)return 0;if(o<0)return 1};const t=this.eventsMap[s]||[];if(t.length===1)t[0].side="full";else if(t.length===2){const n=x(M(t[0].date),{minute:D(t[0].time)}),i=x(n,{minute:t[0].duration}),o=x(M(t[1].date),{minute:D(t[1].time)}),d=x(o,{minute:t[1].duration});I(o,n,i,!0)||I(d,n,i,!0)?(t[0].side="left",t[1].side="right"):(t[0].side="full",t[1].side="full")}return t.length>this.mostEvts&&(this.mostEvts=this.mobile?t.length+5:t.length),t.sort(e)},classyColor(s){return`row items-center ${s.isChildren?"text-":"text-white bg-"}${s.color} `},badgeClasses(s,e){return oe(s,e)},badgeStyles(s,e,t=void 0,n=void 0){return ae(s,e,t,n)},scrollToEvent(s){this.$refs.calendar.scrollToTime(s.time,350)},onToday(){this.$refs.calendar.moveToToday()},onPrev(){this.$refs.calendar.prev()},onNext(){this.$refs.calendar.next()},onClickHeadDay({scope:s,event:e}){var o,d;let t=s.timestamp.date,n=this.moods[t],i=(d=(o=this.eventsMap[t])==null?void 0:o.length)!=null?d:0;n?this.$q.notify({color:"positive",position:"top",message:`${i} Scheduled with Moods: ${n.join()}`,icon:"tag_faces",multiLine:!0,timeout:3e3}):this.$q.notify({color:"white",textColor:"black",position:"top",message:i>0?`${i} Scheduled without Any Mood!`:"Empty and NO mood!!",icon:i>0?"mood":"sentiment_neutral",iconColor:i>0?"positive":"red",multiLine:!0,timeout:3e3})},onChange(s){this.mostEvts=5}}},ne={class:"q-px-md"},de={class:"row justify-center"},re={class:"q-px-md",style:{display:"flex","max-width":"800px",width:"100%",height:"500px",overflow:"auto"}},ue={style:{display:"flex","justify-content":"center","flex-wrap":"wrap",padding:"2px"}},ce={class:"title q-calendar__ellipsis"},he={class:"title q-calendar__ellipsis"},me={class:"lineyy"},ye={key:0,class:"q-pa-md"},fe={key:0,class:"q-pa-md bg-grey-12",style:{"max-width":"400px"}},pe={class:"q-mr-sm text-weight-bold",size:"28px"},ge={key:0},ve={class:"text-weight-bold liney"},_e={key:1,class:"text-weight-light text-black liney"},xe={key:1,class:"column justify-center items-center"};function be(s,e,t,n,i,o){const d=q("navigation-bar"),r=q("q-calendar");return h(),b(U,{padding:""},{default:c(()=>[y("div",ne,[u(d,{onToday:o.onToday,onPrev:o.onPrev,onNext:o.onNext},null,8,["onToday","onPrev","onNext"]),e[3]||(e[3]=y("i",{class:"row justify-center q-pa-sm"},"Click on Day header for that day's Moods ",-1)),y("div",de,[y("div",re,[u(r,{ref:"calendar",modelValue:i.currentDate,"onUpdate:modelValue":e[0]||(e[0]=a=>i.currentDate=a),view:"week",dark:"",animated:"",hoverable:"",bordered:"","transition-prev":"slide-right","transition-next":"slide-left","no-active-date":"","interval-minutes":30,"interval-count":48,"interval-height":i.mostEvts*3,onChange:o.onChange,onClickHeadDay:o.onClickHeadDay},{"head-day-event":c(({scope:{timestamp:a}})=>[y("div",ue,[(h(!0),p(S,null,Q(o.eventsMap[a.date],l=>(h(),p(S,{key:l.id},[l.time?(h(),b(j,{key:1,class:T(o.badgeClasses(l,"header")),style:A([o.badgeStyles(l,"header"),{margin:"1px",width:"10px","max-width":"10px",height:"10px","max-height":"10px",cursor:"pointer"}]),onClick:m=>o.scrollToEvent(l)},{default:c(()=>[u(C,null,{default:c(()=>[g(v(l.time+" - "+l.title),1)]),_:2},1024)]),_:2},1032,["class","style","onClick"])):(h(),b(j,{key:0,class:T(o.badgeClasses(l,"header")),style:A([o.badgeStyles(l,"header"),{width:"100%",cursor:"pointer",height:"12px","font-size":"10px",margin:"1px"}])},{default:c(()=>[y("div",ce,[g(v(l.title)+" ",1),u(C,null,{default:c(()=>[g(v(l.details),1)]),_:2},1024)])]),_:2},1032,["class","style"]))],64))),128))])]),"day-body":c(({scope:{timestamp:a,timeStartPos:l,timeDurationHeight:m}})=>[(h(!0),p(S,null,Q(o.getEvents(a.date),f=>(h(),p(S,{key:f.id},[f.time!==void 0?(h(),p("div",{key:0,class:T(["my-event",o.badgeClasses(f,"body")]),style:A(o.badgeStyles(f,"body",l,m))},[y("span",he,[g(v(f.title)+" ",1),u(C,null,{default:c(()=>[y("div",me,v(f.details),1)]),_:2},1024)])],6)):w("",!0)],64))),128))]),_:1},8,["modelValue","interval-height","onChange","onClickHeadDay"])])])]),u(B,{modelValue:i.showTree,"onUpdate:modelValue":e[1]||(e[1]=a=>i.showTree=a),label:o.label,color:"teal",class:"q-pa-md"},null,8,["modelValue","label"]),u(W,null,{default:c(()=>[i.showTree?(h(),p("div",ye,[i.treeGoals.length>0?(h(),p("div",fe,[e[4]||(e[4]=y("div",{class:"row justify-center"}," Goals & Goal Events ",-1)),u(k),e[5]||(e[5]=y("br",null,null,-1)),u($,{nodes:i.treeGoals,"node-key":"label",expanded:i.expanded,"onUpdate:expanded":e[2]||(e[2]=a=>i.expanded=a),"no-connectors":"",dense:"",accordion:""},{"default-header":c(a=>[y("div",{class:T(o.classyColor(a.node))},[a.node.isChildren?w("",!0):(h(),b(V,{key:0,name:a.expanded?"expand_less":"expand_more",size:"28px",class:"q-mr-sm"},null,8,["name"])),y("div",pe,v(a.node.label),1),u(V,{name:a.node.icon},null,8,["name"])],2)]),"default-body":c(a=>[a.node.isChildren?(h(),p("div",ge,[y("span",ve," >> "+v(a.node.details),1),a.node.moods.length>0?(h(),b(C,{key:0},{default:c(()=>[g(v("Moods::> "+a.node.moods.join(",")),1)]),_:2},1024)):w("",!0)])):(h(),p("span",_e,v(a.node.details),1))]),_:1},8,["nodes","expanded"])])):(h(),p("div",xe,[e[11]||(e[11]=y("br",null,null,-1)),u(E,null,{default:c(()=>e[6]||(e[6]=[g(" 1. Add some Goals first. A schedulable goal is one with a parent Goal--can have multiple related goals with the same parent. ")])),_:1}),u(k),u(E,null,{default:c(()=>e[7]||(e[7]=[g(" 2. Go to Schedule to see a daily schedule. Drag scheduled events to new timeslots or click in calendar to add an event. ")])),_:1}),u(k),u(E,null,{default:c(()=>e[8]||(e[8]=[g(" 3. Reload a saved daily schedule or defaults or choose minimal score events to schedule. Fix any scheduling conflicts. ")])),_:1}),u(k),u(E,null,{default:c(()=>e[9]||(e[9]=[g(" 4. Save the daily schedule (dont forget to update their score as needed!) ")])),_:1}),u(k),u(E,null,{default:c(()=>e[10]||(e[10]=[g(" 5. Check out the summary of all goals here! ")])),_:1})]))])):w("",!0)]),_:1})]),_:1})}var De=P(le,[["render",be],["__scopeId","data-v-1761dfda"]]);export{De as default};
