import{j as st,U as nt,W as rt,r as I,c as he,w as Ve,n as at,h as pe,k as Ne,ay as dt,D as ht,g as Ye,az as ct,ad as Ae,v as ut,aA as ft,aa as ye,aC as Fe,ab as Pe,Z as gt,d as mt,_ as Xe,E as P,F as Q,G as L,H as $,M as H,K,a1 as De,bs as St,bt as pt,a0 as Ze,I as x,bu as yt,N as Ce,a3 as vt,bq as bt,$ as se,L as le,O as G,J as oe,Q as Me,a2 as ve,bv as Tt,R as ce,P as $e,a5 as be,a4 as ne,aS as Te,f as Ot,a6 as Dt,a7 as Ct}from"./index.e7de6a78.js";import{w as F,c as re,p as Et,a as Rt,b as wt,d as Nt,Q as Oe}from"./utiFunc.576b53e4.js";import{a as At}from"./QItem.5706ac8f.js";import{T as Pt,Q as Mt,a as $t}from"./QSelect.4887465e.js";import{c as ke,a as kt,u as _t,Q as _e}from"./goalStorage.2d45b166.js";import{t as Ee,E as He,b as Z,a as B,p as q,d as ee,U as ae,i as Be,V as Bt,m as Ie,l as ue,c as Ue,Q as It,e as Lt}from"./QCalendarTask.85ea6be8.js";import{a as xt}from"./QCalendar.03f4742e.js";/* empty css                             */import"./touch.70a9dd44.js";var je=st({name:"QSplitter",props:{...nt,modelValue:{type:Number,required:!0},reverse:Boolean,unit:{type:String,default:"%",validator:o=>["%","px"].includes(o)},limits:{type:Array,validator:o=>o.length!==2||typeof o[0]!="number"||typeof o[1]!="number"?!1:o[0]>=0&&o[0]<=o[1]},emitImmediately:Boolean,horizontal:Boolean,disable:Boolean,beforeClass:[Array,String,Object],afterClass:[Array,String,Object],separatorClass:[Array,String,Object],separatorStyle:[Array,String,Object]},emits:["update:modelValue"],setup(o,{slots:e,emit:t}){const{proxy:{$q:i}}=Ye(),l=rt(o,i),s=I(null),n={before:I(null),after:I(null)},r=he(()=>`q-splitter no-wrap ${o.horizontal===!0?"q-splitter--horizontal column":"q-splitter--vertical row"} q-splitter--${o.disable===!0?"disabled":"workable"}`+(l.value===!0?" q-splitter--dark":"")),a=he(()=>o.horizontal===!0?"height":"width"),m=he(()=>o.reverse!==!0?"before":"after"),p=he(()=>o.limits!==void 0?o.limits:o.unit==="%"?[10,90]:[50,1/0]);function g(d){return(o.unit==="%"?d:Math.round(d))+o.unit}const O=he(()=>({[m.value]:{[a.value]:g(o.modelValue)}}));let b,c,E,u,D;function T(d){if(d.isFirst===!0){const v=s.value.getBoundingClientRect()[a.value];b=o.horizontal===!0?"up":"left",c=o.unit==="%"?100:v,E=Math.min(c,p.value[1],Math.max(p.value[0],o.modelValue)),u=(o.reverse!==!0?1:-1)*(o.horizontal===!0?1:i.lang.rtl===!0?-1:1)*(o.unit==="%"?v===0?0:100/v:1),s.value.classList.add("q-splitter--active");return}if(d.isFinal===!0){D!==o.modelValue&&t("update:modelValue",D),s.value.classList.remove("q-splitter--active");return}const S=E+u*(d.direction===b?-1:1)*d.distance[o.horizontal===!0?"y":"x"];D=Math.min(c,p.value[1],Math.max(p.value[0],S)),n[m.value].value.style[a.value]=g(D),o.emitImmediately===!0&&o.modelValue!==D&&t("update:modelValue",D)}const h=he(()=>[[Pt,T,void 0,{[o.horizontal===!0?"vertical":"horizontal"]:!0,prevent:!0,stop:!0,mouse:!0,mouseAllDir:!0}]]);function y(d,S){d<S[0]?t("update:modelValue",S[0]):d>S[1]&&t("update:modelValue",S[1])}return Ve(()=>o.modelValue,d=>{y(d,p.value)}),Ve(()=>o.limits,()=>{at(()=>{y(o.modelValue,p.value)})}),()=>{const d=[pe("div",{ref:n.before,class:["q-splitter__panel q-splitter__before"+(o.reverse===!0?" col":""),o.beforeClass],style:O.value.before},Ne(e.before)),pe("div",{class:["q-splitter__separator",o.separatorClass],style:o.separatorStyle,"aria-disabled":o.disable===!0?"true":void 0},[dt("div",{class:"q-splitter__separator-area absolute-full"},Ne(e.separator),"sep",o.disable!==!0,()=>h.value)]),pe("div",{ref:n.after,class:["q-splitter__panel q-splitter__after"+(o.reverse===!0?"":" col"),o.afterClass],style:O.value.after},Ne(e.after))];return pe("div",{class:r.value,ref:s},ht(e.default,d))}}}),Gt=ct({name:"touch-hold",beforeMount(o,e){const{modifiers:t}=e;if(t.mouse!==!0&&Ae.has.touch!==!0)return;const i={handler:e.value,noop:ut,mouseStart(s){typeof i.handler=="function"&&ft(s)===!0&&(ye(i,"temp",[[document,"mousemove","move","passiveCapture"],[document,"click","end","notPassiveCapture"]]),i.start(s,!0))},touchStart(s){if(s.target!==void 0&&typeof i.handler=="function"){const n=s.target;ye(i,"temp",[[n,"touchmove","move","passiveCapture"],[n,"touchcancel","end","notPassiveCapture"],[n,"touchend","end","notPassiveCapture"]]),i.start(s)}},start(s,n){i.origin=Fe(s);const r=Date.now();Ae.is.mobile===!0&&(document.body.classList.add("non-selectable"),ke(),i.styleCleanup=a=>{i.styleCleanup=void 0;const m=()=>{document.body.classList.remove("non-selectable")};a===!0?(ke(),setTimeout(m,10)):m()}),i.triggered=!1,i.sensitivity=n===!0?i.mouseSensitivity:i.touchSensitivity,i.timer=setTimeout(()=>{i.timer=void 0,ke(),i.triggered=!0,i.handler({evt:s,touch:n!==!0,mouse:n===!0,position:i.origin,duration:Date.now()-r})},i.duration)},move(s){const{top:n,left:r}=Fe(s);i.timer!==void 0&&(Math.abs(r-i.origin.left)>=i.sensitivity||Math.abs(n-i.origin.top)>=i.sensitivity)&&(clearTimeout(i.timer),i.timer=void 0)},end(s){Pe(i,"temp"),i.styleCleanup!==void 0&&i.styleCleanup(i.triggered),i.triggered===!0?s!==void 0&&gt(s):i.timer!==void 0&&(clearTimeout(i.timer),i.timer=void 0)}},l=[600,5,7];if(typeof e.arg=="string"&&e.arg.length>0&&e.arg.split(":").forEach((s,n)=>{const r=parseInt(s,10);r&&(l[n]=r)}),[i.duration,i.touchSensitivity,i.mouseSensitivity]=l,o.__qtouchhold=i,t.mouse===!0){const s=t.mouseCapture===!0||t.mousecapture===!0?"Capture":"";ye(i,"main",[[o,"mousedown","mouseStart",`passive${s}`]])}Ae.has.touch===!0&&ye(i,"main",[[o,"touchstart","touchStart",`passive${t.capture===!0?"Capture":""}`],[o,"touchend","noop","notPassiveCapture"]])},updated(o,e){const t=o.__qtouchhold;t!==void 0&&e.oldValue!==e.value&&(typeof e.value!="function"&&t.end(),t.handler=e.value)},beforeUnmount(o){const e=o.__qtouchhold;e!==void 0&&(Pe(e,"main"),Pe(e,"temp"),e.timer!==void 0&&clearTimeout(e.timer),e.styleCleanup!==void 0&&e.styleCleanup(),delete o.__qtouchhold)}});const Vt=()=>!!/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);let ge,W;function Ft(){ge={},W=kt()}function Ht(){ge.pGoalsMap==null;const o=new Map;let e=et();return e?(e.forEach(t=>{o.set(t.id,t)}),ge.pGoalsMap=o,o):(console.log("Repo:: parentGoalsMap is empty or null",e),o)}function Ut(o){return W.hasEventsForDate(o)}function qe(o){return W.getEventsForDate(o)}function et(){return W.getMainGoals}function jt(){return ge.subGoals==null&&(ge.subGoals=W.getSubGoals),ge.subGoals}function qt(){return W.fetchAlternativeEvts()}function Wt(){return W.currentBalance()}function zt(){return W.fetchGoalsTree()}function Jt(){let o=W.fetchAllPrio();return!o.size>0?(console.log("ERROR...no Priority goals?",o),[]):Array.from(o.values()).sort()}function We(o){return W.fetchGoalsUpToMaxScore(o)}function ze(o,e=null,t=null){W.saveSubProp(o,e,t)}function Qt(){return W.getGoalByTitle("Misc")}function Je(o){W.setBalance(o)}function Qe(o,e){W.saveDailySchedule(o,e)}function Kt(o,e,t,i){return W.addMainGoal(o,e,t,i)}function fe(o,e,t,i,l,s,n,r,a){return W.addSubGoal(o,e,t,i,l,s,n,r,a)}function Yt(o,e,t=null){let i=o,l=e.id,s=e,n=t,r=o.duration,a=o.time,m=null,p=null;return{id:l,duration:r,time:a,date:()=>m,datey:g,score:O(),atScore:i.atScore,getGoal:()=>s,getPGoal:()=>n,data:()=>i,setData:d=>i=d,setMoods:d=>p=d,getMoods:u,setNotes:d=>d,hasNote:b,setDura:d=>r=d,setTime:d=>a=d,setDate:d=>m=d,durationChanged:c,timeChanged:E,parsedScore:D,withPropsEventsTo:h,addPropsEventsTo:y};function g(){return m}function O(){return i.atScore||e.score}function b(){return o.notes!==void 0}function c(){return o.duration!==e.duration}function E(){return o.time!==e.time}function u(){return"byMood"in i&&(p=i.byMood),p}function D(){const d=O().split(/on/);return d.length!=2?-89:d[1]-d[0]}function T(d){if(!d)return"";let S=d.split(":");return parseInt(S[0])>=12?d+"PM":d+"AM"}function h(d,S=null){let C=Object.assign({},{...this});return C.bgcolor=d.bgcolor,C.jeSuis?C.details=`Of '${d.title.trim()}' :: << ${C.jeSuis.join(",")} >>`:C.details=`Of '${d.title.trim()}' :: ${T(C==null?void 0:C.time)} -> ${C==null?void 0:C.duration}min -- ${C!=null&&C.inDefaults?"Dft:":":"}${C!=null&&C.canMove?":Mv:":":"}${C!=null&&C.isAlternative?":Alt":":"}`,console.log("withProps",JSON.parse(JSON.stringify(C)),C.datey(),C.date(),C.title,C.details),C}function y(d){if(!n){console.log("addProps:: ERROR no parentGoal",this.data);return}this.data,getGoal();let S=Object.assign({},{...sav});return S.bgcolor=t.bgcolor,S.jeSuis?S.details=`Of '${t.title.trim()}' :: << ${S.jeSuis.join(",")} >>`:S.details=`Of '${t.title.trim()}' :: ${T(S==null?void 0:S.time)} -> ${S==null?void 0:S.duration}min -- ${S!=null&&S.inDefaults?"Dft:":":"}${S!=null&&S.canMove?":Mv:":":"}${S!=null&&S.isAlternative?":Alt":":"}`,console.log("addProps",JSON.parse(JSON.stringify(S)),S.datey(),S.date(),S.title,S.details),S}}class Xt{constructor(e,t){this.showReloadBtn=!1,this.showClearBtn=!1,this.showActionBtns=!0,this.disablePrioBtn=!0,this.disableScoreBtn=!0,this.disableSaveSchedule=!0,this.chosenScore=null,this.chosenPrio=null,this._dailyScheduled=new Map,this._endTimesSet=new Set,this._startTimesSet=new Set,this.savedRawEvts=[],this.usingMoods={},this.isDisabledScoreEdit={},this.hasStarted={},this.mobileEnableScore={},this.showMobileDialog={},this.currentDate=e,this.mobile=t,Ft()}allPGoals(){return et()}getAllEvts(){return this._dailyScheduled}getScheduledEvts(){let e=new Map;for(let[t,i]of this._dailyScheduled)i.start.time.indexOf("NaN")>-1||e.set(t,i);return e}labelScheduled(){let e=this.getSubGoals().length,t=this.getScheduledEvts(),i=this.getAllEvts().size-t.size;return{sched:`Scheduled => ${t.size} out of ${e} Evts
`,noTime:i>0?i:null}}showEvtNoteScoreMobile(e){return this.mobileEnableScore[e]&&this.showMobileDialog[e]}toggleEvtNoteScoreMobile(e){(this.isViewingPast()||this.isViewingToday())&&(this.showMobileDialog[e]=!0)}euhHidin(e){this.showMobileDialog[e]=!1}getCurrentSchedTimesSets(){return{endSet:this._endTimesSet,startSet:this._startTimesSet}}isViewingPast(){let e=Ee();if(this.currentDate&&this.currentDate==e)return!1;let t=He(Z(e));return!(He(Z(this.currentDate))>=t)}isViewingToday(){return Ee()==this.currentDate}toggle(){this.showReloadBtn=!this.showReloadBtn}actionBtnsEnabled(){return this.showActionBtns}getProps(){return{showReloadBtn:this.showReloadBtn,showClearBtn:this.showClearBtn,disablePrioBtn:this.disablePrioBtn,disableScoreBtn:this.disableScoreBtn,chosenScore:this.chosenScore,chosenPrio:this.chosenPrio}}saveBtnEnabled(){return this.disableSaveSchedule}fetchGoalsTree(){return zt()}getCurrentBalance(){return Wt()}getAllPrio(){return Jt()}getSubGoals(){return jt()}getCurrentMoods(){return this.usingMoods}getSubGoalByID(e){let t=this.getSubGoals(),i=parseInt(e);for(let l=0;l<t.length;l++)if(t[l].id===i)return t[l];return null}unscheduledDefaults(){return this.getSubGoals().filter(t=>(t==null?void 0:t.inDefaults)&&!this._dailyScheduled.has(t.id))}unscheduledDefaultEvts(){return this.unscheduledDefaults().length}unscheduled(){return this.getSubGoals().filter(t=>!this._dailyScheduled.has(t.id));//!this.actualEvts.find(item => item.id == x.id)
}subGoalsOfParent(e){return this.getSubGoals().filter(i=>i.parentGoal==e)}getOriginalEvtTime(e){let t=this.getSubGoalByID(e);return t?t.time:""}getStoredRawEvt(e){return this.savedRawEvts&&e in this.savedRawEvts?this.savedRawEvts[e]:null}availableEvtsToSchedule(){let e=(i,l)=>{if(i.parentGoal>l.parentGoal)return 1;if(i.parentGoal==l.parentGoal)return 0;if(i.parentGoal<l.parentGoal)return-1},t=this.unscheduled();return t.length<1?(console.log("availableEvtsToSchedule >NO available on",this.currentDate,t),this.getSubGoals().sort(e)):t.sort(e)}getAlternatives(){let e=(t,i)=>{if(t.parentGoal>i.parentGoal)return 1;if(t.parentGoal==i.parentGoal)return 0;if(t.parentGoal<i.parentGoal)return-1};return qt().sort(e)}getEventsForDate(e){return qe(e)}updateDaySchedule(e,t){Qe(e,t)}parentGoalsMap(){return Ht()}parentGoalById(e){return this.parentGoalsMap().has(e)?this.parentGoalsMap().get(e):null}findSchedEvent(e){return this._dailyScheduled.has(e)?this._dailyScheduled.get(e):null}hasEventsForDate(){return Ut(this.currentDate)}scheduledEventsMap(){const e={};return this._dailyScheduled.forEach((t,i,l)=>{let s=t.date;e[s]||(e[s]=[]),e[s].push(t)}),e}schedEvtWithProps(e,t,i){if(!e.getPGoal()){console.log("schedEvtWithProps:: ERROR no parentGoal",e.data);return}let l=e.data(),s=e.getGoal(),n=e.getPGoal(),r={...s};(e.timeChanged()||e.durationChanged())&&(r.time=l.time,r.duration=l.duration),e.setDate(this.currentDate);let a=e.getMoods();if(a){//!==
this.usingMoods[r.id]=a}r.date=this.currentDate,r.bgcolor=n.bgcolor,r.icon=n.icon,r.start=t,r.end=i;let m=`Of '${n.title.trim()}' :: ${F(r==null?void 0:r.time)} -> ${r==null?void 0:r.duration}min -- ${r!=null&&r.inDefaults?"Dft:":":"}${r!=null&&r.canMove?":Mv:":":"}${r!=null&&r.isAlternative?":Alt":":"}`;return r.jeSuis&&r.jeSuis.length>0&&(m+=a?` <>Mood:'${a}' >>${r.jeSuis.join(",")}`:` << ${r.jeSuis.join(",")} >>`),r.details=m,e.hasNote()&&(r.notes=l.notes),r}doProppy(e,t){let i=this.parentGoalById(e.parentGoal);if(!i){console.log("doProppy:: ERROR no Pgoal found ?!?",e);return}let l=B(Z(t),{minute:q(e.time)}),s=B(l,{minute:e.duration}),n=Object.assign({},{...e,date:t,bgcolor:i.bgcolor,start:l,end:s,icon:i.icon});return e.jeSuis&&e.jeSuis.length>0?n.details=`Of '${i.title.trim()}' :: << ${e.jeSuis.join(",")} >>`:n.details=`Of '${i.title.trim()}' :: ${F(e==null?void 0:e.time)} -> ${e==null?void 0:e.duration}min -- ${e!=null&&e.inDefaults?"Dft:":":"}${e!=null&&e.canMove?":Mv:":":"}${e!=null&&e.isAlternative?":Alt":":"}`,"byMood"in e&&(console.log("doProppy::BYMOOD found!! "+n.id,JSON.parse(JSON.stringify(e))),this.usingMoods[n.id]=e.byMood),n}updateDetz(e){var l,s;let i=`Of '${(s=(l=this.parentGoalById(e.parentGoal))==null?void 0:l.title)==null?void 0:s.trim()}' :: ${F(e==null?void 0:e.time)} -> ${e==null?void 0:e.duration}min -- ${e!=null&&e.inDefaults?"Dft:":":"}${e!=null&&e.canMove?":Mv:":":"}${e!=null&&e.isAlternative?":Alt":":"}`;return e.jeSuis&&e.jeSuis.length>0&&(i+=this.usingMoods[e.id]?` <> Mood:'${this.usingMoods[e.id]}' >>${e.jeSuis.join(",")}`:` << ${e.jeSuis.join(",")} >>`),e.details=i,e}massageManyToOneOverlaps(e){let t=[],i=()=>{let r=[];return e.filter(a=>{a[0]=="oneToMany"&&r.push(a[1])}),r},l=e.filter(r=>r[0]!="oneToMany"),s=i(),n=[];for(let r=0;r<l.length;r++){let a=l[r][0];if(s.some(p=>p==a))n.push(...l[r][1]);else if(t.find(g=>g[0]==a)){let g=t.findIndex(O=>O[0]==a);t[g]=[a,[...t[g][1],...l[r][1]]]}else t.push([a,[...l[r][1]]])}if(t.length<1&&n.length>0)return this.doLog("massageManyToOneOverlaps::ONETOMANY!! returning original >> "+t.length+" vs "+n.length,e),e;if(n.length>0){this.doLog("massageManyToOneOverlaps::ADD SAMEY",n);let r=null,a=[];for(let p=0;p<n.length;p++){let g=n[p];t.find(b=>b[0]==g.inConflict)||(g.target!=r?(t.push([g.inConflict,[g]]),a.push(g.target)):console.log("massageManyToOneOverlaps::INCONF same current target? ERROR?",r,g))}let m=s.filter(p=>!a.some(g=>g==p));if(m.length>0){let p=0;do{let g=m[p],O=n.filter(b=>b.target==g);console.log("massageManyToOneOverlaps::ADDING",g,O),t.push([g,[...O]]),t.find(b=>b[0]=="oneToMany")?console.log("WOAH WOAH massageManyToOneOverlaps::oneToMany already present?!!ERROR ",t):t.push(["oneToMany",g])}while(++p<m.length)}}return this.doLog("massageManyToOneOverlaps::RETURNING",t),t}massageOneToMany(e){let t=[],i={};for(let l=0;l<e.length;l++){let s=e[l],n=t.find(r=>r[0]==s.inConflict);if(n){let r=t.findIndex(a=>a[0]==s.inConflict);t[r]=[s.inConflict,[...n[1],s]]}else if(!i[s.target])i[s.target]=[],i[s.target].push(s),t.push([s.inConflict,[s]]);else{let r=t.find(a=>a[0]=="oneToMany");if(r){let a=t.findIndex(p=>p[0]=="oneToMany"),m=t.findIndex(p=>p[0]==s.target);t[m]=[s.target,[...t[m][1],s]],s.target==r[1]||(t[a]=["oneToMany",[t[a][1],s.target]])}else{let a=t.pop();t.push([s.target,[...a[1],s]]),t.push(["oneToMany",s.target])}}}return t}addGoalsToSchedule(e,t){let i=[];return e.sort(function(l,s){return q(l.time)-q(s.time)}),e.forEach(l=>{let s=this.addToSchedule(l,t,!1);if(!s)console.log("addGoalsToSchedule:: ERROR Evt NOT added",s,t,l.id,l.title,l.time);else if(Array.isArray(s)){let n=s.length>1&&s.find(a=>a[0]=="oneToMany"),r={e:l,ov:s[0],oneToMany:n};i.push(r)}}),this.recheckOverlaps(i)}addToSchedule(e,t,i=!1){if(this._dailyScheduled.has(e.id))return console.log("addToSchedule--NOT added! present?!!?",t,e.title),!1;{let l=B(Z(this.currentDate),{minute:q(e.time)}),s=B(l,{minute:e.duration});if(t){let a=this.hasOverlappingEvent(e.id,l,s);if(a.length>0)return this.massageOneToMany(a)}let n=i?this.schedEvtWithProps(e,l,s):this.doProppy(e,this.currentDate);n.sortTime=l;let r={...n,start:l,end:s};return this._dailyScheduled.set(n.id,r),this._endTimesSet.add(s.time),this._startTimesSet.add(l.time),this.enableNoteScoreEdit(n.id,l,s),!0}}stillInSchedule(e){let t=this.findSchedEvent(e),i=this.getStoredRawEvt(e);return{inSched:t,inStore:i}}doSortingByTime(e){let t=(l,s)=>{let n=q(l[1].time),r=q(s[1].time);return n<r?-1:r>n?1:0};const i=[];for(let l in e)i.push([l,e[l]]);return i.sort(t),this.doLog("doSortingByTime---After",i),Object.fromEntries(i)}anotherSorting(e){return Object.entries(e).sort(([,i],[,l])=>q(i.time)-q(l.time))}enrichAddToSchedule(){let e=[],t=this.isViewingToday();console.log("enrichAddToSchedule",Object.keys(this.savedRawEvts).length,"overlapCheck:"+t);let i=this.anotherSorting(this.savedRawEvts);for(let l=0;l<i.length;l++){let s=i[l][0],n=i[l][1],r=this.getSubGoalByID(s);if(!r){console.log(`enrichAddToSchedule:: ERROR No goal found for key: ${s}...skipping!`);continue}let a=this.parentGoalById(r.parentGoal),m=Yt(n,r,a),p=this.addToSchedule(m,t,!0);if(!p)console.log("enrichAddToSchedule..ERROR?!? not added",p,r);else if(Array.isArray(p)){let g=p.length>1&&p.find(b=>b[0]=="oneToMany"),O={e:m,ov:p[0],oneToMany:g};e.push(O)}}return this.recheckOverlaps(e)}recheckOverlaps(e){let t=[];const i=s=>{let n=t.find(r=>r[0]==s[0]);if(n){let r=t.findIndex(a=>a[0]==s[0]);t[r]=[s[0],[...n[1],...s[1]]]}else t.push(s)};let l=null;for(let s=0;s<e.length;s++){let n=e[s].e,r=e[s].ov;if(r[1].length>1){this.doLog("recheckOverlaps::MULTI Overlaps!!...skipping"+n.id,r),e[s].oneToMany?(t.push(r),t.push(e[s].oneToMany)):this.doLog("recheckOverlaps::MULTI Overlaps!!...umm NOT oneToMany?!?ERROR?",e[s]);continue}let a=e.filter(O=>O.ov[0]==r[0]);if(a.length>1){if(e[s].oneToMany&&this.doLog("recheckOverlaps::filter >>Multiple oneToMany?!?ERROR?"+n.id+" "+r[0],a),r[0]==l)continue;let O=0;do i(a[O].ov);while(++O<a.length);l=r[0];continue}let m=B(Z(this.currentDate),{minute:q(n.time)}),p=B(m,{minute:n.duration}),g=this.hasOverlappingEvent(n.id,m,p);g.length>0?g.length>r[1].length?t.push(...this.massageOneToMany(g)):i(r):console.log("recheckOverlaps::ERROR>>hasOverlappingEvent no overlap?!?",n.id,g)}return t}loadEvtsForDay(e){return e||this.resetSchedule(!0),this.savedRawEvts=qe(this.currentDate),this.savedRawEvts?{overlaps:this.enrichAddToSchedule(),canContinue:!1}:{overlaps:null,canContinue:!0}}onChangeViewDate(e){let t=e==this.currentDate;return this.currentDate=e,this.enableActionBtns(),this.loadEvtsForDay(t)}resetSchedule(e=!1){this.savedRawEvts=[],this._dailyScheduled=new Map,this._endTimesSet=new Set,this._startTimesSet=new Set,e&&(this.usingMoods={}),this.showReloadBtn=!1,this.showClearBtn=!1,this.disableSaveSchedule=!0}chosenScoreLabel(){return this.chosenScore==null?"By Score":`Score <= ${this.chosenScore}`}chosenPrioLabel(){return this.chosenPrio==null?"By Priority":`Prio == ${this.chosenPrio}`}filterSchedToCurrentPrio(){let e=[];return this._dailyScheduled.forEach((t,i,l)=>{var s;((s=this.parentGoalById(t.parentGoal))==null?void 0:s.priority)==this.chosenPrio&&e.push(t)}),e}calculatePrioEvts(){let e=this.getSubGoals().filter(i=>{var l;return((l=this.parentGoalById(i.parentGoal))==null?void 0:l.priority)==this.chosenPrio}),t=e.filter(i=>!this._dailyScheduled.has(i.id));//!this.actualEvts.find(item => item.id == x.id)) //add those not scheduled
this.byPrio={prio:this.chosenPrio,toAdd:t,reset:e,filter:this.filterSchedToCurrentPrio()}}onChoosenPrio(e){let t=this.chosenPrio;t&&t==e?this.disablePrioBtn=!0:(this.chosenPrio=e,this.disablePrioBtn=!1,this.calculatePrioEvts())}scheduleSamePrio(e,t=!1){const i=m=>{console.log("scheduleSamePrio::RECALCULATE?!?",m,this.chosenPrio,this.byPrio);let p=this.getSubGoals().filter(g=>{var O;return((O=this.parentGoalById(g.parentGoal))==null?void 0:O.priority)==this.chosenPrio});return m=="reset"?p:p.filter(g=>!this._dailyScheduled.has(g.id));//!this.actualEvts.find(item => item.id == x.id)
};let l=[];if(e=="filter"?(l=this.filterSchedToCurrentPrio(),this.resetSchedule()):(this.byPrio?e=="add"?l=this.byPrio.toAdd:l=this.byPrio.reset:l=i(e),e!="add"&&this.resetSchedule()),l.length<1)return{overlaps:null,canContinue:!1};let s=l.filter(m=>m.time==""),n=this.addGoalsToSchedule(l,!t),r=n.length;this.updateCurrentMoods();let a=l.length-r-s.length;return this.toggleActionBtns(a>0,"byPrio"),{overlaps:n,canContinue:!(r>0),added:a,noTime:s.length>0?s.length:null}}filterSchedToCurrentScore(){let e=[];return this._dailyScheduled.forEach((t,i,l)=>{let s=re(t.score);s>-1&&s<=this.chosenScore&&e.push(t)}),e}calculateScoreEvts(){let e=We(this.chosenScore),t=e.filter(i=>!this._dailyScheduled.has(i.id));//!this.actualEvts.find(item => item.id == x.id)
this.byScore={score:this.chosenScore,toAdd:t,reset:e,filter:this.filterSchedToCurrentScore()}}onChoosenScore(e){let t=this.chosenScore;t&&t==e?this.disableScoreBtn=!0:(this.chosenScore=e,this.disableScoreBtn=!1,this.calculateScoreEvts())}scheduleByScore(e,t=!1){const i=m=>{console.log("scheduleByScore::RECALCULATE?!?",m,this.chosenScore,this.byScore);let p=We(this.chosenScore);return m=="reset"?p:p.filter(g=>!this._dailyScheduled.has(g.id))};let l=[];if(e=="filter"?(l=this.filterSchedToCurrentScore(),this.resetSchedule()):(this.byScore?e=="add"?l=this.byScore.toAdd:l=this.byScore.reset:l=i(e),e!="add"&&this.resetSchedule()),l.length<1)return{overlaps:null,canContinue:!1};let s=l.filter(m=>m.time==""),n=this.addGoalsToSchedule(l,!t),r=n.length;this.updateCurrentMoods();let a=l.length-r-s.length;return this.toggleActionBtns(a>0,"byScore"),{overlaps:n,canContinue:!(r>0),added:a,noTime:s.length>0?s.length:null}}scheduleOneEach(e,t=!1,i=null){const l=g=>{let O=[];return this.parentGoalsMap().forEach((b,c,E)=>{let u=this.subGoalsOfParent(b.id);if(u.length>0){let D=null,T=u.length;if(g)D=u[Math.floor(Math.random()*T)];else{let h=0;for(;this._dailyScheduled.has(u[T].id);)if(h++,T=Math.floor(Math.random()*u.length),console.log(`selectOneFromP::index ${T} scheduled...new random> At try> `+h,u.length),h>2){console.log("selectOneFromP::random...TOO MANY TRIES..ERROR?",h,T,u.length,u);break}D=u[T],console.log("selectOneFromP::NO Random at index: "+T,h,D)}O.push(D)}else i&&i(`No Evt goal for Parent: '${b==null?void 0:b.title}'`,"warning")}),O},s=()=>{let g=this.unscheduled(),O=[];return this.parentGoalsMap().forEach((b,c,E)=>{let u=g.filter(T=>T.parentGoal==b.id),D=u.length;if(D>0){let T=u[Math.floor(Math.random()*D)];O.push(T)}else{let T=this.subGoalsOfParent(b.id).length>0,h=T?`All goals for Parent: '${b==null?void 0:b.title}' already scheduled`:`Parent: '${b==null?void 0:b.title}' has No Goals :(`;i&&i(h,T?"info":"warning")}}),O};let n=[];if(e=="add"?(n=s(),console.log("scheduleOneEach...TOADD>> "+n.length)):(this.resetSchedule(),n=l(!0)),n.length<1)return console.log("Empty for OneEach :("),{overlaps:null,canContinue:!1};let r=n.filter(g=>g.time==""),a=this.addGoalsToSchedule(n,!t),m=a.length;this.updateCurrentMoods();let p=n.length-m-r.length;return this.toggleActionBtns(p>0,"oneEach"),{overlaps:a,canContinue:!(m>0),added:p,noTime:r.length>0?r.length:null}}scheduleByMood(e){var n;let t=[];for(let r=0;r<e.length;r++){let a=this.getSubGoalByID(e[r].id);a&&(t.push(a),this.usingMoods[e[r].id]=(n=e[r])==null?void 0:n.mood)}if(t.length<1)return this.doLog("scheduleByMood::Error? as Empty Moods with toAdd ",e),{overlaps:null,canContinue:!1};let i=t.filter(r=>r.time==""),l=this.addGoalsToSchedule(t,this.isViewingToday()),s=l.length;return s>0||this.toggleActionBtns(t.length-s>0,"ByMood"),{overlaps:l,canContinue:!(s>0),added:t.length,noTime:i.length>0?i.length:null}}scheduleDefaults(e,t=!1){let i=[];e=="add"?i=this.unscheduledDefaults():(this.resetSchedule(),i=this.unscheduledDefaults()),this.showReloadBtn=this.hasEventsForDate(),this.showClearBtn=!this.isViewingPast()&&i.length>0;let l=i.filter(a=>a.time==""),s=this.addGoalsToSchedule(i,!t),n=s.length,r=i.length-n-l.length;return this.updateCurrentMoods(),this.toggleActionBtns(r>0,"defaults"),{overlaps:s,canContinue:!(n>0),added:r,noTime:l.length>0?l.length:null}}onPickEvent(e,t,i,l,s=null){const n=()=>{l&&(this.removeFromBalance(e==null?void 0:e.duration),console.log("onPickEvent...useBalance","force?"+i));let p=this.addToSchedule({...e,time:t.time},!1);return this.isViewingPast()||l?(s&&s(`onPickEvent::Added ${e==null?void 0:e.title}...Saving schedule`,"info"),this.saveDaySchedule()):this.toggleActionBtns(!0,"onPickEvt"),{overlaps:p,canContinue:!0}};let r=B(t,{minute:e.duration}),a=this.hasOverlappingEvent(e.id,t,r),m=a.length;if(m>0){console.log("onPickEvent::OVERLAPS!!"+m,"with force "+i,JSON.parse(JSON.stringify(a)));let p=this.massageOneToMany(a),g={overlaps:p,canContinue:!1};if(m>1||!i)return g;s&&s(`onPickEvent:: ${m} OVERLAPS! Forcing...`,"info"),this.toggleActionBtns(!0,"onPickEvt");for(let O=0;O<m;O++){let b=p[O][1],c=0;do this.recurChangeTime(b[c].inConflict,e,t,!0,s);while(++c<b.length)}return l&&this.removeFromBalance(e==null?void 0:e.duration),this.isViewingPast()||l?this.saveDaySchedule():this.toggleActionBtns(!0,"onPickEvt"),{overlaps:null,canContinue:!0}}else return n()}onAdHocEvent(e,t,i,l=null){const s=m=>(i?(this.removeFromBalance(m==null?void 0:m.duration),console.log("onAdHocEvent...using Balance",m==null?void 0:m.duration),this.saveDaySchedule(),l&&l("New adHoc Evt!! Saving Schedule with new balance....","positive")):l&&(l("New adHoc Evt added!! ...doSave eh","info"),this.toggleActionBtns(!0,"onAdHoc")),{overlaps:null,canContinue:!0});let n=this.getSubGoalByID(e);if(!n)return{overlaps:null,canContinue:!1};let r=this.addToSchedule(n,!0),a=Array.isArray(r);if(!r||a){let m={overlaps:r,canContinue:!1},p=r.length;if(a&&p>1)return m;if(a&&p==1){l&&l(`onAdHocEvent:: ${p} OVERLAPS! Forcing...`,"warning");for(let g=0;g<p;g++){let O=r[g][1],b=0;do this.recurChangeTime(O[b].inConflict,n,t,!0,l);while(++b<O.length)}return s(n)}return m}return s(n)}addMinsToEvt(e,t,i=null){const l=(g,O,b)=>{let c=g.end,E=this.updateDetz({...g,duration:O,end:b});return this._dailyScheduled.set(e,E),this._endTimesSet.delete(c.time)||console.log("ERROR endTimesSet item does not exist?!?"+c.time,g,this._endTimesSet),this._endTimesSet.add(b.time),i&&i(`${t} mins added to '${g==null?void 0:g.title}' Saving...`,"info"),this.saveDaySchedule(),{overlaps:null,canContinue:!0}};let s=this.findSchedEvent(e);if(!s){console.log("ERROR addMinsToEvt EVT not found!!!",e);return}let n=s.end,r=B(n,{minute:parseInt(t)}),a=parseInt(t)+s.duration,m=this.hasOverlappingEvent(e,s.start,r);return m.length>0?{overlaps:this.massageOneToMany(m),canContinue:!1}:l(s,a,r)}saveNewGoal(e,t,i,l,s){if(l=="self"){let n=this.addParentGoal(t,t,"red-14",2);return n?fe(n,t,"1on5",e.time,s,!0,!1,s<30):(console.log("ERROR? no pID",n),n===0?fe(n,t,"1on5",e.time,s,!0,!1,s<30):null)}else if(i){return console.log("with parentGoal "+i.id,i==null?void 0:i.title),fe(i.id,t,"1on5",e.time,s,!1,!1,s<30);//!canMove and notInDefaults. isAlternative when duration<30
}else{let n=Qt();if(n)return fe(n.id,t,"1on5",e.time,s,!1,!1,s<30);{let r=this.addParentGoal("Misc","Miscellaneous","grey-10",2);return r?fe(r,t,"1on5",e.time,s,!0,!1,s<30):(console.log("ERROR? no pID",r),r===0?fe(r,t,"1on5",e.time,s,!0,!1,s<30):null)}}}addParentGoal(e,t,i,l=2){let s=[];this.parentGoalsMap().forEach((r,a,m)=>{let p=r.bgcolor;s.push(p)});let n=Et().filter(r=>!s.some(a=>a==r));if(n.length>1){let r=Math.floor(Math.random()*n.length),a=n[r];console.log(`addParentGoal::bgcolor..index ${r} from ${i} to:`,a),i=a}else console.log("addParentGoal::NONE available",n,AllColors);return Kt(e,t,i,l)}recurChangeTime(e,t,i,l=!1,s=null){var r,a,m,p,g;let n=this.findSchedEvent(e);if(n){let O=q(n.start.time)-q(i.time),b=`${O>0?"DOWN":"UP"}`,c=null;if(O>=0){c=B(i,{minute:parseInt(t.duration)+10});let h=B(i,{minute:parseInt(n.duration)+10});console.log(`recurChangeTime::START>>(${e}) '${n==null?void 0:n.title}' ${n==null?void 0:n.duration} mins going FORWARD ${b} for ${O} due to evt:(${t.id})${(r=t==null?void 0:t.title)==null?void 0:r.trim()} at ${i.time} 
          
 doAdd?:${l} >`,JSON.parse(JSON.stringify(c.time)),"alt:",h.time);let y=ee(h,c);if(y>0){let d=Math.floor(y/1e3/60);d<=O?console.log(`recurChangeTime::(${e}) duration: ${n.duration} vs Target evtDura:${t.duration}...USING overlappedEvtNew ${c.time}!! ${d} <= dragInterval ${O} `,h.time):(console.log(`recurChangeTime::DIFFY = ${y} and ${d} >= dragInterval ${O}...
COULD USE ALTERNATIVE as duration:${n.duration} vs evtDura:${t.duration}`,c.time,h.time),O==0?c=h:console.log("recurChangeTime::NOT USING ALTERNATIVE",h.time))}}else{c=B(i,{minute:-(parseInt(n.duration)+10)});let h=B(i,{minute:-(parseInt(t.duration)+10)});console.log(`recurChangeTime::START>>(${e}) '${n==null?void 0:n.title}' going BACKWARD ${b} for ${O} due to evt:(${t.id})${(a=t==null?void 0:t.title)==null?void 0:a.trim()} at ${i.time}
          
 doAdd?:${l}`,c.time,"alt:"+h.time);let y=ee(h,c),d=y>0?Math.floor(y/1e3/60):0;console.log(`recurChangeTime::BACKWARD ${b} for ${O}`,d)}let E=this.hasOverlappingEvent(e,c,B(c,{minute:n.duration})),u=E.length;if(u>0){let h=0;s&&s(`${u} Cascading Overlaps handling (${e}) '${n==null?void 0:n.title}' going ${b} as ${l?"Adding":"Moving"} '${(m=t==null?void 0:t.title)==null?void 0:m.trim()}'`);do{if(console.log(`CASCADING OVERLAPPED >> ${h} (${e}) at: ${c.time} now at: ${n.start.time} till ${n.end.time}`,E[h]),E[h].inConflict==t.id){console.log(`EUUUH...ERROR::recurChangeTime::self overlap?!?OVERLAPPED:${e} ...break `+h,u,E[h].inConflict,t.id);break}this.recurChangeTime(E[h].inConflict,n,c,!1,s)}while(++h<u)}this.changeEvtTime(n,c);let D=i;if(!l){this.changeEvtTime(t,D);return}let T=this.addToSchedule({...t,time:D.time},this.isViewingToday());if(T.length>0){this.doLog(`recurChangeTime::TARGET extra OVERLAP ${l?"Adding":"Moving"} ${(p=t==null?void 0:t.title)==null?void 0:p.trim()}`,T),s&&s(`EXTRA OVERLAPS ${l?"Adding":"Moving"} TARGET ${(g=t==null?void 0:t.title)==null?void 0:g.trim()}`),T.find(S=>S[0]=="oneToMany")&&(T=T.filter(S=>S[0]!="oneToMany"),this.doLog("recurChangeTime::TARGET::WITHID!!!Now>>",T.length));let y=T.length,d=0;do{let S=T[d][1],v=S.length-1;for(;v>=0;v--){if(S[v].inConflict==t.id){console.log("EUUUH...::recurChangeTime::TARGET>>OVERLAP::self overlap?!?...breaking!",S[v].inConflict,t.id,S[v].targetStart);break}this.recurChangeTime(S[v].inConflict,t,D,l,s)}}while(++d<y)}}else console.log("recurChangeTime::ERROR ERROR >> overlapped event not found!","doAdd? "+l,e,t)}hasOverlappingEvent(e,t,i){const l=[];return this._dailyScheduled.forEach((s,n,r)=>{if(n!=e){let a=this.checkOverlapByTime(t,i,s.start,s.end,e);a&&l.push({target:e,targetStart:t,direction:a,inConflict:n})}}),l}checkOverlapByTime(e,t,i,l,s){let n=this.getTimeyNumber(e),r=this.getTimeyNumber(t),a=this.getTimeyNumber(i),m=this.getTimeyNumber(l);if(n===!1||a===!1||r===!1||m===!1)return console.log("ERROR... checkOverlapByTime error",n,r,a,m),!1;let p=!1;n>a&&n<m&&(p="bas"),r>a&&r<m&&(p="haut");let g=a>=n&&r>=m,O=n>=a&&r<=m;return(g||O)&&(p="surrounding"),p}canDropEvent(e,t){let i=B(e,{minute:t.duration}),l=this.hasOverlappingEvent(t.id,e,i);return l.length>0?{overlaps:this.massageOneToMany(l),canContinue:!1}:{overlaps:null,canContinue:!0}}toggleActionBtns(e,t){this.disableSaveSchedule=!e,this.showReloadBtn=this.hasEventsForDate()&&e,this.showClearBtn=!this.isViewingPast()&&e}resetChosen(){this.chosenScore=null,this.chosenPrio=null}enableActionBtns(){let e=this.isViewingPast();this.showActionBtns=!e}tooClose(e,t){let i=B(e,{minute:0}),l=this.getTimeNumber(i),s=B(e,{day:1}),n=new Date(s.date);n.setHours(24),n.setMinutes(0),n.setSeconds(0),n.setMilliseconds(0);let r=ae(n),a=Math.floor(ee(i,r)/1e3/60);if(a<t)return console.log("tooClose to midnight eh...:(",a),!0;let m=!1;return this._dailyScheduled.forEach((p,g,O)=>{let c=this.getTimeNumber(p.start)-l,E=ee(i,p.start);Math.floor(E/1e3/60)<=10&&c>0&&(m=g)}),m}changeEvtTime(e,t,i){return i=="ok"&&ze(e.id,t.time,null),this.doUpdateSchedule(e,t),i}doUpdateSchedule(e,t){let i=this.findSchedEvent(e.id);if(!i){console.log("doUpdateSchedule-ERROR NOT found",e.id,i);return}let l=B(Z(i.date),{minute:q(t.time)}),s=B(l,{minute:i.duration}),n=this._endTimesSet.delete(i.end.time);this._endTimesSet.add(s.time),n||console.log("doUpdateSchedule-endTimesSet NOT FOUND?!?",i.id,s.time),this._startTimesSet.delete(i.start.time),this._startTimesSet.add(l.time),i.time=t.time,i.sortTime=l;let r=this.updateDetz({...i,time:t.time,start:l,end:s});this._dailyScheduled.set(e.id,r),this.enableNoteScoreEdit(e.id,l,s)}saveDaySchedule(){let e={};this._dailyScheduled.size<1?e=null:this._dailyScheduled.forEach((t,i,l)=>{t.start.time.indexOf("NaN")>-1||(e[i]={time:t.start.time,duration:t.duration,atScore:t==null?void 0:t.atScore},this.usingMoods[i]&&(e[i].byMood=this.usingMoods[i]),t.notes!==void 0&&(t==null?void 0:t.notes)!==""&&(e[i].notes=t==null?void 0:t.notes))}),console.log("saveDaySchedule",e?Object.keys(e).length:"CLEARED"),Qe(this.currentDate,e),this.disableSaveSchedule=!0,this.showReloadBtn=!1,this.showClearBtn=e!=null&&!this.isViewingPast()}updateMinEndNowBtn(e,t,i){for(let[l,s]of this._dailyScheduled)(t?s.end.time:s.start.time)==e&&(this.hasStarted[l]=!t,this.isDisabledScoreEdit[l]=!t,this.mobile&&(console.log(`updateMinEndNowBtn..MOBILE::good?>>${i}::${t}`,e),this.showMobileDialog[l]=!t))}reduceEvtDuration(e,t){let i=this.findSchedEvent(e);if(!i){console.log("ERROR:: reduceEvtDuration Evt not found!!!",e);return}const l=ae(new Date);let s=i.start,n=i.end,r=this.updateDetz({...i,duration:t,end:l});this._dailyScheduled.set(e,r),this._endTimesSet.delete(n.time)||console.log("ERROR endTimesSet item does not exist?!?",i,this._endTimesSet),this._endTimesSet.add(l.time),this.enableNoteScoreEdit(e,s,l),this.saveDaySchedule()}canEndNow(e){let t=this.findSchedEvent(e);if(!t)return console.log("ERROR canEndNow Evt not found!!!",e),!1;const i=ae(new Date);let l=t.start,s=t.end;if(!Be(i,l,s,!0))return console.log("umm aint in the middle of this event! Nothing to do...canEndNow::ERROR?",i.time,l.time,s.time),!1;let n=B(i,{minute:0}),r=ee(l,n),a=Math.floor(r/1e3/60);return console.log(`canEndNow:: ${e} duration from ${t.duration} to: ${a}`),a<10?a:this.reduceEvtDuration(e,a)}updateNoteScore(e,t,i=""){let l=this.findSchedEvent(e);l?(l.score==t||(ze(e,null,t),l.atScore=t),l.score=t,i!==""&&(l.notes=i),this.isViewingPast()?this.saveDaySchedule():this.toggleActionBtns(!0,"updateNoteScore")):console.log(`ERROR ERROR::updateNoteScore could not find event ${e}?!?`)}deleteEvtMood(e){if(this.usingMoods[e]){delete this.usingMoods[e],console.log("deleteEvtMood::>> "+e);return}}updateCurrentMoods(){for(let e in this.usingMoods)this._dailyScheduled.has(parseInt(e))||this.deleteEvtMood(e)}removeScheduledEvt(e){if(!e){console.log("ERROR removeScheduledEvt, NO evt to delete!",e);return}let t=null;if(this._dailyScheduled.has(e.id))t=this._dailyScheduled.get(e.id),this._dailyScheduled.delete(e.id);else{console.log("removeScheduledEvt:: ERROR NO evt?@? ERROR",e);return}if(t){let i=this._startTimesSet.delete(t.start.time),l=this._endTimesSet.delete(t.end.time);(!i||!l)&&console.log(`removeScheduledEvt ::> ERROR? scheduleSets has no such evt?@? start:${i}...end:${l}`,t,e.id+" "+(e==null?void 0:e.title.trim())+" "+(e==null?void 0:e.details)),this.deleteEvtMood(e.id)}}addToBalance(e){let i=this.getCurrentBalance()-parseInt(e==null?void 0:e.duration);Je(i)}removeFromBalance(e){let i=this.getCurrentBalance()+parseInt(e);Je(i)}disableEvtScoreEdit(e,t){this.isDisabledScoreEdit[e]=!t,this.mobileEnableScore[e]=t}enableNoteScoreEdit(e,t,i){const l=ae(new Date);let s=ee(l,i),n=B(l,{minute:0});this.getTimeNumber(n),s>0?(this.isDisabledScoreEdit[e]=!0,this.mobileEnableScore[e]=!1):(this.hasStarted[e]=!1,this.mobile&&(this.showMobileDialog[e]=!1),this.mobileEnableScore[e]=!0,this.isDisabledScoreEdit[e]=!1),Be(l,t,i,!0)?this.hasStarted[e]=!0:this.hasStarted[e]=!1}getTimeyNumber(e){return e!==null?Bt(e):!1}getTimeNumber(e){return e!==null?Ie(e):!1}doLog(e,t){console.log(e,t?JSON.parse(JSON.stringify(t)):"")}}const Zt=()=>!0;function ei(o){const e={};return o.forEach(t=>{e[t]=Zt}),e}function Le(){const{emit:o,proxy:e}=Ye(),t=I(null);function i(){t.value.show()}function l(){t.value.hide()}function s(r){o("ok",r),l()}function n(){o("hide")}return Object.assign(e,{show:i,hide:l}),{dialogRef:t,onDialogHide:n,onDialogOK:s,onDialogCancel:l}}const tt=["ok","hide"];Le.emits=tt;Le.emitsObject=ei(tt);const ti=mt({name:"scheduleBy",props:{title:String,message:String,options:Array,selectedO:String},emits:["onCancel","onOk","ok","hide"],data(){return{mess:this.message,daOptions:this.options,skipOvCheck:I(!1),optGroup:this.selectedO}},setup(){const{dialogRef:o,onDialogHide:e,onDialogOK:t,onDialogCancel:i}=Le();return{dialogRef:o,onDialogHide:e,onDialogOK:t,onCancelClick:i}},computed:{oCheck:{get(){return this.skipOvCheck},set(o){this.skipOvCheck=o}},oChoice:{get(){return this.optGroup},set(o){this.optGroup=o}}},methods:{show(){this.$refs.dialogRef.show()},hide(){this.$refs.dialogRef.hide()},onDialogHidey(){this.$emit("hide"),this.onDialogHide()},onOKyClick(){this.$emit("ok",{choice:this.oChoice,skipOCheck:this.oCheck}),this.hide()},onCancelyClick(){this.$emit("onCancel"),this.hide(),this.showy=!1}}}),ii={class:"q-ma-md title"},oi={class:"q-ma-md title"},li={class:"q-gutter-sm"};function si(o,e,t,i,l,s){return P(),Q(bt,{ref:"dialogRef","transition-show":"rotate","transition-hide":"rotate",onHide:o.onDialogHidey},{default:L(()=>[$(vt,{class:"my-dialog"},{default:L(()=>[H("div",ii,K(o.title),1),$(De,{dark:""}),H("div",oi,K(o.mess),1),$(St,{class:"q-gutter-md"},{default:L(()=>[H("div",li,[$(pt,{modelValue:o.oChoice,"onUpdate:modelValue":e[0]||(e[0]=n=>o.oChoice=n),options:o.daOptions},null,8,["modelValue","options"])]),o.oChoice!="filter"?(P(),Q(Ze,{key:0,modelValue:o.oCheck,"onUpdate:modelValue":e[1]||(e[1]=n=>o.oCheck=n),label:"Skip Overlap Check?","left-label":""},null,8,["modelValue"])):x("",!0)]),_:1}),$(De,{dark:""}),$(yt,{align:"center",class:"q-mx-md"},{default:L(()=>[$(Ce,{label:"Cancel",flat:"",color:"primary",onClick:o.onCancelyClick},null,8,["onClick"]),$(De,{vertical:!0}),$(Ce,{label:"Ok",flat:"",color:"primary",onClick:o.onOKyClick},null,8,["onClick"])]),_:1})]),_:1})]),_:1},8,["onHide"])}var ni=Xe(ti,[["render",si],["__scopeId","data-v-3623ea57"]]);function Ke(o){return o.button===0}const ri={name:"altDayCalendar",components:{NavigationBar:se(()=>ne(()=>import("./NavigationBar.89aa63fc.js"),["assets/NavigationBar.89aa63fc.js","assets/index.e7de6a78.js","assets/index.4f70e4de.css"])),QCalendarDay:xt,GoalyEnd:se(()=>ne(()=>import("./goalyEnd.fd79546d.js"),["assets/goalyEnd.fd79546d.js","assets/goalyEnd.bf51d2cd.css","assets/index.e7de6a78.js","assets/index.4f70e4de.css","assets/goalStorage.2d45b166.js","assets/QSelect.4887465e.js","assets/touch.70a9dd44.js","assets/QItem.5706ac8f.js"])),daInstructions:se(()=>ne(()=>import("./instructions.868640c2.js"),["assets/instructions.868640c2.js","assets/index.e7de6a78.js","assets/index.4f70e4de.css"])),schedBtn:se(()=>ne(()=>import("./schedBtn.db650e26.js"),["assets/schedBtn.db650e26.js","assets/schedBtn.e216f6f0.css","assets/goalStorage.2d45b166.js","assets/index.e7de6a78.js","assets/index.4f70e4de.css"])),dropDwnBtn:se(()=>ne(()=>import("./dropDwnBtn.19510c65.js"),["assets/dropDwnBtn.19510c65.js","assets/dropDwnBtn.9d1a048a.css","assets/QItem.5706ac8f.js","assets/index.e7de6a78.js","assets/index.4f70e4de.css","assets/QList.0ee03b67.js","assets/QSelect.4887465e.js","assets/touch.70a9dd44.js","assets/goalStorage.2d45b166.js"])),schedDialog:se(()=>ne(()=>import("./schedDialog.9b1faead.js"),["assets/schedDialog.9b1faead.js","assets/schedDialog.0a5a881b.css","assets/index.e7de6a78.js","assets/index.4f70e4de.css","assets/QSpace.e1678d91.js"])),mobileNoteScore:se(()=>ne(()=>import("./onScoreEditDialog.b69d4a0d.js"),["assets/onScoreEditDialog.b69d4a0d.js","assets/onScoreEditDialog.1a5ed29f.css","assets/index.e7de6a78.js","assets/index.4f70e4de.css"]))},data(){return _t(),I(null),I(null),I(null),I(null),I(null),{splitterPage:I(35),splitterLegend:I(40),timeStartPos:I(0),showTree:I(!1),treeGoals:I([]),expanded:I([]),filter:I([]),filterRef:I(null),calendar:I(null),showEvtDialog:I(!1),currentDate:I(Ee()),scoreOptions:I([1,2,3,4,5,6,7,8]),anchorTimestamp:I(null),otherTimestamp:I(null),mouseDown:I(!1),mobile:I(!0),daSchedule:I(null),showInstru:I(!1)}},beforeMount(){this.mobile=Vt(),this.daSchedule=new Xt(this.currentDate,this.mobile),this.constructTree()},mounted(){this.adjustCurrentTime(),this.intervalId=setInterval(()=>{this.adjustCurrentTime()},6e4)},beforeUnmount(){clearInterval(this.intervalId)},computed:{chosenScoreLabel(){return this.daSchedule.chosenScoreLabel()},chosenPrioLabel(){return this.daSchedule.chosenPrioLabel()},style(){return{top:this.timeStartPos+"px"}},showSchedInstru(){return this.getDateEvents(this.currentDate).length<1},showRemInstru(){return this.getDateEvents(this.currentDate).length>0},defaultBtnLabel(){let o=this.daSchedule.unscheduledDefaultEvts();return o>0?o+" Defaults":"Defaults"},isDefaultBtnEnabled(){return!this.daSchedule.unscheduledDefaultEvts()>0||this.isViewingPast()},doShowActionBtns(){return this.daSchedule.actionBtnsEnabled()},scheduleProps(){return this.daSchedule.getProps()},saveScheduleDisabled(){return this.daSchedule.saveBtnEnabled()},showTreeForm(){return this.showTree||this.constructTree(),this.showTree},filterString(){return this.filter.join()},currentBalance(){return this.daSchedule.getCurrentBalance()},canbeScheduled(){return this.daSchedule.availableEvtsToSchedule()},scheduleMoodsLabel(){let o=this.daSchedule.getCurrentMoods();if(!Object.keys(o).length>0)return null;let e=new Map;for(let i in o){let l=o[i].join();e.set(i,l)}let t={};for(let[i,l]of e){let s=this.daSchedule.findSchedEvent(parseInt(i));t[i]={m:l,bg:s==null?void 0:s.bgcolor}}return t},startEndTimes(){const o=[];return this.anchorDayTimeIdentifier!==!1&&this.otherDayTimeIdentifier!==!1&&(this.anchorDayTimeIdentifier<=this.otherDayTimeIdentifier?o.push(ue(this.anchorTimestamp),ue(this.otherTimestamp)):o.push(ue(this.otherTimestamp),ue(this.anchorTimestamp))),o},anchorDayTimeIdentifier(){return this.anchorTimestamp!==null?Ie(this.anchorTimestamp):!1},otherDayTimeIdentifier(){return this.otherTimestamp!==null?Ie(this.otherTimestamp):!1},eventsMap(){return this.daSchedule.scheduledEventsMap()}},methods:{showEvtMobile(o){return this.daSchedule.showEvtNoteScoreMobile(o)},selectedTimeInterval(){return this.targetDrop.timestamp.time},adjustCurrentTime(){var l,s;const o=ae(new Date);if(this.currentDate!==o.date){this.timeStartPos=-10,this.currentTime="";return}this.currentDate=o.date,this.currentTime=o.time,this.timeStartPos=(s=(l=this.$refs)==null?void 0:l.calendar)==null?void 0:s.timeStartPos(o.time,!1);let e=this.daSchedule.getCurrentSchedTimesSets(),t=e.endSet&&e.endSet.has(o.time),i=e.startSet&&e.startSet.has(o.time);(t||i)&&(this.daSchedule.updateMinEndNowBtn(this.currentTime,t,i),i&&(this.scrollToTime(o,"slow"),this.doNotify("Event Starting :)","positive","top")))},hasDate(o){return this.currentDate?o.find(e=>e.date===this.currentDate):!1},getDateEvents(o){let e=(i,l)=>{let s=ee(i.sortTime,l.sortTime);if(s>0)return-1;if(s==0)return 0;if(s<0)return 1};const t=this.eventsMap[o]||[];return t.length===1?t[0].side="full":t.length,t.sort(e)},constructTree(){this.treeGoals=this.daSchedule.fetchGoalsTree()},resetGoalEvts(){return this.daSchedule.getSubGoals()},allMainGPrio(){return this.daSchedule.getAllPrio()},resetFilter(){var o;this.filter=[],(o=this.filterRef)==null||o.focus()},myFilterMethod(o,e){const t=this.filter.map(i=>i.toLowerCase());if(o.isChildren&&(o==null?void 0:o.moods.length)>0){let i=o==null?void 0:o.moods.some(l=>t.indexOf(l.toLowerCase())>-1);return o.label&&i}},labelScheduled(){return this.daSchedule.labelScheduled()},labelBalance(){return`Balance: ${this.daSchedule.getCurrentBalance()||0} 
`},badgeClasses(o,e){return Rt(o,e)},badgeStyles(o,e,t=void 0,i=void 0){return wt(o,e,t,i)},classyColor(o){return`row items-center ${o.isChildren?"text-":"text-white bg-"}${o.color} `},isViewingPast(){return this.daSchedule.isViewingPast()},onMoodAdd(){let o=[];const e=this.filter.map(t=>t.toLowerCase());if(this.treeGoals.filter(t=>{if(t.children.length>0)return t.children.filter(i=>{if((i==null?void 0:i.moods.length)>0&&(i==null?void 0:i.moods.some(l=>e.indexOf(l.toLowerCase())>-1))){let l=i==null?void 0:i.moods.filter(s=>{if(e.indexOf(s.toLowerCase())>-1)return s});return o.push({id:i.id,mood:l}),i}})}),o.length>0)if(o=o.filter(i=>!this.daSchedule.getScheduledEvts().has(i.id)),o.length>0){let i=this.daSchedule.scheduleByMood(o);if(i.canContinue)this.doNotify(`Added ${i==null?void 0:i.added} Evts by Mood...doSave eh`,"info");else{if(i.overlaps&&Object.keys(i.overlaps).length>0)return(i==null?void 0:i.added)>0&&this.doNotify(`${i==null?void 0:i.added} Evts added ${i!=null&&i.noTime?"Plus "+(i==null?void 0:i.noTime)+" Without time":""} BUT some Overlaps to fix!`,"warning"),this.handleOverlaps(i.overlaps,"byMood");this.doNotify("Empty as no Mood Evts :(","warning")}}else this.doNotify(`Evts of Mood '${this.filterString}' already scheduled!`,"warning","top");else this.doNotify("Nothing to add :(","warning","top")},onScheduleOneEach(){let o=i=>{let l=this.daSchedule.scheduleOneEach(i.choice,i.skipOCheck,this.doNotify);if(l.canContinue)this.doNotify(`${l==null?void 0:l.added} Evts by Each ParentGoal...doSave eh`,"info");else{if(l.overlaps&&Object.keys(l.overlaps).length>0)return(l==null?void 0:l.added)>0&&this.doNotify(`${l==null?void 0:l.added} Evts added ${l!=null&&l.noTime?"Plus "+(l==null?void 0:l.noTime)+" Without time":""} BUT some Overlaps to fix!`,"warning"),this.handleOverlaps(l.overlaps,"oneEach");this.doNotify("Empty None for OneEach :(","warning")}t>0||(l==null?void 0:l.added)>0?this.daSchedule.toggleActionBtns(!0,"oneEach"):console.log("onScheduleOneEach::no Evts and no toggling for flag>> ",i.choice,l==null?void 0:l.added)},e=()=>{console.log("onScheduleOneEach..Aborting"),this.reset()},t=this.daSchedule.getScheduledEvts().size;if(t>0){let i=[{label:"Add one Evt from Each parent Goals",value:"add"},{label:"Reset schedule and add one random Evt from Each parent Goals",value:"reset"}];this.scheduleByDialog("Schedule One of Each",`Current: ${this.currentDate} already have scheduled Events...`,i,"",o,e)}else o({choice:"reset",skipOCheck:!this.daSchedule.isViewingToday()})},onReloadSaved(){let o=this.daSchedule.hasEventsForDate(),e=()=>{console.log("Aborting reload!",this.currentDate,o)},t=()=>{let i=this.daSchedule.loadEvtsForDay(!1);i.canContinue||(i.overlaps&&Object.keys(i.overlaps).length>0?(console.log("onReloadSaved::OVERLAPS",i.overlaps),this.handleOverlaps(i.overlaps,"view")):(this.doNotify(`Reloaded schedule for ${this.currentDate}`,"positive","bottom"),(this.isViewingPast()||this.currentDate!==Ee())&&this.adjustCurrentTime())),this.reset()};if(this.daSchedule.getScheduledEvts().size>0&&!this.isViewingPast()){let i=o?`Reload saved schedule of: ${this.currentDate} ?`:"Reset current Schedule?";this.confirmAction("",i,"OK",t,e)}else t()},onClearDay(){let o=this.daSchedule.hasEventsForDate();if(this.isViewingPast()){this.doNotify("Editing past is no no!");return}this.daSchedule.resetSchedule(!0);let e=o?"Cleared...Can still Reload saved":"Resetting...";this.doNotify(e,"warning","top"),this.reset(),this.daSchedule.toggleActionBtns(o,"view")},onLoadDefault(){let o=i=>{let l=this.daSchedule.scheduleDefaults(i.choice,i.skipOCheck);if(l.canContinue)this.doNotify(`Defaults added ${l==null?void 0:l.added} ...doSave eh`,"info");else{if(l.overlaps&&Object.keys(l.overlaps).length>0)return(l==null?void 0:l.added)>0&&this.doNotify(`${l==null?void 0:l.added} Default Evts added ${l!=null&&l.noTime?"Plus "+(l==null?void 0:l.noTime)+" Without time":""} BUT some Overlaps to fix!`,"warning"),this.handleOverlaps(l.overlaps,"byDefaults");this.doNotify("Empty as No Defaults :(","warning")}e>0||(l==null?void 0:l.added)>0?this.daSchedule.toggleActionBtns(!0,"byDefaults"):console.log("onLoadDefault::no Evts and no toggling for flag>> ",i.choice,l==null?void 0:l.added)},e=this.daSchedule.getScheduledEvts().size,t=this.daSchedule.unscheduledDefaults();if(e>0||(t==null?void 0:t.length)>7){let i=[{label:`Add ${t==null?void 0:t.length} Default Evts to current schedule`,value:"add"}];e>0&&i.push({label:"Reset and schedule All Defaults",value:"reset"}),this.scheduleByDialog("Schedule Defaults",`Current: ${this.currentDate} already have scheduled Events...`,i,"",function(l){o(l)},function(){console.log("onLoadDefaults::Aborting")})}else o({choice:"reset",skipOCheck:!this.daSchedule.isViewingToday()})},onChoosenPrio(o){this.daSchedule.onChoosenPrio(o)},doReloadWithPrio(){var a,m,p,g,O,b,c;let o=this.daSchedule.chosenPrio;if(o==null){this.doNotify("Ayo select a priority!");return}let e=()=>{this.reset()},t=E=>{let u=this.daSchedule.scheduleSamePrio(E.choice,E.skipOCheck);if(u.canContinue)this.doNotify(`${u==null?void 0:u.added} Evts with Priority == ${o} ...doSave eh`,"info");else{if(u.overlaps&&Object.keys(u.overlaps).length>0)return(u==null?void 0:u.added)>0&&this.doNotify(`${u==null?void 0:u.added} Evts added ${u!=null&&u.noTime?"Plus "+(u==null?void 0:u.noTime)+" Without time":""} BUT some Overlaps to fix!`,"warning"),this.handleOverlaps(u.overlaps,"byPrio");this.doNotify(`No Evts with Priority == ${o} :(`,"warning","top")}l>0||(u==null?void 0:u.added)>0?this.daSchedule.toggleActionBtns(!0,"byPrio"):console.log("doReloadWithPrio::no Evts and no toggling for flag>> ",E.choice,u==null?void 0:u.added)},i=this.daSchedule.byPrio,l=this.daSchedule.getScheduledEvts().size,s=`Reload Schedule by Parent's Priority == ${o}`,n=[];if(!i){console.log("doReloadWithPrio::ERROR? >> no options",i),n=this.defaultScheduleByOpts(),this.scheduleByDialog("",s,n,"",t,e);return}((a=i==null?void 0:i.filter)==null?void 0:a.length)>0&&((m=i==null?void 0:i.filter)==null?void 0:m.length)!=l&&n.push({label:`Filter out of ${l} scheduled to ${(p=i==null?void 0:i.filter)==null?void 0:p.length} Evts`,value:"filter"}),((g=i==null?void 0:i.toAdd)==null?void 0:g.length)>0&&n.push({label:`Add ${(O=i==null?void 0:i.toAdd)==null?void 0:O.length} Evts to current schedule`,value:"add"}),n.push({label:`Reset current and schedule ${(b=i==null?void 0:i.reset)==null?void 0:b.length} Evts.`,value:"reset"}),l>0?this.scheduleByDialog("",s,n,"",t,e):((c=i==null?void 0:i.toAdd)==null?void 0:c.length)>7?this.scheduleByDialog("",s,n,"",t,e):t({choice:"reset",skipOCheck:!this.daSchedule.isViewingToday()}),this.daSchedule.disablePrioBtn=!0},onChoosenScore(o){this.daSchedule.onChoosenScore(o)},onScheduleByScore(o,e=!1){let t=[],i=!1,l=null;const s=this.daSchedule;let n=()=>[{label:"Keep Evt with Highest Priority",value:"opt1",color:"secondary"},{label:"Manually Choose one event",value:"opt3"}];const r=g=>this.findhighestPrio(g),a=(g,O)=>this.betterEvtLabel(g,O,!1);let m=(g,O,b)=>{this.confirmChoiceDialog("","Choose which Event to keep",g.map(c=>a(c,"default")),"",function(c){let E=g.find(u=>u.id==c);if(!E){console.log("chooseOneEvt::ERROR NOT FOUND!!",c);return}if(O.id==E.id){g.forEach(D=>{D.id!=E.id&&s.removeScheduledEvt(D)});let u=s.addToSchedule(O,!e,!1);//!skipOvCheck
console.log("chooseOneEvt::ADDED",c,b,u)}else g.forEach(u=>{O.id==u.id?console.log("chooseOneEvt,not adding target",u.id,E.id):u.id!=E.id?s.removeScheduledEvt(u):console.log("chooseOneEvt,not adding scheduled",u.id,E.id)});return b=c,b},null,function(){console.log("onScheduleByScore::onDismiss >>chooseOne",b,l),l=b})};o.sort(function(g,O){return q(g.time)-q(O.time)}),o.forEach((g,O,b)=>{let c=s.addToSchedule(g,!e,!1);if(c&&Array.isArray(c))if(c.length>1){console.log("onScheduleByScore::OVERLAP >> oneToMany",g,c),i=!0;let E=null;if(c.find(u=>u[0]=="oneToMany")){c=c.filter(u=>u[0]!="oneToMany");for(let u=0;u<c.length;u++){c[u][0];let D=c[u][1];E=D[0].targetStart,this.scrollToTime(E,"slow");let T=[],h=[],y=!1;for(;D.length;){const v=D.pop();let C=this.daSchedule.findSchedEvent(v.inConflict);T.push(`(${C==null?void 0:C.id}) '${C==null?void 0:C.title.trim()}'`),g.id!=v.target&&console.log("onScheduleByScore::ERROR ERROR:: NOT same target ID?!?",g,v),h.push(C),v.direction=="surrounding"?y=!0:y=y}h.unshift(g);let d=`Adding (${g==null?void 0:g.id}) '${g==null?void 0:g.title.trim()}' at ${F(g==null?void 0:g.time)} Conflicts with scheduled ${T.join(" and ")}. `,S=n();y||S.push({label:`Force in > '${g==null?void 0:g.title.trim()}' ?`,value:"opt4"}),this.confirmChoiceDialog("OneToMany Conflicts",d,S,"",function(v){var C;switch(v){case"opt1":let N=r(h);if(console.log("onScheduleByScore::ByPriority >> AUTO ",N.e.id,(C=N==null?void 0:N.e)==null?void 0:C.title.trim()),g.id==N.e.id){h.forEach(te=>{te.id!=N.e.id&&s.removeScheduledEvt(te)});let U=s.addToSchedule(g,!e,!1);//!skipOvCheck
console.log("onScheduleByScore::ByPriority>>ADDED",l,U)}else h.forEach(U=>{U.id!=N.e.id?s.removeScheduledEvt(U):console.log("onScheduleByScore::ByPrio,not adding target?",U.id,N.e.id)});l=v;return;case"opt4":let z=h.find(U=>U.id!=g.id);s.recurChangeTime(z.id,g,E,!0),l=v;return;default:m(h,g,l);return}},null,function(){console.log("onScheduleByScore::onDismiss >> OneToMany",l)})}}else console.log("onScheduleByScore::OVERLAP! ERROR not oneToMany?!?",c)}else t.push(...c);else c===!0||console.log("onScheduleByScore::adding...FAILED?>>",g,c)});const p=()=>{this.doLog("onScheduleByScore::doContinue",t),t.length>0&&this.doNotify(`${t.length} EXTRA Overlaps to fix!`,"negative","top"),this.doNotify("Added byScore!..doSave eh","info","top")};if(i){let g=setInterval(()=>{l&&(setTimeout(()=>{clearInterval(g)},0),p())},3e3)}else p()},doReloadWithScore(){var a,m,p,g,O,b,c;let o=this.daSchedule.chosenScore;if(o==null){this.doNotify("Ayo select a score!");return}let e=()=>{this.reset()},t=E=>{let u=this.daSchedule.scheduleByScore(E.choice,E.skipOCheck);if(u.canContinue)this.doNotify(`${u==null?void 0:u.added} Evts with Interval Score <= ${o} ...doSave eh`,"info");else{if(u.overlaps&&Object.keys(u.overlaps).length>0)return(u==null?void 0:u.added)>0&&this.doNotify(`${u==null?void 0:u.added} Evts added ${u!=null&&u.noTime?"Plus "+(u==null?void 0:u.noTime)+" Without time":""} BUT some Overlaps to fix!`,"warning"),this.handleOverlaps(u.overlaps,"byScore");this.doNotify(`No Evts with Interval Score <= ${o} :(`,"warning")}l>0||(u==null?void 0:u.added)>0?this.daSchedule.toggleActionBtns(!0,"byScore"):console.log("doReloadWithScore::no Evts and no toggling for flag>> ",E.choice,u==null?void 0:u.added)},i=this.daSchedule.byScore,l=this.daSchedule.getScheduledEvts().size,s=`Reload Schedule by Interval Score <= ${o}`,n=[];if(!i){console.log("doReloadWithScore::ERROR? >> no options",i),n=this.defaultScheduleByOpts(),this.scheduleByDialog("",s,n,"",t,e);return}((a=i==null?void 0:i.filter)==null?void 0:a.length)>0&&((m=i==null?void 0:i.filter)==null?void 0:m.length)!=l&&n.push({label:`Filter out of ${l} scheduled to ${(p=i==null?void 0:i.filter)==null?void 0:p.length} Evts`,value:"filter"}),((g=i==null?void 0:i.toAdd)==null?void 0:g.length)>0&&n.push({label:`Add ${(O=i==null?void 0:i.toAdd)==null?void 0:O.length} Evts to current schedule.`,value:"add"}),n.push({label:`Reset current and schedule ${(b=i==null?void 0:i.reset)==null?void 0:b.length} Evts.`,value:"reset"}),l>0?this.scheduleByDialog("",s,n,"",t,e):((c=i==null?void 0:i.toAdd)==null?void 0:c.length)>10?this.scheduleByDialog("",s,n,"",t,e):t({choice:"reset",skipOCheck:!this.daSchedule.isViewingToday()}),this.daSchedule.disableScoreBtn=!0},doSaveSchedule(){var t;let o=(t=this.labelScheduled())==null?void 0:t.noTime;this.daSchedule.saveDaySchedule();let e=`Schedule saved for ${this.currentDate}`;o&&(e+=` 
Except for ${o} without time!`),this.doNotify(e,o?"info":"positive"),this.resetFilter()},doDroppy(o,e){if(o&&e){let t=this.daSchedule.tooClose(o,e.duration);if(t&&(console.log("doDroppy::tooClose to>>",t),t===!0)){this.doNotify("Dropping event TOO close to midnight!"),this.reset();return}let i=this.daSchedule.canDropEvent(o,e),l=this.daSchedule.getOriginalEvtTime(e.id);if(i.canContinue){let s=(e==null?void 0:e.inDefaults)||!(e!=null&&e.canMove),n=!l||(e==null?void 0:e.time)=="";if(s&&!n){let r=e!=null&&e.inDefaults?"Default at ":"Cannot Move from ",a=[`Evt "${e.title.trim()}" ${r} ${F(l)}.`,`
Also Save Evt default time to ${F(o.time)}?`,`
Cancel or No selection to keep at ${F(e.time)}`].join(`
`);const m=this.daSchedule,p=this.doCleanup;this.confirmTimeChange(`${e!=null&&e.inDefaults?"Changing Default Evt's time":"Evt's Cannot move"}`,a,"Change","Temp.Move",function(g){m.changeEvtTime(e,o,g),m.toggleActionBtns(!0,"doDroppy"),p()},function(){p()},function(){console.log(`doDroppy::onDismiss..keep as is>> ${e.id})'${e.title.trim()}'`),p()})}else this.daSchedule.changeEvtTime(e,o,!1),this.daSchedule.toggleActionBtns(!0,"doDroppy"),this.doCleanup()}else this.handleOverlaps(i.overlaps,"onDrop")}else{console.log("doDroppy null ERROR?",o,this.targetDrop,e,this.selectedItem);return}},titleIncludes(o,e){return{includer:o.trim().toLowerCase().includes(e.trim().toLowerCase()),included:e.trim().toLowerCase().includes(o.trim().toLowerCase())}},canAutoSchedule(o,e){let t=this.titleIncludes(o.title,e.title),i=t.includer,l=t.included,s=this.daSchedule.parentGoalById(o.parentGoal),n=this.daSchedule.parentGoalById(e.parentGoal),r=this.titleIncludes(o.title,n.title),a=this.titleIncludes(e.title,s.title);return(r||a)&&console.log("canAutoSchedule:: WOAH PARENT AUTO schedule?--TODO***",r,a),i||l?{addIncSched:i,schdIncToAdd:l}:!1},movedIntoConflict(o,e,t,i=0){console.log("movedIntoConflict >>",JSON.parse(JSON.stringify(o)),"from:"+t,i);const l=(h,y)=>{if(h!=null&&h.parentGoal){let d=this.daSchedule.parentGoalById(h.parentGoal);return y?`Of '${d==null?void 0:d.title.trim()}' (${d==null?void 0:d.priority})`:`Of '${d==null?void 0:d.title.trim()}'`}return console.log("prioLabel..ERROR no PARENT found?",h),""},s=(h,y)=>{switch(y){case"score":return`${l(h,!1)} > "${h.title.trim()}" with Score:: ${h.score} = ${re(h.score)}`;case"prio":return`"${h.title.trim()}" ${l(h,!0)}`;default:return`"${h.title.trim()}" ${l(h,!0)} && Score:: ${h.score} for ${h.duration} mins`}},n=(h,y=!1)=>{this.doNotify(h,y?"warning":"positive","top")},r=h=>{this.daSchedule.deleteEvtMood(h)},a=h=>{console.log(`movedIntoConflict::doRemove ${h.id}:${h.title}`),this.daSchedule.removeScheduledEvt(h)};let m=h=>{console.log("onDismissy::from "+t,h,D),this.doCleanup(),this.daSchedule.toggleActionBtns(!0,t)};const p=(h,y,d)=>{if(console.log(`movedIntoConflict::removeReplace >> replacing>> ${h.id}) '${h.title.trim()}' WITH ${y.id}) ${y.title.trim()}`,d,"from>"+t),e){if(console.log("movedIntoConflict::removeReplace...OVERRIDE from>>"+t),t=="onDrop"){a(h);return}console.log("movedIntoConflict::removeReplace....OVERRIDE updating..."+t),this.daSchedule.doUpdateSchedule(y,d.targetStart);return}if(a(h),t=="onDrop")console.log("movedIntoConflict::removeReplace for onDrop...just updating schedule",y.id,d.targetStart.time),this.daSchedule.doUpdateSchedule(y,d.targetStart);else{console.log("movedIntoConflict::removeReplace >>addGoalsToSchedule from "+t);let S=this.daSchedule.getStoredRawEvt(d.target);S&&(JSON.parse(JSON.stringify(y)),Object.assign(y,S,{time:d.targetStart.time}));let v=this.daSchedule.addGoalsToSchedule([{...y,time:d.targetStart.time}],!0),C=Object.keys(v).length;if(C>0)return console.log(`movedIntoConflict::removeReplace:: OVERLAPS again of size:${C} from >${t}>`+y.title,JSON.parse(JSON.stringify(v))),this.doNotify(`Extra Overlaps while removing to add '${y.title.trim()}' `,"warning","top"),this.movedIntoConflict(v,e,t+"nah")}},g=(h,y)=>{let d=this.daSchedule.findSchedEvent(y.target);if(!d){console.log("movedIntoConflict::forceAddMins>>NOT FOUND?!?",y.target);return}let S=this.daSchedule.getStoredRawEvt(y.target);if(S){let v=d.duration+parseInt(i);JSON.parse(JSON.stringify(d)),Object.assign(d,S,{duration:v})}else console.log("movedIntoConflict::forceAddMins >>NEWLY ADDED?!? Error?",d.id,d,S),Object.assign(d,{duration:newDura});this.daSchedule.recurChangeTime(h.id,d,y.targetStart,!1,this.doNotify),this.doSaveSchedule()},O=(h,y,d)=>{console.log(`movedIntoConflict::forceAdd:${t} >>${y.id})'${y.title}' at ${y.time} to ${d.targetStart.time}
          
Changing >>${h.id} from ${h.time}`);let S=this.daSchedule.getStoredRawEvt(d.target);S&&(JSON.parse(JSON.stringify(y)),Object.assign(y,S,{time:d.targetStart.time}));let v=this.daSchedule.recurChangeTime(h.id,y,d.targetStart,t!="onDrop",this.doNotify);if(v){let C=Object.keys(v).length;if(C>0)return console.log(`movedIntoConflict::forceAdd:: OVERLAPS again of size:${C} from >${t}>`+y.title,JSON.parse(JSON.stringify(v))),this.doNotify(`Extra Overlaps while adding '${y.title.trim()}'`,"negative","top"),this.movedIntoConflict(v,e,t+"nah")}m("ForceAdd")};let b=(h,y,d,S,v)=>{D.push(y),y==d.id?(p(S,d,v),n(`by ${h}, ${t=="onDrop"?"Moving":"Adding"} '${d.title.trim()}'`,!0)):(console.log(`onOkChoice::by ${h},chose scheduled ${y} ...with override?`,e,t),n(`by ${h}, Keeping '${S.title.trim()}'`),t.indexOf("byMood")>-1&&r(d.id),t=="onDrop"&&a(d))},c=(h,y)=>{if(e){if(console.log("movedIntoConflict::cancelChoice::OVERRIDE...coolios!!from:"+t,h.title.trim()),t=="onDrop"){n("Umm...not moving then...."),this.daSchedule.toggleActionBtns(!1,"view");return}a(h),n(`Keeping '${y.title.trim()}'`);return}t.indexOf("byMood")>-1&&r(h.id),this.daSchedule.toggleActionBtns(!0,"view"),n(`Keeping scheduled '${y.title.trim()}'`)};const E=(h,y,d,S)=>{if(h=="opt3"){let v="Pick one event...",C=[{label:s(y,"def"),value:y.id,color:"secondary"},{label:s(d,"def"),value:d.id}];this.confirmChoiceDialog("",v,C,"",function(N){b("Choice",N,y,d,S)},null,function(){m("resolveChoice::byEvent... dismissing")})}else if(h=="opt2"){let v="Pick event by Score",C=[{label:s(y,"score"),value:y.id,color:"secondary"},{label:s(d,"score"),value:d.id}];this.confirmChoiceDialog("",v,C,"",function(N){b("Score",N,y,d,S)},null,function(){m("resolveChoice::byScore... dismissing")})}else if(h=="opt1"){let v="Pick event by Priority",C=[{label:s(y,"prio"),value:y.id,color:"secondary"},{label:s(d,"prio"),value:d.id}];this.confirmChoiceDialog("",v,C,"",function(N){b("Priority",N,y,d,S)},null,function(){m("resolveChoice::byPriority... dismissing")})}else h=="opt0"?(console.log("resolveChoice::it's a drop?...keeping as is....",t),n("Umm...keeping as is then!"),this.doCleanup()):O(d,y,S)},u=(h,y,d,S,v)=>{S.direction!=="surrounding"&&!v&&(t.indexOf("nah")>-1?console.log("movedIntoConflict::manualSolve NOT adding Force as from "+t):h.push({label:`Force in '${y.title.trim()}'`,value:"opt4"}));let C=`${t=="onDrop"?"Moving":"Adding"} '${y.title.trim()}' at ${F(S.targetStart.time)} Overlaps with Scheduled '${d.title.trim()}' at ${F(d==null?void 0:d.time)}.
          
Cancel to keep '${d.title.trim()}' `,N=v?"Choose Auto Resolution":"Resolve Overlapping Events";this.confirmChoiceDialog(N,C,h,"opt1",function(z){E(z,y,d,S)},function(){console.log("movedIntoConflict>>manualSolve::cancelChoice? Notif?>> from: "+t,D[0]),n("Umm...keeping as is then!")})};let D=[],T=Object.keys(o).length;o.find(h=>h[0]=="oneToMany");for(let h=0;h<T;h++){let y=o[h][0];if(y=="oneToMany"){console.log("movedIntoConflict...skipping oneToMany key",y,o.oneToMany);continue}let d=o[h][1],S=[{label:"Choose one event",value:"opt3"}];t=="onDrop"?S.unshift({label:"Leave as is!",value:"opt0"},{label:"Choose by Priority",value:"opt1",color:"secondary"},{label:"Choose by Score",value:"opt2"}):S.unshift({label:"Choose by Priority",value:"opt1",color:"secondary"},{label:"Choose by Score",value:"opt2"});const v=d.pop();let C=this.daSchedule.getSubGoalByID(v.target),N=this.daSchedule.findSchedEvent(v.inConflict);if(!N||!C){console.log("movedIntoConflict...ERROR ERROR no evts found!!!",v);return}let z=this.canAutoSchedule(C,N);if(t=="onAddMins"){let U=N!=null&&N.inDefaults?"In Defaults":N!=null&&N.canMove?"":"Cannot move",te=`Adding ${i} mins to "${C.title.trim()}" Overlaps with Scheduled "${N.title.trim()}" at ${F(N.time)} as ${U}.
            
Force?
            
Cancel/Dismiss to Leave as is.`;this.confirmAction("",te,"Add",function(){g(N,v)},function(){n("Keeping as Is...")})}else if(z){console.log("movedIntoConflict:: can AUTO schedule",z.addIncSched,z.schdIncToAdd,"direction == surrounding? >>",v.direction=="surrounding"),this.scrollToTime(v==null?void 0:v.targetStart,"slow");let U=`"${C.title.trim()}" at ${F(C.time)} related to Scheduled "${N.title.trim()}" at ${F(N.time)}.
            
Auto resolve Overlap?
            
Cancel/Dismiss to manually choose.`;this.confirmAction("",U,"Auto",function(){var te;z.addIncSched?(console.log("Auto resolve::removeReplace..with TIMES>>",C.time,N.time,(te=v==null?void 0:v.targetStart)==null?void 0:te.time),p(N,C,v),n(`Removing Scheduled to Add '${C.title.trim()}'`,!0),D.push(C.id)):(console.log("Auto resolve::cancelChoice >> from: ",t),c(C,N),D.push(N.id))},function(){u(S,C,N,v,!0)},function(){m("Auto-dismiss")})}else u(S,C,N,v,!1)}},handleOverlaps(o,e=""){let t=o.length;o.reverse(),this.doLog("handleOverlaps::ORIGNL from: "+e+" >> "+t,o);let i=o.filter(s=>s[0]=="oneToMany");i&&(o=o.filter(s=>s[0]!="oneToMany"),t=o.length);const l=Nt(o);for(let s=0;s<t;s++){let n=o[s][0],r=o[s][1],a=null;s>0?a=l[s-1][1][0].targetStart:a=null,s==t-1&&(e.indexOf("nah")>-1?console.log("handleOverlaps...NO END SCROLL::FROM",e,n):this.scrollToTime(r[0].targetStart,"slow")),i&&i.find(m=>m[1]==n)?this.fixConflicts(r,e,!0,[t,s],a):this.fixConflicts(r,e,!1,[t,s],a)}},fixConflicts(o,e,t,i,l=null){var Ge;const s=R=>this.daSchedule.findSchedEvent(R),n=R=>this.daSchedule.getSubGoalByID(R),r=(R,M)=>{if(!R){console.log("fixConflicts::scrollToConflict ERROR >>empty time hasOneToMany="+t,M,R);return}setTimeout(()=>{this.scrollToTime(R,"slow")},1e3)},a=R=>{this.doNotifyTimeout(R,"negative","top",1e4)},m=(R,M=!1)=>{this.doNotify(R,M?"warning":"positive","top")},p=R=>this.findhighestPrio(R);let g=R=>this.getSmallestScoreInterval(R),O=R=>{console.log("onDismissy>> ",R,d.length),d.length>0&&setTimeout(()=>{t?b(d,C):c(d,C)},0)},b=(R,M)=>{console.log(`fixConflicts::removeWithID with toKeep=${R.length} `,l==null?void 0:l.time);let w=[],A=!1;for(M.forEach((f,V,j)=>{if(R.find(_=>_.id==f.id))if(f.id==S.id){let _=y.has(f.id)?y.get(f.id):"",k=h.has(f.id)?h.get(f.id):h.get(S.id),J=this.daSchedule.getStoredRawEvt(f.id);J&&(JSON.parse(JSON.stringify(f)),Object.assign(f,J,{time:k.time}));let ie=e=="onDrop"?this.daSchedule.doUpdateSchedule(f,k)||{}:this.daSchedule.addGoalsToSchedule([{...f,time:k.time}],!1);if(Object.keys(ie).length>0)console.log("fixConflicts::removeWithID::OVERLAP on add",ie,f,k.time),w.push(ie);else{let we=`${_} ${de?"Moving":"Adding"} '${f==null?void 0:f.title.trim()}' at ${F(k.time)}`;this.doNotify(we,"positive","top")}A=!0}else{console.log("fixConflicts::removeWithID....Keeping scheduled Evt!!",f.id,f.title,f.time,h.get(f.id));let _=this.daSchedule.stillInSchedule(f.id);if(_.inSched){let k=`${y.has(f.id)?y.get(f.id):""} Keeping scheduled '${f==null?void 0:f.title.trim()}'`;this.doNotify(k,"positive","top")}else{this.doLog("fixConflicts::removeWithID>>ERROR::scheduled was removed: "+f.id+" "+f.title,_),this.doNotify(`Re-adding ${f.title}`,"warning"),_.inStore?Object.assign(f,_.inStore):console.log("fixConflicts::removeWithID>>scheduled was removed >>NOT STORED!!TODO**");let k=this.daSchedule.addGoalsToSchedule([f],!0);k.length>0?w.push(k):console.log("fixConflicts::removeWithID>>scheduled was removed >>NO Overlaps!!")}}else if(f.id!=S.id){console.log("fixConflicts::removeWithID >>removing scheduled",f.id,f.title,f.time);let _=this.daSchedule.getCurrentMoods()[f.id];this.daSchedule.removeScheduledEvt(f);let k=`Removed scheduled '${f==null?void 0:f.title.trim()}'`;k=_?k+` With Moods: '${_}'`:k,this.doNotify(k,_?"negative":"warning"),A=!0}else e=="onDrop"?(console.log("fixConflicts::removeWithID >>Removing target onDrop!!",f.id,f.title,f.time),this.daSchedule.removeScheduledEvt(f)):console.log("fixConflicts::removeWithID >>NOT adding original target",S.id),this.daSchedule.deleteEvtMood(S.id),this.resetFilter()}),e=="onDrop"||A?(this.daSchedule.toggleActionBtns(!0,e),this.doCleanup()):console.log("fixConflicts::removeWithID...NO TOGGLING",e);w.length;){const f=w.pop();this.doLog(`${e}> fixConflicts::removeWithID:: OVERLAPS`,f),this.doNotify("EXTRA Overlaps to fix!","negative","top");let V=e.indexOf("view")>-1?e:e+"nah";return this.handleOverlaps(f,V)}return l?r(l,"removeWithID"):console.log("fixConflicts::removeWithID >> NO SCROLLING after conflicts",e,l,A),"removeWithID"},c=(R,M)=>{console.log(`fixConflicts::removeConflicts with toKeep=${R.length}`,l==null?void 0:l.time);let w=[],A=!1;for(M.forEach((f,V,j)=>{if(R.find(_=>_.id==f.id)){let _=y.has(f.id)?y.get(f.id):"",k=h.has(f.id)?h.get(f.id):null;if(f.id!=v.id){let J=this.daSchedule.getStoredRawEvt(f.id);J&&(JSON.parse(JSON.stringify(f)),Object.assign(f,J,{time:k.time}));let ie=e=="onDrop"?this.daSchedule.doUpdateSchedule(f,k)||{}:this.daSchedule.addGoalsToSchedule([{...f,time:k.time}],this.daSchedule.isViewingToday());if(ie&&Object.keys(ie).length>0)w.push(ie),this.doNotify(`Extra Overlaps while adding '${f==null?void 0:f.title.trim()}'`,"negative","top");else{let we=`${_} ${de?"Moving":"Adding"} '${f==null?void 0:f.title.trim()}' at ${F(k.time)}`;this.doNotify(we,"positive","top")}A=!0}else{let J=this.daSchedule.stillInSchedule(f.id);if(J.inSched)this.doNotify(`${_} Keeping scheduled '${f==null?void 0:f.title.trim()}' `,"positive","top");else{this.doLog("fixConflicts::removeConflicts>>ERROR::scheduled was removed: "+f.id+" "+f.title,J),this.doNotify(`Re-adding ${f.title}`,"warning"),J.inStore?Object.assign(f,J.inStore):console.log("fixConflicts::removeConflicts>>scheduled was removed >>NOT STORED!!TODO**");let ie=this.daSchedule.addGoalsToSchedule([f],!0);ie.length>0?w.push(ie):console.log("fixConflicts::removeConflicts>>scheduled was removed >>NO Overlaps!!")}}}else if(f.id==v.id){let _=this.daSchedule.getCurrentMoods()[f.id];this.daSchedule.removeScheduledEvt(f);let k=`Removed scheduled '${f==null?void 0:f.title.trim()}'`;k=_?k+` With Moods: '${_}'`:k,this.doNotify(k,_?"negative":"warning"),A=!0}else console.log("fixConflicts::removeConflicts >> NOT adding target ",f.id,f.title),this.daSchedule.deleteEvtMood(f.id),this.resetFilter()}),e.indexOf("view")>-1||A?this.daSchedule.toggleActionBtns(!0,e):console.log("fixConflicts::removeConflicts...NO TOGGLING",e,A);w.length;){const f=w.pop();this.doLog(`fixConflicts::removeConflicts::EXTRA OVERLAPS from ${e} `,f),this.doNotify("EXTRA Overlaps to fix","negative","top");let V=e.indexOf("view")>-1?e:e+"nah";return this.handleOverlaps(f,V)}return l?r(l,"removeConflicts"):console.log("removeConflicts::NO SCROLLING after conflicts",l,e,A),"removeConflicts"};const E=(R,M)=>{let w=[],A=M.filter(f=>!R.some(V=>V.id==f.id));for(console.log(`fixConflicts::forceAdd of ${R.length} hasOneToMany=${t} `+e,"allConflicts= "+M.length,l==null?void 0:l.time),M.forEach(f=>{if(R.find(V=>V.id==f.id)){let V=h.has(f.id)?h.get(f.id):null,j=this.daSchedule.getStoredRawEvt(f.id);j&&Object.assign(f,j,{time:V.time});let _=A.length>0?A[0]:null;_||(console.log("fixConflicts::forceAdd::ERROR as no scheduled?!?",A),_=M.find(J=>J.id!=f.id)),console.log(`fixConflicts::forceAdd...NEW:${f.id} '${f.title.trim()}' dura= ${f.duration} 
 
              origAt: ${f.time} added at>>`,V==null?void 0:V.time,"from>>"+e,`
 >> USING for change `+_.id+" "+(_==null?void 0:_.title),"hasOneToMany "+t);let k=this.daSchedule.recurChangeTime(_.id,f,V,e!="onDrop",a);if(k&&Object.keys(k).length>0)console.log("fixConflicts::forceAdd >>OVERLAP on add",k,f,V.time),w.push(k);else{let J=`Force ${de?"Moved":"Added"}  '${f==null?void 0:f.title.trim()}' at ${F(V.time)}`;this.doNotify(J,"positive","top")}}else t?e=="onDrop"?this.daSchedule.recurChangeTime(f.id,R[0],h.get(R[0].id),e!="onDrop",a):console.log("fixConflicts::forceAdd >> WITHID but nothing to do?",t,f.id):console.log("fixConflicts::forceAdd >>not WITHID >> NOTHING for scheduled",f.id,"Not onDrop: "+e!="onDrop")}),this.daSchedule.toggleActionBtns(!0,e);w.length;){const f=w.pop();return this.doLog("fixConflicts::forceAdd:: EXTRA OVERLAPS "+e,f),this.doNotify("EXTRA Overlaps to fix!","negative","top"),this.handleOverlaps(f,e+"nah")}return l&&r(l,"forceAdd"),"forceAdd"};let u=(R,M)=>{switch(R){case"score":this.confirmChoiceDialog("","Choose one event by Score",M.map(w=>this.betterEvtLabel(w,"score",!1)),"",function(w){let A=M.find(f=>f.id==w);if(A)d.push(A),y.set(A.id,`By Score Interval (${A.score}),`);else{console.log("chooseOneEvt::ERROR NOT FOUND!!",w);return}return A},null,function(){O("chooseOneEvt::>>byScore...")});return;case"prio":this.confirmChoiceDialog("","Choose one event by Priority",M.map(w=>this.betterEvtLabel(w,"prio",!1)),"",function(w){let A=M.find(f=>f.id==w);if(A)d.push(A),y.set(A.id,"By Priority,");else{console.log("chooseOneEvt::ERROR NOT FOUND!!",w);return}return A},null,function(){O("chooseOneEvt::>>byPriority...")});return;default:this.confirmChoiceDialog("","Choose which Event to keep",M.map(w=>this.betterEvtLabel(w,"default",!1)),"",function(w){let A=M.find(f=>f.id==w);if(A)d.push(A),y.set(A.id,"By pick,");else{console.log("chooseOneEvt::ERROR NOT FOUND!!",w);return}return A},null,function(){O("chooseOneEvt::>>byPick...")});return}},D=(R,M,w,A,f)=>{var V;if(R=="opt3")u("default",A);else if(R=="opt2")if(f)u("score",A);else{let j=g(A);j?(d.push(j),y.set(j.id,`By Shortest Score Interval (${j.score}),`)):(console.log("ERROR ERROR::fixConflicts >> smallestScoreInterval::No current set?",A),m("Umm...Score Error",!0),u("score",A))}else if(R=="opt1")if(f)u("prio",A);else{let j=p(A);console.log("fixConflicts::ByPriority >> AUTO "+e,j.e.id,(V=j==null?void 0:j.e)==null?void 0:V.title.trim()),d.push(j.e),y.set(j.e.id,`By Highest Priority (${j.prio}),`)}else R=="opt0"?(console.log("fixConflicts::AUTO:SOLVE >>",S,v,w,A),M.addIncSched?t?(d.push(S),y.set(S.id,"By Title Auto-Solve,")):(d.push(w[0]),y.set(w[0].id,"By Title Auto-Solve,")):t?(d.push(A[0]),y.set(A[0].id,"By Title Auto-Solve,")):(d.push(v),y.set(v.id,"By Title Auto-Solve,"))):E(w,A)},T=()=>{if(e=="onDrop"){m("Umm...not moving then...."),this.doCleanup();return}if(e.indexOf("byMood")>-1){console.log("fixConflicts::cancelChoice >>Mood update? canChooseOne:"+Y+" hasOneToMany "+t,S.id),this.daSchedule.deleteEvtMood(S.id);return}if(t){console.log("fixConflicts::cancelChoice::hasOneToMany from> ",e),m("Keeping Schedule as-is...");return}d.push(v)},h=new Map,y=new Map,d=[],S=null,v=null,C=[],N=[],z=!1,U=[];for(o.length;o.length;){const R=o.pop();let M=s(R.inConflict);if(!M){console.log("fixConflicts...ERROR ERROR no evts found!!!",R);return}let w=n(R.target);if(!w){console.log("fixConflicts...ERROR ERROR target evt not found!!!",R);return}h.set(R.target,R==null?void 0:R.targetStart),t?(S?S.id!==R.target&&console.log("fixConflicts::ERROR ERROR:: oneToManyConflict >>Not same target ID?!?",S,R,N,h):(S=w,N.push(w),C.unshift(w)),U.push(`'${M==null?void 0:M.title.trim()}'`),C.push(M),this.titleIncludes(S.title,M==null?void 0:M.title)):(v?v.id!==M.id&&console.log("fixConflicts::ERROR ERROR::manyToOneConflict Not same schedule?!?",v.id,M.id,R,N):(v=M,C.unshift(M),h.set(R.inConflict,R==null?void 0:R.targetStart)),U.push(`'${w==null?void 0:w.title.trim()}'`),this.titleIncludes(w==null?void 0:w.title,v==null?void 0:v.title),N.push(w),C.push(w)),R.direction=="surrounding"?z=!0:z=z}let te=U.join(" and "),Y=i[0]<3,me=!1;U.length<2&&(me=t?this.canAutoSchedule(S,C[0]):this.canAutoSchedule(N[0],v));let X=[],Se=Y?"Pick one event via ":"Auto-Resolve to keep Evt with ";if(me?(this.doLog("fixConflicts::AUTO-RESOLVE!! "+v.id+"hasOneToMany:"+t,me),X.unshift({label:"By Title Auto-resolve?",value:"opt0"}),X.push({label:"Manually Choose one event",value:"opt3"})):Y?X.push({label:"Manually Choose one event",value:"opt3"}):(X.push({label:"Manually Choose one event",value:"opt3"}),e=="byScore"?X.unshift({label:Se+`${Y?"Priority":"Highest Priority"}`,value:"opt1",color:"secondary"}):e=="byPrio"?X.unshift({label:Se+`${Y?"Score Interval":"Shortest Score Interval"}`,value:"opt2"}):X.unshift({label:Se+`${Y?"Priority":"Highest Priority"}`,value:"opt1",color:"secondary"},{label:Se+`${Y?"Score Interval":"Shortest Score Interval"}`,value:"opt2"})),!z&&!e.indexOf("nah")>-1){let R=t?`Force in > '${S==null?void 0:S.title.trim()}' ?`:`Force in > ${U.join()}`;X.push({label:R,value:"opt4"})}else{let R=e.indexOf("view")>-1&&Y;z&&Y&&(e.indexOf("onPickEvt")>-1||e.indexOf("adHocEvt")>-1||R)&&X.push({label:"Force in ?",value:"opt4"})}let de=e.indexOf("onDrop")>-1,it=e.indexOf("byMood")>-1,Re=`${de?"Cancel to keep as-is":Y&&X.length<=2||me||it?"Cancel to keep scheduled":""}`,ot=t?`${de?"Moving":"Adding"} (${S==null?void 0:S.id}) '${S==null?void 0:S.title.trim()}' at ${F((Ge=h.get(S.id))==null?void 0:Ge.time)} Conflicts with scheduled ${te}. 
 ${Re}`:`${de?"Moving":"Adding"} ${te} Conflicts with scheduled (${v==null?void 0:v.id}) '${v==null?void 0:v.title.trim()}' at ${F(v==null?void 0:v.time)}. 
 ${Re}`,lt=t?`OneToMany Conflicts #${i[1]+1}`:`ManyToOne Conflicts #${i[1]+1}`;this.radioChoiceDialog(lt,ot,X,"",function(R){D(R,me,N,C,Y)},Re!=""?T:null,function(){O("Main!")})},onPickEvent(o,e,t,i){if(this.closingDialog(),!o||!o.id){console.log("onPickEvent...ERROR nothing!",o,e,t,i),this.doNotify("No Goal selected..."),this.reset();return}const l=()=>{n&&(o.duration=i);let a=this.daSchedule.onPickEvent(o,this.targetDrop.timestamp,s,t,this.doNotifyTimeout);a.canContinue?t&&this.doNotify("What is Owed PAID! gg!","info","top"):a.overlaps&&Object.keys(a.overlaps).length>0?(t&&this.doNotify("Overlaps!-Balance Not Used!","negative","top"),this.handleOverlaps(a.overlaps,"onPickEvt")):this.doNotify("Error? onPickEvt :(","negative","bottom"),this.reset()};let s=this.isViewingPast()?!0:e,n=i!=o.duration,r=this.daSchedule.tooClose(this.targetDrop.timestamp,n?i:o.duration);if(r){if(console.log("onPickEvent::tooClose check FAIL!",r),r===!0){this.doNotify("Picking event TOO close to midnight!"),this.reset();return}if(s)this.doNotify(`'${o.title.trim()}' TOO close Buuut..FORCING!`,"warning","top");else{this.withActionNotify(`'${o.title.trim()}' TOO close to an Evt!!`,function(){console.log("onPickEvent::Force eh"),l()});return}}l()},onAddHocEvent(o,e,t,i,l){if(this.possibleRange||(this.possibleRange=this.startEndTimes),o.trim()==""){this.doNotify("Empty Goal title..."),this.closingDialog(),this.reset();return}let s=Ue(this.possibleRange[0]),n=i>15?B(s,{minute:parseInt(i)}):B(Ue(this.possibleRange[1]),{minute:15}),r=Math.floor(ee(s,n)/1e3/60),a=this.daSchedule.tooClose(s,r);if(a){if(console.log("onAddHocEvent::tooClose check FAIL!!",a),this.closingDialog(),a===!0){this.doNotify(`'${o}' Not added as over midnight!`);return}this.doNotify(`'${o}' too close to a scheduled Evt--Forcing!!`,"warning")}this.closingDialog();let m=this.daSchedule.saveNewGoal(s,o,e,t,r);if(m===0||m){let p=this.daSchedule.onAdHocEvent(m,s,l,this.doNotifyTimeout);if(p.canContinue)this.constructTree(),this.reset(),this.mobile&&this.adjustCurrentTime();else if(console.log("onAdHocEvent::OVERLAPS?",JSON.parse(JSON.stringify(p))),p.overlaps==null){this.doNotify("Error Adding this event :(","negative"),console.log("onAdHocEvent::ERROR not found?");return}else l&&this.doNotify("Overlaps!-Balance Not Used!","warning","top"),this.handleOverlaps(p.overlaps,"adHocEvt")}else console.log("onAdHocEvent::BOO ERROR no subID :(",m),this.doNotify("Error adding :(  Add Evt by select!","negative")},onEndNow(o){const e=()=>{let n=this.daSchedule.findSchedEvent(o);this.daSchedule.removeScheduledEvt(n),this.doNotify(`Removing "${n==null?void 0:n.title.trim()}" and Saving...`,"info"),this.doSaveSchedule()},t=n=>{this.daSchedule.reduceEvtDuration(o,n),this.doNotify("Reducing and Saving...","info")},i=n=>{const r=ae(new Date);let a=n.start,m=n.end;if(!Be(r,a,m,!0))return console.log("onEndNow::ERROR >> not in the middle of event?!? Nothing to do...",r.time,a.time,m.time,n),!1;let p=B(r,{minute:0}),g=ee(a,p);return Math.floor(g/1e3/60)};let l=this.daSchedule.findSchedEvent(o);if(!l){console.log("onEndNow::ERROR Evt not found!!!",o,l),this.doNotify("Error evt not in schedule?!","negative");return}let s=i(l);s?s<10?this.confirmAction("",`Less than 10mins remove?
 Cancel to just EndNow`,"Remove",e,function(){t(s)}):t(s):console.log("onEndNow...END",o,s,Number.isInteger(s))},onSaveScore(o,e,t=""){let i=re(o);if(i<-1){i==-89?(console.log("onSaveScore parsing error",i,o),this.doNotify("Score Parsing Error... YOU FOO! ")):this.doNotify("Score Error: higher# on lower#");return}this.daSchedule.updateNoteScore(e,o,t),t!==""&&!this.isViewingPast()&&this.doNotify("Note added...do Save eh!","warning","bottom")},onAddMins(o,e){let t=this.daSchedule.addMinsToEvt(o,e,this.doNotify);if(!t.canContinue){if(t.overlaps&&Object.keys(t.overlaps).length>0)return this.doNotify("Bumped into some Evts","warning","top"),this.movedIntoConflict(t.overlaps,!0,"onAddMins",e);this.doNotify("Add ERROR:(","negative","bottom")}},removeEvtInSchedule(o,e=!0){let t=!1,i=()=>{if(this.daSchedule.removeScheduledEvt(o),t||e){e&&(this.daSchedule.addToBalance(o),this.doNotify(`Balance change after removing '${o.title}'`,"warning","top")),this.doSaveSchedule();return}this.daSchedule.toggleActionBtns(!0,"view")},l=()=>{console.log("Cancelled remove.."),this.reset(),this.closingDialog()},s=()=>this.chooseAlternatives(o);if(this.isViewingPast()){if(o.duration<30){this.doNotify("Removing from the past... Check BALANCE!"),this.daSchedule.addToBalance(o),t=!0,i();return}this.chooseAlternatives(o);return}if(!this.daSchedule.isViewingToday()&&!this.mobile){t=this.daSchedule.getCurrentMoods()[o.id],console.log("Removing future evt"),i();return}let n=`Remove "${o.title}" ?`,r=this.daSchedule.getStoredRawEvt(o.id),a=this.daSchedule.getCurrentMoods()[o.id];a&&(t=!!r,n=n+` With Moods: '${a}'`),r||(e=!1);let m=e?"Remove (Balance affected)":"Schedule Change";o.duration>=30&&e?this.confirmCancelAction(m,n+` 
 Or choose an alternative?`,"Remove","Choose",i,s):this.confirmAction(m,n,"Remove",i,l)},defaultScheduleByOpts(){return[{label:"Filter out of current scheduled Evts",value:"filter"},{label:"Add Evts to current schedule",value:"add"},{label:"Reset current schedule",value:"reset"}]},betterEvtLabel(o,e,t=null){const i=(s,n)=>{if(s!=null&&s.parentGoal){let r=this.daSchedule.parentGoalById(s.parentGoal);return n?`Of '${r==null?void 0:r.title.trim()}' (${r==null?void 0:r.priority})`:`Of '${r==null?void 0:r.title.trim()}'`}return console.log("prioLabel..ERROR no PARENT found?",s),""};let l="";switch(e){case"score":return l=`${i(o,!1)} > "${o.title.trim()}" with Score:: ${o.score} = ${re(o.score)} `,l+=t?`@ ${F(o==null?void 0:o.time)} ++ ${o==null?void 0:o.duration} mins`:`for ${o==null?void 0:o.duration} mins`,{label:l,value:o.id};case"prio":return l=`"${o.title.trim()}" ${i(o,!1)} `,l+=t?`@ ${F(o==null?void 0:o.time)} ++ ${o==null?void 0:o.duration} mins`:`for ${o==null?void 0:o.duration} mins`,{label:l,value:o.id};default:return l=`"${o.title.trim()}" ${i(o,!0)} && Score:: ${o.score} = ${re(o.score)} ${t?` @ ${F(o==null?void 0:o.time)} ++ ${o==null?void 0:o.duration} mins`:`for ${o.duration} mins`}`,{label:l,value:o.id}}},getLargestScoreInterval(o){let e=0,t=null;for(let i of o){let l=re(i.score);l>-1&&l>=e&&(e=l,t=i)}return t},expandAll(){for(let o of this.treeGoals)this.expanded[o.label]=!0},getSmallestScoreInterval(o){let e=9,t=null;for(let i of o){let l=re(i.score);l>-1&&l<=e&&(e=l,t=i)}return t},findhighestPrio(o){let e=0,t=null;for(let i of o)if(i.parentGoal){let l=this.daSchedule.parentGoalById(i.parentGoal);l?l.priority>e&&(e=l.priority,t=i):console.log("findhighestPrio::ERROR no PARENT found?",i)}else console.log("findhighestPrio::ERROR EVT not found?",i);return{e:t,prio:e}},chooseAlternatives(o){let e=this.daSchedule.getAlternatives(),t=ae(new Date),i=o.time,l=t.date,s=o.title,n=this.daSchedule.isViewingToday();const r=b=>b.filter(c=>!this.daSchedule.getScheduledEvts().has(c.id)),a=b=>{let c=B(Z(l),{day:n?1:0}),E=B(Z(c.date),{day:1}),u=this.daSchedule.getEventsForDate(c.date),D={},T=null;u?D=u:console.log("chooseAlternatives::addInFutur EMPTY for >>...",c.date),b.forEach(h=>{if(T=this.daSchedule.getSubGoalByID(h),D[h]){console.log("addInFutur...ALREADY PRESENT",h,c.date,T==null?void 0:T.title.trim()),this.doNotify(`Alternative '${T==null?void 0:T.title.trim()}' already present on ${c.date}. Moving it to next day`,"warning");let y=this.daSchedule.getEventsForDate(E.date);if(y)if(!y[h])y[h]={duration:T==null?void 0:T.duration,time:i,notes:`Alt replace for '${s}'`};else{console.log("addInFutur...STILL PRESENT in next day:"+E.date,T.title.trim()),this.doNotify(`Booo! Alt '${T==null?void 0:T.title.trim()}' also present on ${E.date} :(( ...Check BALANCE!`),this.daSchedule.addToBalance(T);return}else y={},y[h]={duration:T.duration,time:i,notes:`Alt replace for '${s}'`};this.daSchedule.updateDaySchedule(E.date,y),this.doNotify(`Saving ${T.title} in ${E.date}`,"info","bottom")}else D[h]={duration:T.duration,time:i,notes:`Alt replace for '${s}'`}}),this.daSchedule.updateDaySchedule(c.date,D)},m=b=>{this.daSchedule.removeScheduledEvt(o);let c=e.find(D=>D.id==b);console.log("remReplace...Add at:",i,c.title,"usually at:"+c.time);let E=this.daSchedule.addGoalsToSchedule([{...c,time:i,notes:`Alt replace for '${s}'`}],!0),u=Object.keys(E).length;if(u>0)return console.log(`chooseAlternatives::removeReplace:: OVERLAPS again from ${c.length} overlaps =${u}`,c,E),this.doNotify(`Extra Overlaps while adding ${c.title.trim()}`,"negative"),this.handleOverlaps(E,"alts");this.daSchedule.saveDaySchedule(),this.doNotify(`Added Alt replacement '${c==null?void 0:c.title}' at ${i}`,"info")},p=b=>{this.doNotify(b)},g=()=>{this.daSchedule.removeScheduledEvt(o),this.daSchedule.addToBalance(o),this.doNotify(`Balance change after removing '${o.title}'`,"warning","top"),this.doSaveSchedule()};if(e=r(e),e.length==0){this.withActionNotify("...Alternatives already present!",g);return}let O=`First Evt to replace Removed ${n?"(today)":""} + an Extra evt for next day! ${n?"":"(today)"}`;this.checkBoxDialog(`Alternative for '${s}'`,O,e.map(b=>this.betterEvtLabel(b,"default",!1)),function(b){console.log("chooseAlternatives::opt",b),m(b.shift()),b.length>0?a(b):(console.log("chooseAlternatives::onOk...nothing to add?!?",e.length,b.length,e.length-b.length),p("No Alternative scheduled later :("))},function(){console.log("chooseAlternatives::onCancel")})},reset(){this.selectedItem=null,this.targetDrop=null,this.touchedItem=null,this.daSchedule.resetChosen(),this.possibleRange=null},doCleanup(){this.lastTarget&&(this.lastTarget.style.background="",this.lastTarget=null)},closeDialogWithReset(){this.showEvtDialog=!1,this.selectedItem=null,this.targetDrop=null,this.touchedItem=null,this.possibleRange=null},closingDialog(){this.showEvtDialog=!1},doLog(o,e){console.log(o,JSON.parse(JSON.stringify(e)))},onPrev(){let o=()=>{this.$refs.calendar.prev(),this.adjustCurrentTime()},e=()=>{setTimeout(o,1e3),this.doSaveSchedule()};this.saveScheduleDisabled?o():this.confirmAction("",`Save day: ${this.currentDate} changes?`,"Save",e,o)},onToday(){let o=()=>{this.$refs.calendar.moveToToday(),this.adjustCurrentTime()},e=()=>{setTimeout(o,1e3),this.doSaveSchedule()};this.saveScheduleDisabled?o():this.confirmAction("",`Save day: ${this.currentDate} changes?`,"Save",e,o)},onNext(){let o=()=>{this.$refs.calendar.next(),this.adjustCurrentTime()},e=()=>{setTimeout(o,1e3),this.doSaveSchedule()};this.saveScheduleDisabled?o():this.confirmAction("",`Save day: ${this.currentDate} changes?`,"Save",e,o)},onChange(){let o=this.daSchedule.onChangeViewDate(this.currentDate);if(!o.canContinue){if(o.overlaps&&o.overlaps.length>0)return this.handleOverlaps(o.overlaps,"view");this.doNotify(`Loaded schedule for ${this.currentDate}`,"positive","bottom"),this.adjustCurrentTime()}},onDragStart(o,e,t){if(this.isViewingPast()){this.doNotify("Editing past is no no!"),o.preventDefault();return}this.selectedItem=t},onDragEnter(o,e,t){if(e==="goal-item")o.preventDefault();else{if(this.targetDrop&&this.targetDrop.timestamp.time==t.timestamp.time)console.log("onDragEnter...calendar,SAME",this.targetDrop.timestamp.time);else{let i=o.target;i.style.background=this.selectedItem.bgcolor.includes("-")?"grey":this.selectedItem.bgcolor,this.lastTarget=i}this.targetDrop=t,o.preventDefault()}return!0},onDragOver(o,e,t){return o.preventDefault(),!0},onDragLeave(o,e,t){let i=o.target;return i.style.background="",!1},onDragEnd(o){},onDrop(o,e,t){let i=this.daSchedule.findSchedEvent(this.selectedItem.id);if(!i){console.log("onDrop ERROR",i,this.selectedItem);return}let l=null;if(e==="interval")l=t.timestamp;else if(e==="goal-item"&&this.targetDrop)l=this.targetDrop.timestamp;else{console.log("Cannot drop here YO!!",o,e,t,this.targetDrop);return}if(!l){console.log("ERROR...no timestamp YO!!",o,e,t,this.targetDrop);return}this.doDroppy(l,this.selectedItem)},onClickTime(o){this.targetDrop=o.scope,this.showEvtDialog=!0},onClickDate(o){console.log("onClickDate",o)},onClickInterval(o){console.log("onClickInterval",o)},onClickHeadIntervals(o){console.log("onClickHeadIntervals",o)},onClickHeadDay(o){console.log("onClickHeadDay",o)},onMouseDownTime({scope:o,event:e}){if(Ke(e)){if(this.mobile===!0&&this.anchorTimestamp!==null&&this.otherTimestamp!==null&&ue(this.anchorTimestamp)===ue(this.otherTimestamp)){this.otherTimestamp=o.timestamp,this.mouseDown=!1;return}this.mouseDown=!0,this.anchorTimestamp=o.timestamp,this.otherTimestamp=o.timestamp}},onMouseUpTime({scope:o,event:e}){if(this.mobile!==!0&&Ke(e)&&(this.otherTimestamp=o.timestamp,this.mouseDown=!1),!this.mousedown){let t=this.startEndTimes;if(t[1]==t[0])return;this.possibleRange=t,console.log("onMouseUpTime range change",this.possibleRange)}},onMouseMoveTime({scope:o,event:e}){this.mobile!==!0&&this.mouseDown===!0&&(this.otherTimestamp=o.timestamp)},onDblClickEvent(o,e){if(this.isViewingPast()){if(console.log("onDblClickEvent::ERROR?",e),e.duration<30){console.log("onDblClickEvent..baah too smoll smoll",e.title,e.duration),this.doNotify("umm Removing from the past..Soo Check BALANCE!"),this.daSchedule.addToBalance(e),this.daSchedule.removeScheduledEvt(e);return}this.chooseAlternatives(e),o.preventDefault();return}this.removeEvtInSchedule(e,!1),o.preventDefault()},onTouchHStart(o,e){return this.selectedItem=e,o.target.classList.add("my-header-drag"),o.preventDefault(),!0},onTouchStart(o,e){if(console.log("onTouchStart",o,e),o.type=="touchstart"){this.selectedItem=e;let t=document.elementFromPoint(o.changedTouches[0].clientX,o.changedTouches[0].clientY);if(t.parentNode.classList.contains("my-event"))t.parentNode.classList.add("my-event-drag"),this.touchedItem=t;else if(t.closest(".my-event"),t=t.parentNode,t.parentNode.classList.contains("my-event"))t.parentNode.classList.add("my-event-drag"),this.touchedItem=t;else{this.touchedItem=!1;return}return o.preventDefault(),!0}console.log("onTouchStart::ERROR...UNKNOWN",o)},onTouchHEvt(o,e){if(o.type=="touchmove"){let t=document.elementFromPoint(o.changedTouches[0].clientX,o.changedTouches[0].clientY);if(t.ariaLabel){let i=this.getLabelTime(t.ariaLabel);if(this.targetDrop){let l=ee(this.targetDrop,i);if(JSON.stringify(this.targetDrop)===JSON.stringify(i)&&l==0)return;this.lastTarget?(this.lastTarget.style.background="",t.style.background=this.selectedItem.bgcolor.includes("-")?"grey":this.selectedItem.bgcolor,this.lastTarget=t):(this.lastTarget=t,t.style.background=this.selectedItem.bgcolor.includes("-")?"grey":this.selectedItem.bgcolor)}this.targetDrop=i}return o.preventDefault(),!0}if(o.type=="touchend"){let t=document.elementFromPoint(o.changedTouches[0].clientX,o.changedTouches[0].clientY);if(t.ariaLabel){let i=this.getLabelTime(t.ariaLabel);this.targetDrop=i,this.doDroppy(this.targetDrop,this.selectedItem)}else this.targetDrop&&this.doDroppy(this.targetDrop,this.selectedItem);o.preventDefault(),o.stopPropagation();return}console.log("onTouchHEvt::UNKNOWN",o)},onTouchEvt(o,e){let t=i=>{let l=i.closest(".my-event");l.classList.contains("my-event-drag")&&l.classList.toggle("my-event-drag")};if(this.selectedItem||(console.log("onTouchEvt NULL Item >>ERROR?!? "+o.type,this.selectedItem,this.touchedItem),e=this.selectedItem),this.isViewingPast()){this.doNotify("Editing past is no no!"),t(this.touchedItem),o.preventDefault(),o.stopPropagation();return}if(o.type=="touchmove"){let i=document.elementFromPoint(o.changedTouches[0].clientX,o.changedTouches[0].clientY);if(i.ariaLabel){let l=this.getLabelTime(i.ariaLabel);if(this.targetDrop){let s=ee(this.targetDrop,l);if(JSON.stringify(this.targetDrop)===JSON.stringify(l)&&s==0)return;this.lastTarget?(this.lastTarget.style.background="",i.style.background=this.selectedItem.bgcolor.includes("-")?"grey":this.selectedItem.bgcolor,this.lastTarget=i):(this.lastTarget=i,i.style.background=this.selectedItem.bgcolor.includes("-")?"grey":this.selectedItem.bgcolor)}this.targetDrop=l,o.preventDefault();return}return}if(o.type=="touchend"){let i=document.elementFromPoint(o.changedTouches[0].clientX,o.changedTouches[0].clientY);if(!this.touchedItem)return;if(i.parentNode.classList.contains("my-event-drag"))console.log("onTouchEvt::END >>removing my-event-drag","isDisabledScoreEdit>> "+this.daSchedule.isDisabledScoreEdit[e.id],"mobileEnableScore>> "+this.daSchedule.mobileEnableScore[e.id]),i.parentNode.classList.remove("my-event-drag");else{let l=this.touchedItem.parentNode.classList.contains("my-event-drag");l?this.touchedItem.parentNode.classList.remove("my-event-drag"):console.log("onTouchEvt::END...target NO my-event-drag?",l,i,i.parentNode)}if(i.ariaLabel){let l=this.getLabelTime(i.ariaLabel);this.targetDrop=l,this.doDroppy(this.targetDrop,this.selectedItem)}else(i.classList.contains("title")||i.classList.contains("my-event"))&&this.targetDrop&&this.doDroppy(this.targetDrop,this.selectedItem);o.preventDefault(),o.stopPropagation();return}console.log("onTouchEvt::UNKNOWN",o)},getLabelTime(o){let e=o.split(" "),t=e[e.length-2],i=B(Z(this.currentDate),{minute:q(t)});return e[e.length-1]=="PM"?i.hour==12?i:B(Z(this.currentDate),{hour:12,minute:q(t)}):i.hour==12?B(Z(this.currentDate),{hour:-12,minute:q(t)}):i},onTouchHold({evt:o,...e},t){if(!this.mobile)return console.log("onTouchHold>>NOT MOBILE",o.type,"mobileEnableScore>> "+this.daSchedule.mobileEnableScore[t.id]),!0;let i=document.elementFromPoint(o.changedTouches[0].clientX,o.changedTouches[0].clientY);this.daSchedule.toggleEvtNoteScoreMobile(t.id);let l=i.closest(".my-event");i.classList.contains("title")&&i.parentNode.classList.contains("my-event-drag")?(console.log("onTouchHold...REMOVING my-event-drag"),i.parentNode.classList.remove("my-event-drag")):l&&l.classList.contains("my-event-drag")?l.classList.toggle("my-event-drag"):this.touchedItem&&(l=this.touchedItem.closest(".my-event"),l&&l.classList.contains("my-event-drag")?l.classList.toggle("my-event-drag"):console.log("ERROR...onTouchHold--class not found on Target!!",i,this.touchedItem)),this.daSchedule.isDisabledScoreEdit[t.id]&&!this.daSchedule.mobileEnableScore[t.id]&&this.onDblClickEvent(o,t)},scrollToEvent(o){this.$refs.calendar.scrollToTime(o.time,350)},scrollToTime(o,e=null){var t;if(this.$refs.calendar){let i=B(o,{minute:-10});(t=this.$refs.calendar)==null||t.scrollToTime(i.time,e?e=="fast"?400:1e3:500)}else setTimeout(()=>{console.log("scrollToTime::NO SCROLLY at",o.time,"Trying again...."),this.scrollToTime(o,"slow")},1e3)},confirmTimeChange(o,e,t,i,l,s,n=null){this.$q.dialog({title:o,message:e,cancel:"Cancel",ok:t,options:{type:"radio",model:"",items:[{label:t+" and "+i,value:"ok"},{label:i,value:"alt"}]},class:"overflow-wrap: break-word;",style:""}).onOk(r=>{if(r==""){console.log("confirmTimeChange onOk with no selection >>onDismiss"),this.doNotify("No selection made...Leaving as is","info"),n?n():console.log("confirmTimeChange:: No Dismiss func to execute!");return}return l(r)}).onCancel(()=>{s()})},radioChoiceDialog(o,e,t,i,l=null,s=null,n=null){this.$q.dialog({title:o,cancel:!!s,persistent:!0,message:e,seamless:!0,options:{type:"radio",model:i,items:t}}).onOk(r=>{l&&(r===""?this.radioChoiceDialog(o,e,t,i,l,s,n):l(r))}).onCancel(()=>{s&&s()}).onDismiss(()=>{n&&n()})},checkBoxDialog(o,e,t,i=null,l=null,s=null){let n=t.length,r=n>2?2:n;this.$q.dialog({title:o,message:e,options:{type:"checkbox",model:[],isValid:a=>a.length>0&&a.length>=r,items:t},cancel:!0,persistent:!0,class:"overflow-wrap: break-word;",style:""}).onOk(a=>{i(a)}).onCancel(()=>{l&&l()}).onDismiss(()=>{s&&s()})},confirmChoiceDialog(o,e,t,i,l=null,s=null,n=null){this.$q.dialog({title:o,cancel:!!s,persistent:!0,message:e,options:{type:"radio",model:i,items:t}}).onOk(r=>{l&&(r===""?this.confirmChoiceDialog(o,e,t,i,l,s,n):l(r))}).onCancel(()=>{s&&s()}).onDismiss(()=>{n&&n()})},scheduleByDialog(o,e,t,i,l=null,s=null,n=null){this.$q.dialog({component:ni,componentProps:{title:o,message:e,options:t,selectedO:i}}).onOk(r=>{l&&(r.choice==""?this.scheduleByDialog(o,e,t,i,l,s,n):l(r))}).onCancel(()=>{s&&s()}).onDismiss(()=>{n&&n()})},confirmAction(o,e,t,i,l,s=null){this.$q.dialog({title:o,cancel:!0,ok:t,message:e}).onOk(()=>{i()}).onCancel(()=>{l()}).onDismiss(()=>{if(s){s();return}})},confirmCancelAction(o,e,t,i,l,s,n=null){this.$q.dialog({title:o,cancel:i,ok:t,message:e}).onOk(()=>{l()}).onCancel(()=>{s()}).onDismiss(()=>{if(n){n();return}})},doNotifyTimeout(o,e=void 0,t="top",i=null){this.$q.notify({color:e!==void 0?e:"negative",position:t,message:o,icon:e==null?"report_problem":"thumb_up",timeout:i||5e3,multiLine:!0})},doNotify(o,e=void 0,t="top"){this.$q.notify({color:e!==void 0?e:"negative",position:t,message:o,multiLine:!0,icon:e==null?"report_problem":"thumb_up"})},withActionNotify(o,e=null,t=void 0,i="top",l=null){this.$q.notify({color:t!==void 0?t:"negative",position:i,message:o,icon:t==null?"report_problem":"thumb_up",onDismiss:l,actions:[{label:"Force?",color:"yellow",handler:()=>{e?e():console.log("withActionNotify::ActionHandler::NOTHING...")}}]})}}},xe=o=>(Dt("data-v-385ca7be"),o=o(),Ct(),o),ai={class:"subcontent"},di={key:0,class:"q-pa-sm bg-grey-12"},hi={class:"q-pa-sm row justify-center"},ci={key:0,class:"q-pa-sm row justify-center labely"},ui={class:"row justify-center"},fi={class:"q-px-md boxy"},gi={key:0},mi={key:1},Si={key:2},pi={key:3},yi={key:4},vi={key:5},bi={key:6},Ti={class:"row justify-center"},Oi=xe(()=>H("br",null,null,-1)),Di={key:0,class:"q-gutter-md q-pa-sm bg-grey-12"},Ci={class:"q-mr-sm text-weight-bold",size:"28px"},Ei={key:0},Ri={class:"text-weight-bold"},wi={key:1,class:"text-weight-light text-black"},Ni=xe(()=>H("br",null,null,-1)),Ai={class:"instru"},Pi={key:0,class:"row q-px-md"},Mi={class:"row justify-center"},$i={class:"q-gutter-md",style:{display:"flex","max-width":"800px",width:"100%",height:"600px"}},ki={style:{display:"flex","justify-content":"center","flex-wrap":"wrap",padding:"2px"}},_i=["onDragstart","onTouchstart","onTouchmove","onTouchend"],Bi=["onDblclick","onDragstart","onTouchstart","onTouchmove","onTouchend"],Ii=xe(()=>H("br",null,null,-1));function Li(o,e,t,i,l,s){const n=le("sched-btn"),r=le("drop-dwn-btn"),a=le("da-instructions"),m=le("navigation-bar"),p=le("goaly-end"),g=le("mobileNoteScore"),O=le("q-calendar-day"),b=le("sched-dialog");return P(),Q(It,{padding:""},{default:L(()=>[H("div",ai,[$(je,{modelValue:l.splitterPage,"onUpdate:modelValue":e[11]||(e[11]=c=>l.splitterPage=c),limits:[30,70]},{before:L(()=>[$(je,{modelValue:l.splitterLegend,"onUpdate:modelValue":e[4]||(e[4]=c=>l.splitterLegend=c),horizontal:"",limits:[20,80],style:{height:"100%"}},{before:L(()=>[l.treeGoals.length>0?(P(),G("div",di,[H("div",hi,K(s.labelScheduled().sched),1),s.labelScheduled().noTime?(P(),G("div",ci,K(s.labelScheduled().noTime)+" Evts Need manual addition! ",1)):x("",!0),H("div",ui,[$(Oe,{color:"secondary","multi-line":""},{default:L(()=>[oe(K(s.labelBalance())+" mins ",1)]),_:1})]),$(De)])):x("",!0),H("div",fi,[s.scheduleProps.showReloadBtn?(P(),G("div",gi,[$(n,{"text-label":"Reload",class:"sched-btn","text-color":"green",onDoBtnAction:s.onReloadSaved},null,8,["onDoBtnAction"])])):x("",!0),s.scheduleProps.showClearBtn?(P(),G("div",mi,[$(n,{"text-label":"Clear",class:"sched-btn","text-color":"lime-5",onDoBtnAction:s.onClearDay},null,8,["onDoBtnAction"])])):x("",!0),s.doShowActionBtns?(P(),G("div",Si,[$(n,{textLabel:s.defaultBtnLabel,isDisabled:s.isDefaultBtnEnabled,class:"sched-btn","text-color":"blue",onDoBtnAction:s.onLoadDefault},null,8,["textLabel","isDisabled","onDoBtnAction"])])):x("",!0),s.doShowActionBtns?(P(),G("div",pi,[$(r,{class:"sched-drop-btn","text-color":"teal",disableBtn:s.scheduleProps.disableScoreBtn,optionLabel:s.chosenScoreLabel,daOptions:l.scoreOptions,onDoReload:s.doReloadWithScore,onChooseOption:s.onChoosenScore},null,8,["disableBtn","optionLabel","daOptions","onDoReload","onChooseOption"])])):x("",!0),s.doShowActionBtns?(P(),G("div",yi,[$(r,{class:"sched-drop-btn","text-color":"teal",disableBtn:s.scheduleProps.disablePrioBtn,optionLabel:s.chosenPrioLabel,daOptions:s.allMainGPrio(),onDoReload:s.doReloadWithPrio,onChooseOption:s.onChoosenPrio},null,8,["disableBtn","optionLabel","daOptions","onDoReload","onChooseOption"])])):x("",!0),s.doShowActionBtns?(P(),G("div",vi,[$(n,{"text-label":"One Each",class:"sched-btn","text-color":"brown",onDoBtnAction:s.onScheduleOneEach},null,8,["onDoBtnAction"])])):x("",!0),s.doShowActionBtns?(P(),G("div",bi,[l.showTree?x("",!0):(P(),Q(n,{key:0,"text-label":l.showTree?"HideTree":"By Moods",class:"sched-btn","text-color":"purple",onDoBtnAction:e[0]||(e[0]=c=>l.showTree=!l.showTree)},null,8,["text-label"]))])):x("",!0)]),H("div",Ti,[$(Ce,{class:"q-mt-md","text-color":s.saveScheduleDisabled?"grey":"blue",elevated:"",push:"",align:"evenly",label:"SaveSchedule",disable:s.saveScheduleDisabled,onClick:s.doSaveSchedule,"no-caps":""},null,8,["text-color","disable","onClick"]),l.showTree||s.isViewingPast()?(P(),Q(Ce,{key:0,class:"q-mt-md","text-color":"green",elevated:"",push:"",align:"evenly",label:l.showTree?"HideTree":"ShowTree",onClick:e[1]||(e[1]=()=>{l.showTree&&s.resetFilter(),l.showTree=!l.showTree}),"no-caps":""},null,8,["label"])):x("",!0)]),Oi]),after:L(()=>[s.showTreeForm?(P(),G("div",Di,[$(At,{overline:"",header:"",lines:"3"},{default:L(()=>[oe(" Filter by Mood / Expand & Hover for Moods ")]),_:1}),$(Mt,{label:s.isViewingPast()?"Disabled In Past :(":"je-suis",hint:"Keyword >> Enter","hide-hint":"",ref:"filterRef",modelValue:l.filter,"onUpdate:modelValue":e[2]||(e[2]=c=>l.filter=c),"use-input":"","use-chips":"",multiple:"",disable:s.isViewingPast(),"hide-dropdown-icon":"","input-debounce":"0","new-value-mode":"add-unique",class:"q-gutter-sm"},{"selected-item":L(c=>[$($t,{removable:"",dense:"",onRemove:E=>c.removeAtIndex(c.index),tabindex:c.tabindex,"text-color":"black",class:"q-ma-none",style:{width:"80px"}},{default:L(()=>[oe(K(c.opt),1)]),_:2},1032,["onRemove","tabindex"])]),append:L(()=>[l.filter.length>0?(P(),Q(Me,{key:0,name:"clear",class:"cursor-pointer",onClick:s.resetFilter},null,8,["onClick"])):x("",!0)]),_:1},8,["label","modelValue","disable"]),$(Lt,{nodes:l.treeGoals,"node-key":"label",filter:s.filterString,"filter-method":s.myFilterMethod,expanded:l.expanded,"onUpdate:expanded":e[3]||(e[3]=c=>l.expanded=c),"no-connectors":"",dense:""},{"default-header":L(c=>[H("div",{class:ve(s.classyColor(c.node))},[c.node.isChildren?x("",!0):(P(),Q(Me,{key:0,name:c.expanded?"expand_less":"expand_more",size:"28px",right:""},null,8,["name"])),H("div",Ci,K(c.node.label),1),$(Me,{name:c.node.icon},null,8,["name"])],2)]),"default-body":L(c=>[c.node.isChildren?(P(),G("div",Ei,[H("span",Ri," >> "+K(c.node.details),1),c.node.moods.length>0?(P(),Q(_e,{key:0},{default:L(()=>[oe(K("Moods::> "+c.node.moods.join(",")),1)]),_:2},1024)):x("",!0)])):(P(),G("span",wi,K(c.node.details),1))]),_:1},8,["nodes","filter","filter-method","expanded"]),Ni,l.filter.length>0?(P(),Q(n,{key:0,"text-label":"Add Mood Evts",class:"q-mt-xl sched-btn","text-color":"red",onDoBtnAction:s.onMoodAdd},null,8,["onDoBtnAction"])):x("",!0)])):x("",!0)]),_:1},8,["modelValue"]),H("div",Ai,[$(Ze,{modelValue:l.showInstru,"onUpdate:modelValue":e[5]||(e[5]=c=>l.showInstru=c),label:l.showInstru?"Hide Instructions":"Show Instructions",color:"teal",class:"q-pa-md q-mx-xl",align:"center"},null,8,["modelValue","label"]),l.showInstru?(P(),Q(a,{key:0,showRemInstru:s.showRemInstru,showSchedInstru:s.showSchedInstru},null,8,["showRemInstru","showSchedInstru"])):x("",!0)])]),separator:L(()=>[$(Tt,{color:"primary",class:"q-px-md","text-color":"white",size:"40px",icon:"drag_indicator",style:{position:"relative",top:"70%"}})]),after:L(()=>[$(m,{onToday:s.onToday,onPrev:s.onPrev,onNext:s.onNext},null,8,["onToday","onPrev","onNext"]),s.scheduleMoodsLabel?(P(),G("div",Pi,[oe(" By moods: "),(P(!0),G(ce,null,$e(s.scheduleMoodsLabel,(c,E)=>(P(),Q(Oe,{key:E,color:c.bg,"multi-line":"",rounded:""},{default:L(()=>[oe(K(c.m),1)]),_:2},1032,["color"]))),128))])):x("",!0),H("div",Mi,[H("div",$i,[$(O,{ref:"calendar",view:"day",modelValue:l.currentDate,"onUpdate:modelValue":e[10]||(e[10]=c=>l.currentDate=c),"drag-enter-func":s.onDragEnter,"drag-over-func":s.onDragOver,"drag-leave-func":s.onDragLeave,"drop-func":s.onDrop,animated:"",bordered:"",hoverable:"","no-active-date":"","transition-next":"slide-left","transition-prev":"slide-right","time-clicks-clamped":"","interval-minutes":15,"interval-count":96,"interval-height":28,"selected-start-end-dates":s.startEndTimes,onChange:s.onChange,onClickDate:s.onClickDate,onClickTime:s.onClickTime,onClickInterval:s.onClickInterval,onClickHeadIntervals:s.onClickHeadIntervals,onClickHeadDay:s.onClickHeadDay,onMousedownTime:s.onMouseDownTime,onMouseupTime:s.onMouseUpTime,onMousemoveTime:s.onMouseMoveTime},{"head-day-event":L(({scope:{timestamp:c}})=>[H("div",ki,[(P(!0),G(ce,null,$e(s.eventsMap[c.date],E=>(P(),G(ce,{key:E.id},[E.time?(P(),Q(Oe,{key:1,class:ve(s.badgeClasses(E,"header")),style:be([s.badgeStyles(E,"header"),{margin:"1px",width:"10px","max-width":"10px",height:"10px","max-height":"10px",cursor:"pointer"}]),onClick:u=>s.scrollToEvent(E)},{default:L(()=>[$(_e,null,{default:L(()=>[oe(K("("+E.id+") "+E.title+" - "+E.time+" ("+E.duration+"min) >> "+E.end.time),1)]),_:2},1024)]),_:2},1032,["class","style","onClick"])):(P(),G("div",{key:0,draggable:!0,style:{width:"100%",cursor:"grab",height:"12px","font-size":"10px",margin:"5px"},class:"heady",onDragstart:Te(u=>s.onDragStart(u,"header-item",E),["stop"]),onTouchstart:u=>s.onTouchHStart(u,E),onTouchmove:u=>s.onTouchHEvt(u,E),onTouchend:u=>s.onTouchHEvt(u,E)},[$(Oe,{class:ve(s.badgeClasses(E,"header-item"))},{default:L(()=>[oe(K(E.title)+" ",1),$(_e,null,{default:L(()=>[oe("Drag to schedule >> "+K(E.duration)+"min ",1)]),_:2},1024)]),_:2},1032,["class"])],40,_i))],64))),128))])]),"day-container":L(({scope:{days:c}})=>[s.hasDate(c)?(P(),G(ce,{key:0},[H("div",{class:"day-view-current-time-indicator",style:be(s.style)},null,4),H("div",{class:"day-view-current-time-line",style:be(s.style)},null,4)],64)):x("",!0)]),"day-body":L(({scope:{timestamp:c,timeStartPos:E,timeDurationHeight:u}})=>[(P(!0),G(ce,null,$e(s.getDateEvents(c.date),D=>(P(),G(ce,{key:D.id},[D.time?(P(),G("div",{key:0,class:ve(["my-event",s.badgeClasses(D,"body")]),style:be(s.badgeStyles(D,"body",E,u)),draggable:!0,onDblclick:Te(T=>s.onDblClickEvent(T,D),["prevent"]),onDragstart:Te(T=>s.onDragStart(T,"goal-item",D),["stop"]),onDragend:e[6]||(e[6]=Te((...T)=>s.onDragEnd&&s.onDragEnd(...T),["stop"])),onDrop:e[7]||(e[7]=T=>s.onDrop(T,"goal-item",o.scope)),onDragenter:e[8]||(e[8]=T=>s.onDragEnter(T,"goal-item",o.scope)),onDragover:e[9]||(e[9]=T=>s.onDragOver(T,"goal-item",o.scope)),onTouchstart:T=>s.onTouchStart(T,D),onTouchmove:T=>s.onTouchEvt(T,D),onTouchend:T=>s.onTouchEvt(T,D)},[Ot($(p,{disabledScore:l.daSchedule.isDisabledScoreEdit[D.id],title:D.title,id:D.id,startTime:D.time,score:D.score,details:D.details,notes:D.notes,icon:D.icon,happeningNow:l.daSchedule.hasStarted[D.id]?l.daSchedule.hasStarted[D.id]:!1,onEndNow:s.onEndNow,onSaveScore:s.onSaveScore,onAddMins:s.onAddMins,onDeleteNow:T=>s.removeEvtInSchedule(D)},null,8,["disabledScore","title","id","startTime","score","details","notes","icon","happeningNow","onEndNow","onSaveScore","onAddMins","onDeleteNow"]),[[Gt,T=>s.onTouchHold(T,D),"400:12:15"]]),s.showEvtMobile(D.id)?(P(),Q(g,{key:0,title:D.title,id:D.id,startTime:D.time,score:D.score,details:D.details,notes:D.notes,"show-dialog":s.showEvtMobile(D.id),onSaveScore:s.onSaveScore,onDeleteNow:T=>s.removeEvtInSchedule(D),onEuhHidin:T=>l.daSchedule.euhHidin(D.id)},null,8,["title","id","startTime","score","details","notes","show-dialog","onSaveScore","onDeleteNow","onEuhHidin"])):x("",!0)],46,Bi)):x("",!0)],64))),128))]),_:1},8,["modelValue","drag-enter-func","drag-over-func","drag-leave-func","drop-func","selected-start-end-dates","onChange","onClickDate","onClickTime","onClickInterval","onClickHeadIntervals","onClickHeadDay","onMousedownTime","onMouseupTime","onMousemoveTime"])])]),Ii]),_:1},8,["modelValue"]),l.showEvtDialog?(P(),Q(b,{key:0,parentGoals:l.daSchedule.allPGoals(),canBeScheduled:s.canbeScheduled,balance:s.currentBalance,selectedTime:s.selectedTimeInterval(),onAdHocEvent:s.onAddHocEvent,onOnPickEvent:s.onPickEvent,onEuhHidin:s.closingDialog},null,8,["parentGoals","canBeScheduled","balance","selectedTime","onAdHocEvent","onOnPickEvent","onEuhHidin"])):x("",!0)])]),_:1})}var zi=Xe(ri,[["render",Li],["__scopeId","data-v-385ca7be"]]);export{zi as default};
